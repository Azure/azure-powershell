#### New-AzCloudHsm

#### SYNOPSIS
Creates a Cloud HSM.

#### SYNTAX

```powershell
New-AzCloudHsm -Name <String> -ResourceGroupName <String> -Location <String> [-SubscriptionId <String>]
 [-DomainNameLabelScope <String>] [-Sku <String>] [-Tag <Hashtable>] [-UserAssignedIdentity <String[]>]
 [-DefaultProfile <PSObject>] [-AsJob] [-NoWait] [-Confirm] [-WhatIf] [<CommonParameters>]
```

#### EXAMPLES

+ Example 1: Create Cloud HSM with Tags
```powershell
New-AzCloudHsm -name myCloudHsm -resourcegroupname group -location UkWest -Tag @{ CloudHsmRegion = "UkWest"; Department = "Engineering"}
```

```output
ActivationState                   : NotActivated
AutoGeneratedDomainNameLabelScope : TenantReuse
Hsm                               : {}
Id                                : /subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxxx/resourceGroups/group/providers/Microsoft.HardwareSecurityModules/cloudHsmClusters/myCloudHsm
IdentityPrincipalId               :
IdentityTenantId                  :
IdentityType                      :
IdentityUserAssignedIdentity      : {
                                    }
Location                          : UkWest
Name                              : myCloudHsm
PrivateEndpointConnection         : {}
ProvisioningState                 : Succeeded
PublicNetworkAccess               : Disabled
ResourceGroupName                 : group
SkuCapacity                       :
SkuFamily                         : B
Sku                               : Standard_B1
StatusMessage                     : HSM cluster provisioning successful.
SystemDataCreatedAt               : 26/05/2025 8:28:36 am
SystemDataCreatedBy               : username@microsoft.com
SystemDataCreatedByType           : User
SystemDataLastModifiedAt          : 26/05/2025 8:28:36 am
SystemDataLastModifiedBy          : username@microsoft.com
SystemDataLastModifiedByType      : User
Tag                               : {
                                      "Department": "Engineering",
                                      "CloudHsmRegion": "UkWest"
                                    }
Type                              : Microsoft.HardwareSecurityModules/cloudHsmClusters

```

This command creates a Cloud HSM names myCloudHsm, in the Azure region UK West.
The command adds the cloud HSM to the resource group named group and adds 2 tags.
Because the command does not specify a value for the SKU parameter, it creates a cloud HSM with the default SKU Standard_B1.

+ Example 2: Create Cloud HSM with User Assigned Identity
```powershell
New-AzCloudHsm -name myCloudHsm -resourcegroupname group -location UkWest -Sku "Standard_B1" -UserAssignedIdentity  "/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxxx/resourceGroups/group/providers/Microsoft.ManagedIdentity/userAssignedIdentities/identity"

```

```output
ActivationState                   : NotActivated
AutoGeneratedDomainNameLabelScope : TenantReuse
Hsm                               : {}
Id                                : /subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxxx/resourceGroups/group/providers/Microsoft.HardwareSecurityModules/cloudHsmClusters/myCloudHsm
IdentityPrincipalId               :
IdentityTenantId                  :
IdentityType                      :UserAssigned
IdentityUserAssignedIdentity      : {
                                      "/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxxx/resourceGroups/group/providers/Microsoft.ManagedIdentity/userAssignedIdentities/identity": {
                                      }
                                    }
Location                          : UkWest
Name                              : myCloudHsm
PrivateEndpointConnection         : {}
ProvisioningState                 : Succeeded
PublicNetworkAccess               : Disabled
ResourceGroupName                 : group
SkuCapacity                       :
SkuFamily                         : B
Sku                               : Standard_B1
StatusMessage                     : HSM cluster provisioning successful.
SystemDataCreatedAt               : 26/05/2025 8:28:36 am
SystemDataCreatedBy               : username@microsoft.com
SystemDataCreatedByType           : User
SystemDataLastModifiedAt          : 26/05/2025 8:28:36 am
SystemDataLastModifiedBy          : username@microsoft.com
SystemDataLastModifiedByType      : User
Tag                               : {}
Type                              : Microsoft.HardwareSecurityModules/cloudHsmClusters
```

This command creates a Cloud HSM names myCloudHsm, in the Azure region UK West.
The command adds the cloud HSM to the resource group named group with Standard_B1 SKU.
The command associates user assigned identity named "identity" with the cloud HSM resource.


#### Backup-AzCloudHsm

#### SYNOPSIS
Begin a backup of the Cloud HSM.

#### SYNTAX

```powershell
Backup-AzCloudHsm -ClusterName <String> -ResourceGroupName <String> [-SubscriptionId <String>]
 [-BlobContainerUri <String>] [-DefaultProfile <PSObject>] [-AsJob] [-NoWait] [-Confirm] [-WhatIf]
 [<CommonParameters>]
```

#### EXAMPLES

+ Example 1:  Backup a Cloud HSM.
```powershell
Backup-AzCloudHsm -ClusterName chsm1 -ResourceGroupName group -BlobContainerUri  "https://{accountName}.blob.core.windows.net/{containerName}"
```

```output
AdditionalInfo               :
AzureStorageBlobContainerUri : https://backup.blob.core.windows.net/testbackup
BackupId                     : cloudhsm-eb0e0bf9-9d12-4201-b38c-567c8a452dd5-2025061208354444
Code                         :
Detail                       :
EndTime                      : 12/06/2025 8:35:54 am
JobId                        : 472f1c6185d74e78bf796c9a8e993a42
Message                      :
StartTime                    : 12/06/2025 8:35:44 am
Status                       : Succeeded
StatusDetail                 : HSM Backup Time: 6/12/2025 8:17:27 AM +00:00 UTC.
Target                       :
XmsRequestId                 : 378da564-737d-4f40-86f5-9623e19c74e1
```

The cmdlet will create a folder (typically named `cloudhsm-{guid}-{timestamp}`) in the storage container, store the backup in that folder and output the folder URI.


#### Get-AzCloudHsm

#### SYNOPSIS
Gets Cloud HSMs.

#### SYNTAX

+ List1 (Default)
```powershell
Get-AzCloudHsm [-SubscriptionId <String[]>] [-DefaultProfile <PSObject>] [<CommonParameters>]
```

+ Get
```powershell
Get-AzCloudHsm -Name <String> -ResourceGroupName <String> [-SubscriptionId <String[]>]
 [-DefaultProfile <PSObject>] [<CommonParameters>]
```

+ List
```powershell
Get-AzCloudHsm -ResourceGroupName <String> [-SubscriptionId <String[]>] [-DefaultProfile <PSObject>]
 [<CommonParameters>]
```

#### EXAMPLES

+ Example 1: Get all Cloud HSMs in your current subscription
```powershell
Get-AzCloudHsm
```

```output
IdentityPrincipalId IdentityTenantId IdentityType Location      Name                 SkuCapacity SkuFamily SkuName
------------------- ---------------- ------------ --------      ----                 ----------- --------- -------
                                     UserAssigned ukwest        chsm1                      B         Standard_B1
                                     UserAssigned ukwest        chsm2                      B         Standard_B1```

This command gets all the Cloud HSMs in your current subscription

+ Example 2:  Get a specific Cloud HSM 
```powershell
Get-AzCloudHsm -Name chsm1
```

```output
ActivationState                   : NotActivated
AutoGeneratedDomainNameLabelScope : TenantReuse
Hsm                               : {}
Id                                : /subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxxx/resourceGroups/group/providers/Microsoft.HardwareSecurityModules/          cloudHsmClusters/chsm1
IdentityPrincipalId               :
IdentityTenantId                  :
IdentityType                      :
IdentityUserAssignedIdentity      : {
                                    }
Location                          : UkWest
Name                              : chsm1
PrivateEndpointConnection         : {}
ProvisioningState                 : Succeeded
PublicNetworkAccess               : Disabled
ResourceGroupName                 : group
SkuCapacity                       :
SkuFamily                         : B
Sku                               : Standard_B1
StatusMessage                     : HSM cluster provisioning successful.
SystemDataCreatedAt               : 26/05/2025 8:28:36 am
SystemDataCreatedBy               : username@microsoft.com
SystemDataCreatedByType           : User
SystemDataLastModifiedAt          : 26/05/2025 8:28:36 am
SystemDataLastModifiedBy          : username@microsoft.com
SystemDataLastModifiedByType      : User
Tag                               : {
                                      "Department": "Engineering",
                                      "CloudHsmRegion": "UkWest"
                                    }
Type                              : Microsoft.HardwareSecurityModules/cloudHsmClusters
```

This command gets the Cloud HSM  named chsm1 in your current subscription.

+ Example 2:  Get a Cloud HSM in a resource group 
```powershell
Get-AzCloudHsm  -ResourceGroupName 'group'
```

```output
IdentityPrincipalId IdentityTenantId IdentityType Location      Name                 SkuCapacity SkuFamily SkuName
------------------- ---------------- ------------ --------      ----                 ----------- --------- -------
                                     UserAssigned ukwest        chsm1                      B         Standard_B1
                                     UserAssigned ukwest        chsm2                      B         Standard_B1
```

This command gets all the Cloud HSMs in the resource group named group.


#### Remove-AzCloudHsm

#### SYNOPSIS
Deletes a Cloud HSM

#### SYNTAX

```powershell
Remove-AzCloudHsm -Name <String> -ResourceGroupName <String> [-SubscriptionId <String>]
 [-DefaultProfile <PSObject>] [-AsJob] [-NoWait] [-PassThru] [-Confirm] [-WhatIf] [<CommonParameters>]
```

#### EXAMPLES

+ Example 1: Deletes a Cloud HSM.
```powershell
Remove-AzCloudHsm -name chsm1 -resourcegroupname group
```

This command removes the Cloud HSM named chsm1 from the named resource group.
If you do not specify the resource group name, the cmdlet searches for the named Cloud HSM to delete in your current subscription.


#### Restore-AzCloudHsm

#### SYNOPSIS
Restore a backup of a Cloud HSM.

#### SYNTAX

```powershell
Restore-AzCloudHsm -ClusterName <String> -ResourceGroupName <String> -BackupId <String>
 -BlobContainerUri <String> [-SubscriptionId <String>] [-DefaultProfile <PSObject>] [-AsJob] [-NoWait]
 [-Confirm] [-WhatIf] [<CommonParameters>]
```

#### EXAMPLES

+ Example 1:   Restores a Cloud HSM from backup.
```powershell
Restore-AzCloudHsm 	-ClusterName chsm1 -ResourceGroupName group -BlobContainerUri "https://{accountName}.blob.core.windows.net/{containerName}" -BackupId cloudhsm-eb0e0bf9-9d12-4201-b38c-567c8a452dd5-2025052912032456
```

```output
AdditionalInfo               :
Code                         :
Detail                       :
EndTime                      : 12/06/2025 8:35:54 am
JobId                        : 472f1c6185d74e78bf796c9a8e993a42
Message                      :
StartTime                    : 12/06/2025 8:35:44 am
Status                       : Succeeded
Target                       :
XmsRequestId                 : 378da564-737d-4f40-86f5-9623e19c74e1
```

The example restores a backup stored in a folder named "cloudhsm-eb0e0bf9-9d12-4201-b38c-567c8a452dd5-2025052912032456" of a storage container "https://{accountName}.blob.core.windows.net/{containerName}"


#### Update-AzCloudHsm

#### SYNOPSIS
Updates the state of a Cloud HSM.

#### SYNTAX

```powershell
Update-AzCloudHsm -Name <String> -ResourceGroupName <String> [-SubscriptionId <String>] [-Tag <Hashtable>]
 [-UserAssignedIdentity <String[]>] [-DefaultProfile <PSObject>] [-AsJob] [-NoWait] [-Confirm] [-WhatIf]
 [<CommonParameters>]
```

#### EXAMPLES

+ Example 1: Update Cloud HSM to Add Tags
```powershell
Update-AzCloudHsm -name myCloudHsm -resourcegroupname group -Tag @{ CloudHsmRegion = "UkWest"; Department = "Engineering"; DepartmentNo = "1"}
```

```output
ActivationState                   : NotActivated
AutoGeneratedDomainNameLabelScope : TenantReuse
Hsm                               : {}
Id                                : /subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxxx/resourceGroups/group/providers/Microsoft.HardwareSecurityModules/cloudHsmClusters/myCloudHsm
IdentityPrincipalId               :
IdentityTenantId                  :
IdentityType                      :UserAssigned
IdentityUserAssignedIdentity      : {
                                      "/subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxxx/resourceGroups/group/providers/Microsoft.ManagedIdentity/userAssignedIdentities/identity": {
                                      }
                                    }
Location                          : UkWest
Name                              : myCloudHsm
PrivateEndpointConnection         : {}
ProvisioningState                 : Succeeded
PublicNetworkAccess               : Disabled
ResourceGroupName                 : group
SkuCapacity                       :
SkuFamily                         : B
SkuName                           : Standard_B1
StatusMessage                     : HSM cluster provisioning successful.
SystemDataCreatedAt               : 26/05/2025 8:28:36 am
SystemDataCreatedBy               : username@microsoft.com
SystemDataCreatedByType           : User
SystemDataLastModifiedAt          : 26/05/2025 8:28:36 am
SystemDataLastModifiedBy          : username@microsoft.com
SystemDataLastModifiedByType      : User
Tag                               : {
                                      "Department": "Engineering",
                                      "CloudHsmRegion": "UkWest",
                                      "DepartmentNo": "1"
                                    }
Type                              : Microsoft.HardwareSecurityModules/cloudHsmClusters
```

Adds 3 Tags to a Cloud HSM named myCloudHsm.

+ Example 2: Update Cloud HSM to add remove user Assigned Identity.
```powershell
Update-AzCloudHsm -name myCloudHsm -resourcegroupname group  -UserAssignedIdentity  @null
```

```output
ActivationState                   : NotActivated
AutoGeneratedDomainNameLabelScope : TenantReuse
Hsm                               : {}
Id                                : /subscriptions/xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxxx/resourceGroups/group/providers/Microsoft.HardwareSecurityModules/cloudHsmClusters/myCloudHsm
IdentityPrincipalId               :
IdentityTenantId                  :
IdentityType                      :
IdentityUserAssignedIdentity      : {
                                    }
Location                          : UkWest
Name                              : myCloudHsm
PrivateEndpointConnection         : {}
ProvisioningState                 : Succeeded
PublicNetworkAccess               : Disabled
ResourceGroupName                 : group
SkuCapacity                       :
SkuFamily                         : B
SkuName                           : Standard_B1
StatusMessage                     : HSM cluster provisioning successful.
SystemDataCreatedAt               : 26/05/2025 8:28:36 am
SystemDataCreatedBy               : username@microsoft.com
SystemDataCreatedByType           : User
SystemDataLastModifiedAt          : 26/05/2025 8:28:36 am
SystemDataLastModifiedBy          : username@microsoft.com
SystemDataLastModifiedByType      : User
Tag                               : {
                                      "Department": "Engineering",
                                      "CloudHsmRegion": "UkWest",
                                      "DepartmentNo": "1"
                                    }
Type                              : Microsoft.HardwareSecurityModules/cloudHsmClusters
```

Removes the User Assigned Identity named Identity from a Cloud HSM named myCloudHsm.


