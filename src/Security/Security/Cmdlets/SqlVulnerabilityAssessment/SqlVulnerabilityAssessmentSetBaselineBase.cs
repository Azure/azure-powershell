using Commands.Security;
using Microsoft.Azure.Commands.Security.Common;
using System.Management.Automation;
namespace Microsoft.Azure.Commands.SecurityCenter.Cmdlets.SqlVulnerabilityAssessment
{
    public abstract class SqlVulnerabilityAssessmentSetBaselineBase : SecurityCenterCmdletBase
    {
        [Parameter(ParameterSetName = ParameterSetNames.ResourceIdWithBaselineObject, Mandatory = true, HelpMessage = ParameterHelpMessages.ResourceId)]
        [Parameter(ParameterSetName = ParameterSetNames.ResourceIdWithBaselineLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.ResourceId)]
        [Parameter(ParameterSetName = ParameterSetNames.InputObjectBaselineWithResourceId, Mandatory = true, HelpMessage = ParameterHelpMessages.ResourceId)]
        [ValidateNotNullOrEmpty]
        public string ResourceId { get; set; }

        [Parameter(ParameterSetName = ParameterSetNames.ResourceIdWithBaselineObject, Mandatory = true, HelpMessage = ParameterHelpMessages.WorkspaceId)]
        [Parameter(ParameterSetName = ParameterSetNames.ResourceIdWithBaselineLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.WorkspaceId)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithBaselineObject, Mandatory = true, HelpMessage = ParameterHelpMessages.WorkspaceId)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithBaselineLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.WorkspaceId)]
        [Parameter(ParameterSetName = ParameterSetNames.InputObjectBaselineWithResourceId, Mandatory = true, HelpMessage = ParameterHelpMessages.WorkspaceId)]
        [Parameter(ParameterSetName = ParameterSetNames.InputObjectBaselineWithOnPrem, Mandatory = true, HelpMessage = ParameterHelpMessages.WorkspaceId)]
        [ValidateNotNullOrEmpty]
        public string WorkspaceId { get; set; }

        [Parameter(ParameterSetName = ParameterSetNames.ResourceIdWithBaselineObject, Mandatory = true, HelpMessage = ParameterHelpMessages.Server)]
        [Parameter(ParameterSetName = ParameterSetNames.ResourceIdWithBaselineLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.Server)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithBaselineObject, Mandatory = true, HelpMessage = ParameterHelpMessages.Server)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithBaselineLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.Server)]
        [Parameter(ParameterSetName = ParameterSetNames.InputObjectBaselineWithResourceId, Mandatory = true, HelpMessage = ParameterHelpMessages.Server)]
        [Parameter(ParameterSetName = ParameterSetNames.InputObjectBaselineWithOnPrem, Mandatory = true, HelpMessage = ParameterHelpMessages.Server)]
        [ValidateNotNullOrEmpty]
        public string Server { get; set; }

        [Parameter(ParameterSetName = ParameterSetNames.ResourceIdWithBaselineObject, Mandatory = true, HelpMessage = ParameterHelpMessages.Database)]
        [Parameter(ParameterSetName = ParameterSetNames.ResourceIdWithBaselineLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.Database)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithBaselineObject, Mandatory = true, HelpMessage = ParameterHelpMessages.Database)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithBaselineLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.Database)]
        [Parameter(ParameterSetName = ParameterSetNames.InputObjectBaselineWithResourceId, Mandatory = true, HelpMessage = ParameterHelpMessages.Database)]
        [Parameter(ParameterSetName = ParameterSetNames.InputObjectBaselineWithOnPrem, Mandatory = true, HelpMessage = ParameterHelpMessages.Database)]
        [ValidateNotNullOrEmpty]
        public string Database { get; set; }

        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithBaselineObject, Mandatory = true, HelpMessage = ParameterHelpMessages.ComputerName)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithBaselineLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.ComputerName)]
        [Parameter(ParameterSetName = ParameterSetNames.InputObjectBaselineWithOnPrem, Mandatory = true, HelpMessage = ParameterHelpMessages.ComputerName)]
        [ValidateNotNullOrEmpty]
        public string ComputerName { get; set; }

        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithBaselineObject, Mandatory = true, HelpMessage = ParameterHelpMessages.VMUUID)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithBaselineLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.VMUUID)]
        [Parameter(ParameterSetName = ParameterSetNames.InputObjectBaselineWithOnPrem, Mandatory = true, HelpMessage = ParameterHelpMessages.VMUUID)]
        [ValidateNotNullOrEmpty]
        public string VMUUID { get; set; }

        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithBaselineObject, Mandatory = true, HelpMessage = ParameterHelpMessages.AgentId)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithBaselineLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.AgentId)]
        [Parameter(ParameterSetName = ParameterSetNames.InputObjectBaselineWithOnPrem, Mandatory = true, HelpMessage = ParameterHelpMessages.AgentId)]
        [ValidateNotNullOrEmpty]
        public string AgentId { get; set; }

        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithBaselineObject, Mandatory = true, HelpMessage = ParameterHelpMessages.WorkspaceResourceId)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithBaselineLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.WorkspaceResourceId)]
        [Parameter(ParameterSetName = ParameterSetNames.InputObjectBaselineWithOnPrem, Mandatory = true, HelpMessage = ParameterHelpMessages.WorkspaceResourceId)]
        [ValidateNotNullOrEmpty]
        public string WorkspaceResourceId { get; set; }


        [Parameter(ParameterSetName = ParameterSetNames.ResourceIdWithBaselineLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.UseLatest)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithBaselineLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.UseLatest)]
        public SwitchParameter UseLatest { get; set; }

        public string BuildDatabaseResourceId()
        {
            if (this.ParameterSetName == ParameterSetNames.InputObjectBaselineWithOnPrem
                || this.ParameterSetName == ParameterSetNames.OnPremMachinesWithBaselineLatest
                || this.ParameterSetName == ParameterSetNames.OnPremMachinesWithBaselineObject)
            {
                return $"{WorkspaceResourceId}/onPremiseMachines/{ComputerName}_{AgentId}_{VMUUID}/sqlServers/{Server}/databases/{Database}";
            }

            return $"{ResourceId}/sqlServers/{Server}/databases/{Database}";
        }
    }
}
