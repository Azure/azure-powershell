using Commands.Security;
using Microsoft.Azure.Commands.Security.Common;
using System.Management.Automation;
namespace Microsoft.Azure.Commands.SecurityCenter.Cmdlets.SqlVulnerabilityAssessment
{
    public abstract class SqlVulnerabilityAssessmentScanBase : SecurityCenterCmdletBase
    {
        [Parameter(ParameterSetName = ParameterSetNames.ResourceIdWithScanId, Mandatory = true, HelpMessage = ParameterHelpMessages.ResourceId)]
        [Parameter(ParameterSetName = ParameterSetNames.ResourceIdWithLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.ResourceId)]
        [ValidateNotNullOrEmpty]
        public string ResourceId { get; set; }

        [Parameter(ParameterSetName = ParameterSetNames.ResourceIdWithScanId, Mandatory = true, HelpMessage = ParameterHelpMessages.WorkspaceId)]
        [Parameter(ParameterSetName = ParameterSetNames.ResourceIdWithLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.WorkspaceId)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithScanId, Mandatory = true, HelpMessage = ParameterHelpMessages.WorkspaceId)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.WorkspaceId)]
        [ValidateNotNullOrEmpty]
        public string WorkspaceId { get; set; }

        [Parameter(ParameterSetName = ParameterSetNames.ResourceIdWithScanId, Mandatory = true, HelpMessage = ParameterHelpMessages.Server)]
        [Parameter(ParameterSetName = ParameterSetNames.ResourceIdWithLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.Server)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithScanId, Mandatory = true, HelpMessage = ParameterHelpMessages.Server)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.Server)]
        [ValidateNotNullOrEmpty]
        public string Server { get; set; }

        [Parameter(ParameterSetName = ParameterSetNames.ResourceIdWithScanId, Mandatory = true, HelpMessage = ParameterHelpMessages.Database)]
        [Parameter(ParameterSetName = ParameterSetNames.ResourceIdWithLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.Database)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithScanId, Mandatory = true, HelpMessage = ParameterHelpMessages.Database)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.Database)]
        [ValidateNotNullOrEmpty]
        public string Database { get; set; }

        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithScanId, Mandatory = true, HelpMessage = ParameterHelpMessages.ComputerName)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.ComputerName)]
        [ValidateNotNullOrEmpty]
        public string ComputerName { get; set; }

        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithScanId, Mandatory = true, HelpMessage = ParameterHelpMessages.VMUUID)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.VMUUID)]
        [ValidateNotNullOrEmpty]
        public string VMUUID { get; set; }

        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithScanId, Mandatory = true, HelpMessage = ParameterHelpMessages.AgentId)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.AgentId)]
        [ValidateNotNullOrEmpty]
        public string AgentId { get; set; }

        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithScanId, Mandatory = true, HelpMessage = ParameterHelpMessages.WorkspaceResourceId)]
        [Parameter(ParameterSetName = ParameterSetNames.OnPremMachinesWithLatest, Mandatory = true, HelpMessage = ParameterHelpMessages.WorkspaceResourceId)]
        [ValidateNotNullOrEmpty]
        public string WorkspaceResourceId { get; set; }

        public string BuildDatabaseResourceId()
        {
            if (this.ParameterSetName == ParameterSetNames.OnPremMachinesWithScanId
                || this.ParameterSetName == ParameterSetNames.OnPremMachinesWithBaselineLatest)
            {
                return $"{WorkspaceResourceId}/onPremiseMachines/{ComputerName}_{AgentId}_{VMUUID}/sqlServers/{Server}/databases/{Database}";
            }

            return $"{ResourceId}/sqlServers/{Server}/databases/{Database}";
        }
    }
}
