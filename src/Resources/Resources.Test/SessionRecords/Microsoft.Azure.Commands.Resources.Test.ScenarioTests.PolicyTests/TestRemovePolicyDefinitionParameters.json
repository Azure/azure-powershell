{
  "Entries": [
    {
      "RequestUri": "/subscriptions/f67cc918-f64f-4c3f-aa24-a855465f9d41/providers/Microsoft.Authorization/policydefinitions?$filter=PolicyType%20eq%20'Builtin'&api-version=2020-09-01",
      "EncodedRequestUri": "L3N1YnNjcmlwdGlvbnMvZjY3Y2M5MTgtZjY0Zi00YzNmLWFhMjQtYTg1NTQ2NWY5ZDQxL3Byb3ZpZGVycy9NaWNyb3NvZnQuQXV0aG9yaXphdGlvbi9wb2xpY3lkZWZpbml0aW9ucz8kZmlsdGVyPVBvbGljeVR5cGUlMjBlcSUyMCdCdWlsdGluJyZhcGktdmVyc2lvbj0yMDIwLTA5LTAx",
      "RequestMethod": "GET",
      "RequestBody": "",
      "RequestHeaders": {
        "User-Agent": [
          "AzurePowershell/v5.4.0",
          "PSVersion/v6.2.4"
        ],
        "ParameterSetName": [
          "BuiltinFilterParameterSet"
        ],
        "CommandName": [
          "Get-AzPolicyDefinition"
        ]
      },
      "ResponseHeaders": {
        "Cache-Control": [
          "no-cache"
        ],
        "Pragma": [
          "no-cache"
        ],
        "Strict-Transport-Security": [
          "max-age=31536000; includeSubDomains"
        ],
        "Server": [
          "Kestrel"
        ],
        "x-ms-ratelimit-remaining-subscription-reads": [
          "11998"
        ],
        "x-ms-request-id": [
          "013158f0-bde8-4261-9257-66a7139e93e4"
        ],
        "x-ms-correlation-request-id": [
          "013158f0-bde8-4261-9257-66a7139e93e4"
        ],
        "x-ms-routing-request-id": [
          "WESTUS2:20210517T223641Z:013158f0-bde8-4261-9257-66a7139e93e4"
        ],
        "X-Content-Type-Options": [
          "nosniff"
        ],
        "Date": [
          "Mon, 17 May 2021 22:36:41 GMT"
        ],
        "Content-Length": [
          "1456545"
        ],
        "Content-Type": [
          "application/json; charset=utf-8"
        ],
        "Expires": [
          "-1"
        ],
        "Retry-After": [
          "0"
        ]
      },
      "ResponseBody": "{\r\n  \"value\": [\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit virtual machines without disaster recovery configured\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Audit virtual machines which do not have disaster recovery configured. To learn more about disaster recovery, visit https://aka.ms/asr-doc.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.ClassicCompute/virtualMachines\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Resources/links\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"name\",\r\n                \"like\": \"ASR-Protect-*\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0015ea4d-51ff-4ce3-8d8c-f3f8f0179a56\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0015ea4d-51ff-4ce3-8d8c-f3f8f0179a56\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Audit Web Sockets state for a Function App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"The Web Sockets protocol is vulnerable to different types of security threats. Use of Web Sockets within an Function app must be carefully reviewed.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyof\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"DisableWebSockets\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"in\": [\r\n                  \"OffByPolicy\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/001802d1-4969-4c82-a700-c29c6c6f9bbd\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"001802d1-4969-4c82-a700-c29c6c6f9bbd\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Vulnerability assessment should be enabled on your Synapse workspaces\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Discover, track, and remediate potential vulnerabilities by configuring recurring SQL vulnerability assessment scans on your Synapse workspaces.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Synapse\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Synapse/workspaces\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Synapse/workspaces/vulnerabilityAssessments\",\r\n              \"name\": \"default\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Synapse/workspaces/vulnerabilityAssessments/recurringScans.isEnabled\",\r\n                \"equals\": \"True\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0049a6b3-a662-4f3e-8635-39cf44ace45a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0049a6b3-a662-4f3e-8635-39cf44ace45a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"SQL Server Integration Services integration runtimes on Azure Data Factory should be joined to a virtual network\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Azure Virtual Network deployment provides enhanced security and isolation for your SQL Server Integration Services integration runtimes on Azure Data Factory, as well as subnets, access control policies, and other features to further restrict access.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Data Factory\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DataFactory/factories/integrationRuntimes\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DataFactory/factories/integrationruntimes/type\",\r\n                \"equals\": \"Managed\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DataFactory/factories/integrationRuntimes/Managed.typeProperties.computeProperties.vnetProperties.vnetId\",\r\n                \"exists\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0088bc63-6dee-4a9c-9d29-91cfdc848952\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0088bc63-6dee-4a9c-9d29-91cfdc848952\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Private endpoint connections on Batch accounts should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoint connections allow secure communication by enabling private connectivity to Batch accounts without a need for public IP addresses at the source or destination. Learn more about private endpoints in Batch at https://docs.microsoft.com/azure/batch/private-connectivity.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Batch\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Batch/batchAccounts\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Batch/batchAccounts/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Batch/batchAccounts/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/009a0c92-f5b4-4776-9b66-4ed2b4775563\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"009a0c92-f5b4-4776-9b66-4ed2b4775563\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Backup should be enabled for Virtual Machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Ensure protection of your Azure Virtual Machines by enabling Azure Backup. Azure Backup is a secure and cost effective data protection solution for Azure.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Backup\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"id\",\r\n                \"notContains\": \"/resourceGroups/databricks-rg-\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.RecoveryServices/backupprotecteditems\"\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/013e242c-8828-4970-87b3-ab247555486d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"013e242c-8828-4970-87b3-ab247555486d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs on which the remote connection status does not match the specified one\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines on which the remote host connection status does not match the specified one. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsRemoteConnection\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/02a84be7-c304-421f-9bb7-5d2c26af54ad\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"02a84be7-c304-421f-9bb7-5d2c26af54ad\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Cognitive Services accounts should restrict network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Network access to Cognitive Services accounts should be restricted. Configure network rules so only applications from allowed networks can access the Cognitive Services account. To allow connections from specific internet or on-premises clients, access can be granted to traffic from specific Azure virtual networks or to public internet IP address ranges.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Cognitive Services\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.CognitiveServices/accounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.CognitiveServices/accounts/networkAcls.defaultAction\",\r\n                \"notEquals\": \"Deny\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/037eea7a-bd0a-46c5-9a66-03aea78705d3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"037eea7a-bd0a-46c5-9a66-03aea78705d3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Kubernetes Service Private Clusters should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enable the private cluster feature for your Azure Kubernetes Service cluster to ensure network traffic between your API server and your node pools remains on the private network only. This is a common requirement in many regulatory and industry compliance standards.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Kubernetes\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ContainerService/managedClusters\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.ContainerService/managedClusters/apiServerAccessProfile.enablePrivateCluster\",\r\n                \"notEquals\": true\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/040732e8-d947-40b8-95d6-854c95024bf8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"040732e8-d947-40b8-95d6-854c95024bf8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit Linux machines that have the specified applications installed\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if the Chef InSpec resource indicates that one or more of the packages provided by the parameter are installed.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"3.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"not_installed_application_linux\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"ApplicationName\": \"[ChefInSpec]NotInstalledApplicationLinuxResource1;AttributesYmlContent\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"ApplicationName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Application names\",\r\n              \"description\": \"A semicolon-separated list of the names of the applications that should not be installed. e.g. 'python; powershell'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"microsoft-aks\",\r\n                          \"qubole-inc\",\r\n                          \"datastax\",\r\n                          \"couchbase\",\r\n                          \"scalegrid\",\r\n                          \"checkpoint\",\r\n                          \"paloaltonetworks\",\r\n                          \"debian\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"OpenLogic\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"CentOS*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Oracle\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Oracle-Linux\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"RHEL\",\r\n                              \"RHEL-HA\",\r\n                              \"RHEL-SAP\",\r\n                              \"RHEL-SAP-APPS\",\r\n                              \"RHEL-SAP-HA\",\r\n                              \"RHEL-SAP-HANA\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"osa\",\r\n                              \"rhel-byos\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"cis-centos-7-l1\",\r\n                              \"cis-centos-7-v2-1-1-l1\",\r\n                              \"cis-centos-8-l1\",\r\n                              \"cis-debian-linux-8-l1\",\r\n                              \"cis-debian-linux-9-l1\",\r\n                              \"cis-nginx-centos-7-v1-1-0-l1\",\r\n                              \"cis-oracle-linux-7-v2-0-0-l1\",\r\n                              \"cis-oracle-linux-8-l1\",\r\n                              \"cis-postgresql-11-centos-linux-7-level-1\",\r\n                              \"cis-rhel-7-l2\",\r\n                              \"cis-rhel-7-v2-2-0-l1\",\r\n                              \"cis-rhel-8-l1\",\r\n                              \"cis-suse-linux-12-v2-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1604-v1-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1804-l1\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"credativ\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Debian\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"7*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Suse\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"SLES*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"11*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Canonical\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"UbuntuServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"12*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"linux-data-science-vm-ubuntu\",\r\n                              \"azureml\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-centos-os\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-altus-centos-os\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"linux*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.linuxConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Linux*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"notIn\": [\r\n                                  \"OpenLogic\",\r\n                                  \"RedHat\",\r\n                                  \"credativ\",\r\n                                  \"Suse\",\r\n                                  \"Canonical\",\r\n                                  \"microsoft-dsvm\",\r\n                                  \"cloudera\",\r\n                                  \"microsoft-ads\",\r\n                                  \"center-for-internet-security-inc\",\r\n                                  \"Oracle\"\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"linux*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"not_installed_application_linux\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('[ChefInSpec]NotInstalledApplicationLinuxResource1;AttributesYmlContent', '=', parameters('ApplicationName')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0447bc18-e2f7-4c0d-aa20-bff034275be1\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0447bc18-e2f7-4c0d-aa20-bff034275be1\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Storage account keys should not be expired\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Ensure the user storage account keys are not expired when key expiration policy is set, for improving security of account keys by taking action when the keys are expired.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Audit allows a non-compliant resource to be created, but flags it as non-compliant. Deny blocks the resource creation and update. Disable turns off the policy.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Storage/storageAccounts/keyPolicy.keyExpirationPeriodInDays\",\r\n                \"exists\": true\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Storage/storageAccounts/keyCreationTime.key1\",\r\n                        \"exists\": true\r\n                      },\r\n                      {\r\n                        \"value\": \"[utcNow()]\",\r\n                        \"greater\": \"[addDays(field('Microsoft.Storage/storageAccounts/keyCreationTime.key1'), field('Microsoft.Storage/storageAccounts/keyPolicy.keyExpirationPeriodInDays'))]\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Storage/storageAccounts/keyCreationTime.key2\",\r\n                        \"exists\": true\r\n                      },\r\n                      {\r\n                        \"value\": \"[utcNow()]\",\r\n                        \"greater\": \"[addDays(field('Microsoft.Storage/storageAccounts/keyCreationTime.key2'), field('Microsoft.Storage/storageAccounts/keyPolicy.keyExpirationPeriodInDays'))]\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/044985bb-afe1-42cd-8a36-9d5d42424537\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"044985bb-afe1-42cd-8a36-9d5d42424537\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Cosmos DB allowed locations\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy enables you to restrict the locations your organization can specify when deploying Azure Cosmos DB resources. Use to enforce your geo-compliance requirements.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Cosmos DB\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfAllowedLocations\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed locations\",\r\n              \"description\": \"The list of locations that can be specified when deploying Azure Cosmos DB resources.\",\r\n              \"strongType\": \"location\"\r\n            }\r\n          },\r\n          \"policyEffect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Policy Effect\",\r\n              \"description\": \"The desired effect of the policy.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"deny\",\r\n              \"audit\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"deny\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DocumentDB/databaseAccounts\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.DocumentDB/databaseAccounts/Locations[*]\",\r\n                  \"where\": {\r\n                    \"value\": \"[replace(toLower(first(field('Microsoft.DocumentDB/databaseAccounts/Locations[*].locationName'))), ' ', '')]\",\r\n                    \"in\": \"[parameters('listOfAllowedLocations')]\"\r\n                  }\r\n                },\r\n                \"notEquals\": \"[length(field('Microsoft.DocumentDB/databaseAccounts/Locations[*]'))]\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('policyEffect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0473574d-2d43-4217-aefe-941fcdf7e684\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0473574d-2d43-4217-aefe-941fcdf7e684\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"SQL managed instances should use customer-managed keys to encrypt data at rest\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Implementing Transparent Data Encryption (TDE) with your own key provides you with increased transparency and control over the TDE Protector, increased security with an HSM-backed external service, and promotion of separation of duties. This recommendation applies to organizations with a related compliance requirement.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.2\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/managedInstances\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/managedInstances/encryptionProtector\",\r\n              \"name\": \"current\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/managedInstances/encryptionProtector/serverKeyType\",\r\n                    \"equals\": \"AzureKeyVault\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/managedInstances/encryptionProtector/uri\",\r\n                    \"notEquals\": \"\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/managedInstances/encryptionProtector/uri\",\r\n                    \"exists\": \"true\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/048248b0-55cd-46da-b1ff-39efd52db260\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"048248b0-55cd-46da-b1ff-39efd52db260\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Network traffic data collection agent should be installed on Linux virtual machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Security Center uses the Microsoft Dependency agent to collect network traffic data from your Azure virtual machines to enable advanced network protection features such as traffic visualization on the network map, network hardening recommendations and specific network threats.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1-preview\",\r\n          \"category\": \"Monitoring\",\r\n          \"preview\": \"true\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable Dependency Agent for Linux VMs monitoring\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"14.04.0-LTS\",\r\n                              \"14.04.1-LTS\",\r\n                              \"14.04.5-LTS\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"16.04-LTS\",\r\n                              \"16.04.0-LTS\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"18.04-LTS\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-SAP-HANA\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"SLES\",\r\n                          \"SLES-HPC\",\r\n                          \"SLES-HPC-Priority\",\r\n                          \"SLES-SAP\",\r\n                          \"SLES-SAP-BYOS\",\r\n                          \"SLES-Priority\",\r\n                          \"SLES-BYOS\",\r\n                          \"SLES-SAPCAL\",\r\n                          \"SLES-Standard\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"12-SP2\",\r\n                              \"12-SP3\",\r\n                              \"12-SP4\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"CentOS\",\r\n                          \"Centos-LVM\",\r\n                          \"CentOS-SRIOV\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-centos-os\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"like\": \"7*\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"DependencyAgentLinux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Monitoring.DependencyAgent\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/04c4380f-3fae-46e8-96c9-30193528f602\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"04c4380f-3fae-46e8-96c9-30193528f602\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Shared dashboards should not have markdown tiles with inline content\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disallow creating a shared dashboard that has inline content in markdown tiles and enforce that the content should be stored as a markdown file that's hosted online. If you use inline content in the markdown tile, you cannot manage encryption of the content. By configuring your own storage, you can encrypt, double encrypt and even bring your own keys. Enabling this policy restricts users to use 2020-09-01-preview or above version of shared dashboards REST API.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Portal\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Portal/dashboards\"\r\n              },\r\n              {\r\n                \"anyof\": [\r\n                  {\r\n                    \"not\": {\r\n                      \"value\": \"[requestContext().apiVersion]\",\r\n                      \"greaterOrEquals\": \"2020-09-01-alpha\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"count\": {\r\n                      \"field\": \"Microsoft.Portal/dashboards/lenses[*].parts[*]\",\r\n                      \"where\": {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Portal/dashboards/lenses[*].parts[*].metadata.type\",\r\n                            \"equals\": \"Extension/HubsExtension/PartType/MarkdownPart\"\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Portal/dashboards/lenses[*].parts[*].metadata.Extension-HubsExtension-PartType-MarkdownPart.settings.content.settings.markdownUri\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Portal/dashboards/lenses[*].parts[*].metadata.Extension-HubsExtension-PartType-MarkdownPart.settings.content.settings.markdownSource\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Portal/dashboards/lenses[*].parts[*].metadata.Extension-HubsExtension-PartType-MarkdownPart.settings.content.settings.markdownSource\",\r\n                                \"equals\": \"1\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    },\r\n                    \"greater\": 0\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/04c655fe-0ac7-48ae-9a32-3a2e208c7624\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"04c655fe-0ac7-48ae-9a32-3a2e208c7624\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Diagnostic Settings for Service Bus to Log Analytics workspace\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploys the diagnostic settings for Service Bus to stream to a regional Log Analytics workspace when any Service Bus which is missing this diagnostic settings is created or updated.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          },\r\n          \"profileName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Profile name\",\r\n              \"description\": \"The diagnostic settings profile name\"\r\n            },\r\n            \"defaultValue\": \"setbypolicy_logAnalytics\"\r\n          },\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"metricsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable metrics\",\r\n              \"description\": \"Whether to enable metrics stream to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"False\"\r\n          },\r\n          \"logsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable logs\",\r\n              \"description\": \"Whether to enable logs stream to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.ServiceBus/namespaces\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"name\": \"[parameters('profileName')]\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                    \"equals\": \"[parameters('logsEnabled')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\r\n                    \"equals\": \"[parameters('metricsEnabled')]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"resourceName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"metricsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"profileName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.ServiceBus/namespaces/providers/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"dependsOn\": [],\r\n                        \"properties\": {\r\n                          \"workspaceId\": \"[parameters('logAnalytics')]\",\r\n                          \"metrics\": [\r\n                            {\r\n                              \"category\": \"AllMetrics\",\r\n                              \"enabled\": \"[parameters('metricsEnabled')]\",\r\n                              \"retentionPolicy\": {\r\n                                \"enabled\": false,\r\n                                \"days\": 0\r\n                              }\r\n                            }\r\n                          ],\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"OperationalLogs\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {}\r\n                  },\r\n                  \"parameters\": {\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"resourceName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    },\r\n                    \"metricsEnabled\": {\r\n                      \"value\": \"[parameters('metricsEnabled')]\"\r\n                    },\r\n                    \"logsEnabled\": {\r\n                      \"value\": \"[parameters('logsEnabled')]\"\r\n                    },\r\n                    \"profileName\": {\r\n                      \"value\": \"[parameters('profileName')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/04d53d87-841c-4f23-8a5b-21564380b55e\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"04d53d87-841c-4f23-8a5b-21564380b55e\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure API for FHIR should use a customer-managed key to encrypt data at rest\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use a customer-managed key to control the encryption at rest of the data stored in Azure API for FHIR when this is a regulatory or compliance requirement. Customer-managed keys also deliver double encryption by adding a second layer of encryption on top of the default one done with service-managed keys.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"API for FHIR\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"audit\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.HealthcareApis/services\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.HealthcareApis/services/cosmosDbConfiguration.keyVaultKeyUri\",\r\n                \"exists\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/051cba44-2429-45b9-9649-46cec11c7119\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"051cba44-2429-45b9-9649-46cec11c7119\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Log Analytics agent for Linux VMs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Log Analytics agent for Linux VMs if the VM Image (OS) is in the list defined and the agent is not installed.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"listOfImageIdToInclude\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Linux OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageId\",\r\n                    \"in\": \"[parameters('listOfImageIdToInclude')]\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-SAP-HANA\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"8*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"allOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                \"in\": [\r\n                                  \"SLES\",\r\n                                  \"SLES-HPC\",\r\n                                  \"SLES-HPC-Priority\",\r\n                                  \"SLES-SAP\",\r\n                                  \"SLES-SAP-BYOS\",\r\n                                  \"SLES-Priority\",\r\n                                  \"SLES-BYOS\",\r\n                                  \"SLES-SAPCAL\",\r\n                                  \"SLES-Standard\"\r\n                                ]\r\n                              },\r\n                              {\r\n                                \"anyOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"like\": \"12*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"like\": \"15*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"allOf\": [\r\n                              {\r\n                                \"anyOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"like\": \"sles-12-sp*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"like\": \"sles-15-sp*\"\r\n                                  }\r\n                                ]\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"in\": [\r\n                                  \"gen1\",\r\n                                  \"gen2\"\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"UbuntuServer\",\r\n                          \"0001-com-ubuntu-server-focal\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"14.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"16.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"16_04*lts-gen2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"18.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"18_04*lts-gen2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"20_04*lts\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"20_04*lts-gen2\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"credativ\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Debian\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"8*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"9*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Oracle\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Oracle-Linux\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7.*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"CentOS\",\r\n                          \"Centos-LVM\",\r\n                          \"CentOS-SRIOV\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"8*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-centos-os\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"like\": \"7*\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"OmsAgentForLinux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"OMSAgentForLinux\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.EnterpriseCloud.Monitoring\",\r\n                      \"vmExtensionType\": \"OmsAgentForLinux\",\r\n                      \"vmExtensionTypeHandlerVersion\": \"1.13\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"typeHandlerVersion\": \"[variables('vmExtensionTypeHandlerVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"workspaceId\": \"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\",\r\n                            \"stopOnMultipleConnections\": \"true\"\r\n                          },\r\n                          \"protectedSettings\": {\r\n                            \"workspaceKey\": \"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"\r\n                          }\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for VM', ': ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/053d3325-282c-4e5c-b944-24faffd30d77\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"053d3325-282c-4e5c-b944-24faffd30d77\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Web Application Firewall (WAF) should be enabled for Azure Front Door Service service\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Azure Web Application Firewall (WAF) in front of public facing web applications for additional inspection of incoming traffic. Web Application Firewall (WAF) provides centralized protection of your web applications from common exploits and vulnerabilities such as SQL injections, Cross-Site Scripting, local and remote file executions. You can also restrict access to your web applications by countries, IP address ranges, and other http(s) parameters via custom rules.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/frontdoors\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Network/frontdoors/frontendEndpoints[*].webApplicationFirewallPolicyLink.id\",\r\n                \"exists\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/055aa869-bc98-4af8-bafc-23f1ab6ffe2c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"055aa869-bc98-4af8-bafc-23f1ab6ffe2c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Private endpoint should be enabled for PostgreSQL servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoint connections enforce secure communication by enabling private connectivity to Azure Database for PostgreSQL. Configure a private endpoint connection to enable access to traffic coming only from known networks and prevent access from all other IP addresses, including within Azure.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.2\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.DBforPostgreSQL/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.DBforPostgreSQL/servers/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.DBforPostgreSQL/servers/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0564d078-92f5-4f97-8398-b9f58a51f70b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0564d078-92f5-4f97-8398-b9f58a51f70b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Vulnerability Assessment settings for SQL server should contain an email address to receive scan reports\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Ensure that an email address is provided for the 'Send scan reports to' field in the Vulnerability Assessment settings. This email address receives scan result summary after a periodic scan runs on SQL servers.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/vulnerabilityAssessments\",\r\n              \"name\": \"default\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/servers/vulnerabilityAssessments/default.recurringScans.emails[*]\",\r\n                    \"notEquals\": \"\"\r\n                  },\r\n                  {\r\n                    \"count\": {\r\n                      \"field\": \"Microsoft.Sql/servers/vulnerabilityAssessments/default.recurringScans.emails[*]\"\r\n                    },\r\n                    \"notEquals\": 0\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/057d6cfe-9c4f-4a6d-bc60-14420ea1f1a9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"057d6cfe-9c4f-4a6d-bc60-14420ea1f1a9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Resource logs in Azure Data Lake Store should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised\",\r\n        \"metadata\": {\r\n          \"version\": \"4.0.1\",\r\n          \"category\": \"Data Lake\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"requiredRetentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Required retention (days)\",\r\n              \"description\": \"The required resource logs retention in days\"\r\n            },\r\n            \"defaultValue\": \"365\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.DataLakeStore/accounts\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*]\",\r\n                  \"where\": {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                            \"equals\": \"true\"\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                                \"equals\": \"0\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                                \"greaterOrEquals\": \"[parameters('requiredRetentionDays')]\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                            \"equals\": \"true\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                            \"equals\": \"true\"\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                                \"notEquals\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/storageAccountId\",\r\n                                \"exists\": false\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                \"greaterOrEquals\": 1\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/057ef27e-665e-4328-8ea3-04b3122bd9fb\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"057ef27e-665e-4328-8ea3-04b3122bd9fb\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Azure File Sync to use private DNS zones\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"To access the private endpoint(s) for Storage Sync Service resource interfaces from a registered server, you need to configure your DNS to resolve the correct names to your private endpoint's private IP addresses. This policy creates the requisite Azure Private DNS Zone and A records for the interfaces of your Storage Sync Service private endpoint(s).\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateDnsZoneId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"privateDnsZoneId\",\r\n              \"strongType\": \"Microsoft.Network/privateDnsZones\",\r\n              \"description\": \"Private DNS Zone Identifier\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/privateEndpoints\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*].groupIds[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*].groupIds[*]\",\r\n                    \"equals\": \"afs\"\r\n                  }\r\n                },\r\n                \"greaterOrEquals\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Network/privateEndpoints/privateDnsZoneGroups\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/b12aa53e-6015-4669-85d0-8515ebb3ae7f\",\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"privateDnsZoneId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('privateEndpointName'), '/deployedByPolicy')]\",\r\n                        \"type\": \"Microsoft.Network/privateEndpoints/privateDnsZoneGroups\",\r\n                        \"apiVersion\": \"2020-03-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"privateDnsZoneConfigs\": [\r\n                            {\r\n                              \"name\": \"privatelink-afs\",\r\n                              \"properties\": {\r\n                                \"privateDnsZoneId\": \"[parameters('privateDnsZoneId')]\"\r\n                              }\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"privateDnsZoneId\": {\r\n                      \"value\": \"[parameters('privateDnsZoneId')]\"\r\n                    },\r\n                    \"privateEndpointName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/06695360-db88-47f6-b976-7500d4297475\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"06695360-db88-47f6-b976-7500d4297475\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Audit SQL DB Level Audit Setting\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Audit DB level audit setting for SQL databases\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"SQL\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"setting\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit Setting\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"enabled\",\r\n              \"disabled\"\r\n            ]\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers/databases\"\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"notEquals\": \"master\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"AuditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/databases/auditingSettings\",\r\n              \"name\": \"default\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/auditingSettings.state\",\r\n                    \"equals\": \"[parameters('setting')]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a12\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"06a78e20-9358-41c9-923c-fb736d382a12\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit VMs that do not use managed disks\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy audits VMs that do not use managed disks\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/osDisk.uri\",\r\n                    \"exists\": \"True\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/VirtualMachineScaleSets\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/VirtualMachineScaleSets/osDisk.vhdContainers\",\r\n                        \"exists\": \"True\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/VirtualMachineScaleSets/osdisk.imageUrl\",\r\n                        \"exists\": \"True\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a4d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"06a78e20-9358-41c9-923c-fb736d382a4d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Cognitive Services accounts should disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disabling public network access improves security by ensuring that Cognitive Services account isn't exposed on the public internet. Creating private endpoints can limit exposure of Cognitive Services account. Learn more at: https://go.microsoft.com/fwlink/?linkid=2129800. \",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"Cognitive Services\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.CognitiveServices/accounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.CognitiveServices/accounts/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0725b4dd-7e76-479c-a735-68e7ee23d5ca\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0725b4dd-7e76-479c-a735-68e7ee23d5ca\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"CORS should not allow every resource to access your Function Apps\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Cross-Origin Resource Sharing (CORS) should not allow all domains to access your Function app. Allow only required domains to interact with your Function app.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"functionapp*\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/config/web.cors.allowedOrigins[*]\",\r\n                \"notEquals\": \"*\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0820b7b9-23aa-4725-a1ce-ae4558f718e5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0820b7b9-23aa-4725-a1ce-ae4558f718e5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy - Configure Log Analytics agent to be enabled on Windows virtual machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Log Analytics agent for Windows virtual machines if the virtual machine image is in the list defined and the agent is not installed.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Log Analytics workspace is used to receive performance data. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"listOfImageIdToInclude\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of virtual machine images that have supported Windows OS to add to scope\",\r\n              \"description\": \"Example values: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageId\",\r\n                    \"in\": \"[parameters('listOfImageIdToInclude')]\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2008-R2-SP1\",\r\n                          \"2008-R2-SP1-smalldisk\",\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\",\r\n                          \"2019-Datacenter\",\r\n                          \"2019-Datacenter-Core\",\r\n                          \"2019-Datacenter-Core-smalldisk\",\r\n                          \"2019-Datacenter-Core-with-Containers\",\r\n                          \"2019-Datacenter-Core-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-smalldisk\",\r\n                          \"2019-Datacenter-with-Containers\",\r\n                          \"2019-Datacenter-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-zhcn\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerSemiAnnual\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"Datacenter-Core-1709-smalldisk\",\r\n                          \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                          \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerHPCPack\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016-BYOL\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2-BYOL\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftRServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"MLServer-WS2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftVisualStudio\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"VisualStudio\",\r\n                          \"Windows\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-V4\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"windows-data-science-vm\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsDesktop\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Windows-10\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"MicrosoftMonitoringAgent\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"MicrosoftMonitoringAgent\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.EnterpriseCloud.Monitoring\",\r\n                      \"vmExtensionType\": \"MicrosoftMonitoringAgent\",\r\n                      \"vmExtensionTypeHandlerVersion\": \"1.0\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"typeHandlerVersion\": \"[variables('vmExtensionTypeHandlerVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"workspaceId\": \"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\",\r\n                            \"stopOnMultipleConnections\": \"true\"\r\n                          },\r\n                          \"protectedSettings\": {\r\n                            \"workspaceKey\": \"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"\r\n                          }\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for VM', ': ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0868462e-646c-4fe3-9ced-a733534b6a2c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0868462e-646c-4fe3-9ced-a733534b6a2c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit Windows machines on which the DSC configuration is not compliant\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if the Windows PowerShell command Get-DSCConfigurationStatus returns that the DSC configuration for the machine is not compliant.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"WindowsDscConfiguration\",\r\n            \"version\": \"1.*\"\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsDscConfiguration\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/08a2f2d2-94b2-4a7b-aa3b-bb3f523ee6fd\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"08a2f2d2-94b2-4a7b-aa3b-bb3f523ee6fd\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Data Factories to disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disable public network access for your Data Factory so that it is not accessible over the public internet. This can reduce data leakage risks. Learn more at: https://docs.microsoft.com/azure/data-factory/data-factory-private-link.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Data Factory\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Modify\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Modify\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DataFactory/factories\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DataFactory/factories/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"conflictEffect\": \"audit\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/673868aa-7521-48a0-acc6-0f60742d39f5\"\r\n              ],\r\n              \"operations\": [\r\n                {\r\n                  \"condition\": \"[greaterOrEquals(requestContext().apiVersion, '2018-06-01')]\",\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.DataFactory/factories/publicNetworkAccess\",\r\n                  \"value\": \"Disabled\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/08b1442b-7789-4130-8506-4f99a97226a7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"08b1442b-7789-4130-8506-4f99a97226a7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Audit Web Applications that are not using latest supported PHP Framework\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use the latest supported PHP version for the latest security classes. Using older classes and types can make your application vulnerable.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyof\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"WebApp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UseLatestPHP\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"in\": [\r\n                  \"OffByPolicy\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/08b17839-76c6-4015-90e0-33d9d54d219c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"08b17839-76c6-4015-90e0-33d9d54d219c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Diagnostic Settings for Search Services to Log Analytics workspace\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploys the diagnostic settings for Search Services to stream to a regional Log Analytics workspace when any Search Services which is missing this diagnostic settings is created or updated.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          },\r\n          \"profileName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Profile name\",\r\n              \"description\": \"The diagnostic settings profile name\"\r\n            },\r\n            \"defaultValue\": \"setbypolicy_logAnalytics\"\r\n          },\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"metricsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable metrics\",\r\n              \"description\": \"Whether to enable metrics stream to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"False\"\r\n          },\r\n          \"logsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable logs\",\r\n              \"description\": \"Whether to enable logs stream to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Search/searchServices\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"name\": \"[parameters('profileName')]\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                    \"equals\": \"[parameters('logsEnabled')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\r\n                    \"equals\": \"[parameters('metricsEnabled')]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"resourceName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"metricsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"profileName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Search/searchServices/providers/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"dependsOn\": [],\r\n                        \"properties\": {\r\n                          \"workspaceId\": \"[parameters('logAnalytics')]\",\r\n                          \"metrics\": [\r\n                            {\r\n                              \"category\": \"AllMetrics\",\r\n                              \"enabled\": \"[parameters('metricsEnabled')]\",\r\n                              \"retentionPolicy\": {\r\n                                \"enabled\": false,\r\n                                \"days\": 0\r\n                              }\r\n                            }\r\n                          ],\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"OperationLogs\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {}\r\n                  },\r\n                  \"parameters\": {\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"resourceName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    },\r\n                    \"metricsEnabled\": {\r\n                      \"value\": \"[parameters('metricsEnabled')]\"\r\n                    },\r\n                    \"logsEnabled\": {\r\n                      \"value\": \"[parameters('logsEnabled')]\"\r\n                    },\r\n                    \"profileName\": {\r\n                      \"value\": \"[parameters('profileName')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/08ba64b8-738f-4918-9686-730d2ed79c7d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"08ba64b8-738f-4918-9686-730d2ed79c7d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Adaptive network hardening recommendations should be applied on internet facing virtual machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Security Center analyzes the traffic patterns of Internet facing virtual machines and provides Network Security Group rule recommendations that reduce the potential attack surface\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"f9f0eed0-f143-47bf-b856-671ea2eeed62\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/08e6af2d-db70-460a-bfe9-d5bd474ba9d6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"08e6af2d-db70-460a-bfe9-d5bd474ba9d6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"There should be more than one owner assigned to your subscription\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"It is recommended to designate more than one subscription owner in order to have administrator access redundancy.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"2c79b4af-f830-b61e-92b9-63dfa30f16e4\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/09024ccc-0c5f-475e-9457-b7c0d9ed487b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"09024ccc-0c5f-475e-9457-b7c0d9ed487b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Disk encryption should be applied on virtual machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Virtual machines without an enabled disk encryption will be monitored by Azure Security Center as recommendations.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.ClassicCompute/virtualMachines\",\r\n              \"Microsoft.Compute/virtualMachines\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"d57a4221-a804-52ca-3dea-768284f06bb7\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0961003e-5a0a-4549-abde-af6a37f2724d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0961003e-5a0a-4549-abde-af6a37f2724d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure backup on virtual machines without a given tag to an existing recovery services vault in the same location\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enforce backup for all virtual machines by backing them up to an existing central recovery services vault in the same location and subscription as the virtual machine. Doing this is useful when there is a central team in your organization managing backups for all resources in a subscription. You can optionally exclude virtual machines containing a specified tag to control the scope of assignment. See https://aka.ms/AzureVMCentralBackupExcludeTag.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"Backup\"\r\n        },\r\n        \"parameters\": {\r\n          \"vaultLocation\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Location (Specify the location of the VMs that you want to protect)\",\r\n              \"description\": \"Specify the location of the VMs that you want to protect. VMs should be backed up to a vault in the same location. For example - southeastasia.\",\r\n              \"strongType\": \"location\"\r\n            }\r\n          },\r\n          \"backupPolicyId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Backup Policy (of type Azure VM from a vault in the location chosen above)\",\r\n              \"description\": \"Specify the id of the Azure backup policy to configure backup of the virtual machines. The selected Azure backup policy should be of type Azure virtual machine. This policy needs to be in a vault that is present in the location chosen above. For example - /subscriptions/<SubscriptionId>/resourceGroups/<resourceGroupName>/providers/Microsoft.RecoveryServices/vaults/<VaultName>/backupPolicies/<BackupPolicyName>.\",\r\n              \"strongType\": \"Microsoft.RecoveryServices/vaults/backupPolicies\"\r\n            }\r\n          },\r\n          \"exclusionTagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Exclusion Tag Name\",\r\n              \"description\": \"Name of the tag to use for excluding VMs from the scope of this policy. This should be used along with the Exclusion Tag Value parameter. Learn more at https://aka.ms/AppCentricVMBackupPolicy.\"\r\n            },\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"exclusionTagValue\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Exclusion Tag Values\",\r\n              \"description\": \"Value of the tag to use for excluding VMs from the scope of this policy (in case of multiple values, use a comma-separated list). This should be used along with the Exclusion Tag Name parameter. Learn more at https://aka.ms/AppCentricVMBackupPolicy.\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"deployIfNotExists\",\r\n              \"auditIfNotExists\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"deployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"equals\": \"[parameters('vaultLocation')]\"\r\n              },\r\n              {\r\n                \"field\": \"id\",\r\n                \"notContains\": \"/resourceGroups/databricks-rg-\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"[concat('tags[', parameters('exclusionTagName'), ']')]\",\r\n                      \"in\": \"[parameters('exclusionTagValue')]\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"value\": \"[empty(parameters('exclusionTagValue'))]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[empty(parameters('exclusionTagName'))]\",\r\n                    \"equals\": \"true\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2008-R2-SP1\",\r\n                          \"2008-R2-SP1-smalldisk\",\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\",\r\n                          \"2019-Datacenter\",\r\n                          \"2019-Datacenter-Core\",\r\n                          \"2019-Datacenter-Core-smalldisk\",\r\n                          \"2019-Datacenter-Core-with-Containers\",\r\n                          \"2019-Datacenter-Core-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-smalldisk\",\r\n                          \"2019-Datacenter-with-Containers\",\r\n                          \"2019-Datacenter-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-zhcn\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerSemiAnnual\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"Datacenter-Core-1709-smalldisk\",\r\n                          \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                          \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerHPCPack\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2019\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016-BYOL\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2-BYOL\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftRServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"MLServer-WS2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftVisualStudio\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"VisualStudio\",\r\n                          \"Windows\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"windows-data-science-vm\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsDesktop\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Windows-10\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-SAP-HANA\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"SLES\",\r\n                          \"SLES-HPC\",\r\n                          \"SLES-HPC-Priority\",\r\n                          \"SLES-SAP\",\r\n                          \"SLES-SAP-BYOS\",\r\n                          \"SLES-Priority\",\r\n                          \"SLES-BYOS\",\r\n                          \"SLES-SAPCAL\",\r\n                          \"SLES-Standard\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"12*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"contains\": \"ubuntu\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"14.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"16.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"18.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"*20_04-lts\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"20_04-lts*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Oracle\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Oracle-Linux\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7.*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"CentOS\",\r\n                          \"Centos-LVM\",\r\n                          \"CentOS-SRIOV\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-centos-os\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"like\": \"7*\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/5e467623-bb1f-42f4-a55d-6e525e11384b\"\r\n              ],\r\n              \"type\": \"Microsoft.RecoveryServices/backupprotecteditems\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"backupPolicyId\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"fabricName\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"protectionContainers\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"protectedItems\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"sourceResourceId\": {\r\n                        \"type\": \"String\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2017-05-10\",\r\n                        \"name\": \"[concat('DeployProtection-',uniqueString(parameters('protectedItems')))]\",\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"resourceGroup\": \"[first(skip(split(parameters('backupPolicyId'), '/'), 4))]\",\r\n                        \"subscriptionId\": \"[first(skip(split(parameters('backupPolicyId'), '/'), 2))]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"backupPolicyId\": {\r\n                                \"type\": \"String\"\r\n                              },\r\n                              \"fabricName\": {\r\n                                \"type\": \"String\"\r\n                              },\r\n                              \"protectionContainers\": {\r\n                                \"type\": \"String\"\r\n                              },\r\n                              \"protectedItems\": {\r\n                                \"type\": \"String\"\r\n                              },\r\n                              \"sourceResourceId\": {\r\n                                \"type\": \"String\"\r\n                              }\r\n                            },\r\n                            \"resources\": [\r\n                              {\r\n                                \"type\": \"Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems\",\r\n                                \"name\": \"[concat(first(skip(split(parameters('backupPolicyId'), '/'), 8)), '/', parameters('fabricName'), '/',parameters('protectionContainers'), '/', parameters('protectedItems'))]\",\r\n                                \"apiVersion\": \"2016-06-01\",\r\n                                \"properties\": {\r\n                                  \"protectedItemType\": \"Microsoft.Compute/virtualMachines\",\r\n                                  \"policyId\": \"[parameters('backupPolicyId')]\",\r\n                                  \"sourceResourceId\": \"[parameters('sourceResourceId')]\"\r\n                                }\r\n                              }\r\n                            ]\r\n                          },\r\n                          \"parameters\": {\r\n                            \"backupPolicyId\": {\r\n                              \"value\": \"[parameters('backupPolicyId')]\"\r\n                            },\r\n                            \"fabricName\": {\r\n                              \"value\": \"[parameters('fabricName')]\"\r\n                            },\r\n                            \"protectionContainers\": {\r\n                              \"value\": \"[parameters('protectionContainers')]\"\r\n                            },\r\n                            \"protectedItems\": {\r\n                              \"value\": \"[parameters('protectedItems')]\"\r\n                            },\r\n                            \"sourceResourceId\": {\r\n                              \"value\": \"[parameters('sourceResourceId')]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"backupPolicyId\": {\r\n                      \"value\": \"[parameters('backupPolicyId')]\"\r\n                    },\r\n                    \"fabricName\": {\r\n                      \"value\": \"Azure\"\r\n                    },\r\n                    \"protectionContainers\": {\r\n                      \"value\": \"[concat('iaasvmcontainer;iaasvmcontainerv2;', resourceGroup().name, ';' ,field('name'))]\"\r\n                    },\r\n                    \"protectedItems\": {\r\n                      \"value\": \"[concat('vm;iaasvmcontainerv2;', resourceGroup().name, ';' ,field('name'))]\"\r\n                    },\r\n                    \"sourceResourceId\": {\r\n                      \"value\": \"[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Compute/virtualMachines/',field('name'))]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/09ce66bc-1220-4153-8104-e3f51c936913\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"09ce66bc-1220-4153-8104-e3f51c936913\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Private endpoint should be enabled for MariaDB servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoint connections enforce secure communication by enabling private connectivity to Azure Database for MariaDB. Configure a private endpoint connection to enable access to traffic coming only from known networks and prevent access from all other IP addresses, including within Azure.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.2\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.DBforMariaDB/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.DBforMariaDB/servers/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.DBforMariaDB/servers/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0a1302fb-a631-4106-9753-f3d494733990\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0a1302fb-a631-4106-9753-f3d494733990\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Policy Add-on for Kubernetes service (AKS) should be installed and enabled on your clusters\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Policy Add-on for Kubernetes service (AKS) extends Gatekeeper v3, an admission controller webhook for Open Policy Agent (OPA), to apply at-scale enforcements and safeguards on your clusters in a centralized, consistent manner.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.2\",\r\n          \"category\": \"Kubernetes\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ContainerService/managedClusters\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.ContainerService/managedClusters/addonProfiles.azurePolicy.enabled\",\r\n                    \"exists\": \"false\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.ContainerService/managedClusters/addonProfiles.azurePolicy.enabled\",\r\n                    \"equals\": \"false\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0a15ec92-a229-4763-bb14-0ea34a568f8d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0a15ec92-a229-4763-bb14-0ea34a568f8d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit resource location matches resource group location\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit that the resource location matches its resource group location\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"General\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"location\",\r\n                \"notEquals\": \"[resourcegroup().location]\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"notEquals\": \"global\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0a914e76-4921-4c19-b460-a2d36003525a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0a914e76-4921-4c19-b460-a2d36003525a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs configurations in 'System Audit Policies - Account Management'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Account Management'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SystemAuditPoliciesAccountManagement\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AzureBaseline_SystemAuditPoliciesAccountManagement\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0a9991e6-21be-49f9-8916-a06d934bcf29\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0a9991e6-21be-49f9-8916-a06d934bcf29\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Container Instance container group should use customer-managed key for encryption\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Secure your containers with greater flexibility using customer-managed keys. When you specify a customer-managed key, that key is used to protect and control access to the key that encrypts your data. Using customer-managed keys provides additional capabilities to control rotation of the key encryption key or cryptographically erase data.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Container Instance\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\",\r\n              \"Deny\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ContainerInstance/containerGroups\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.ContainerInstance/containerGroups/encryptionProperties.vaultBaseUrl\",\r\n                    \"exists\": false\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.ContainerInstance/containerGroups/encryptionProperties.keyName\",\r\n                    \"exists\": false\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0aa61e00-0a01-4a3c-9945-e93cffedf0e6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0aa61e00-0a01-4a3c-9945-e93cffedf0e6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Email notification to subscription owner for high severity alerts should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"To ensure your subscription owners are notified when there is a potential security breach in their subscription, set email notifications to subscription owners for high severity alerts in Security Center.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/securityContacts\",\r\n              \"existenceScope\": \"subscription\",\r\n              \"existenceCondition\": {\r\n                \"not\": {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Security/securityContacts/alertsToAdmins\",\r\n                      \"equals\": \"Off\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Security/securityContacts/alertNotifications.minimalSeverity\",\r\n                      \"equals\": \"High\"\r\n                    }\r\n                  ]\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0b15565f-aa9e-48ba-8619-45960f2c314d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0b15565f-aa9e-48ba-8619-45960f2c314d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Key vaults should have purge protection enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Malicious deletion of a key vault can lead to permanent data loss. A malicious insider in your organization can potentially delete and purge key vaults. Purge protection protects you from insider attacks by enforcing a mandatory retention period for soft deleted key vaults. No one inside your organization or Microsoft will be able to purge your key vaults during the soft delete retention period.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.1\",\r\n          \"category\": \"Key Vault\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.KeyVault/vaults\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.KeyVault/vaults/enableSoftDelete\",\r\n                    \"exists\": \"false\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.KeyVault/vaults/enablePurgeProtection\",\r\n                    \"exists\": \"false\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.KeyVault/vaults/enableSoftDelete\",\r\n                    \"equals\": \"false\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.KeyVault/vaults/enablePurgeProtection\",\r\n                    \"equals\": \"false\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0b60c0b2-2dc2-4e1c-b5c9-abbed971de53\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0b60c0b2-2dc2-4e1c-b5c9-abbed971de53\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Cosmos DB throughput should be limited\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy enables you to restrict the maximum throughput your organization can specify when creating Azure Cosmos DB databases and containers through the resource provider. It blocks the creation of autoscale resources.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Cosmos DB\"\r\n        },\r\n        \"parameters\": {\r\n          \"throughputMax\": {\r\n            \"type\": \"Integer\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Max RUs\",\r\n              \"description\": \"The maximum throughput (RU/s) that can be assigned to a container via the Resource Provider during create or update.\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Policy Effect\",\r\n              \"description\": \"The desired effect of the policy.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"audit\",\r\n              \"deny\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"deny\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"like\": \"Microsoft.DocumentDB/databaseAccounts/*/throughputSettings\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"in\": [\r\n                      \"Microsoft.DocumentDB/databaseAccounts/sqlDatabases\",\r\n                      \"Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers\",\r\n                      \"Microsoft.DocumentDB/databaseAccounts/mongodbDatabases\",\r\n                      \"Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/collections\",\r\n                      \"Microsoft.DocumentDB/databaseAccounts/gremlinDatabases\",\r\n                      \"Microsoft.DocumentDB/databaseAccounts/gremlinDatabases/graphs\",\r\n                      \"Microsoft.DocumentDB/databaseAccounts/cassandraKeyspaces\",\r\n                      \"Microsoft.DocumentDB/databaseAccounts/cassandraKeyspaces/tables\",\r\n                      \"Microsoft.DocumentDB/databaseAccounts/tables\"\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"value\": \"[requestContext().apiVersion]\",\r\n                    \"less\": \"2019-08-01\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[if(equals(field('Microsoft.DocumentDB/databaseAccounts/sqlDatabases/options.throughput'), ''), 0, int(field('Microsoft.DocumentDB/databaseAccounts/sqlDatabases/options.throughput')))]\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/sqlDatabases/options\",\r\n                    \"containsKey\": \"ProvisionedThroughputSettings\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/sqlDatabases/throughputSettings/default.resource.throughput\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/sqlDatabases/throughputSettings/default.resource.provisionedThroughputSettings\",\r\n                    \"exists\": \"true\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[if(equals(field('Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/options.throughput'), ''), 0, int(field('Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/options.throughput')))]\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/options\",\r\n                    \"containsKey\": \"ProvisionedThroughputSettings\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/throughputSettings/default.resource.throughput\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/sqlDatabases/containers/throughputSettings/default.resource.provisionedThroughputSettings\",\r\n                    \"exists\": \"true\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[if(equals(field('Microsoft.DocumentDB/databaseAccounts/cassandraKeyspaces/options.throughput'), ''), 0, int(field('Microsoft.DocumentDB/databaseAccounts/cassandraKeyspaces/options.throughput')))]\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/cassandraKeyspaces/options\",\r\n                    \"containsKey\": \"ProvisionedThroughputSettings\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/cassandraKeyspaces/throughputSettings/default.resource.throughput\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/cassandraKeyspaces/throughputSettings/default.resource.provisionedThroughputSettings\",\r\n                    \"exists\": \"true\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[if(equals(field('Microsoft.DocumentDB/databaseAccounts/cassandraKeyspaces/tables/options.throughput'), ''), 0, int(field('Microsoft.DocumentDB/databaseAccounts/cassandraKeyspaces/tables/options.throughput')))]\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/cassandraKeyspaces/tables/options\",\r\n                    \"containsKey\": \"ProvisionedThroughputSettings\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/cassandraKeyspaces/tables/throughputSettings/default.resource.throughput\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/cassandraKeyspaces/tables/throughputSettings/default.resource.provisionedThroughputSettings\",\r\n                    \"exists\": \"true\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[if(equals(field('Microsoft.DocumentDB/databaseAccounts/gremlinDatabases/options.throughput'), ''), 0, int(field('Microsoft.DocumentDB/databaseAccounts/gremlinDatabases/options.throughput')))]\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/gremlinDatabases/options\",\r\n                    \"containsKey\": \"ProvisionedThroughputSettings\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/gremlinDatabases/throughputSettings/default.resource.throughput\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/gremlinDatabases/throughputSettings/default.resource.provisionedThroughputSettings\",\r\n                    \"exists\": \"true\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[if(equals(field('Microsoft.DocumentDB/databaseAccounts/gremlinDatabases/graphs/options.throughput'), ''), 0, int(field('Microsoft.DocumentDB/databaseAccounts/gremlinDatabases/graphs/options.throughput')))]\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/gremlinDatabases/graphs/options\",\r\n                    \"containsKey\": \"ProvisionedThroughputSettings\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/gremlinDatabases/graphs/throughputSettings/default.resource.throughput\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/gremlinDatabases/graphs/throughputSettings/default.resource.provisionedThroughputSettings\",\r\n                    \"exists\": \"true\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[if(equals(field('Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/options.throughput'), ''), 0, int(field('Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/options.throughput')))]\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/options\",\r\n                    \"containsKey\": \"ProvisionedThroughputSettings\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/throughputSettings/default.resource.throughput\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/throughputSettings/default.resource.provisionedThroughputSettings\",\r\n                    \"exists\": \"true\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[if(equals(field('Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/collections/options.throughput'), ''), 0, int(field('Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/collections/options.throughput')))]\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/collections/options\",\r\n                    \"containsKey\": \"ProvisionedThroughputSettings\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/collections/throughputSettings/default.resource.throughput\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/mongodbDatabases/collections/throughputSettings/default.resource.provisionedThroughputSettings\",\r\n                    \"exists\": \"true\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[if(equals(field('Microsoft.DocumentDB/databaseAccounts/tables/options.throughput'), ''), 0, int(field('Microsoft.DocumentDB/databaseAccounts/tables/options.throughput')))]\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/tables/options\",\r\n                    \"containsKey\": \"ProvisionedThroughputSettings\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/tables/throughputSettings/default.resource.throughput\",\r\n                    \"greater\": \"[parameters('throughputMax')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/tables/throughputSettings/default.resource.provisionedThroughputSettings\",\r\n                    \"exists\": \"true\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0b7ef78e-a035-4f23-b9bd-aff122a1b1cf\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0b7ef78e-a035-4f23-b9bd-aff122a1b1cf\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Ensure API app has 'Client Certificates (Incoming client certificates)' set to 'On'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Client certificates allow for the app to request a certificate for incoming requests. Only clients that have a valid certificate will be able to reach the app.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"*api\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Web/sites/clientCertEnabled\",\r\n                \"equals\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0c192fe8-9cbb-4516-85b3-0ade8bd03886\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0c192fe8-9cbb-4516-85b3-0ade8bd03886\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Private endpoint connections on Automation Accounts should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoint connections allow secure communication by enabling private connectivity to Automation accounts without a need for public IP addresses at the source or destination. Learn more about private endpoints in Azure Automation at https://docs.microsoft.com/azure/automation/how-to/private-link-security\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Automation\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Automation/automationAccounts\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Automation/automationAccounts/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Automation/automationAccounts/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0c2b3618-68a8-4034-a150-ff4abc873462\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0c2b3618-68a8-4034-a150-ff4abc873462\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"SQL servers should use customer-managed keys to encrypt data at rest\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Implementing Transparent Data Encryption (TDE) with your own key provides increased transparency and control over the TDE Protector, increased security with an HSM-backed external service, and promotion of separation of duties. This recommendation applies to organizations with a related compliance requirement.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.1\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"notContains\": \"analytics\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/encryptionProtector\",\r\n              \"name\": \"current\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/servers/encryptionProtector/serverKeyType\",\r\n                    \"equals\": \"AzureKeyVault\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/servers/encryptionProtector/uri\",\r\n                    \"notEquals\": \"\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/servers/encryptionProtector/uri\",\r\n                    \"exists\": \"true\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0d134df8-db83-46fb-ad72-fe0c9428c8dd\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0d134df8-db83-46fb-ad72-fe0c9428c8dd\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Private endpoint should be enabled for IoT Hub\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoint connections enforce secure communication by enabling private connectivity to IoT Hub. Configure a private endpoint connection to enable access to traffic coming only from known networks and prevent access from all other IP addresses, including within Azure.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Internet of Things\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Devices/IotHubs\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Devices/IotHubs/privateEndpointConnections[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.Devices/IotHubs/privateEndpointConnections[*].privateLinkServiceConnectionState.status\",\r\n                    \"equals\": \"Approved\"\r\n                  }\r\n                },\r\n                \"less\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0d40b058-9f95-4a19-93e3-9b0330baa2a3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0d40b058-9f95-4a19-93e3-9b0330baa2a3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs on which Windows Defender Exploit Guard is not enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines on which Windows Defender Exploit Guard is not enabled. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsDefenderExploitGuard\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0d9b45ff-9ddd-43fc-bf59-fbd1c8423053\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0d9b45ff-9ddd-43fc-bf59-fbd1c8423053\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Managed identity should be used in your Function App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use a managed identity for enhanced authentication security\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"functionapp*\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/managedServiceIdentityId\",\r\n                    \"exists\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/xmanagedServiceIdentityId\",\r\n                    \"exists\": \"true\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0da106f2-4ca3-48e8-bc85-c638fe6aea8f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0da106f2-4ca3-48e8-bc85-c638fe6aea8f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy a flow log resource with target network security group\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Configures flow log for specific network security group. It will allow to log information about IP traffic flowing through an network security group. Flow log helps to identify unknown or undesired traffic, verify network isolation and compliance with enterprise access rules, analyze network flows from compromised IPs and network interfaces.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {\r\n          \"nsgRegion\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"NSG Region\",\r\n              \"description\": \"This Policy will review NSGs only in the selected region. You can create other assignments to include other regions.\",\r\n              \"strongType\": \"location\"\r\n            }\r\n          },\r\n          \"storageId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Storage id\",\r\n              \"description\": \"A string with the storage id for the flowlogs to be sent to. It will be used for deployment purposes only. Make sure this storage account is located in the same region as the NSG. The format must be: '/subscriptions/{subscription id}/resourceGroups/{resourceGroup name}/providers/Microsoft.Storage/storageAccounts/{storage account name}\",\r\n              \"assignPermissions\": \"true\"\r\n            }\r\n          },\r\n          \"networkWatcherRG\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network Watchers RG\",\r\n              \"description\": \"The name of the resource group where the flowLog resources will be created. This will be used only if a deployment is required. This is the resource group where the Network Watchers are located.\",\r\n              \"strongType\": \"existingResourceGroups\"\r\n            }\r\n          },\r\n          \"networkWatcherName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network Watcher name\",\r\n              \"description\": \"The name of the network watcher under which the flowLog resources will be created. Make sure it belongs to the same region as the NSG.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/networkSecurityGroups\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"equals\": \"[parameters('nsgRegion')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Network/networkWatchers/flowlogs\",\r\n              \"resourceGroupName\": \"[if(empty(coalesce(field('Microsoft.Network/networkSecurityGroups/flowLogs'))), parameters('networkWatcherRG'), split(first(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id')), '/')[4])]\",\r\n              \"name\": \"[if(empty(coalesce(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id'))), 'null/null', concat(split(first(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id')), '/')[8], '/', split(first(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id')), '/')[10]))]\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkWatchers/flowLogs/enabled\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkWatchers/flowLogs/storageId\",\r\n                    \"equals\": \"[parameters('storageId')]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"storageId\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"networkWatcherRG\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"networkWatcherName\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"flowlogName\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"targetResource\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[concat('flowlogDeployment-', uniqueString(parameters('flowlogName')))]\",\r\n                        \"apiVersion\": \"2019-10-01\",\r\n                        \"resourceGroup\": \"[parameters('networkWatcherRG')]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"incremental\",\r\n                          \"parameters\": {},\r\n                          \"template\": {\r\n                            \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {},\r\n                            \"resources\": [\r\n                              {\r\n                                \"type\": \"Microsoft.Network/networkWatchers/flowLogs\",\r\n                                \"name\": \"[concat(parameters('networkWatcherName'), '/', parameters('flowlogName'))]\",\r\n                                \"apiVersion\": \"2019-11-01\",\r\n                                \"location\": \"[parameters('location')]\",\r\n                                \"properties\": {\r\n                                  \"targetResourceId\": \"[parameters('targetResource')]\",\r\n                                  \"storageId\": \"[parameters('storageId')]\",\r\n                                  \"enabled\": \"true\",\r\n                                  \"retentionPolicy\": {\r\n                                    \"days\": \"0\",\r\n                                    \"enabled\": \"false\"\r\n                                  }\r\n                                }\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"storageId\": {\r\n                      \"value\": \"[parameters('storageId')]\"\r\n                    },\r\n                    \"networkWatcherRG\": {\r\n                      \"value\": \"[if(empty(coalesce(field('Microsoft.Network/networkSecurityGroups/flowLogs'))), parameters('networkWatcherRG'), split(first(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id')), '/')[4])]\"\r\n                    },\r\n                    \"networkWatcherName\": {\r\n                      \"value\": \"[if(empty(coalesce(field('Microsoft.Network/networkSecurityGroups/flowLogs'))), parameters('networkWatcherName'), split(first(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id')), '/')[8])]\"\r\n                    },\r\n                    \"flowlogName\": {\r\n                      \"value\": \"[if(empty(coalesce(field('Microsoft.Network/networkSecurityGroups/flowLogs'))), concat(field('name'), '-', resourceGroup().name, '-', 'flowlog'), split(first(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id')), '/')[10])]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"targetResource\": {\r\n                      \"value\": \"[concat(resourceGroup().id, '/providers/Microsoft.Network/networkSecurityGroups/', field('name'))]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0db34a60-64f4-4bf6-bd44-f95c16cf34b9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0db34a60-64f4-4bf6-bd44-f95c16cf34b9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Modify - Configure Azure File Sync to disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"The Azure File Sync's internet-accessible public endpoint are disabled by your organizational policy. You may still access the Storage Sync Service via its private endpoint(s).\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Modify\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Modify\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.StorageSync/storageSyncServices\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.StorageSync/storageSyncServices/incomingTrafficPolicy\",\r\n                \"notEquals\": \"AllowVirtualNetworksOnly\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"conflictEffect\": \"Audit\",\r\n              \"operations\": [\r\n                {\r\n                  \"condition\": \"[greater(requestContext().apiVersion, '2019-10-01')]\",\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.StorageSync/storageSyncServices/incomingTrafficPolicy\",\r\n                  \"value\": \"AllowVirtualNetworksOnly\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0e07b2e9-6cd9-4c40-9ccb-52817b95133b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0e07b2e9-6cd9-4c40-9ccb-52817b95133b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Authorized IP ranges should be defined on Kubernetes Services\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Restrict access to the Kubernetes Service Management API by granting API access only to IP addresses in specific ranges. It is recommended to limit access to authorized IP ranges to ensure that only applications from allowed networks can access the cluster.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.1\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ContainerService/managedClusters\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.ContainerService/managedClusters/apiServerAccessProfile.authorizedIPRanges\",\r\n                \"exists\": \"false\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.ContainerService/managedClusters/apiServerAccessProfile.enablePrivateCluster\",\r\n                    \"exists\": \"false\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.ContainerService/managedClusters/apiServerAccessProfile.enablePrivateCluster\",\r\n                    \"equals\": \"false\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0e246bcf-5f6f-4f87-bc6f-775d4712c7ea\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0e246bcf-5f6f-4f87-bc6f-775d4712c7ea\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Remote debugging should be turned off for Function Apps\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Remote debugging requires inbound ports to be opened on function apps. Remote debugging should be turned off.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"functionapp*\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/config/web.remoteDebuggingEnabled\",\r\n                \"equals\": \"false\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0e60b895-3786-45da-8377-9c6b4b6ac5f9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0e60b895-3786-45da-8377-9c6b4b6ac5f9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Defender for Key Vault should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Azure Defender for Key Vault provides an additional layer of protection and security intelligence by detecting unusual and potentially harmful attempts to access or exploit key vault accounts.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.3\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/pricings\",\r\n              \"name\": \"KeyVaults\",\r\n              \"existenceScope\": \"subscription\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/pricings/pricingTier\",\r\n                \"equals\": \"Standard\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0e6763cc-5078-4e64-889d-ff4d9a839047\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0e6763cc-5078-4e64-889d-ff4d9a839047\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Geo-redundant backup should be enabled for Azure Database for MariaDB\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Database for MariaDB allows you to choose the redundancy option for your database server. It can be set to a geo-redundant backup storage in which the data is not only stored within the region in which your server is hosted, but is also replicated to a paired region to provide recovery option in case of a region failure. Configuring geo-redundant storage for backup is only allowed during server create.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DBforMariaDB/servers\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DBforMariaDB/servers/storageProfile.geoRedundantBackup\",\r\n                \"notEquals\": \"Enabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0ec47710-77ff-4a3d-9181-6aa50af424d0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0ec47710-77ff-4a3d-9181-6aa50af424d0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to enable Guest Configuration Policy on Windows VMs.\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a system-assigned managed identity and deploys the VM extension for Guest Configuration on Windows VMs. This is a prerequisite for Guest Configuration Policy and must be assigned to the scope before using any Guest Configuration policy. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                    \"in\": [\r\n                      \"esri\",\r\n                      \"incredibuild\",\r\n                      \"MicrosoftDynamicsAX\",\r\n                      \"MicrosoftSharepoint\",\r\n                      \"MicrosoftVisualStudio\",\r\n                      \"MicrosoftWindowsDesktop\",\r\n                      \"MicrosoftWindowsServerHPCPack\"\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"2008*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"notLike\": \"SQL2008*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-dsvm\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"dsvm-windows\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"standard-data-science-vm\",\r\n                          \"windows-data-science-vm\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"batch\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"rendering-windows2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"center-for-internet-security-inc\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"cis-windows-server-201*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"pivotal\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"bosh-windows-server*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloud-infrastructure-services\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"ad*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                            \"exists\": \"true\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                            \"like\": \"Windows*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"exists\": \"false\"\r\n                          },\r\n                          {\r\n                            \"allOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"notLike\": \"2008*\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                \"notLike\": \"SQL2008*\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"name\": \"AzurePolicyforWindows\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.GuestConfiguration\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"ConfigurationforWindows\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0ecd903d-91e7-4726-83d3-a229d7f2e293\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0ecd903d-91e7-4726-83d3-a229d7f2e293\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Batch accounts with private endpoints\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoints connect your virtual network to Azure services without a public IP address at the source or destination. By mapping private endpoints to Batch accounts, you can reduce data leakage risks. Learn more about private links at: https://docs.microsoft.com/azure/batch/private-connectivity.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Batch\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateEndpointSubnetId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private endpoint subnet id\",\r\n              \"description\": \"A subnet with private endpoint network policies disabled\",\r\n              \"strongType\": \"Microsoft.Network/virtualNetworks/subnets\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Batch/batchAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Batch/batchAccounts/publicNetworkAccess\",\r\n                \"equals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Batch/batchAccounts/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Batch/batchAccounts/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"name\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"serviceId\": {\r\n                      \"value\": \"[field('id')]\"\r\n                    },\r\n                    \"privateEndpointSubnetId\": {\r\n                      \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"name\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"serviceId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointSubnetId\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"privateEndpointName\": \"[concat('pe-',substring(parameters('name'),0,min(length(parameters('name')),50)),'-',uniquestring(deployment().name))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('privateEndpointName')]\",\r\n                        \"apiVersion\": \"2020-06-01\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"expressionEvaluationOptions\": {\r\n                            \"scope\": \"inner\"\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"serviceId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"privateEndpointSubnetId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"subnetLocation\": {\r\n                                \"type\": \"string\"\r\n                              }\r\n                            },\r\n                            \"variables\": {\r\n                              \"privateEndpointName\": \"[deployment().name]\"\r\n                            },\r\n                            \"resources\": [\r\n                              {\r\n                                \"name\": \"[variables('privateEndpointName')]\",\r\n                                \"type\": \"Microsoft.Network/privateEndpoints\",\r\n                                \"apiVersion\": \"2020-07-01\",\r\n                                \"location\": \"[parameters('subnetLocation')]\",\r\n                                \"tags\": {},\r\n                                \"properties\": {\r\n                                  \"subnet\": {\r\n                                    \"id\": \"[parameters('privateEndpointSubnetId')]\"\r\n                                  },\r\n                                  \"privateLinkServiceConnections\": [\r\n                                    {\r\n                                      \"name\": \"[variables('privateEndpointName')]\",\r\n                                      \"properties\": {\r\n                                        \"privateLinkServiceId\": \"[parameters('serviceId')]\",\r\n                                        \"groupIds\": [\r\n                                          \"batchAccount\"\r\n                                        ],\r\n                                        \"requestMessage\": \"autoapprove\"\r\n                                      }\r\n                                    }\r\n                                  ],\r\n                                  \"manualPrivateLinkServiceConnections\": []\r\n                                }\r\n                              }\r\n                            ]\r\n                          },\r\n                          \"parameters\": {\r\n                            \"serviceId\": {\r\n                              \"value\": \"[parameters('serviceId')]\"\r\n                            },\r\n                            \"privateEndpointSubnetId\": {\r\n                              \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                            },\r\n                            \"subnetLocation\": {\r\n                              \"value\": \"[reference(first(take(split(parameters('privateEndpointSubnetId'),'/subnets'),1)),'2020-07-01','Full').location]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0ef5aac7-c064-427a-b87b-d47b3ddcaf73\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0ef5aac7-c064-427a-b87b-d47b3ddcaf73\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Azure Spring Cloud instances where distributed tracing is not enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Distributed tracing tools in Azure Spring Cloud allow debugging and monitoring the complex interconnections between microservices in an application. Distributed tracing tools should be enabled and in a healthy state.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-preview\",\r\n          \"category\": \"App Platform\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.AppPlatform/Spring\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.AppPlatform/Spring/trace.enabled\",\r\n                    \"notEquals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.AppPlatform/Spring/trace.state\",\r\n                    \"notEquals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0f2d8593-4667-4932-acca-6a9f187af109\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0f2d8593-4667-4932-acca-6a9f187af109\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Cognitive Search services should use private link\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to Azure Cognitive Search, data leakage risks are reduced. Learn more about private links at: https://aka.ms/azure-cognitive-search/inbound-private-endpoints.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Search\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Search/searchServices\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Search/searchServices/privateEndpointConnections[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.Search/searchServices/privateEndpointConnections[*].privateLinkServiceConnectionState.status\",\r\n                    \"equals\": \"Approved\"\r\n                  }\r\n                },\r\n                \"less\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0fda3595-9f2b-4592-8675-4231d6fa82fe\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0fda3595-9f2b-4592-8675-4231d6fa82fe\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Public network access should be disabled for Container registries\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disabling public network access improves security by ensuring that container registries are not exposed on the public internet. Creating private endpoints can limit exposure of container registry resources. Learn more at: https://aka.ms/acr/portal/public-network and https://aka.ms/acr/private-link.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Container Registry\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ContainerRegistry/registries\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.ContainerRegistry/registries/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0fdf0491-d080-4575-b627-ad0e843cba0f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0fdf0491-d080-4575-b627-ad0e843cba0f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"CORS should not allow every domain to access your API for FHIR\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Cross-Origin Resource Sharing (CORS) should not allow all domains to access your API for FHIR. To protect your API for FHIR, remove access for all domains and explicitly define the domains allowed to connect.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"API for FHIR\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"audit\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.HealthcareApis/services\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.HealthcareApis/services/corsConfiguration.origins[*]\",\r\n                  \"notEquals\": \"*\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0fea8f8a-4169-495d-8307-30ec335f387d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0fea8f8a-4169-495d-8307-30ec335f387d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs that do not contain the specified certificates in Trusted Root\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows VMs that do not contain the specified certificates in the Trusted Root Certification Authorities certificate store (Cert:\\\\LocalMachine\\\\Root). It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"CertificateThumbprints\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Certificate thumbprints\",\r\n              \"description\": \"A semicolon-separated list of certificate thumbprints that should exist under the Trusted Root certificate store (Cert:\\\\LocalMachine\\\\Root). e.g. THUMBPRINT1;THUMBPRINT2;THUMBPRINT3\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsCertificateInTrustedRoot\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('[CertificateStore]CertificateStore1;CertificateThumbprintsToInclude', '=', parameters('CertificateThumbprints')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"WindowsCertificateInTrustedRoot\"\r\n                    },\r\n                    \"CertificateThumbprints\": {\r\n                      \"value\": \"[parameters('CertificateThumbprints')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"CertificateThumbprints\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[CertificateStore]CertificateStore1;CertificateThumbprintsToInclude\",\r\n                                \"value\": \"[parameters('CertificateThumbprints')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[CertificateStore]CertificateStore1;CertificateThumbprintsToInclude\",\r\n                                \"value\": \"[parameters('CertificateThumbprints')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/106ccbe4-a791-4f33-a44a-06796944b8d5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"106ccbe4-a791-4f33-a44a-06796944b8d5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Ensure that '.NET Framework' version is the latest, if used as a part of the Function App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy is not required since Azure App Service automatically updates and maintains the .NET Framework versions installed on the platform.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"App Service\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"functionapp*\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/config/web.netFrameworkVersion\",\r\n                \"in\": [\r\n                  \"v3.0\",\r\n                  \"v4.0\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/10c1859c-e1a7-4df3-ab97-a487fa8059f6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"10c1859c-e1a7-4df3-ab97-a487fa8059f6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Custom subscription owner roles should not exist\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy ensures that no custom subscription owner roles exist.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"General\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Authorization/roleDefinitions\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Authorization/roleDefinitions/type\",\r\n                \"equals\": \"CustomRole\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Authorization/roleDefinitions/permissions[*].actions[*]\",\r\n                      \"notEquals\": \"*\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Authorization/roleDefinitions/permissions.actions[*]\",\r\n                      \"notEquals\": \"*\"\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Authorization/roleDefinitions/assignableScopes[*]\",\r\n                      \"notIn\": [\r\n                        \"[concat(subscription().id,'/')]\",\r\n                        \"[subscription().id]\",\r\n                        \"/\"\r\n                      ]\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Authorization/roleDefinitions/assignableScopes[*]\",\r\n                      \"notLike\": \"/providers/Microsoft.Management/*\"\r\n                    }\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/10ee2ea2-fb4d-45b8-a7e9-a2e770044cd9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"10ee2ea2-fb4d-45b8-a7e9-a2e770044cd9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Modify - Configure Azure IoT Hubs to disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disabling the public network access property improves security by ensuring your Azure IoT Hub can only be accessed from a private endpoint. This policy disables public network access on IoT Hub resources.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Internet of Things\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Modify\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Modify\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Devices/IotHubs\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Devices/IotHubs/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"conflictEffect\": \"audit\",\r\n              \"operations\": [\r\n                {\r\n                  \"condition\": \"[greaterOrEquals(requestContext().apiVersion, '2020-03-01')]\",\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.Devices/IotHubs/publicNetworkAccess\",\r\n                  \"value\": \"Disabled\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/114eec6e-5e59-4bad-999d-6eceeb39d582\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"114eec6e-5e59-4bad-999d-6eceeb39d582\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Cognitive Services accounts should use customer owned storage or enable data encryption.\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy is deprecated. Cognitive Services have data encryption enforced.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0-deprecated\",\r\n          \"category\": \"Cognitive Services\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Disabled\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.CognitiveServices/accounts\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.CognitiveServices/accounts/userOwnedStorage[*]\"\r\n                },\r\n                \"less\": 1\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.CognitiveServices/accounts/encryption.keySource\",\r\n                \"exists\": \"false\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.CognitiveServices/accounts/encryption\",\r\n                \"exists\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/11566b39-f7f7-4b82-ab06-68d8700eb0a4\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"11566b39-f7f7-4b82-ab06-68d8700eb0a4\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Dependency agent should be enabled for listed virtual machine images\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Reports virtual machines as non-compliant if the virtual machine image is not in the list defined and the agent is not installed. The list of OS images is updated over time as support is updated.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfImageIdToInclude_windows\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of virtual machine images that have supported Windows OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"listOfImageIdToInclude_linux\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of virtual machine images that have supported Linux OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"anyOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageId\",\r\n                      \"in\": \"[parameters('listOfImageIdToInclude_windows')]\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageId\",\r\n                      \"in\": \"[parameters('listOfImageIdToInclude_linux')]\"\r\n                    },\r\n                    {\r\n                      \"anyOf\": [\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"2008-R2-SP1\",\r\n                                \"2008-R2-SP1-smalldisk\",\r\n                                \"2012-Datacenter\",\r\n                                \"2012-Datacenter-smalldisk\",\r\n                                \"2012-R2-Datacenter\",\r\n                                \"2012-R2-Datacenter-smalldisk\",\r\n                                \"2016-Datacenter\",\r\n                                \"2016-Datacenter-Server-Core\",\r\n                                \"2016-Datacenter-Server-Core-smalldisk\",\r\n                                \"2016-Datacenter-smalldisk\",\r\n                                \"2016-Datacenter-with-Containers\",\r\n                                \"2016-Datacenter-with-RDSH\",\r\n                                \"2019-Datacenter\",\r\n                                \"2019-Datacenter-Core\",\r\n                                \"2019-Datacenter-Core-smalldisk\",\r\n                                \"2019-Datacenter-Core-with-Containers\",\r\n                                \"2019-Datacenter-Core-with-Containers-smalldisk\",\r\n                                \"2019-Datacenter-smalldisk\",\r\n                                \"2019-Datacenter-with-Containers\",\r\n                                \"2019-Datacenter-with-Containers-smalldisk\",\r\n                                \"2019-Datacenter-zhcn\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServerSemiAnnual\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"Datacenter-Core-1709-smalldisk\",\r\n                                \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                                \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServerHPCPack\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftSQLServer\"\r\n                            },\r\n                            {\r\n                              \"anyOf\": [\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2016\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2016-BYOL\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2012R2\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2012R2-BYOL\"\r\n                                }\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftRServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"MLServer-WS2016\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftVisualStudio\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"in\": [\r\n                                \"VisualStudio\",\r\n                                \"Windows\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftDynamicsAX\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"Dynamics\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftDynamicsAX\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"Dynamics\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"equals\": \"Pre-Req-AX7-Onebox-V4\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"microsoft-ads\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"windows-data-science-vm\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsDesktop\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"Windows-10\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"RedHat\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"RHEL\",\r\n                            \"RHEL-SAP-HANA\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"SUSE\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"SLES\",\r\n                            \"SLES-HPC\",\r\n                            \"SLES-HPC-Priority\",\r\n                            \"SLES-SAP\",\r\n                            \"SLES-SAP-BYOS\",\r\n                            \"SLES-Priority\",\r\n                            \"SLES-BYOS\",\r\n                            \"SLES-SAPCAL\",\r\n                            \"SLES-Standard\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"12-SP2\",\r\n                                \"12-SP3\",\r\n                                \"12-SP4\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"Canonical\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"UbuntuServer\"\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"14.04.0-LTS\",\r\n                                \"14.04.1-LTS\",\r\n                                \"14.04.5-LTS\"\r\n                              ]\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"16.04-LTS\",\r\n                                \"16.04.0-LTS\"\r\n                              ]\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"18.04-LTS\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"OpenLogic\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"Centos\",\r\n                            \"Centos-LVM\",\r\n                            \"CentOS-SRIOV\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"cloudera\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"cloudera-centos-os\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSKU\",\r\n                          \"like\": \"7*\"\r\n                        }\r\n                      ]\r\n                    }\r\n                  ]\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                \"equals\": \"Microsoft.Azure.Monitoring.DependencyAgent\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/11ac78e3-31bc-4f0c-8434-37ab963cea07\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"11ac78e3-31bc-4f0c-8434-37ab963cea07\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'Security Options - System settings'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'Security Options - System settings' for certificate rules on executables for SRP and optional subsystems. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_SecurityOptionsSystemsettings\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"SystemSettingsUseCertificateRulesOnWindowsExecutablesForSoftwareRestrictionPolicies\": \"System settings: Use Certificate Rules on Windows Executables for Software Restriction Policies;ExpectedValue\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"SystemSettingsUseCertificateRulesOnWindowsExecutablesForSoftwareRestrictionPolicies\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"System settings: Use Certificate Rules on Windows Executables for Software Restriction Policies\",\r\n              \"description\": \"Specifies whether digital certificates are processed when software restriction policies are enabled and a user or process attempts to run software with an .exe file name extension. It enables or disables certificate rules (a type of software restriction policies rule). For certificate rules to take effect in software restriction policies, you must enable this policy setting.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsSystemsettings\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('System settings: Use Certificate Rules on Windows Executables for Software Restriction Policies;ExpectedValue', '=', parameters('SystemSettingsUseCertificateRulesOnWindowsExecutablesForSoftwareRestrictionPolicies')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/12017595-5a75-4bb1-9d97-4c2c939ea3c3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"12017595-5a75-4bb1-9d97-4c2c939ea3c3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'Security Options - Network Security'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'Security Options - Network Security' for including Local System behavior, PKU2U, LAN Manager, LDAP client, and NTLM SSP. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_SecurityOptionsNetworkSecurity\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"NetworkSecurityConfigureEncryptionTypesAllowedForKerberos\": \"Network Security: Configure encryption types allowed for Kerberos;ExpectedValue\",\r\n              \"NetworkSecurityLANManagerAuthenticationLevel\": \"Network security: LAN Manager authentication level;ExpectedValue\",\r\n              \"NetworkSecurityLDAPClientSigningRequirements\": \"Network security: LDAP client signing requirements;ExpectedValue\",\r\n              \"NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCClients\": \"Network security: Minimum session security for NTLM SSP based (including secure RPC) clients;ExpectedValue\",\r\n              \"NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCServers\": \"Network security: Minimum session security for NTLM SSP based (including secure RPC) servers;ExpectedValue\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"NetworkSecurityConfigureEncryptionTypesAllowedForKerberos\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network Security: Configure encryption types allowed for Kerberos\",\r\n              \"description\": \"Specifies the encryption types that Kerberos is allowed to use.\"\r\n            },\r\n            \"defaultValue\": \"2147483644\"\r\n          },\r\n          \"NetworkSecurityLANManagerAuthenticationLevel\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network security: LAN Manager authentication level\",\r\n              \"description\": \"Specify which challenge-response authentication protocol is used for network logons. This choice affects the level of authentication protocol used by clients, the level of session security negotiated, and the level of authentication accepted by servers.\"\r\n            },\r\n            \"defaultValue\": \"5\"\r\n          },\r\n          \"NetworkSecurityLDAPClientSigningRequirements\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network security: LDAP client signing requirements\",\r\n              \"description\": \"Specify the level of data signing that is requested on behalf of clients that issue LDAP BIND requests.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCClients\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network security: Minimum session security for NTLM SSP based (including secure RPC) clients\",\r\n              \"description\": \"Specifies which behaviors are allowed by clients for applications using the NTLM Security Support Provider (SSP). The SSP Interface (SSPI) is used by applications that need authentication services. See https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-minimum-session-security-for-ntlm-ssp-based-including-secure-rpc-servers for more information.\"\r\n            },\r\n            \"defaultValue\": \"537395200\"\r\n          },\r\n          \"NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCServers\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network security: Minimum session security for NTLM SSP based (including secure RPC) servers\",\r\n              \"description\": \"Specifies which behaviors are allowed by servers for applications using the NTLM Security Support Provider (SSP). The SSP Interface (SSPI) is used by applications that need authentication services.\"\r\n            },\r\n            \"defaultValue\": \"537395200\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsNetworkSecurity\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('Network Security: Configure encryption types allowed for Kerberos;ExpectedValue', '=', parameters('NetworkSecurityConfigureEncryptionTypesAllowedForKerberos'), ',', 'Network security: LAN Manager authentication level;ExpectedValue', '=', parameters('NetworkSecurityLANManagerAuthenticationLevel'), ',', 'Network security: LDAP client signing requirements;ExpectedValue', '=', parameters('NetworkSecurityLDAPClientSigningRequirements'), ',', 'Network security: Minimum session security for NTLM SSP based (including secure RPC) clients;ExpectedValue', '=', parameters('NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCClients'), ',', 'Network security: Minimum session security for NTLM SSP based (including secure RPC) servers;ExpectedValue', '=', parameters('NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCServers')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1221c620-d201-468c-81e7-2817e6107e84\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1221c620-d201-468c-81e7-2817e6107e84\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Allowlist rules in your adaptive application control policy should be updated\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Monitor for changes in behavior on groups of machines configured for auditing by Azure Security Center's adaptive application controls. Security Center uses machine learning to analyze the running processes on your machines and suggest a list of known-safe applications. These are presented as recommended apps to allow in adaptive application control policies.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.ClassicCompute/virtualMachines\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"1234abcd-1b53-4fd4-9835-2c2fa3935313\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/123a3936-f020-408a-ba0c-47873faf1534\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"123a3936-f020-408a-ba0c-47873faf1534\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Web Application Firewall (WAF) should use the specified mode for Application Gateway\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Mandates the use of 'Detection' or 'Prevention' mode to be active on all Web Application Firewall policies for Application Gateway.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          },\r\n          \"modeRequirement\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Mode Requirement\",\r\n              \"description\": \"Mode required for all WAF policies\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Prevention\",\r\n              \"Detection\"\r\n            ],\r\n            \"defaultValue\": \"Detection\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/applicationGatewayWebApplicationFirewallPolicies\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Network/applicationGatewayWebApplicationFirewallPolicies/policySettings.mode\",\r\n                \"notEquals\": \"[parameters('modeRequirement')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/12430be1-6cc8-4527-a9a8-e3d38f250096\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"12430be1-6cc8-4527-a9a8-e3d38f250096\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Azure Data Factory linked services should use Key Vault for storing secrets\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"To ensure secrets (such as connection strings) are managed securely, require users to provide secrets using an Azure Key Vault instead of specifying them inline in linked services.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-preview\",\r\n          \"category\": \"Data Factory\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DataFactory/factories/linkedservices\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.DataFactory/factories/linkedservices/typeProperties.connectionString\",\r\n                        \"exists\": \"true\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.DataFactory/factories/linkedservices/typeProperties.connectionString\",\r\n                            \"contains\": \"AccountKey=\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.DataFactory/factories/linkedservices/typeProperties.connectionString\",\r\n                            \"contains\": \"PWD=\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.DataFactory/factories/linkedservices/typeProperties.connectionString\",\r\n                            \"contains\": \"Password=\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.DataFactory/factories/linkedservices/typeProperties.connectionString\",\r\n                            \"contains\": \"CredString=\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.DataFactory/factories/linkedservices/typeProperties.connectionString\",\r\n                            \"contains\": \"pwd=\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/linkedservices/SqlServer.typeProperties.password.type\",\r\n                    \"equals\": \"SecureString\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.DataFactory/factories/linkedservices/SqlServer.typeProperties.password\",\r\n                        \"exists\": \"true\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.DataFactory/factories/linkedservices/SqlServer.typeProperties.password.type\",\r\n                        \"exists\": \"false\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/linkedservices/AzureSqlDW.typeProperties.servicePrincipalKey.type\",\r\n                    \"equals\": \"SecureString\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/linkedservices/AzureSearch.typeProperties.key.type\",\r\n                    \"equals\": \"SecureString\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.DataFactory/factories/linkedservices/AzureStorage.typeProperties.sasUri\",\r\n                        \"exists\": \"true\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.DataFactory/factories/linkedservices/AzureStorage.typeProperties.sasUri.type\",\r\n                        \"notEquals\": \"AzureKeyVaultSecret\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.DataFactory/factories/linkedservices/AzureBlobStorage.typeProperties.servicePrincipalKey\",\r\n                        \"exists\": \"true\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.DataFactory/factories/linkedservices/AzureBlobStorage.typeProperties.servicePrincipalKey.type\",\r\n                        \"notEquals\": \"AzureKeyVaultSecret\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.DataFactory/factories/linkedservices/AzureStorage.typeProperties.accountKey\",\r\n                        \"exists\": \"true\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.DataFactory/factories/linkedservices/CosmosDb.typeProperties.accountKey.type\",\r\n                        \"notEquals\": \"AzureKeyVaultSecret\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/linkedservices/typeProperties.encryptedCredential\",\r\n                    \"exists\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/linkedservices/AmazonMWS.typeProperties.mwsAuthToken.type\",\r\n                    \"equals\": \"SecureString\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/linkedservices/AmazonMWS.typeProperties.secretKey.type\",\r\n                    \"equals\": \"SecureString\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/linkedservices/AmazonS3.typeProperties.secretAccessKey.type\",\r\n                    \"equals\": \"SecureString\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.DataFactory/factories/linkedservices/Dynamics.typeProperties.servicePrincipalCredential\",\r\n                        \"exists\": \"true\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.DataFactory/factories/linkedservices/Dynamics.typeProperties.servicePrincipalCredential.type\",\r\n                        \"equals\": \"SecureString\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.DataFactory/factories/linkedservices/Hubspot.typeProperties.accessToken\",\r\n                        \"exists\": \"true\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.DataFactory/factories/linkedservices/Hubspot.typeProperties.accessToken.type\",\r\n                        \"equals\": \"SecureString\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/linkedservices/Odbc.typeProperties.credential.type\",\r\n                    \"equals\": \"SecureString\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/linkedservices/GoogleAdWords.typeProperties.developerToken.type\",\r\n                    \"equals\": \"SecureString\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/linkedservices/GoogleBigQuery.typeProperties.clientSecret.type\",\r\n                    \"equals\": \"SecureString\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/linkedservices/GoogleBigQuery.typeProperties.refreshToken.type\",\r\n                    \"equals\": \"SecureString\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.DataFactory/factories/linkedservices/type\",\r\n                        \"in\": [\r\n                          \"MongoDbAtlas\",\r\n                          \"MongoDbV2\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.DataFactory/factories/linkedservices/typeProperties.connectionString.type\",\r\n                        \"notEquals\": \"AzureKeyVaultSecret\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/linkedservices/OData.typeProperties.servicePrincipalEmbeddedCert.type\",\r\n                    \"equals\": \"SecureString\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/linkedservices/OData.typeProperties.servicePrincipalEmbeddedCertPassword.type\",\r\n                    \"equals\": \"SecureString\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/linkedservices/Sftp.typeProperties.privateKeyContent.type\",\r\n                    \"equals\": \"SecureString\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/linkedservices/Sftp.typeProperties.passPhrase.type\",\r\n                    \"equals\": \"SecureString\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/linkedservices/Salesforce.typeProperties.securityToken.type\",\r\n                    \"equals\": \"SecureString\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/127ef6d7-242f-43b3-9eef-947faf1725d0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"127ef6d7-242f-43b3-9eef-947faf1725d0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs configurations in 'Security Options - System objects'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - System objects'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsSystemobjects\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AzureBaseline_SecurityOptionsSystemobjects\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/12ae2d24-3805-4b37-9fa9-465968bfbcfa\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"12ae2d24-3805-4b37-9fa9-465968bfbcfa\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs that do not have the specified applications installed\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines that do not have the specified applications installed. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"installedApplication\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Application names (supports wildcards)\",\r\n              \"description\": \"A semicolon-separated list of the names of the applications that should be installed. e.g. 'Microsoft SQL Server 2014 (64-bit); Microsoft Visual Studio Code' or 'Microsoft SQL Server 2014*' (to match any application starting with 'Microsoft SQL Server 2014')\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WhitelistedApplication\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('[InstalledApplication]bwhitelistedapp;Name', '=', parameters('installedApplication')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"WhitelistedApplication\"\r\n                    },\r\n                    \"installedApplication\": {\r\n                      \"value\": \"[parameters('installedApplication')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"installedApplication\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[InstalledApplication]bwhitelistedapp;Name\",\r\n                                \"value\": \"[parameters('installedApplication')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[InstalledApplication]bwhitelistedapp;Name\",\r\n                                \"value\": \"[parameters('installedApplication')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/12f7e5d0-42a7-4630-80d8-54fb7cff9bd6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"12f7e5d0-42a7-4630-80d8-54fb7cff9bd6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Configure machines to receive a vulnerability assessment agent\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Defender includes vulnerability scanning for your machines at no extra cost. You don't need a Qualys license or even a Qualys account - everything's handled seamlessly inside Security Center. When you enable this policy, Azure Defender automatically deploys the Qualys vulnerability assessment agent to all supported machines that don't already have it installed.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true,\r\n          \"version\": \"2.1.0-preview\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.HybridCompute/machines\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"ffff0522-1e88-47fc-8382-2a80ba848f5d\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"Incremental\",\r\n                  \"template\": {\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"resourceType\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('resourceType')), toLower('microsoft.compute/virtualmachines'))]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/serverVulnerabilityAssessments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.Security/default')]\",\r\n                        \"apiVersion\": \"2020-01-01\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('resourceType')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/serverVulnerabilityAssessments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.Security/default')]\",\r\n                        \"apiVersion\": \"2020-01-01\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"resourceType\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    }\r\n                  }\r\n                }\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/fb1c8493-542b-48eb-b624-b4c8fea62acd\"\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/13ce0167-8ca6-4048-8e6b-f996402e3c1b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"13ce0167-8ca6-4048-8e6b-f996402e3c1b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit Windows machines that contain certificates expiring within the specified number of days\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if certificates in the specified store have an expiration date out of range for the number of days given as parameter. The policy also provides the option to only check for specific certificates or exclude specific certificates, and whether to report on expired certificates.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"CertificateExpiration\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"CertificateStorePath\": \"[CertificateStore]CertificateStore1;CertificateStorePath\",\r\n              \"ExpirationLimitInDays\": \"[CertificateStore]CertificateStore1;ExpirationLimitInDays\",\r\n              \"CertificateThumbprintsToInclude\": \"[CertificateStore]CertificateStore1;CertificateThumbprintsToInclude\",\r\n              \"CertificateThumbprintsToExclude\": \"[CertificateStore]CertificateStore1;CertificateThumbprintsToExclude\",\r\n              \"IncludeExpiredCertificates\": \"[CertificateStore]CertificateStore1;IncludeExpiredCertificates\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"CertificateStorePath\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Certificate store path\",\r\n              \"description\": \"The path to the certificate store containing the certificates to check the expiration dates of. Default value is 'Cert:' which is the root certificate store path, so all certificates on the machine will be checked. Other example paths: 'Cert:\\\\LocalMachine', 'Cert:\\\\LocalMachine\\\\TrustedPublisher', 'Cert:\\\\CurrentUser'\"\r\n            },\r\n            \"defaultValue\": \"Cert:\"\r\n          },\r\n          \"ExpirationLimitInDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Expiration limit in days\",\r\n              \"description\": \"An integer indicating the number of days within which to check for certificates that are expiring. For example, if this value is 30, any certificate expiring within the next 30 days will cause this policy to be non-compliant.\"\r\n            },\r\n            \"defaultValue\": \"30\"\r\n          },\r\n          \"CertificateThumbprintsToInclude\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Certificate thumbprints to include\",\r\n              \"description\": \"A semicolon-separated list of certificate thumbprints to check under the specified path. If a value is not specified, all certificates under the certificate store path will be checked. If a value is specified, no certificates other than those with the thumbprints specified will be checked. e.g. THUMBPRINT1;THUMBPRINT2;THUMBPRINT3\"\r\n            },\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"CertificateThumbprintsToExclude\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Certificate thumbprints to exclude\",\r\n              \"description\": \"A semicolon-separated list of certificate thumbprints to ignore. e.g. THUMBPRINT1;THUMBPRINT2;THUMBPRINT3\"\r\n            },\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"IncludeExpiredCertificates\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include expired certificates\",\r\n              \"description\": \"Must be 'true' or 'false'. True indicates that any found certificates that have already expired will also make this policy non-compliant. False indicates that certificates that have expired will be be ignored.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"CertificateExpiration\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('[CertificateStore]CertificateStore1;CertificateStorePath', '=', parameters('CertificateStorePath'), ',', '[CertificateStore]CertificateStore1;ExpirationLimitInDays', '=', parameters('ExpirationLimitInDays'), ',', '[CertificateStore]CertificateStore1;CertificateThumbprintsToInclude', '=', parameters('CertificateThumbprintsToInclude'), ',', '[CertificateStore]CertificateStore1;CertificateThumbprintsToExclude', '=', parameters('CertificateThumbprintsToExclude'), ',', '[CertificateStore]CertificateStore1;IncludeExpiredCertificates', '=', parameters('IncludeExpiredCertificates')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1417908b-4bff-46ee-a2a6-4acc899320ab\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1417908b-4bff-46ee-a2a6-4acc899320ab\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs if the Administrators group contains any of the specified members\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines in which the Administrators group contains any of the specified members. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"MembersToExclude\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Members to exclude\",\r\n              \"description\": \"A semicolon-separated list of members that should be excluded in the Administrators local group. Ex: Administrator; myUser1; myUser2\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AdministratorsGroupMembersToExclude\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('[LocalGroup]AdministratorsGroup;MembersToExclude', '=', parameters('MembersToExclude')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AdministratorsGroupMembersToExclude\"\r\n                    },\r\n                    \"MembersToExclude\": {\r\n                      \"value\": \"[parameters('MembersToExclude')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"MembersToExclude\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[LocalGroup]AdministratorsGroup;MembersToExclude\",\r\n                                \"value\": \"[parameters('MembersToExclude')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[LocalGroup]AdministratorsGroup;MembersToExclude\",\r\n                                \"value\": \"[parameters('MembersToExclude')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/144f1397-32f9-4598-8c88-118decc3ccba\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"144f1397-32f9-4598-8c88-118decc3ccba\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy - Configure Windows machines to automatically install the Azure Security agent\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Configure Windows machines to automatically install the Azure Security agent. Security Center collects events from the agent and uses them to provide security alerts and tailored hardening tasks (recommendations). Create a resource group and Log Analytics workspace in the same region as the machine to store audit records. Target virtual machines must be in a supported location.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"version\": \"1.0.0-preview\",\r\n          \"preview\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"in\": [\r\n                  \"australiacentral\",\r\n                  \"australiaeast\",\r\n                  \"australiasoutheast\",\r\n                  \"centralindia\",\r\n                  \"centralus\",\r\n                  \"eastasia\",\r\n                  \"eastus2euap\",\r\n                  \"eastus\",\r\n                  \"eastus2\",\r\n                  \"germanywestcentral\",\r\n                  \"japaneast\",\r\n                  \"northcentralus\",\r\n                  \"northeurope\",\r\n                  \"southcentralus\",\r\n                  \"southeastasia\",\r\n                  \"uksouth\",\r\n                  \"westcentralus\",\r\n                  \"westeurope\",\r\n                  \"westus\",\r\n                  \"westus2\"\r\n                ]\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2008-R2-SP1\",\r\n                          \"2008-R2-SP1-smalldisk\",\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\",\r\n                          \"2019-Datacenter\",\r\n                          \"2019-Datacenter-Core\",\r\n                          \"2019-Datacenter-Core-smalldisk\",\r\n                          \"2019-Datacenter-Core-with-Containers\",\r\n                          \"2019-Datacenter-Core-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-smalldisk\",\r\n                          \"2019-Datacenter-with-Containers\",\r\n                          \"2019-Datacenter-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-zhcn\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerSemiAnnual\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"Datacenter-Core-1709-smalldisk\",\r\n                          \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                          \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerHPCPack\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016-BYOL\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2-BYOL\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftRServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"MLServer-WS2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftVisualStudio\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"VisualStudio\",\r\n                          \"Windows\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"windows-data-science-vm\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsDesktop\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Windows-10\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"deploymentScope\": \"subscription\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"AzureSecurityWindowsAgent\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/Publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Security.Monitoring\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"in\": [\r\n                      \"Succeeded\",\r\n                      \"Provisioning succeeded\"\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"deployment\": {\r\n                \"location\": \"eastus\",\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"resourceGroup\": {\r\n                      \"value\": \"[resourceGroup().name]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"resourceGroup\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"pairedLocations\": {\r\n                        \"australiacentral\": \"australiacentral\",\r\n                        \"australiaeast\": \"australiaeast\",\r\n                        \"australiasoutheast\": \"australiasoutheast\",\r\n                        \"centralindia\": \"centralindia\",\r\n                        \"centralus\": \"centralus\",\r\n                        \"eastasia\": \"eastasia\",\r\n                        \"eastus2euap\": \"eastus2euap\",\r\n                        \"eastus\": \"eastus\",\r\n                        \"eastus2\": \"eastus2\",\r\n                        \"germanywestcentral\": \"germanywestcentral\",\r\n                        \"japaneast\": \"japaneast\",\r\n                        \"northcentralus\": \"northcentralus\",\r\n                        \"northeurope\": \"northeurope\",\r\n                        \"southcentralus\": \"southcentralus\",\r\n                        \"southeastasia\": \"southeastasia\",\r\n                        \"uksouth\": \"uksouth\",\r\n                        \"westcentralus\": \"westcentralus\",\r\n                        \"westeurope\": \"westeurope\",\r\n                        \"westus\": \"westus\",\r\n                        \"westus2\": \"westus2\"\r\n                      },\r\n                      \"locationLongNameToShortMap\": {\r\n                        \"australiacentral\": \"CAU\",\r\n                        \"australiaeast\": \"EAU\",\r\n                        \"australiasoutheast\": \"SEAU\",\r\n                        \"centralindia\": \"CIN\",\r\n                        \"centralus\": \"CUS\",\r\n                        \"eastasia\": \"EA\",\r\n                        \"eastus2euap\": \"eus2p\",\r\n                        \"eastus\": \"EUS\",\r\n                        \"eastus2\": \"EUS2\",\r\n                        \"germanywestcentral\": \"DEWC\",\r\n                        \"japaneast\": \"EJP\",\r\n                        \"northcentralus\": \"NCUS\",\r\n                        \"northeurope\": \"NEU\",\r\n                        \"southcentralus\": \"SCUS\",\r\n                        \"southeastasia\": \"SEA\",\r\n                        \"uksouth\": \"SUK\",\r\n                        \"westcentralus\": \"WCUS\",\r\n                        \"westeurope\": \"WEU\",\r\n                        \"westus\": \"WUS\",\r\n                        \"westus2\": \"WUS2\"\r\n                      },\r\n                      \"locationCode\": \"[variables('locationLongNameToShortMap')[variables('pairedLocations')[parameters('location')]]]\",\r\n                      \"subscriptionId\": \"[subscription().subscriptionId]\",\r\n                      \"defaultRGName\": \"[concat('DefaultResourceGroup-', variables('locationCode'))]\",\r\n                      \"defaultRGLocation\": \"[variables('pairedLocations')[parameters('location')]]\",\r\n                      \"workspaceName\": \"[concat('defaultWorkspace-', variables('subscriptionId'),'-', variables('locationCode'))]\",\r\n                      \"dcrName\": \"[concat('Microsoft-Security-', variables('locationCode'), '-dcr')]\",\r\n                      \"dcrId\": \"[concat('/subscriptions/', variables('subscriptionId'), '/resourceGroups/', variables('defaultRGName'), '/providers/Microsoft.Insights/dataCollectionRules/', variables('dcrName'))]\",\r\n                      \"dcraName\": \"[concat(parameters('vmName'),'/Microsoft.Insights/Security-RulesAssociation')]\",\r\n                      \"deployAzureSecurityWindowsAgent\": \"[concat('deployAzureSecurityWindowsAgent-', uniqueString(deployment().name))]\",\r\n                      \"deployDefaultAscResourceGroup\": \"[concat('deployDefaultAscResourceGroup-', uniqueString(deployment().name))]\",\r\n                      \"deployDataCollectionRulesAssociation\": \"[concat('deployDataCollectionRulesAssociation-', uniqueString(deployment().name))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('deployAzureSecurityWindowsAgent')]\",\r\n                        \"apiVersion\": \"2020-06-01\",\r\n                        \"resourceGroup\": \"[parameters('resourceGroup')]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"expressionEvaluationOptions\": {\r\n                            \"scope\": \"inner\"\r\n                          },\r\n                          \"parameters\": {\r\n                            \"location\": {\r\n                              \"value\": \"[parameters('location')]\"\r\n                            },\r\n                            \"vmName\": {\r\n                              \"value\": \"[parameters('vmName')]\"\r\n                            }\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"location\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"vmName\": {\r\n                                \"type\": \"string\"\r\n                              }\r\n                            },\r\n                            \"variables\": {},\r\n                            \"resources\": [\r\n                              {\r\n                                \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                                \"name\": \"[concat(parameters('vmName'), '/', 'AzureSecurityWindowsAgent')]\",\r\n                                \"apiVersion\": \"2019-03-01\",\r\n                                \"location\": \"[parameters('location')]\",\r\n                                \"properties\": {\r\n                                  \"publisher\": \"Microsoft.Azure.Security.Monitoring\",\r\n                                  \"type\": \"AzureSecurityWindowsAgent\",\r\n                                  \"typeHandlerVersion\": \"1.0\",\r\n                                  \"autoUpgradeMinorVersion\": \"true\",\r\n                                  \"settings\": {},\r\n                                  \"protectedsettings\": {}\r\n                                }\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                        \"name\": \"[variables('defaultRGName')]\",\r\n                        \"apiVersion\": \"2019-05-01\",\r\n                        \"location\": \"[variables('defaultRGLocation')]\"\r\n                      },\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('deployDefaultAscResourceGroup')]\",\r\n                        \"apiVersion\": \"2020-06-01\",\r\n                        \"resourceGroup\": \"[variables('defaultRGName')]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"expressionEvaluationOptions\": {\r\n                            \"scope\": \"inner\"\r\n                          },\r\n                          \"parameters\": {\r\n                            \"defaultRGLocation\": {\r\n                              \"value\": \"[variables('defaultRGLocation')]\"\r\n                            },\r\n                            \"workspaceName\": {\r\n                              \"value\": \"[variables('workspaceName')]\"\r\n                            },\r\n                            \"dcrName\": {\r\n                              \"value\": \"[variables('dcrName')]\"\r\n                            }\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"defaultRGLocation\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"workspaceName\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"dcrName\": {\r\n                                \"type\": \"string\"\r\n                              }\r\n                            },\r\n                            \"variables\": {\r\n                              \"securitySolution\": {\r\n                                \"Name\": \"[Concat('Security', '(', parameters('workspaceName'), ')')]\",\r\n                                \"GalleryName\": \"Security\"\r\n                              },\r\n                              \"securityCenterFreeSolution\": {\r\n                                \"Name\": \"[Concat('SecurityCenterFree', '(', parameters('workspaceName'), ')')]\",\r\n                                \"GalleryName\": \"SecurityCenterFree\"\r\n                              }\r\n                            },\r\n                            \"resources\": [\r\n                              {\r\n                                \"type\": \"Microsoft.OperationalInsights/workspaces\",\r\n                                \"name\": \"[parameters('workspaceName')]\",\r\n                                \"apiVersion\": \"2015-11-01-preview\",\r\n                                \"location\": \"[parameters('defaultRGLocation')]\",\r\n                                \"properties\": {\r\n                                  \"sku\": {\r\n                                    \"name\": \"pernode\"\r\n                                  },\r\n                                  \"retentionInDays\": 30,\r\n                                  \"features\": {\r\n                                    \"searchVersion\": 1\r\n                                  }\r\n                                }\r\n                              },\r\n                              {\r\n                                \"type\": \"Microsoft.OperationsManagement/solutions\",\r\n                                \"name\": \"[variables('securitySolution').Name]\",\r\n                                \"apiVersion\": \"2015-11-01-preview\",\r\n                                \"location\": \"[parameters('defaultRGLocation')]\",\r\n                                \"dependsOn\": [\r\n                                  \"[parameters('workspaceName')]\"\r\n                                ],\r\n                                \"properties\": {\r\n                                  \"workspaceResourceId\": \"[resourceId('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]\"\r\n                                },\r\n                                \"plan\": {\r\n                                  \"name\": \"[variables('securitySolution').Name]\",\r\n                                  \"publisher\": \"Microsoft\",\r\n                                  \"product\": \"[Concat('OMSGallery/', variables('securitySolution').GalleryName)]\",\r\n                                  \"promotionCode\": \"\"\r\n                                }\r\n                              },\r\n                              {\r\n                                \"type\": \"Microsoft.OperationsManagement/solutions\",\r\n                                \"name\": \"[variables('securityCenterFreeSolution').Name]\",\r\n                                \"apiVersion\": \"2015-11-01-preview\",\r\n                                \"location\": \"[parameters('defaultRGLocation')]\",\r\n                                \"dependsOn\": [\r\n                                  \"[parameters('workspaceName')]\"\r\n                                ],\r\n                                \"properties\": {\r\n                                  \"workspaceResourceId\": \"[resourceId('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]\"\r\n                                },\r\n                                \"plan\": {\r\n                                  \"name\": \"[variables('securityCenterFreeSolution').Name]\",\r\n                                  \"publisher\": \"Microsoft\",\r\n                                  \"product\": \"[Concat('OMSGallery/', variables('securityCenterFreeSolution').GalleryName)]\",\r\n                                  \"promotionCode\": \"\"\r\n                                }\r\n                              },\r\n                              {\r\n                                \"type\": \"Microsoft.Insights/dataCollectionRules\",\r\n                                \"name\": \"[parameters('dcrName')]\",\r\n                                \"apiVersion\": \"2019-11-01-preview\",\r\n                                \"location\": \"[parameters('defaultRGLocation')]\",\r\n                                \"dependsOn\": [\r\n                                  \"[parameters('workspaceName')]\"\r\n                                ],\r\n                                \"properties\": {\r\n                                  \"description\": \"Data collection rule for Azure Security Center. Deleting this rule will break the detection of security vulnerabilities.\",\r\n                                  \"dataSources\": {\r\n                                    \"windowsEventLogs\": [\r\n                                      {\r\n                                        \"name\": \"RomeDetectionEventDataSource\",\r\n                                        \"streams\": [\r\n                                          \"Microsoft-RomeDetectionEvent\"\r\n                                        ],\r\n                                        \"scheduledTransferPeriod\": \"PT5M\",\r\n                                        \"xPathQueries\": [\r\n                                          \"Security!*\",\r\n                                          \"Microsoft-Windows-AppLocker/EXE and DLL!*\"\r\n                                        ]\r\n                                      }\r\n                                    ],\r\n                                    \"syslog\": [\r\n                                      {\r\n                                        \"name\": \"SyslogDataSource\",\r\n                                        \"streams\": [\r\n                                          \"Microsoft-Syslog\"\r\n                                        ],\r\n                                        \"facilityNames\": [\r\n                                          \"kern\",\r\n                                          \"auth\",\r\n                                          \"authpriv\",\r\n                                          \"cron\",\r\n                                          \"user\",\r\n                                          \"daemon\",\r\n                                          \"syslog\",\r\n                                          \"local0\"\r\n                                        ],\r\n                                        \"logLevels\": [\r\n                                          \"Debug\",\r\n                                          \"Critical\",\r\n                                          \"Emergency\"\r\n                                        ]\r\n                                      }\r\n                                    ],\r\n                                    \"extensions\": [\r\n                                      {\r\n                                        \"extensionName\": \"AzureSecurityLinuxAgent\",\r\n                                        \"name\": \"AscLinuxDataSource\",\r\n                                        \"streams\": [\r\n                                          \"Microsoft-OperationLog\",\r\n                                          \"Microsoft-SecurityBaseline\",\r\n                                          \"Microsoft-SecurityBaselineSummary\",\r\n                                          \"Microsoft-ProcessInvestigator\",\r\n                                          \"Microsoft-Auditd\",\r\n                                          \"Microsoft-ProtectionStatus\",\r\n                                          \"Microsoft-Heartbeat\"\r\n                                        ],\r\n                                        \"extensionSettings\": {\r\n                                          \"scanners\": [\r\n                                            {\r\n                                              \"name\": \"heartbeat\",\r\n                                              \"frequency\": \"PT1H\"\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"time\",\r\n                                              \"frequency\": \"PT8H\"\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"antimalware\",\r\n                                              \"frequency\": \"PT8H\"\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"codeintegrity\",\r\n                                              \"frequency\": \"P1D\"\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"processinvestigator\",\r\n                                              \"frequency\": \"PT1H\"\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"baseline\",\r\n                                              \"frequency\": \"P1D\",\r\n                                              \"options\": [\r\n                                                {\r\n                                                  \"name\": \"Baseline\",\r\n                                                  \"value\": \"Azure.Ubuntu\"\r\n                                                },\r\n                                                {\r\n                                                  \"name\": \"AscBaseline\",\r\n                                                  \"value\": \"OMS.Linux\"\r\n                                                }\r\n                                              ]\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"docker\",\r\n                                              \"frequency\": \"P1D\",\r\n                                              \"options\": [\r\n                                                {\r\n                                                  \"name\": \"Baseline\",\r\n                                                  \"value\": \"Azure.Docker.Linux\"\r\n                                                },\r\n                                                {\r\n                                                  \"name\": \"AscBaseline\",\r\n                                                  \"value\": \"OMS.Docker.Linux\"\r\n                                                }\r\n                                              ]\r\n                                            }\r\n                                          ]\r\n                                        }\r\n                                      },\r\n                                      {\r\n                                        \"extensionName\": \"AzureSecurityWindowsAgent\",\r\n                                        \"name\": \"AsaWindowsDataSource\",\r\n                                        \"streams\": [\r\n                                          \"Microsoft-OperationLog\",\r\n                                          \"Microsoft-SecurityBaseline\",\r\n                                          \"Microsoft-ProcessInvestigator\",\r\n                                          \"Microsoft-ProtectionStatus\",\r\n                                          \"Microsoft-SecurityBaselineSummary\"\r\n                                        ],\r\n                                        \"extensionSettings\": {\r\n                                          \"scanners\": [\r\n                                            {\r\n                                              \"name\": \"heartbeat\",\r\n                                              \"frequency\": \"PT1H\"\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"baseline\",\r\n                                              \"frequency\": \"P1D\"\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"antimalware\",\r\n                                              \"frequency\": \"P1D\"\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"processinvestigator\",\r\n                                              \"frequency\": \"PT1H\"\r\n                                            }\r\n                                          ]\r\n                                        }\r\n                                      }\r\n                                    ]\r\n                                  },\r\n                                  \"destinations\": {\r\n                                    \"logAnalytics\": [\r\n                                      {\r\n                                        \"workspaceResourceId\": \"[resourceId('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]\",\r\n                                        \"name\": \"LogAnalyticsDest\"\r\n                                      }\r\n                                    ]\r\n                                  },\r\n                                  \"dataFlows\": [\r\n                                    {\r\n                                      \"streams\": [\r\n                                        \"Microsoft-Syslog\",\r\n                                        \"Microsoft-OperationLog\",\r\n                                        \"Microsoft-SecurityBaseline\",\r\n                                        \"Microsoft-SecurityBaselineSummary\",\r\n                                        \"Microsoft-RomeDetectionEvent\",\r\n                                        \"Microsoft-ProcessInvestigator\",\r\n                                        \"Microsoft-Auditd\",\r\n                                        \"Microsoft-ProtectionStatus\",\r\n                                        \"Microsoft-Heartbeat\"\r\n                                      ],\r\n                                      \"destinations\": [\r\n                                        \"LogAnalyticsDest\"\r\n                                      ]\r\n                                    }\r\n                                  ]\r\n                                }\r\n                              }\r\n                            ]\r\n                          }\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[resourceId('Microsoft.Resources/resourceGroups', variables('defaultRGName'))]\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('deployDataCollectionRulesAssociation')]\",\r\n                        \"apiVersion\": \"2020-06-01\",\r\n                        \"resourceGroup\": \"[parameters('resourceGroup')]\",\r\n                        \"dependsOn\": [\r\n                          \"[variables('deployDefaultAscResourceGroup')]\"\r\n                        ],\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"expressionEvaluationOptions\": {\r\n                            \"scope\": \"inner\"\r\n                          },\r\n                          \"parameters\": {\r\n                            \"location\": {\r\n                              \"value\": \"[parameters('location')]\"\r\n                            },\r\n                            \"vmName\": {\r\n                              \"value\": \"[parameters('vmName')]\"\r\n                            },\r\n                            \"dcrId\": {\r\n                              \"value\": \"[variables('dcrId')]\"\r\n                            },\r\n                            \"dcraName\": {\r\n                              \"value\": \"[variables('dcraName')]\"\r\n                            }\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"location\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"vmName\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"dcrId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"dcraName\": {\r\n                                \"type\": \"string\"\r\n                              }\r\n                            },\r\n                            \"variables\": {},\r\n                            \"resources\": [\r\n                              {\r\n                                \"type\": \"Microsoft.Compute/virtualMachines/providers/dataCollectionRuleAssociations\",\r\n                                \"name\": \"[parameters('dcraName')]\",\r\n                                \"apiVersion\": \"2019-11-01-preview\",\r\n                                \"properties\": {\r\n                                  \"description\": \"Association of data collection rule for Azure Security Center. Deleting this association will break the detection of security vulnerabilities for this virtual machine.\",\r\n                                  \"dataCollectionRuleId\": \"[parameters('dcrId')]\"\r\n                                }\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1537496a-b1e8-482b-a06a-1cc2415cdc7b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1537496a-b1e8-482b-a06a-1cc2415cdc7b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Log Analytics agent should be installed on your Cloud Services (extended support) role instances\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Security Center collects data from your Cloud Services (extended support) role instances to monitor for security vulnerabilities and threats.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/cloudServices\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"45cfe080-ceb1-a91e-9743-71551ed24e94\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/15fdbc87-8a47-4ee9-a2aa-9a2ea1f37554\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"15fdbc87-8a47-4ee9-a2aa-9a2ea1f37554\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs that do not have a minimum password age of 1 day\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines that do not have a minimum password age of 1 day. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"2.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"MinimumPasswordAge\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"MinimumPasswordAge\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/16390df4-2f73-4b42-af13-c801066763df\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"16390df4-2f73-4b42-af13-c801066763df\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs that do not have the specified Windows PowerShell modules installed\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that do not have the specified Windows PowerShell modules installed. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsPowerShellModules\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/16f9b37c-4408-4c30-bc17-254958f2e2d6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"16f9b37c-4408-4c30-bc17-254958f2e2d6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy associations for a managed application\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploys an association resource that associates selected resource types to the specified managed application.  This policy deployment does not support nested resource types.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Managed Application\"\r\n        },\r\n        \"parameters\": {\r\n          \"targetManagedApplicationId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Managed application ID\",\r\n              \"description\": \"Resource ID of the managed application to which resources need to be associated.\"\r\n            }\r\n          },\r\n          \"resourceTypesToAssociate\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Resource types to associate\",\r\n              \"description\": \"The list of resource types to be associated to the managed application.\",\r\n              \"strongType\": \"resourceTypes\"\r\n            }\r\n          },\r\n          \"associationNamePrefix\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Association name prefix\",\r\n              \"description\": \"Prefix to be added to the name of the association resource being created.\"\r\n            },\r\n            \"defaultValue\": \"DeployedByPolicy\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": \"[parameters('resourceTypesToAssociate')]\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.CustomProviders/Associations\",\r\n              \"name\": \"[concat(parameters('associationNamePrefix'), '-', uniqueString(parameters('targetManagedApplicationId')))]\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"associatedResourceName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"resourceTypesToAssociate\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"targetManagedApplicationId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"associationNamePrefix\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"resourceType\": \"[concat(parameters('resourceTypesToAssociate'), '/providers/associations')]\",\r\n                      \"resourceName\": \"[concat(parameters('associatedResourceName'), '/microsoft.customproviders/', parameters('associationNamePrefix'), '-', uniqueString(parameters('targetManagedApplicationId')))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"apiVersion\": \"2017-05-10\",\r\n                        \"name\": \"[concat(deployment().Name, '-2')]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"resources\": [\r\n                              {\r\n                                \"type\": \"[variables('resourceType')]\",\r\n                                \"name\": \"[variables('resourceName')]\",\r\n                                \"apiVersion\": \"2018-09-01-preview\",\r\n                                \"properties\": {\r\n                                  \"targetResourceId\": \"[parameters('targetManagedApplicationId')]\"\r\n                                }\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"resourceTypesToAssociate\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"associatedResourceName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"targetManagedApplicationId\": {\r\n                      \"value\": \"[parameters('targetManagedApplicationId')]\"\r\n                    },\r\n                    \"associationNamePrefix\": {\r\n                      \"value\": \"[parameters('associationNamePrefix')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/17763ad9-70c0-4794-9397-53d765932634\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"17763ad9-70c0-4794-9397-53d765932634\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[ASC Private Preview] Configure system-assigned managed identity to enable Azure Monitor assignments on VMs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"[ASC Private Preview] Configure system-assigned managed identity to virtual machines hosted in Azure that are supported by Azure Monitor that do not have a system-assigned managed identity. A system-assigned managed identity is a prerequisite for all Azure Monitor assignments and must be added to machines before using any Azure Monitor extension. Target virtual machines must be in a supported location.\",\r\n        \"metadata\": {\r\n          \"category\": \"Monitoring\",\r\n          \"version\": \"2.0.0-preview\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Modify\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Modify\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"in\": [\r\n                  \"australiacentral\",\r\n                  \"australiaeast\",\r\n                  \"australiasoutheast\",\r\n                  \"centralindia\",\r\n                  \"centralus\",\r\n                  \"eastasia\",\r\n                  \"eastus\",\r\n                  \"eastus2\",\r\n                  \"germanywestcentral\",\r\n                  \"japaneast\",\r\n                  \"northcentralus\",\r\n                  \"northeurope\",\r\n                  \"southcentralus\",\r\n                  \"southeastasia\",\r\n                  \"uksouth\",\r\n                  \"westcentralus\",\r\n                  \"westeurope\",\r\n                  \"westus\",\r\n                  \"westus2\"\r\n                ]\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-SAP-HANA\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"SLES\",\r\n                          \"SLES-HPC\",\r\n                          \"SLES-HPC-Priority\",\r\n                          \"SLES-SAP\",\r\n                          \"SLES-SAP-BYOS\",\r\n                          \"SLES-Priority\",\r\n                          \"SLES-BYOS\",\r\n                          \"SLES-SAPCAL\",\r\n                          \"SLES-Standard\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"12*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"14.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"16.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"18.04*LTS\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Oracle\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Oracle-Linux\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"7.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"CentOS\",\r\n                          \"Centos-LVM\",\r\n                          \"CentOS-SRIOV\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-centos-os\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"like\": \"7*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"credativ\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"debian\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"8\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"9\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Debian\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"debian-10\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"like\": \"10\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"in\": [\r\n                          \"2008-R2-SP1\",\r\n                          \"2008-R2-SP1-smalldisk\",\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\",\r\n                          \"2019-Datacenter\",\r\n                          \"2019-Datacenter-Core\",\r\n                          \"2019-Datacenter-Core-smalldisk\",\r\n                          \"2019-Datacenter-Core-with-Containers\",\r\n                          \"2019-Datacenter-Core-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-smalldisk\",\r\n                          \"2019-Datacenter-with-Containers\",\r\n                          \"2019-Datacenter-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-zhcn\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerSemiAnnual\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"in\": [\r\n                          \"Datacenter-Core-1709-smalldisk\",\r\n                          \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                          \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerHPCPack\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016-BYOL\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2-BYOL\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftRServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"MLServer-WS2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftVisualStudio\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"VisualStudio\",\r\n                          \"Windows\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"windows-data-science-vm\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsDesktop\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Windows-10\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings\",\r\n                    \"exists\": \"true\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"value\": \"[requestContext().apiVersion]\",\r\n                \"greaterOrEquals\": \"2018-10-01\"\r\n              },\r\n              {\r\n                \"field\": \"identity.type\",\r\n                \"notContains\": \"SystemAssigned\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"\r\n              ],\r\n              \"operations\": [\r\n                {\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"identity.type\",\r\n                  \"value\": \"[if(contains(field('identity.type'), 'UserAssigned'), concat(field('identity.type'), ',SystemAssigned'), 'SystemAssigned')]\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/17b3de92-f710-4cf4-aa55-0e7859f1ed7b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"17b3de92-f710-4cf4-aa55-0e7859f1ed7b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Transparent Data Encryption on SQL databases should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Transparent data encryption should be enabled to protect data-at-rest and meet compliance requirements\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers/databases\"\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"notEquals\": \"master\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/databases/transparentDataEncryption\",\r\n              \"name\": \"current\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/transparentDataEncryption.status\",\r\n                    \"equals\": \"enabled\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/17k78e20-9358-41c9-923c-fb736d382a12\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"17k78e20-9358-41c9-923c-fb736d382a12\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Bring your own key data protection should be enabled for PostgreSQL servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use customer-managed keys to manage the encryption at rest of your PostgreSQL servers. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.3\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.DBforPostgreSQL/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.DBforPostgreSQL/servers/keys\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.DBforPostgreSQL/servers/keys/serverKeyType\",\r\n                    \"equals\": \"AzureKeyVault\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DBforPostgreSQL/servers/keys/uri\",\r\n                    \"notEquals\": \"\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DBforPostgreSQL/servers/keys/uri\",\r\n                    \"exists\": \"true\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/18adea5e-f416-4d0f-8aa8-d24321e3e274\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"18adea5e-f416-4d0f-8aa8-d24321e3e274\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'System Audit Policies - Logon-Logoff'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'System Audit Policies - Logon-Logoff' for auditing IPSec, network policy, claims, account lockout, group membership, and logon/logoff events. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_SystemAuditPoliciesLogonLogoff\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"AuditGroupMembership\": \"Audit Group Membership;ExpectedValue\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"AuditGroupMembership\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit Group Membership\",\r\n              \"description\": \"Specifies whether audit events are generated when group memberships are enumerated on the client computer.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"No Auditing\",\r\n              \"Success\",\r\n              \"Failure\",\r\n              \"Success and Failure\"\r\n            ],\r\n            \"defaultValue\": \"Success\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SystemAuditPoliciesLogonLogoff\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('Audit Group Membership;ExpectedValue', '=', parameters('AuditGroupMembership')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/19be9779-c776-4dfa-8a15-a2fd5dc843d6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"19be9779-c776-4dfa-8a15-a2fd5dc843d6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Monitor log profile should collect logs for categories 'write,' 'delete,' and 'action'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy ensures that a log profile collects logs for categories 'write,' 'delete,' and 'action'\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/logprofiles\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/categories[*]\",\r\n                      \"notEquals\": \"Write\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/categories[*]\",\r\n                      \"notEquals\": \"Delete\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/categories[*]\",\r\n                      \"notEquals\": \"Action\"\r\n                    }\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1a4e592a-6a6e-44a5-9814-e36264ca96e7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1a4e592a-6a6e-44a5-9814-e36264ca96e7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Access to App Services should be restricted\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Azure security center has discovered that the networking configuration of some of your app services are overly permissive and allow inbound traffic from ranges that are too broad\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Disabled\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Web/sites\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"restrictAccessToAppServices\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"in\": [\r\n                  \"OffByPolicy\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1a833ff1-d297-4a0f-9944-888428f8e0ff\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1a833ff1-d297-4a0f-9944-888428f8e0ff\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Event Grid topics should disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disabling public network access improves security by ensuring that the resource isn't exposed on the public internet. You can limit exposure of your resources by creating private endpoints instead. Learn more at: https://aka.ms/privateendpoints.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Event Grid\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.EventGrid/topics\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"notEquals\": \"AzureArc\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.EventGrid/topics/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1adadefe-5f21-44f7-b931-a59b54ccdb45\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1adadefe-5f21-44f7-b931-a59b54ccdb45\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Vulnerability assessment should be enabled on SQL Managed Instance\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit each SQL Managed Instance which doesn't have recurring vulnerability assessment scans enabled. Vulnerability assessment can discover, track, and help you remediate potential database vulnerabilities.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/managedInstances\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/managedInstances/vulnerabilityAssessments\",\r\n              \"name\": \"default\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Sql/managedInstances/vulnerabilityAssessments/recurringScans.isEnabled\",\r\n                \"equals\": \"True\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1b7aa243-30e4-4c9e-bca8-d0d3022b634a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1b7aa243-30e4-4c9e-bca8-d0d3022b634a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Public network access on Azure SQL Database should be disabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disabling the public network access property improves security by ensuring your Azure SQL Database can only be accessed from a private endpoint. This configuration denies all logins that match IP or virtual network based firewall rules.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.0\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Sql/servers/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1b8ca024-1d5c-4dec-8995-b1a932b41780\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1b8ca024-1d5c-4dec-8995-b1a932b41780\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Application Insights components should block log ingestion and querying from public networks\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Improve Application Insights security by blocking log ingestion and querying from public networks. Only private-link connected networks will be able to ingest and query logs of this component. Learn more at https://aka.ms/AzMonPrivateLink#configure-application-insights.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"audit\",\r\n              \"deny\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Insights/components\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/components/publicNetworkAccessForIngestion\",\r\n                    \"notEquals\": \"disabled\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/components/publicNetworkAccessForQuery\",\r\n                    \"notEquals\": \"disabled\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1bc02227-0cb6-4e11-8f53-eb0b22eab7e8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1bc02227-0cb6-4e11-8f53-eb0b22eab7e8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Ensure that 'PHP version' is the latest, if used as a part of the API app\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Periodically, newer versions are released for PHP software either due to security flaws or to include additional functionality. Using the latest PHP version for API apps is recommended in order to take advantage of security fixes, if any, and/or new functionalities of the latest version. Currently, this policy only applies to Linux web apps.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.1.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"PHPLatestVersion\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Latest PHP version\",\r\n              \"description\": \"Latest supported PHP version for App Services\"\r\n            },\r\n            \"defaultValue\": \"7.4\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"*api\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"contains\": \"linux\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/web.linuxFxVersion\",\r\n                    \"notContains\": \"PHP\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/web.linuxFxVersion\",\r\n                    \"equals\": \"[concat('PHP|', parameters('PHPLatestVersion'))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1bc1795e-d44a-4d48-9b3b-6fff0fd5f9ba\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1bc1795e-d44a-4d48-9b3b-6fff0fd5f9ba\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Service Bus namespaces should use private link\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to Service Bus namespaces, data leakage risks are reduced. Learn more at: https://docs.microsoft.com/azure/service-bus-messaging/private-link-service.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Service Bus\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ServiceBus/namespaces\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.ServiceBus/namespaces/sku.tier\",\r\n                \"equals\": \"Premium\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.ServiceBus/namespaces/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.ServiceBus/namespaces/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1c06e275-d63d-4540-b761-71f364c2111d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1c06e275-d63d-4540-b761-71f364c2111d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy - Configure Dependency agent to be enabled on Windows virtual machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Dependency agent for Windows virtual machines if the virtual machine image is in the list defined and the agent is not installed.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfImageIdToInclude\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of virtual machine images that have supported Windows OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageId\",\r\n                    \"in\": \"[parameters('listOfImageIdToInclude')]\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2008-R2-SP1\",\r\n                          \"2008-R2-SP1-smalldisk\",\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\",\r\n                          \"2019-Datacenter\",\r\n                          \"2019-Datacenter-Core\",\r\n                          \"2019-Datacenter-Core-smalldisk\",\r\n                          \"2019-Datacenter-Core-with-Containers\",\r\n                          \"2019-Datacenter-Core-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-smalldisk\",\r\n                          \"2019-Datacenter-with-Containers\",\r\n                          \"2019-Datacenter-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-zhcn\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerSemiAnnual\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"Datacenter-Core-1709-smalldisk\",\r\n                          \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                          \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerHPCPack\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016-BYOL\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2-BYOL\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftRServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"MLServer-WS2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftVisualStudio\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"VisualStudio\",\r\n                          \"Windows\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-V4\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"windows-data-science-vm\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsDesktop\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Windows-10\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"DependencyAgentWindows\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Monitoring.DependencyAgent\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"DependencyAgentWindows\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.Azure.Monitoring.DependencyAgent\",\r\n                      \"vmExtensionType\": \"DependencyAgentWindows\",\r\n                      \"vmExtensionTypeHandlerVersion\": \"9.6\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"typeHandlerVersion\": \"[variables('vmExtensionTypeHandlerVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for VM', ': ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1c210e94-a481-4beb-95fa-1571b434fb04\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1c210e94-a481-4beb-95fa-1571b434fb04\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: vTPM should be enabled on supported virtual machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enable virtual TPM device on supported virtual machines to facilitate Measured Boot and other OS security features that require a TPM. Once enabled, vTPM can be used to attest boot integrity. This assessment only applies to trusted launch enabled virtual machines.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"version\": \"1.0.0-preview\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings\",\r\n                \"exists\": \"true\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings.vTpmEnabled\",\r\n                \"notequals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1c30f9cd-b84c-49cc-aa2c-9288447cc3b3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1c30f9cd-b84c-49cc-aa2c-9288447cc3b3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Guest Attestation extension should be installed on supported Windows virtual machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Install Guest Attestation extension on supported virtual machines to allow Azure Security Center to proactively attest and monitor the boot integrity. Once installed, boot integrity will be attested via Remote Attestation. This assessment only applies to trusted launch enabled virtual machines.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"version\": \"1.0.0-preview\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.imageReference.offer\",\r\n                \"like\": \"windows*\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings\",\r\n                \"exists\": \"true\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings.secureBootEnabled\",\r\n                \"equals\": \"true\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings.vTpmEnabled\",\r\n                \"equals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Security.WindowsAttestation\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"GuestAttestation\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"in\": [\r\n                      \"Succeeded\",\r\n                      \"Provisioning succeeded\"\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1cb4d9c2-f88f-4069-bee0-dba239a57b09\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1cb4d9c2-f88f-4069-bee0-dba239a57b09\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Public network access on Azure Data Factory should be disabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disabling the public network access property improves security by ensuring your Azure Data Factory can only be accessed from a private endpoint.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Data Factory\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DataFactory/factories\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DataFactory/factories/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1cf164be-6819-4a50-b8fa-4bcaa4f98fb6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1cf164be-6819-4a50-b8fa-4bcaa4f98fb6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure File Sync should use private link\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Creating a private endpoint for the indicated Storage Sync Service resource allows you to address your Storage Sync Service resource from within the private IP address space of your organization's network, rather than through the internet-accessible public endpoint. Creating a private endpoint by itself does not disable the public endpoint.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.StorageSync/storageSyncServices\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.StorageSync/storageSyncServices/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.StorageSync/storageSyncServices/privateEndpointConnections/privateEndpoint\",\r\n                    \"exists\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.StorageSync/storageSyncServices/privateEndpointConnections/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.StorageSync/storageSyncServices/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                    \"equals\": \"Approved\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1d320205-c6a1-4ac6-873d-46224024e8e2\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1d320205-c6a1-4ac6-873d-46224024e8e2\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Kubernetes clusters with specified GitOps configuration using no secrets\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy a 'sourceControlConfiguration' to Kubernetes clusters to assure that the clusters get their source of truth for workloads and configurations from the defined git repo. This definition requires no secrets. For instructions, visit https://aka.ms/K8sGitOpsPolicy.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Kubernetes\"\r\n        },\r\n        \"parameters\": {\r\n          \"configurationResourceName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Configuration resource name\",\r\n              \"description\": \"The name for the sourceControlConfiguration.  Learn more about setting up GitOps configuration: https://aka.ms/AzureArcK8sUsingGitOps.\"\r\n            }\r\n          },\r\n          \"operatorInstanceName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Operator instance name\",\r\n              \"description\": \"Name used in the operator instances. Maximum of 23 lowercase alphanumeric characters or hyphen. Must start and end with an alphanumeric character.\"\r\n            }\r\n          },\r\n          \"operatorNamespace\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Operator namespace\",\r\n              \"description\": \"Namespace within which the operators will be installed. Maximum of 23 lowercase alphanumeric characters or hyphen. Must start and end with an alphanumeric character.\"\r\n            }\r\n          },\r\n          \"operatorScope\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Operator scope\",\r\n              \"description\": \"The permission scope for the operator. Possible values are 'cluster' (full access) or 'namespace' (restricted access).\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"cluster\",\r\n              \"namespace\"\r\n            ],\r\n            \"defaultValue\": \"namespace\"\r\n          },\r\n          \"operatorType\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Operator type\",\r\n              \"description\": \"The type of operator to install. Currently, 'Flux' is supported.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Flux\"\r\n            ],\r\n            \"defaultValue\": \"Flux\"\r\n          },\r\n          \"operatorParams\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Operator parameters\",\r\n              \"description\": \"Parameters to set on the Flux operator, separated by spaces.  For example, --git-readonly --sync-garbage-collection.  Learn more: http://aka.ms/AzureArcK8sFluxOperatorParams.\"\r\n            },\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"repositoryUrl\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Repository Url\",\r\n              \"description\": \"The URL for the source control repository. Learn more about URL formats: https://aka.ms/GitOpsRepoUrlParameters\"\r\n            }\r\n          },\r\n          \"enableHelmOperator\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable Helm\",\r\n              \"description\": \"Indicate whether to enable Helm for this instance of Flux. Learn more: http://aka.ms/AzureArcK8sGitOpsWithHelm.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"true\"\r\n          },\r\n          \"chartVersion\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Helm chart version for installing Flux Helm\",\r\n              \"description\": \"The version of the Helm chart for installing Flux Helm. For example, 1.2.0\"\r\n            },\r\n            \"defaultValue\": \"1.2.0\"\r\n          },\r\n          \"chartValues\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Helm chart parameters for installing Flux Helm\",\r\n              \"description\": \"Parameters for the Helm chart for installing Flux Helm, separated by spaces. For example, --set helm.versions=v3\"\r\n            },\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"deployIfNotExists\",\r\n              \"auditIfNotExists\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"deployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Kubernetes/connectedClusters\",\r\n              \"Microsoft.ContainerService/managedClusters\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.KubernetesConfiguration/sourceControlConfigurations\",\r\n              \"name\": \"[parameters('configurationResourceName')]\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"deploymentScope\": \"ResourceGroup\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.KubernetesConfiguration/sourceControlConfigurations/operatorParams\",\r\n                    \"in\": [\r\n                      \"[parameters('operatorParams')]\",\r\n                      \"[concat('--git-readonly ',parameters('operatorParams'))]\"\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.KubernetesConfiguration/sourceControlConfigurations/repositoryUrl\",\r\n                    \"equals\": \"[parameters('repositoryUrl')]\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.KubernetesConfiguration/sourceControlConfigurations/enableHelmOperator\",\r\n                        \"equals\": \"false\"\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.KubernetesConfiguration/sourceControlConfigurations/enableHelmOperator\",\r\n                            \"equals\": \"true\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.KubernetesConfiguration/sourceControlConfigurations/helmOperatorProperties.chartVersion\",\r\n                            \"equals\": \"[parameters('chartVersion')]\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.KubernetesConfiguration/sourceControlConfigurations/helmOperatorProperties.chartValues\",\r\n                            \"equals\": \"[parameters('chartValues')]\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"configurationResourceName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"clusterLocation\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"clusterName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"operatorInstanceName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"operatorNamespace\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"operatorScope\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"operatorType\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"operatorParams\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"repositoryUrl\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"enableHelmOperator\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"chartVersion\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"chartValues\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"clusterResourceType\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[contains(toLower(parameters('clusterResourceType')), toLower('connectedclusters'))]\",\r\n                        \"type\": \"Microsoft.Kubernetes/connectedClusters/providers/sourceControlConfigurations\",\r\n                        \"name\": \"[concat(parameters('clusterName'), '/Microsoft.KubernetesConfiguration/', parameters('configurationResourceName'))]\",\r\n                        \"apiVersion\": \"2021-03-01\",\r\n                        \"properties\": {\r\n                          \"operatorInstanceName\": \"[parameters('operatorInstanceName')]\",\r\n                          \"operatorNamespace\": \"[parameters('operatorNamespace')]\",\r\n                          \"operatorScope\": \"[parameters('operatorScope')]\",\r\n                          \"operatorType\": \"[parameters('operatorType')]\",\r\n                          \"operatorParams\": \"[parameters('operatorParams')]\",\r\n                          \"repositoryUrl\": \"[parameters('repositoryUrl')]\",\r\n                          \"enableHelmOperator\": \"[parameters('enableHelmOperator')]\",\r\n                          \"helmOperatorProperties\": {\r\n                            \"chartVersion\": \"[parameters('chartVersion')]\",\r\n                            \"chartValues\": \"[parameters('chartValues')]\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[contains(toLower(parameters('clusterResourceType')), toLower('managedclusters'))]\",\r\n                        \"type\": \"Microsoft.ContainerService/managedClusters/providers/sourceControlConfigurations\",\r\n                        \"name\": \"[concat(parameters('clusterName'), '/Microsoft.KubernetesConfiguration/', parameters('configurationResourceName'))]\",\r\n                        \"apiVersion\": \"2021-03-01\",\r\n                        \"properties\": {\r\n                          \"operatorInstanceName\": \"[parameters('operatorInstanceName')]\",\r\n                          \"operatorNamespace\": \"[parameters('operatorNamespace')]\",\r\n                          \"operatorScope\": \"[parameters('operatorScope')]\",\r\n                          \"operatorType\": \"[parameters('operatorType')]\",\r\n                          \"operatorParams\": \"[parameters('operatorParams')]\",\r\n                          \"repositoryUrl\": \"[parameters('repositoryUrl')]\",\r\n                          \"enableHelmOperator\": \"[parameters('enableHelmOperator')]\",\r\n                          \"helmOperatorProperties\": {\r\n                            \"chartVersion\": \"[parameters('chartVersion')]\",\r\n                            \"chartValues\": \"[parameters('chartValues')]\"\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"clusterLocation\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"clusterName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"configurationResourceName\": {\r\n                      \"value\": \"[parameters('configurationResourceName')]\"\r\n                    },\r\n                    \"operatorInstanceName\": {\r\n                      \"value\": \"[parameters('operatorInstanceName')]\"\r\n                    },\r\n                    \"operatorNamespace\": {\r\n                      \"value\": \"[parameters('operatorNamespace')]\"\r\n                    },\r\n                    \"operatorScope\": {\r\n                      \"value\": \"[parameters('operatorScope')]\"\r\n                    },\r\n                    \"operatorType\": {\r\n                      \"value\": \"[parameters('operatorType')]\"\r\n                    },\r\n                    \"operatorParams\": {\r\n                      \"value\": \"[parameters('operatorParams')]\"\r\n                    },\r\n                    \"repositoryUrl\": {\r\n                      \"value\": \"[parameters('repositoryUrl')]\"\r\n                    },\r\n                    \"enableHelmOperator\": {\r\n                      \"value\": \"[parameters('enableHelmOperator')]\"\r\n                    },\r\n                    \"chartVersion\": {\r\n                      \"value\": \"[parameters('chartVersion')]\"\r\n                    },\r\n                    \"chartValues\": {\r\n                      \"value\": \"[parameters('chartValues')]\"\r\n                    },\r\n                    \"clusterResourceType\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1d61c4d2-aef2-432b-87fc-7f96b019b7e1\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1d61c4d2-aef2-432b-87fc-7f96b019b7e1\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Virtual machines should be migrated to new Azure Resource Manager resources\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use new Azure Resource Manager for your virtual machines to provide security enhancements such as: stronger access control (RBAC), better auditing, Azure Resource Manager based deployment and governance, access to managed identities, access to key vault for secrets, Azure AD-based authentication and support for tags and resource groups for easier security management\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"in\": [\r\n                  \"Microsoft.ClassicCompute/virtualMachines\",\r\n                  \"Microsoft.Compute/virtualMachines\"\r\n                ]\r\n              },\r\n              {\r\n                \"value\": \"[field('type')]\",\r\n                \"equals\": \"Microsoft.ClassicCompute/virtualMachines\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1d84d5fb-01f6-4d12-ba4f-4a26081d403d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1d84d5fb-01f6-4d12-ba4f-4a26081d403d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Audit API Applications that are not using latest supported .NET Framework\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use the latest supported .NET Framework version for the latest security classes. Using older classes and types can make your application vulnerable.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyof\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"api\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"apiApp\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UseLatestDotNet\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"in\": [\r\n                  \"OffByPolicy\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1de7b11d-1870-41a5-8181-507e7c663cfb\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1de7b11d-1870-41a5-8181-507e7c663cfb\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Require a tag and its value on resources\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enforces a required tag and its value. Does not apply to resource groups.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"Tags\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            }\r\n          },\r\n          \"tagValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Value\",\r\n              \"description\": \"Value of the tag, such as 'production'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n              \"equals\": \"[parameters('tagValue')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1e30110a-5ceb-460c-a204-c1c3969c6d62\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1e30110a-5ceb-460c-a204-c1c3969c6d62\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Cloud Services (extended support) role instances should have an endpoint protection solution installed\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Protect your Cloud Services (extended support) role instances from threats and vulnerabilities by ensuring an endpoint protection solution is installed on them.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Compute/cloudServices\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"e71020c2-860c-3235-cd39-04f3f8c936d2\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1e378679-f122-4a96-a739-a7729c46e1aa\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1e378679-f122-4a96-a739-a7729c46e1aa\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Azure Synapse workspaces to use private DNS zones\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use private DNS zones to override the DNS resolution for a private endpoint. A private DNS zone links to your virtual network to resolve to Azure Synapse workspace. Learn more at: https://docs.microsoft.com/azure/synapse-analytics/security/how-to-connect-to-workspace-from-restricted-network#appendix-dns-registration-for-private-endpoint.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Synapse\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateDnsZoneId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private DNS Zone id\",\r\n              \"description\": \"A private DNS zone Id\",\r\n              \"strongType\": \"Microsoft.Network/privateDnsZones\"\r\n            }\r\n          },\r\n          \"targetSubResource\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Target sub-resource\",\r\n              \"description\": \"Target sub resource the private endpoint connects to\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Dev\",\r\n              \"Sql\",\r\n              \"SqlOnDemand\"\r\n            ],\r\n            \"defaultValue\": \"Dev\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/privateEndpoints\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*].groupIds[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*].groupIds[*]\",\r\n                    \"equals\": \"[parameters('targetSubResource')]\"\r\n                  }\r\n                },\r\n                \"greaterOrEquals\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Network/privateEndpoints/privateDnsZoneGroups\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"privateDnsZoneId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('privateEndpointName'), '/deployedByPolicy')]\",\r\n                        \"type\": \"Microsoft.Network/privateEndpoints/privateDnsZoneGroups\",\r\n                        \"apiVersion\": \"2020-03-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"privateDnsZoneConfigs\": [\r\n                            {\r\n                              \"name\": \"synapse-privateDnsZone\",\r\n                              \"properties\": {\r\n                                \"privateDnsZoneId\": \"[parameters('privateDnsZoneId')]\"\r\n                              }\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"privateDnsZoneId\": {\r\n                      \"value\": \"[parameters('privateDnsZoneId')]\"\r\n                    },\r\n                    \"privateEndpointName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1e5ed725-f16c-478b-bd4b-7bfa2f7940b9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1e5ed725-f16c-478b-bd4b-7bfa2f7940b9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Key vaults should have soft delete enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deleting a key vault without soft delete enabled permanently deletes all secrets, keys, and certificates stored in the key vault. Accidental deletion of a key vault can lead to permanent data loss. Soft delete allows you to recover an accidentally deleted key vault for a configurable retention period.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.2\",\r\n          \"category\": \"Key Vault\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.KeyVault/vaults\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.KeyVault/vaults/enableSoftDelete\",\r\n                    \"exists\": \"false\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.KeyVault/vaults/enableSoftDelete\",\r\n                    \"equals\": \"false\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1e66c121-a66a-4b1f-9b83-0fd99bf0fc2d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure API for FHIR should use private link\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure API for FHIR should have at least one approved private endpoint connection. Clients in a virtual network can securely access resources that have private endpoint connections through private links. For more information, visit: https://aka.ms/fhir-privatelink.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"API for FHIR\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.HealthcareApis/services\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.HealthcareApis/services/privateEndpointConnections[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.HealthcareApis/services/privateEndpointConnections[*].privateLinkServiceConnectionState.status\",\r\n                    \"equals\": \"Approved\"\r\n                  }\r\n                },\r\n                \"less\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1ee56206-5dd1-42ab-b02d-8aae8b1634ce\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1ee56206-5dd1-42ab-b02d-8aae8b1634ce\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"An Azure Active Directory administrator should be provisioned for SQL servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit provisioning of an Azure Active Directory administrator for your SQL server to enable Azure AD authentication. Azure AD authentication enables simplified permission management and centralized identity management of database users and other Microsoft services\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/administrators\"\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1f314764-cb73-4fc9-b863-8eca98ac36e9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1f314764-cb73-4fc9-b863-8eca98ac36e9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Monitor Logs clusters should be encrypted with customer-managed key\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Create Azure Monitor logs cluster with customer-managed keys encryption. By default, the log data is encrypted with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance. Customer-managed key in Azure Monitor gives you more control over the access to you data, see https://docs.microsoft.com/azure/azure-monitor/platform/customer-managed-keys.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"audit\",\r\n              \"deny\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.OperationalInsights/clusters\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.OperationalInsights/clusters/keyVaultProperties.keyVaultUri\",\r\n                        \"equals\": \"\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.OperationalInsights/clusters/keyVaultProperties.keyVaultUri\",\r\n                        \"exists\": \"false\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.OperationalInsights/clusters/keyVaultProperties.keyName\",\r\n                        \"equals\": \"\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.OperationalInsights/clusters/keyVaultProperties.keyName\",\r\n                        \"exists\": \"false\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.OperationalInsights/clusters/keyVaultProperties.keyVersion\",\r\n                      \"exists\": \"true\"\r\n                    }\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1f68a601-6e6d-4e42-babf-3f643a047ea2\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1f68a601-6e6d-4e42-babf-3f643a047ea2\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Diagnostic Settings for Event Hub to Log Analytics workspace\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploys the diagnostic settings for Event Hub to stream to a regional Log Analytics workspace when any Event Hub which is missing this diagnostic settings is created or updated.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          },\r\n          \"profileName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Profile name\",\r\n              \"description\": \"The diagnostic settings profile name\"\r\n            },\r\n            \"defaultValue\": \"setbypolicy_logAnalytics\"\r\n          },\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"metricsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable metrics\",\r\n              \"description\": \"Whether to enable metrics stream to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"False\"\r\n          },\r\n          \"logsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable logs\",\r\n              \"description\": \"Whether to enable logs stream to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.EventHub/namespaces\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"name\": \"[parameters('profileName')]\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                    \"equals\": \"[parameters('logsEnabled')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\r\n                    \"equals\": \"[parameters('metricsEnabled')]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"resourceName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"metricsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"profileName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.EventHub/namespaces/providers/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"dependsOn\": [],\r\n                        \"properties\": {\r\n                          \"workspaceId\": \"[parameters('logAnalytics')]\",\r\n                          \"metrics\": [\r\n                            {\r\n                              \"category\": \"AllMetrics\",\r\n                              \"enabled\": \"[parameters('metricsEnabled')]\",\r\n                              \"retentionPolicy\": {\r\n                                \"enabled\": false,\r\n                                \"days\": 0\r\n                              }\r\n                            }\r\n                          ],\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"ArchiveLogs\",\r\n                              \"enabled\": true,\r\n                              \"retentionPolicy\": {\r\n                                \"enabled\": false,\r\n                                \"days\": 0\r\n                              }\r\n                            },\r\n                            {\r\n                              \"category\": \"OperationalLogs\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"AutoScaleLogs\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"KafkaCoordinatorLogs\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"KafkaUserErrorLogs\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"EventHubVNetConnectionEvent\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"CustomerManagedKeyUserLogs\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {}\r\n                  },\r\n                  \"parameters\": {\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"resourceName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    },\r\n                    \"metricsEnabled\": {\r\n                      \"value\": \"[parameters('metricsEnabled')]\"\r\n                    },\r\n                    \"logsEnabled\": {\r\n                      \"value\": \"[parameters('logsEnabled')]\"\r\n                    },\r\n                    \"profileName\": {\r\n                      \"value\": \"[parameters('profileName')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1f6e93e8-6b31-41b1-83f6-36e449a42579\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1f6e93e8-6b31-41b1-83f6-36e449a42579\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs configurations in 'Security Options - Shutdown'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Shutdown'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"ShutdownAllowSystemToBeShutDownWithoutHavingToLogOn\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Shutdown: Allow system to be shut down without having to log on\",\r\n              \"description\": \"Specifies whether a computer can be shut down when a user is not logged on. If this policy setting is enabled, the shutdown command is available on the Windows logon screen.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"ShutdownClearVirtualMemoryPagefile\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Shutdown: Clear virtual memory pagefile\",\r\n              \"description\": \"Specifies whether the virtual memory pagefile is cleared when the system is shut down. When this policy setting is enabled, the system pagefile is cleared each time that the system shuts down properly. For systems with large amounts of RAM, this could result in substantial time needed to complete the shutdown.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsShutdown\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('Shutdown: Allow system to be shut down without having to log on;ExpectedValue', '=', parameters('ShutdownAllowSystemToBeShutDownWithoutHavingToLogOn'), ',', 'Shutdown: Clear virtual memory pagefile;ExpectedValue', '=', parameters('ShutdownClearVirtualMemoryPagefile')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AzureBaseline_SecurityOptionsShutdown\"\r\n                    },\r\n                    \"ShutdownAllowSystemToBeShutDownWithoutHavingToLogOn\": {\r\n                      \"value\": \"[parameters('ShutdownAllowSystemToBeShutDownWithoutHavingToLogOn')]\"\r\n                    },\r\n                    \"ShutdownClearVirtualMemoryPagefile\": {\r\n                      \"value\": \"[parameters('ShutdownClearVirtualMemoryPagefile')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ShutdownAllowSystemToBeShutDownWithoutHavingToLogOn\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ShutdownClearVirtualMemoryPagefile\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Shutdown: Allow system to be shut down without having to log on;ExpectedValue\",\r\n                                \"value\": \"[parameters('ShutdownAllowSystemToBeShutDownWithoutHavingToLogOn')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Shutdown: Clear virtual memory pagefile;ExpectedValue\",\r\n                                \"value\": \"[parameters('ShutdownClearVirtualMemoryPagefile')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Shutdown: Allow system to be shut down without having to log on;ExpectedValue\",\r\n                                \"value\": \"[parameters('ShutdownAllowSystemToBeShutDownWithoutHavingToLogOn')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Shutdown: Clear virtual memory pagefile;ExpectedValue\",\r\n                                \"value\": \"[parameters('ShutdownClearVirtualMemoryPagefile')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1f8c20ce-3414-4496-8b26-0e902a1541da\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1f8c20ce-3414-4496-8b26-0e902a1541da\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Cosmos DB accounts should use customer-managed keys to encrypt data at rest\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use customer-managed keys to manage the encryption at rest of your Azure Cosmos DB. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more at https://aka.ms/cosmosdb-cmk.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.2\",\r\n          \"category\": \"Cosmos DB\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The desired effect of the policy.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"audit\",\r\n              \"deny\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.DocumentDB/databaseAccounts/keyVaultKeyUri\",\r\n                \"exists\": false\r\n              },\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DocumentDB/databaseAccounts\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1f905d99-2ab7-462c-a6b0-f709acca6c8f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1f905d99-2ab7-462c-a6b0-f709acca6c8f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Logic Apps Integration Service Environment should be encrypted with customer-managed keys\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy into Integration Service Environment to manage encryption at rest of Logic Apps data using customer-managed keys. By default, customer data is encrypted with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Logic Apps\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Logic/integrationServiceEnvironments\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Logic/integrationServiceEnvironments/encryptionConfiguration\",\r\n                \"exists\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1fafeaf6-7927-4059-a50a-8eb2a7a6f2b5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1fafeaf6-7927-4059-a50a-8eb2a7a6f2b5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure HDInsight clusters should use encryption at host to encrypt data at rest\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enabling encryption at host helps protect and safeguard your data to meet your organizational security and compliance commitments. When you enable encryption at host, data stored on the VM host is encrypted at rest and flows encrypted to the Storage service.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"HDInsight\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.HDInsight/clusters\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.HDInsight/clusters/diskEncryptionProperties.encryptionAtHost\",\r\n                    \"exists\": false\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HDInsight/clusters/diskEncryptionProperties.encryptionAtHost\",\r\n                    \"equals\": false\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1fd32ebd-e4c3-4e13-a54a-d7422d4d95f6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1fd32ebd-e4c3-4e13-a54a-d7422d4d95f6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Web ports should be restricted on Network Security Groups associated to your VM\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Azure security center has discovered that some of your virtual machines are running web applications, and the NSGs associated to these virtual machines are overly permissive with regards to the web application ports\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Disabled\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.ClassicCompute/virtualMachines\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"unprotectedWebApplication\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"in\": [\r\n                  \"OffByPolicy\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/201ea587-7c90-41c3-910f-c280ae01cfd6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"201ea587-7c90-41c3-910f-c280ae01cfd6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"VM Image Builder templates should use private link\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your VM Image Builder building resources, data leakage risks are reduced. Learn more about private links at: https://docs.microsoft.com/azure/virtual-machines/linux/image-builder-networking#deploy-using-an-existing-vnet.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.0\",\r\n          \"category\": \"VM Image Builder\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\",\r\n              \"Deny\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.VirtualMachineImages/imageTemplates\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.VirtualMachineImages/imageTemplates/vmProfile.vnetConfig\",\r\n                \"exists\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2154edb9-244f-4741-9970-660785bccdaa\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2154edb9-244f-4741-9970-660785bccdaa\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Public network access should be disabled for Azure File Sync\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disabling the public endpoint allows you to restrict access to your Storage Sync Service resource to requests destined to approved private endpoints on your organization's network. There is nothing inherently insecure about allowing requests to the public endpoint, however, you may wish to disable it to meet regulatory, legal, or organizational policy requirements. You can disable the public endpoint for a Storage Sync Service by setting the incomingTrafficPolicy of the resource to AllowVirtualNetworksOnly.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.StorageSync/storageSyncServices\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.StorageSync/storageSyncServices/incomingTrafficPolicy\",\r\n                \"notEquals\": \"AllowVirtualNetworksOnly\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/21a8cd35-125e-4d13-b82d-2e19b7208bb7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"21a8cd35-125e-4d13-b82d-2e19b7208bb7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure SignalR Service should disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"To improve the security of Azure SignalR Service resource, ensure that it isn't exposed to the public internet and can only be accessed from a private endpoint. Disable the public network access property as described in https://aka.ms/asrs/networkacls. This option disables access from any public address space outside the Azure IP range, and denies all logins that match IP or virtual network-based firewall rules. This reduces data leakage risks.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"SignalR\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.SignalRService/SignalR\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.SignalRService/SignalR/networkACLs.defaultAction\",\r\n                    \"equals\": \"Allow\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.SignalRService/SignalR/networkACLs.publicNetwork.allow\",\r\n                    \"exists\": false\r\n                  },\r\n                  {\r\n                    \"count\": {\r\n                      \"field\": \"Microsoft.SignalRService/SignalR/networkACLs.publicNetwork.allow[*]\"\r\n                    },\r\n                    \"greater\": 0\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/21a9766a-82a5-4747-abb5-650b6dbba6d0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"21a9766a-82a5-4747-abb5-650b6dbba6d0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs configurations in 'Security Options - Audit'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Audit'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsAudit\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/21e2995e-683e-497a-9e81-2f42ad07050a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"21e2995e-683e-497a-9e81-2f42ad07050a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Audit API Apps that are not using custom domains\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use of custom domains protects a API app from common attacks such as phishing and other DNS-related attacks.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyof\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"api\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"apiApp\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UsedCustomDomains\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"in\": [\r\n                  \"OffByPolicy\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/224da9fe-0d38-4e79-adb3-0a6e2af942ac\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"224da9fe-0d38-4e79-adb3-0a6e2af942ac\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs configurations in 'System Audit Policies - Account Management'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Account Management'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SystemAuditPoliciesAccountManagement\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/225e937e-d32e-4713-ab74-13ce95b3519a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"225e937e-d32e-4713-ab74-13ce95b3519a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Management ports should be closed on your virtual machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Open remote management ports are exposing your VM to a high level of risk from Internet-based attacks. These attacks attempt to brute force credentials to gain admin access to the machine.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.ClassicCompute/virtualMachines\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"bc303248-3d14-44c2-96a0-55f5c326b5fe\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/22730e10-96f6-4aac-ad84-9383d35b5917\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"22730e10-96f6-4aac-ad84-9383d35b5917\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Only secure connections to your Azure Cache for Redis should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit enabling of only connections via SSL to Azure Cache for Redis. Use of secure connections ensures authentication between the server and the service and protects data in transit from network layer attacks such as man-in-the-middle, eavesdropping, and session-hijacking\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Cache\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Cache/redis\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Cache/Redis/enableNonSslPort\",\r\n                \"equals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/22bee202-a82f-4305-9a2a-6d7f44d4dedb\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"22bee202-a82f-4305-9a2a-6d7f44d4dedb\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs that do not restrict the minimum password length to 14 characters\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines that do not restrict the minimum password length to 14 characters. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"2.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"MinimumPasswordLength\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"MinimumPasswordLength\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/23020aa6-1135-4be2-bae2-149982b06eca\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"23020aa6-1135-4be2-bae2-149982b06eca\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Service Bus should use a virtual network service endpoint\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy audits any Service Bus not configured to use a virtual network service endpoint.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.ServiceBus/namespaces\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.ServiceBus/namespaces/virtualNetworkRules\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.ServiceBus/namespaces/virtualNetworkRules/virtualNetworkSubnetId\",\r\n                \"exists\": \"true\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/235359c5-7c52-4b82-9055-01c75cf9f60e\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"235359c5-7c52-4b82-9055-01c75cf9f60e\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit Windows machines that do not have a minimum password age of 1 day\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if Windows machines that do not have a minimum password age of 1 day\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"MinimumPasswordAge\",\r\n            \"version\": \"1.*\"\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"MinimumPasswordAge\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/237b38db-ca4d-4259-9e47-7882441ca2c0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"237b38db-ca4d-4259-9e47-7882441ca2c0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Diagnostic Settings for Stream Analytics to Log Analytics workspace\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploys the diagnostic settings for Stream Analytics to stream to a regional Log Analytics workspace when any Stream Analytics which is missing this diagnostic settings is created or updated.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          },\r\n          \"profileName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Profile name\",\r\n              \"description\": \"The diagnostic settings profile name\"\r\n            },\r\n            \"defaultValue\": \"setbypolicy_logAnalytics\"\r\n          },\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"metricsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable metrics\",\r\n              \"description\": \"Whether to enable metrics stream to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"False\"\r\n          },\r\n          \"logsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable logs\",\r\n              \"description\": \"Whether to enable logs stream to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.StreamAnalytics/streamingjobs\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"name\": \"[parameters('profileName')]\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                    \"equals\": \"[parameters('logsEnabled')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\r\n                    \"equals\": \"[parameters('metricsEnabled')]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"resourceName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"metricsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"profileName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.StreamAnalytics/streamingjobs/providers/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"dependsOn\": [],\r\n                        \"properties\": {\r\n                          \"workspaceId\": \"[parameters('logAnalytics')]\",\r\n                          \"metrics\": [\r\n                            {\r\n                              \"category\": \"AllMetrics\",\r\n                              \"enabled\": \"[parameters('metricsEnabled')]\",\r\n                              \"retentionPolicy\": {\r\n                                \"enabled\": false,\r\n                                \"days\": 0\r\n                              }\r\n                            }\r\n                          ],\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"Execution\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"Authoring\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {}\r\n                  },\r\n                  \"parameters\": {\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"resourceName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    },\r\n                    \"metricsEnabled\": {\r\n                      \"value\": \"[parameters('metricsEnabled')]\"\r\n                    },\r\n                    \"logsEnabled\": {\r\n                      \"value\": \"[parameters('logsEnabled')]\"\r\n                    },\r\n                    \"profileName\": {\r\n                      \"value\": \"[parameters('profileName')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/237e0f7e-b0e8-4ec4-ad46-8c12cb66d673\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"237e0f7e-b0e8-4ec4-ad46-8c12cb66d673\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Azure Automation accounts to disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disable public network access for Azure Automation account so that it isn't accessible over the public internet. This configuration helps protect them against data leakage risks. You can limit exposure of the your Automation account resources by creating private endpoints instead. Learn more at: https://aka.ms/privateendpoints.\",\r\n        \"metadata\": {\r\n          \"category\": \"Automation\",\r\n          \"version\": \"1.0.0\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Modify\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Modify\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Automation/automationAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Automation/automationAccounts/publicNetworkAccess\",\r\n                \"notEquals\": false\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"conflictEffect\": \"audit\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"operations\": [\r\n                {\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.Automation/automationAccounts/publicNetworkAccess\",\r\n                  \"value\": false\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/23b36a7c-9d26-4288-a8fd-c1d2fa284d8c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"23b36a7c-9d26-4288-a8fd-c1d2fa284d8c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Azure Activity logs to stream to specified Log Analytics workspace\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Deploys the diagnostic settings for Azure Activity to stream subscriptions audit logs to a Log Analytics workspace to monitor subscription-level events\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Primary Log Analytics workspace\",\r\n              \"description\": \"If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          },\r\n          \"logsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable logs\",\r\n              \"description\": \"Whether to enable logs stream to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"deploymentScope\": \"Subscription\",\r\n              \"existenceScope\": \"Subscription\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                    \"equals\": \"[parameters('logsEnabled')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/workspaceId\",\r\n                    \"equals\": \"[parameters('logAnalytics')]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"location\": \"northeurope\",\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"subscriptionToLa\",\r\n                        \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"location\": \"Global\",\r\n                        \"properties\": {\r\n                          \"workspaceId\": \"[parameters('logAnalytics')]\",\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"Administrative\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"Security\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"ServiceHealth\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"Alert\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"Recommendation\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"Policy\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"Autoscale\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"ResourceHealth\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {}\r\n                  },\r\n                  \"parameters\": {\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    },\r\n                    \"logsEnabled\": {\r\n                      \"value\": \"[parameters('logsEnabled')]\"\r\n                    }\r\n                  }\r\n                }\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2465583e-4e78-4c15-b6be-a36cbc7c8b0f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2465583e-4e78-4c15-b6be-a36cbc7c8b0f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs that do not have a maximum password age of 70 days\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that do not have a maximum password age of 70 days. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"MaximumPasswordAge\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/24dde96d-f0b1-425e-884f-4a1421e2dcdc\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"24dde96d-f0b1-425e-884f-4a1421e2dcdc\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Infrastructure encryption should be enabled for Azure Database for PostgreSQL servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enable infrastructure encryption for Azure Database for PostgreSQL servers to have higher level of assurance that the data is secure. When infrastructure encryption is enabled, the data at rest is encrypted twice using FIPS 140-2 compliant Microsoft managed keys\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DBforPostgreSQL/servers\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DBforPostgreSQL/servers/infrastructureEncryption\",\r\n                \"notEquals\": \"Enabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/24fba194-95d6-48c0-aea7-f65bf859c598\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"24fba194-95d6-48c0-aea7-f65bf859c598\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Diagnostic Settings for Data Lake Storage Gen1 to Log Analytics workspace\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploys the diagnostic settings for Data Lake Storage Gen1 to stream to a regional Log Analytics workspace when any Data Lake Storage Gen1 which is missing this diagnostic settings is created or updated.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          },\r\n          \"profileName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Profile name\",\r\n              \"description\": \"The diagnostic settings profile name\"\r\n            },\r\n            \"defaultValue\": \"setbypolicy_logAnalytics\"\r\n          },\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"metricsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable metrics\",\r\n              \"description\": \"Whether to enable metrics stream to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"False\"\r\n          },\r\n          \"logsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable logs\",\r\n              \"description\": \"Whether to enable logs stream to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.DataLakeStore/accounts\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"name\": \"[parameters('profileName')]\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                    \"equals\": \"[parameters('logsEnabled')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\r\n                    \"equals\": \"[parameters('metricsEnabled')]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"resourceName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"metricsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"profileName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.DataLakeStore/accounts/providers/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"dependsOn\": [],\r\n                        \"properties\": {\r\n                          \"workspaceId\": \"[parameters('logAnalytics')]\",\r\n                          \"metrics\": [\r\n                            {\r\n                              \"category\": \"AllMetrics\",\r\n                              \"enabled\": \"[parameters('metricsEnabled')]\",\r\n                              \"retentionPolicy\": {\r\n                                \"enabled\": false,\r\n                                \"days\": 0\r\n                              }\r\n                            }\r\n                          ],\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"Audit\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"Requests\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {}\r\n                  },\r\n                  \"parameters\": {\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"resourceName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    },\r\n                    \"metricsEnabled\": {\r\n                      \"value\": \"[parameters('metricsEnabled')]\"\r\n                    },\r\n                    \"logsEnabled\": {\r\n                      \"value\": \"[parameters('logsEnabled')]\"\r\n                    },\r\n                    \"profileName\": {\r\n                      \"value\": \"[parameters('profileName')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/25763a0a-5783-4f14-969e-79d4933eb74b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"25763a0a-5783-4f14-969e-79d4933eb74b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Endpoint protection solution should be installed on virtual machine scale sets\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit the existence and health of an endpoint protection solution on your virtual machines scale sets, to protect them from threats and vulnerabilities.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"e71020c2-860c-3235-cd39-04f3f8c936d2\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/26a828e1-e88f-464e-bbb3-c134a282b9de\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"26a828e1-e88f-464e-bbb3-c134a282b9de\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Metric alert rules should be configured on Batch accounts\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit configuration of metric alert rules on Batch account to enable the required metric\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Batch\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"metricName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Metric name\",\r\n              \"description\": \"The metric name that an alert rule must be enabled on\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Batch/batchAccounts\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/alertRules\",\r\n              \"existenceScope\": \"Subscription\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/alertRules/isEnabled\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/alertRules/condition.dataSource.metricName\",\r\n                    \"equals\": \"[parameters('metricName')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/alertRules/condition.dataSource.resourceUri\",\r\n                    \"equals\": \"[concat('/subscriptions/', subscription().subscriptionId, '/resourcegroups/', resourceGroup().name, '/providers/Microsoft.Batch/batchAccounts/', field('name'))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/26ee67a2-f81a-4ba8-b9ce-8550bd5ee1a7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"26ee67a2-f81a-4ba8-b9ce-8550bd5ee1a7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure virtual machines to be onboarded to Azure Automanage\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Automanage enrolls, configures, and monitors virtual machines with best practice as defined in the Microsoft Cloud Adoption Framework for Azure. Use this policy to apply Automanage to your selected scope.\",\r\n        \"metadata\": {\r\n          \"version\": \"4.1.0\",\r\n          \"category\": \"Automanage\"\r\n        },\r\n        \"parameters\": {\r\n          \"automanageAccount\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Automanage account\",\r\n              \"description\": \"The Automanage account is an Azure managed identity under which virtual machine operations are performed. If this account is outside of the scope of the assignment you must manually grant 'Contributor' permissions (or similar) on the account to the policy assignment's principal ID.\",\r\n              \"strongType\": \"Microsoft.Automanage/accounts\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"configurationProfileAssignment\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Configuration profile\",\r\n              \"description\": \"The management services provided are based on whether the machine is intended to be used in a dev/test environment or production.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Azure virtual machine best practices – Production\",\r\n              \"Azure virtual machine best practices – Dev/test\"\r\n            ],\r\n            \"defaultValue\": \"Azure virtual machine best practices – Production\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"location\",\r\n                \"in\": [\r\n                  \"eastus\",\r\n                  \"eastus2\",\r\n                  \"westus\",\r\n                  \"westus2\",\r\n                  \"centralus\",\r\n                  \"southcentralus\",\r\n                  \"westcentralus\",\r\n                  \"northeurope\",\r\n                  \"westeurope\",\r\n                  \"canadacentral\",\r\n                  \"japaneast\",\r\n                  \"uksouth\",\r\n                  \"australiaeast\",\r\n                  \"australiasoutheast\",\r\n                  \"southeastasia\"\r\n                ]\r\n              },\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                    \"in\": [\r\n                      \"esri\",\r\n                      \"incredibuild\",\r\n                      \"MicrosoftDynamicsAX\",\r\n                      \"MicrosoftSharepoint\",\r\n                      \"MicrosoftVisualStudio\",\r\n                      \"MicrosoftWindowsDesktop\",\r\n                      \"MicrosoftWindowsServerHPCPack\"\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"2008*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"notLike\": \"SQL2008*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-dsvm\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"dsvm-windows\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"standard-data-science-vm\",\r\n                          \"windows-data-science-vm\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"batch\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"rendering-windows2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"center-for-internet-security-inc\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"cis-windows-server-201*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"pivotal\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"bosh-windows-server*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloud-infrastructure-services\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"ad*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                            \"exists\": \"true\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                            \"like\": \"Windows*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.imageReference.id\",\r\n                        \"exists\": \"true\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.imageReference.sku\",\r\n                        \"exists\": \"false\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                    \"in\": [\r\n                      \"microsoft-aks\",\r\n                      \"qubole-inc\",\r\n                      \"datastax\",\r\n                      \"couchbase\",\r\n                      \"scalegrid\",\r\n                      \"checkpoint\",\r\n                      \"paloaltonetworks\",\r\n                      \"debian\"\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"CentOS*\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"6*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"CentOS*\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"8*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-HA\",\r\n                          \"RHEL-SAP\",\r\n                          \"RHEL-SAP-APPS\",\r\n                          \"RHEL-SAP-HA\",\r\n                          \"RHEL-SAP-HANA\",\r\n                          \"rhel-raw\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"6*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-HA\",\r\n                          \"RHEL-SAP\",\r\n                          \"RHEL-SAP-APPS\",\r\n                          \"RHEL-SAP-HA\",\r\n                          \"RHEL-SAP-HANA\",\r\n                          \"rhel-raw\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"8*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"osa\",\r\n                          \"rhel-byos\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"center-for-internet-security-inc\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"cis-centos-7-l1\",\r\n                          \"cis-centos-7-v2-1-1-l1\",\r\n                          \"cis-nginx-centos-7-v1-1-0-l1\",\r\n                          \"cis-oracle-linux-7-v2-0-0-l1\",\r\n                          \"cis-postgresql-11-centos-linux-7-level-1\",\r\n                          \"cis-rhel-7-l2\",\r\n                          \"cis-rhel-7-v2-2-0-l1\",\r\n                          \"cis-suse-linux-12-v2-0-0-l1\",\r\n                          \"cis-ubuntu-linux-1604-v1-0-0-l1\",\r\n                          \"cis-ubuntu-linux-1804-l1\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"credativ\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Suse\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"SLES*\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"11*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Suse\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"SLES*\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"15*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"12*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-dsvm\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"linux-data-science-vm-ubuntu\",\r\n                          \"azureml\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-centos-os\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"6*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-altus-centos-os\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"linux*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/virtualMachines/osProfile.linuxConfiguration\",\r\n                            \"exists\": \"true\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                            \"like\": \"Linux*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.imageReference.id\",\r\n                        \"exists\": \"true\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.imageReference.sku\",\r\n                        \"exists\": \"false\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.Automanage/configurationProfileAssignments\",\r\n              \"name\": \"default\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Automanage/configurationProfileAssignments/configurationProfile\",\r\n                    \"equals\": \"[parameters('configurationProfileAssignment')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Automanage/configurationProfileAssignments/accountId\",\r\n                    \"equals\": \"[parameters('automanageAccount')]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"machineName\": {\r\n                      \"value\": \"[field('Name')]\"\r\n                    },\r\n                    \"automanageAccount\": {\r\n                      \"value\": \"[parameters('automanageAccount')]\"\r\n                    },\r\n                    \"configurationProfileAssignment\": {\r\n                      \"value\": \"[parameters('configurationProfileAssignment')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"machineName\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"automanageAccount\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationProfileAssignment\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/configurationProfileAssignments\",\r\n                        \"apiVersion\": \"2020-06-30-preview\",\r\n                        \"name\": \"[concat(parameters('machineName'), '/Microsoft.Automanage/', 'default')]\",\r\n                        \"properties\": {\r\n                          \"configurationProfile\": \"[parameters('configurationProfileAssignment')]\",\r\n                          \"accountId\": \"[parameters('automanageAccount')]\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/270610db-8c04-438a-a739-e8e6745b22d3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"270610db-8c04-438a-a739-e8e6745b22d3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Flow logs should be enabled for every network security group\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit for flow log resources to verify if flow log status is enabled. Enabling flow logs allows to log information about IP traffic flowing through network security group. It can be used for optimizing network flows, monitoring throughput, verifying compliance, detecting intrusions and more.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/networkWatchers/flowLogs\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Network/networkWatchers/flowLogs/enabled\",\r\n                \"equals\": false\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/27960feb-a23c-4577-8d36-ef8b5f35e0be\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"27960feb-a23c-4577-8d36-ef8b5f35e0be\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy default Microsoft IaaSAntimalware extension for Windows Server\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy deploys a Microsoft IaaSAntimalware extension with a default configuration when a VM is not configured with the antimalware extension.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                \"equals\": \"MicrosoftWindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                \"equals\": \"WindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                \"in\": [\r\n                  \"2008-R2-SP1\",\r\n                  \"2008-R2-SP1-smalldisk\",\r\n                  \"2012-Datacenter\",\r\n                  \"2012-Datacenter-smalldisk\",\r\n                  \"2012-R2-Datacenter\",\r\n                  \"2012-R2-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter\",\r\n                  \"2016-Datacenter-Server-Core\",\r\n                  \"2016-Datacenter-Server-Core-smalldisk\",\r\n                  \"2016-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter-with-Containers\",\r\n                  \"2016-Datacenter-with-RDSH\",\r\n                  \"2019-Datacenter\",\r\n                  \"2019-Datacenter-Core\",\r\n                  \"2019-Datacenter-Core-smalldisk\",\r\n                  \"2019-Datacenter-Core-with-Containers\",\r\n                  \"2019-Datacenter-Core-with-Containers-smalldisk\",\r\n                  \"2019-Datacenter-smalldisk\",\r\n                  \"2019-Datacenter-with-Containers\",\r\n                  \"2019-Datacenter-with-Containers-smalldisk\"\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"IaaSAntimalware\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Security\"\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ExclusionsPaths\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Semicolon delimited list of file paths or locations to exclude from scanning\"\r\n                        }\r\n                      },\r\n                      \"ExclusionsExtensions\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Semicolon delimited list of file extensions to exclude from scanning\"\r\n                        }\r\n                      },\r\n                      \"ExclusionsProcesses\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Semicolon delimited list of process names to exclude from scanning\"\r\n                        }\r\n                      },\r\n                      \"RealtimeProtectionEnabled\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"true\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Indicates whether or not real time protection is enabled (default is true)\"\r\n                        }\r\n                      },\r\n                      \"ScheduledScanSettingsIsEnabled\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"false\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Indicates whether or not custom scheduled scan settings are enabled (default is false)\"\r\n                        }\r\n                      },\r\n                      \"ScheduledScanSettingsScanType\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"Quick\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Indicates whether scheduled scan setting type is set to Quick or Full (default is Quick)\"\r\n                        }\r\n                      },\r\n                      \"ScheduledScanSettingsDay\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"7\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Day of the week for scheduled scan (1-Sunday, 2-Monday, ..., 7-Saturday)\"\r\n                        }\r\n                      },\r\n                      \"ScheduledScanSettingsTime\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"120\",\r\n                        \"metadata\": {\r\n                          \"description\": \"When to perform the scheduled scan, measured in minutes from midnight (0-1440). For example: 0 = 12AM, 60 = 1AM, 120 = 2AM.\"\r\n                        }\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('vmName'),'/IaaSAntimalware')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"apiVersion\": \"2017-12-01\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.Azure.Security\",\r\n                          \"type\": \"IaaSAntimalware\",\r\n                          \"typeHandlerVersion\": \"1.3\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"AntimalwareEnabled\": true,\r\n                            \"RealtimeProtectionEnabled\": \"[parameters('RealtimeProtectionEnabled')]\",\r\n                            \"ScheduledScanSettings\": {\r\n                              \"isEnabled\": \"[parameters('ScheduledScanSettingsIsEnabled')]\",\r\n                              \"day\": \"[parameters('ScheduledScanSettingsDay')]\",\r\n                              \"time\": \"[parameters('ScheduledScanSettingsTime')]\",\r\n                              \"scanType\": \"[parameters('ScheduledScanSettingsScanType')]\"\r\n                            },\r\n                            \"Exclusions\": {\r\n                              \"Extensions\": \"[parameters('ExclusionsExtensions')]\",\r\n                              \"Paths\": \"[parameters('ExclusionsPaths')]\",\r\n                              \"Processes\": \"[parameters('ExclusionsProcesses')]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"RealtimeProtectionEnabled\": {\r\n                      \"value\": \"true\"\r\n                    },\r\n                    \"ScheduledScanSettingsIsEnabled\": {\r\n                      \"value\": \"true\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2835b622-407b-4114-9198-6f7064cbe0dc\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2835b622-407b-4114-9198-6f7064cbe0dc\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Azure SQL Server to disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disabling the public network access property shuts down public connectivity such that Azure SQL Server can only be accessed from a private endpoint. This configuration disables the public network access for all databases under the Azure SQL Server.\",\r\n        \"metadata\": {\r\n          \"category\": \"SQL\",\r\n          \"version\": \"1.0.0\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Modify\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Modify\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Sql/servers/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"conflictEffect\": \"audit\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/6d8ee4ec-f05a-4a1d-8b00-a9b17e38b437\"\r\n              ],\r\n              \"operations\": [\r\n                {\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.Sql/servers/publicNetworkAccess\",\r\n                  \"value\": \"Disabled\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/28b0b1e5-17ba-4963-a7a4-5a1ab4400a0b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"28b0b1e5-17ba-4963-a7a4-5a1ab4400a0b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Defender for App Service should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Azure Defender for App Service leverages the scale of the cloud, and the visibility that Azure has as a cloud provider, to monitor for common web app attacks.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.3\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/pricings\",\r\n              \"name\": \"AppServices\",\r\n              \"existenceScope\": \"subscription\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/pricings/pricingTier\",\r\n                \"equals\": \"Standard\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2913021d-f2fd-4f3d-b958-22354e2bdbcb\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2913021d-f2fd-4f3d-b958-22354e2bdbcb\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Service Bus Premium namespaces should use a customer-managed key for encryption\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Service Bus supports the option of encrypting data at rest with either Microsoft-managed keys (default) or customer-managed keys. Choosing to encrypt data using customer-managed keys enables you to assign, rotate, disable, and revoke access to the keys that Service Bus will use to encrypt data in your namespace. Note that Service Bus only supports encryption with customer-managed keys for premium namespaces.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Service Bus\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ServiceBus/namespaces\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.ServiceBus/namespaces/sku.tier\",\r\n                \"equals\": \"Premium\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.ServiceBus/namespaces/encryption.keySource\",\r\n                  \"equals\": \"Microsoft.Keyvault\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/295fc8b1-dc9f-4f53-9c61-3f313ceab40a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"295fc8b1-dc9f-4f53-9c61-3f313ceab40a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs configurations in 'Security Options - User Account Control'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - User Account Control'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsUserAccountControl\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/29829ec2-489d-4925-81b7-bda06b1718e0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"29829ec2-489d-4925-81b7-bda06b1718e0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Append a tag and its value to resources\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Appends the specified tag and value when any resource which is missing this tag is created or updated. Does not modify the tags of resources created before this policy was applied until those resources are changed. Does not apply to resource groups. New 'modify' effect policies are available that support remediation of tags on existing resources (see https://aka.ms/modifydoc).\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"Tags\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            }\r\n          },\r\n          \"tagValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Value\",\r\n              \"description\": \"Value of the tag, such as 'production'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n            \"exists\": \"false\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                \"value\": \"[parameters('tagValue')]\"\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2a0e14a6-b0a6-4fab-991a-187a4f81c498\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2a0e14a6-b0a6-4fab-991a-187a4f81c498\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Storage accounts should restrict network access using virtual network rules\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Protect your storage accounts from potential threats using virtual network rules as a preferred method instead of IP-based filtering. Disabling IP-based filtering prevents public IPs from accessing your storage accounts.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the audit policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Storage/storageAccounts/networkAcls.defaultAction\",\r\n                    \"notEquals\": \"Deny\"\r\n                  },\r\n                  {\r\n                    \"count\": {\r\n                      \"field\": \"Microsoft.Storage/storageAccounts/networkAcls.ipRules[*]\"\r\n                    },\r\n                    \"greaterOrEquals\": 1\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2a1a9cdf-e04d-429a-8416-3bfb72a1b26f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2a1a9cdf-e04d-429a-8416-3bfb72a1b26f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'System Audit Policies - Policy Change'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'System Audit Policies - Policy Change' for auditing changes to system audit policies. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_SystemAuditPoliciesPolicyChange\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"AuditAuthenticationPolicyChange\": \"Audit Authentication Policy Change;ExpectedValue\",\r\n              \"AuditAuthorizationPolicyChange\": \"Audit Authorization Policy Change;ExpectedValue\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"AuditAuthenticationPolicyChange\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit Authentication Policy Change\",\r\n              \"description\": \"Specifies whether audit events are generated when changes are made to authentication policy. This setting is useful for tracking changes in domain-level and forest-level trust and privileges that are granted to user accounts or groups.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"No Auditing\",\r\n              \"Success\",\r\n              \"Failure\",\r\n              \"Success and Failure\"\r\n            ],\r\n            \"defaultValue\": \"Success\"\r\n          },\r\n          \"AuditAuthorizationPolicyChange\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit Authorization Policy Change\",\r\n              \"description\": \"Specifies whether audit events are generated for assignment and removal of user rights in user right policies, changes in security token object permission, resource attributes changes and Central Access Policy changes for file system objects.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"No Auditing\",\r\n              \"Success\",\r\n              \"Failure\",\r\n              \"Success and Failure\"\r\n            ],\r\n            \"defaultValue\": \"No Auditing\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SystemAuditPoliciesPolicyChange\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('Audit Authentication Policy Change;ExpectedValue', '=', parameters('AuditAuthenticationPolicyChange'), ',', 'Audit Authorization Policy Change;ExpectedValue', '=', parameters('AuditAuthorizationPolicyChange')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2a7a701e-dff3-4da9-9ec5-42cb98594c0b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2a7a701e-dff3-4da9-9ec5-42cb98594c0b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Synapse workspace auditing settings should have action groups configured to capture critical activities\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"To ensure your audit logs are as thorough as possible, the AuditActionsAndGroups property should include all the relevant groups. We recommend adding at least SUCCESSFUL_DATABASE_AUTHENTICATION_GROUP, FAILED_DATABASE_AUTHENTICATION_GROUP, and BATCH_COMPLETED_GROUP. This is sometimes required for compliance with regulatory standards.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Synapse\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Synapse/workspaces\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Synapse/workspaces/auditingSettings\",\r\n              \"name\": \"default\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Synapse/workspaces/auditingSettings/auditActionsAndGroups[*]\",\r\n                      \"notEquals\": \"SUCCESSFUL_DATABASE_AUTHENTICATION_GROUP\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Synapse/workspaces/auditingSettings/auditActionsAndGroups[*]\",\r\n                      \"notEquals\": \"FAILED_DATABASE_AUTHENTICATION_GROUP\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Synapse/workspaces/auditingSettings/auditActionsAndGroups[*]\",\r\n                      \"notEquals\": \"BATCH_COMPLETED_GROUP\"\r\n                    }\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2b18f286-371e-4b80-9887-04759970c0d3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2b18f286-371e-4b80-9887-04759970c0d3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Managed identity should be used in your Web App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use a managed identity for enhanced authentication security\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"app*\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/managedServiceIdentityId\",\r\n                    \"exists\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/xmanagedServiceIdentityId\",\r\n                    \"exists\": \"true\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2b9ad585-36bc-4615-b300-fd4435808332\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2b9ad585-36bc-4615-b300-fd4435808332\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Cognitive Services accounts should enable data encryption\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy is deprecated. Cognitive Services have data encryption enforced.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0-deprecated\",\r\n          \"category\": \"Cognitive Services\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Disabled\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.CognitiveServices/accounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.CognitiveServices/accounts/encryption.keySource\",\r\n                \"exists\": \"false\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.CognitiveServices/accounts/encryption\",\r\n                \"exists\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2bdd0062-9d75-436e-89df-487dd8e4b3c7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2bdd0062-9d75-436e-89df-487dd8e4b3c7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"SSH access from the Internet should be blocked\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy audits any network security rule that allows SSH access from Internet\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/networkSecurityGroups/securityRules\"\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/access\",\r\n                    \"equals\": \"Allow\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/direction\",\r\n                    \"equals\": \"Inbound\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRange\",\r\n                        \"equals\": \"*\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRange\",\r\n                        \"equals\": \"22\"\r\n                      },\r\n                      {\r\n                        \"value\": \"[if(and(not(empty(field('Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRange'))), contains(field('Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRange'),'-')), and(lessOrEquals(int(first(split(field('Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRange'), '-'))),22),greaterOrEquals(int(last(split(field('Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRange'), '-'))),22)), 'false')]\",\r\n                        \"equals\": \"true\"\r\n                      },\r\n                      {\r\n                        \"count\": {\r\n                          \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRanges[*]\",\r\n                          \"where\": {\r\n                            \"value\": \"[if(and(not(empty(first(field('Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRanges[*]')))), contains(first(field('Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRanges[*]')),'-')), and(lessOrEquals(int(first(split(first(field('Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRanges[*]')), '-'))),22),greaterOrEquals(int(last(split(first(field('Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRanges[*]')), '-'))),22)) , 'false')]\",\r\n                            \"equals\": \"true\"\r\n                          }\r\n                        },\r\n                        \"greater\": 0\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRanges[*]\",\r\n                          \"notEquals\": \"*\"\r\n                        }\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRanges[*]\",\r\n                          \"notEquals\": \"22\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefix\",\r\n                        \"equals\": \"*\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefix\",\r\n                        \"equals\": \"Internet\"\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefixes[*]\",\r\n                          \"notEquals\": \"*\"\r\n                        }\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefixes[*]\",\r\n                          \"notEquals\": \"Internet\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2c89a2e5-7285-40fe-afe0-ae8654b92fab\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2c89a2e5-7285-40fe-afe0-ae8654b92fab\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Unattached disks should be encrypted\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy audits any unattached disk without encryption enabled.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/disks\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/disks/diskState\",\r\n                \"equals\": \"Unattached\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/disks/encryptionSettingsCollection.enabled\",\r\n                    \"exists\": \"false\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/disks/encryptionSettingsCollection.enabled\",\r\n                    \"equals\": \"false\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2c89a2e5-7285-40fe-afe0-ae8654b92fb2\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2c89a2e5-7285-40fe-afe0-ae8654b92fb2\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"App Service should use a virtual network service endpoint\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy audits any App Service not configured to use a virtual network service endpoint.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"app*\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/virtualNetworkConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/virtualnetworkconnections/vnetResourceId\",\r\n                \"exists\": \"true\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2d21331d-a4c2-4def-a9ad-ee4e1e023beb\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2d21331d-a4c2-4def-a9ad-ee4e1e023beb\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs that do not store passwords using reversible encryption\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that do not store passwords using reversible encryption. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"StorePasswordsUsingReversibleEncryption\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2d60d3b7-aa10-454c-88a8-de39d99d17c6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2d60d3b7-aa10-454c-88a8-de39d99d17c6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Linux VMs that allow remote connections from accounts without passwords\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Linux virtual machines that allow remote connections from accounts without passwords. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"microsoft-aks\",\r\n                          \"qubole-inc\",\r\n                          \"datastax\",\r\n                          \"couchbase\",\r\n                          \"scalegrid\",\r\n                          \"checkpoint\",\r\n                          \"paloaltonetworks\",\r\n                          \"debian\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"OpenLogic\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"CentOS*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Oracle\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Oracle-Linux\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"RHEL\",\r\n                              \"RHEL-HA\",\r\n                              \"RHEL-SAP\",\r\n                              \"RHEL-SAP-APPS\",\r\n                              \"RHEL-SAP-HA\",\r\n                              \"RHEL-SAP-HANA\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"osa\",\r\n                              \"rhel-byos\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"cis-centos-7-l1\",\r\n                              \"cis-centos-7-v2-1-1-l1\",\r\n                              \"cis-centos-8-l1\",\r\n                              \"cis-debian-linux-8-l1\",\r\n                              \"cis-debian-linux-9-l1\",\r\n                              \"cis-nginx-centos-7-v1-1-0-l1\",\r\n                              \"cis-oracle-linux-7-v2-0-0-l1\",\r\n                              \"cis-oracle-linux-8-l1\",\r\n                              \"cis-postgresql-11-centos-linux-7-level-1\",\r\n                              \"cis-rhel-7-l2\",\r\n                              \"cis-rhel-7-v2-2-0-l1\",\r\n                              \"cis-rhel-8-l1\",\r\n                              \"cis-suse-linux-12-v2-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1604-v1-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1804-l1\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"credativ\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Debian\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"7*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Suse\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"SLES*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"11*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Canonical\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"UbuntuServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"12*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"linux-data-science-vm-ubuntu\",\r\n                              \"azureml\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-centos-os\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-altus-centos-os\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"linux*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.linuxConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Linux*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"notIn\": [\r\n                                  \"OpenLogic\",\r\n                                  \"RedHat\",\r\n                                  \"credativ\",\r\n                                  \"Suse\",\r\n                                  \"Canonical\",\r\n                                  \"microsoft-dsvm\",\r\n                                  \"cloudera\",\r\n                                  \"microsoft-ads\",\r\n                                  \"center-for-internet-security-inc\",\r\n                                  \"Oracle\"\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"linux*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"PasswordPolicy_msid110\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2d67222d-05fd-4526-a171-2ee132ad9e83\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2d67222d-05fd-4526-a171-2ee132ad9e83\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Public network access on Azure IoT Hub should be disabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disabling the public network access property improves security by ensuring your Azure IoT Hub can only be accessed from a private endpoint.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Internet of Things\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Devices/IotHubs\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Devices/IotHubs/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2d6830fb-07eb-48e7-8c4d-2a442b35f0fb\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2d6830fb-07eb-48e7-8c4d-2a442b35f0fb\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Azure IoT Hub should use customer-managed key to encrypt data at rest\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Encryption of data at rest in IoT Hub with customer-managed key adds a second layer of encryption on top of the default service-managed keys, enables customer control of keys, custom rotation policies, and ability to manage access to data through key access control. Customer-managed keys must be configured during creation of IoT Hub. For more information on how to configure customer-managed keys, see https://aka.ms/iotcmk.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-preview\",\r\n          \"category\": \"Internet of Things\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The desired effect of the policy.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Devices/IotHubs\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Devices/IotHubs/encryption.keyVaultProperties[*]\",\r\n                  \"where\": {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Devices/IotHubs/encryption.keyVaultProperties[*].keyIdentifier\",\r\n                        \"exists\": \"true\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Devices/IotHubs/encryption.keyVaultProperties[*].keyIdentifier\",\r\n                        \"notequals\": \"\"\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                \"lessOrEquals\": 0\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2d7e144b-159c-44fc-95c1-ac3dbf5e6e54\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2d7e144b-159c-44fc-95c1-ac3dbf5e6e54\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Managed workspace virtual network on Azure Synapse workspaces should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enabling a managed workspace virtual network ensures that your workspace is network isolated from other workspaces. Data integration and Spark resources deployed in this virtual network also provides user level isolation for Spark activities.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Synapse\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Synapse/workspaces\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Synapse/workspaces/managedVirtualNetwork\",\r\n                \"notEquals\": \"default\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2d9dbfa3-927b-4cf0-9d0f-08747f971650\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2d9dbfa3-927b-4cf0-9d0f-08747f971650\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Azure Recovery Services vaults should use customer-managed keys for encrypting backup data\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use customer-managed keys to manage the encryption at rest of your backup data. By default, customer data is encrypted with service-managed keys, but CMKs are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more at https://aka.ms/AB-CmkEncryption.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-preview\",\r\n          \"preview\": true,\r\n          \"category\": \"Backup\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          },\r\n          \"enableDoubleEncryption\": {\r\n            \"type\": \"Boolean\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Double encryption should be enabled on Recovery Services vaults for Backup\",\r\n              \"description\": \"Check if double encryption is enabled on Recovery Services vaults for Backup.  For more details refer to https://aka.ms/AB-InfraEncryption.\"\r\n            },\r\n            \"allowedValues\": [\r\n              true,\r\n              false\r\n            ],\r\n            \"defaultValue\": false\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.RecoveryServices/vaults\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.RecoveryServices/vaults/encryption.keyVaultProperties.keyUri\",\r\n                    \"exists\": \"false\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"value\": \"[parameters('enableDoubleEncryption')]\",\r\n                        \"equals\": true\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.RecoveryServices/vaults/encryption.infrastructureEncryption\",\r\n                        \"notEquals\": \"Enabled\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2e94d99a-8a36-4563-bc77-810d8893b671\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2e94d99a-8a36-4563-bc77-810d8893b671\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Network Watcher flow logs should have traffic analytics enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Traffic analytics analyzes Network Watcher network security group flow logs to provide insights into traffic flow in your Azure cloud. It can be used to visualize network activity across your Azure subscriptions and identify hot spots, identify security threats, understand traffic flow patterns, pinpoint network misconfigurations and more.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/networkWatchers/flowLogs\"\r\n              },\r\n              {\r\n                \"anyof\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkWatchers/flowLogs/flowAnalyticsConfiguration.networkWatcherFlowAnalyticsConfiguration.enabled\",\r\n                    \"equals\": false\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkWatchers/flowLogs/flowAnalyticsConfiguration.networkWatcherFlowAnalyticsConfiguration.trafficAnalyticsInterval\",\r\n                    \"notin\": [\r\n                      \"10\",\r\n                      \"60\"\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2f080164-9f4d-497e-9db6-416dc9f7b48a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2f080164-9f4d-497e-9db6-416dc9f7b48a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'Security Options - System objects'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'Security Options - System objects' for case insensitivity for non-Windows subsystems and permissions of internal system objects. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_SecurityOptionsSystemobjects\",\r\n            \"version\": \"1.*\"\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsSystemobjects\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2f262ace-812a-4fd0-b731-b38ba9e9708d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2f262ace-812a-4fd0-b731-b38ba9e9708d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Network traffic data collection agent should be installed on Windows virtual machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Security Center uses the Microsoft Dependency agent to collect network traffic data from your Azure virtual machines to enable advanced network protection features such as traffic visualization on the network map, network hardening recommendations and specific network threats.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1-preview\",\r\n          \"category\": \"Monitoring\",\r\n          \"preview\": \"true\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable Dependency Agent for Windows VMs monitoring\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2008-R2-SP1\",\r\n                          \"2008-R2-SP1-smalldisk\",\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\",\r\n                          \"2019-Datacenter\",\r\n                          \"2019-Datacenter-Core\",\r\n                          \"2019-Datacenter-Core-smalldisk\",\r\n                          \"2019-Datacenter-Core-with-Containers\",\r\n                          \"2019-Datacenter-Core-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-smalldisk\",\r\n                          \"2019-Datacenter-with-Containers\",\r\n                          \"2019-Datacenter-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-zhcn\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerSemiAnnual\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"Datacenter-Core-1709-smalldisk\",\r\n                          \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                          \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerHPCPack\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016-BYOL\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2-BYOL\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftRServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"MLServer-WS2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftVisualStudio\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"VisualStudio\",\r\n                          \"Windows\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"windows-data-science-vm\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsDesktop\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Windows-10\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"DependencyAgentWindows\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Monitoring.DependencyAgent\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2f2ee1de-44aa-4762-b6bd-0893fc3f306d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2f2ee1de-44aa-4762-b6bd-0893fc3f306d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Web Application should only be accessible over HTTPS\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyof\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"WebApp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"OnlyHttpsForWebApplication\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"in\": [\r\n                  \"OffByPolicy\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2fde8a98-6892-426a-83ba-050e640c0ce0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2fde8a98-6892-426a-83ba-050e640c0ce0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs configurations in 'Security Options - Network Access'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Network Access'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsNetworkAccess\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/30040dab-4e75-4456-8273-14b8f75d91d9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"30040dab-4e75-4456-8273-14b8f75d91d9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Defender for Storage should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Azure Defender for Storage provides detections of unusual and potentially harmful attempts to access or exploit storage accounts.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.3\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/pricings\",\r\n              \"name\": \"StorageAccounts\",\r\n              \"existenceScope\": \"subscription\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/pricings/pricingTier\",\r\n                \"equals\": \"Standard\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/308fbb08-4ab8-4e67-9b29-592e93fb94fa\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"308fbb08-4ab8-4e67-9b29-592e93fb94fa\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Azure Cache for Redis to disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disable public network access for your Azure Cache for Redis resource so that it's not accessible over the public internet. This helps protect the cache against data leakage risks.\",\r\n        \"metadata\": {\r\n          \"category\": \"Cache\",\r\n          \"version\": \"1.0.0\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Modify\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Modify\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Cache/Redis\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Cache/Redis/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"conflictEffect\": \"audit\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/e0f68234-74aa-48ed-b826-c38b57376e17\"\r\n              ],\r\n              \"operations\": [\r\n                {\r\n                  \"condition\": \"[greaterOrEquals(requestContext().apiVersion, '2020-06-01')]\",\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.Cache/Redis/publicNetworkAccess\",\r\n                  \"value\": \"Disabled\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/30b3dfa5-a70d-4c8e-bed6-0083858f663d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"30b3dfa5-a70d-4c8e-bed6-0083858f663d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit Windows machines missing any of specified members in the Administrators group\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if the local Administrators group does not contain one or more members that are listed in the policy parameter.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AdministratorsGroupMembersToInclude\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"MembersToInclude\": \"[LocalGroup]AdministratorsGroup;MembersToInclude\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"MembersToInclude\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Members to include\",\r\n              \"description\": \"A semicolon-separated list of members that should be included in the Administrators local group. Ex: Administrator; myUser1; myUser2\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AdministratorsGroupMembersToInclude\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('[LocalGroup]AdministratorsGroup;MembersToInclude', '=', parameters('MembersToInclude')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/30f71ea1-ac77-4f26-9fc5-2d926bbd4ba7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"30f71ea1-ac77-4f26-9fc5-2d926bbd4ba7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs that are not joined to the specified domain\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines that are not joined to the specified domain. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"DomainName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Domain Name (FQDN)\",\r\n              \"description\": \"The fully qualified domain name (FQDN) that the Windows VMs should be joined to\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsDomainMembership\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('[DomainMembership]WindowsDomainMembership;DomainName', '=', parameters('DomainName')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"WindowsDomainMembership\"\r\n                    },\r\n                    \"DomainName\": {\r\n                      \"value\": \"[parameters('DomainName')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"DomainName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[DomainMembership]WindowsDomainMembership;DomainName\",\r\n                                \"value\": \"[parameters('DomainName')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[DomainMembership]WindowsDomainMembership;DomainName\",\r\n                                \"value\": \"[parameters('DomainName')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/315c850a-272d-4502-8935-b79010405970\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"315c850a-272d-4502-8935-b79010405970\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Log Analytics Agent should be enabled for listed virtual machine images\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Reports virtual machines as non-compliant if the virtual machine image is not in the list defined and the agent is not installed.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0-preview\",\r\n          \"category\": \"Monitoring\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"listOfImageIdToInclude_windows\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of virtual machine images that have supported Windows OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"listOfImageIdToInclude_linux\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of virtual machine images that have supported Linux OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"anyOf\": [\r\n                    {\r\n                      \"anyOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageId\",\r\n                          \"in\": \"[parameters('listOfImageIdToInclude_windows')]\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageId\",\r\n                          \"in\": \"[parameters('listOfImageIdToInclude_linux')]\"\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"2008-R2-SP1\",\r\n                                \"2008-R2-SP1-smalldisk\",\r\n                                \"2012-Datacenter\",\r\n                                \"2012-Datacenter-smalldisk\",\r\n                                \"2012-R2-Datacenter\",\r\n                                \"2012-R2-Datacenter-smalldisk\",\r\n                                \"2016-Datacenter\",\r\n                                \"2016-Datacenter-Server-Core\",\r\n                                \"2016-Datacenter-Server-Core-smalldisk\",\r\n                                \"2016-Datacenter-smalldisk\",\r\n                                \"2016-Datacenter-with-Containers\",\r\n                                \"2016-Datacenter-with-RDSH\",\r\n                                \"2019-Datacenter\",\r\n                                \"2019-Datacenter-Core\",\r\n                                \"2019-Datacenter-Core-smalldisk\",\r\n                                \"2019-Datacenter-Core-with-Containers\",\r\n                                \"2019-Datacenter-Core-with-Containers-smalldisk\",\r\n                                \"2019-Datacenter-smalldisk\",\r\n                                \"2019-Datacenter-with-Containers\",\r\n                                \"2019-Datacenter-with-Containers-smalldisk\",\r\n                                \"2019-Datacenter-zhcn\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServerSemiAnnual\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"Datacenter-Core-1709-smalldisk\",\r\n                                \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                                \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServerHPCPack\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftSQLServer\"\r\n                            },\r\n                            {\r\n                              \"anyOf\": [\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2016\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2016-BYOL\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2012R2\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2012R2-BYOL\"\r\n                                }\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftRServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"MLServer-WS2016\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftVisualStudio\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"in\": [\r\n                                \"VisualStudio\",\r\n                                \"Windows\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftDynamicsAX\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"Dynamics\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftDynamicsAX\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"Dynamics\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"equals\": \"Pre-Req-AX7-Onebox-V4\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"microsoft-ads\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"windows-data-science-vm\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsDesktop\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"Windows-10\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"RedHat\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"RHEL\",\r\n                            \"RHEL-SAP-HANA\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"SUSE\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"SLES\",\r\n                            \"SLES-HPC\",\r\n                            \"SLES-HPC-Priority\",\r\n                            \"SLES-SAP\",\r\n                            \"SLES-SAP-BYOS\",\r\n                            \"SLES-Priority\",\r\n                            \"SLES-BYOS\",\r\n                            \"SLES-SAPCAL\",\r\n                            \"SLES-Standard\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"12*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"Canonical\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"UbuntuServer\"\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"14.04*LTS\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"16.04*LTS\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"18.04*LTS\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"Oracle\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"Oracle-Linux\"\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7.*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"OpenLogic\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"CentOS\",\r\n                            \"Centos-LVM\",\r\n                            \"CentOS-SRIOV\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"cloudera\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"cloudera-centos-os\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSKU\",\r\n                          \"like\": \"7*\"\r\n                        }\r\n                      ]\r\n                    }\r\n                  ]\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/32133ab0-ee4b-4b44-98d6-042180979d50\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"32133ab0-ee4b-4b44-98d6-042180979d50\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"API apps should use an Azure file share for its content directory\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"The content directory of an API app should be located on an Azure file share. The storage account information for the file share must be provided before any publishing activity. To learn more about using Azure Files for hosting app service content refer to https://go.microsoft.com/fwlink/?linkid=2151594.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"*api\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Web/sites/storageAccountRequired\",\r\n                \"equals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/324c7761-08db-4474-9661-d1039abc92ee\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"324c7761-08db-4474-9661-d1039abc92ee\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs on which the specified services are not installed and 'Running'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines on which the specified services are not installed and 'Running'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"ServiceName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Service names (supports wildcards)\",\r\n              \"description\": \"A semicolon-separated list of the names of the services that should be installed and 'Running'. e.g. 'WinRm;Wi*'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsServiceStatus\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('[WindowsServiceStatus]WindowsServiceStatus1;ServiceName', '=', parameters('ServiceName')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"WindowsServiceStatus\"\r\n                    },\r\n                    \"ServiceName\": {\r\n                      \"value\": \"[parameters('ServiceName')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ServiceName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[WindowsServiceStatus]WindowsServiceStatus1;ServiceName\",\r\n                                \"value\": \"[parameters('ServiceName')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[WindowsServiceStatus]WindowsServiceStatus1;ServiceName\",\r\n                                \"value\": \"[parameters('ServiceName')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/32b1e4d4-6cd5-47b4-a935-169da8a5c262\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"32b1e4d4-6cd5-47b4-a935-169da8a5c262\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure SQL Database should have the minimal TLS version of 1.2\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Setting minimal TLS version to 1.2 improves security by ensuring your Azure SQL Database can only be accessed from clients using TLS 1.2. Using versions of TLS less than 1.2 is not recommended since they have well documented security vulnerabilities.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/servers/minimalTlsVersion\",\r\n                    \"exists\": false\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/servers/minimalTlsVersion\",\r\n                    \"notEquals\": \"1.2\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/32e6bbec-16b6-44c2-be37-c5b672d103cf\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"32e6bbec-16b6-44c2-be37-c5b672d103cf\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy the Linux Guest Configuration extension to enable Guest Configuration assignments on Linux VMs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy deploys the Linux Guest Configuration extension to Linux virtual machines hosted in Azure that are supported by Guest Configuration. The Linux Guest Configuration extension is a prerequisite for all Linux Guest Configuration assignments and must deployed to machines before using any Linux Guest Configuration policy definition. For more information on Guest Configuration, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.1\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                    \"in\": [\r\n                      \"microsoft-aks\",\r\n                      \"qubole-inc\",\r\n                      \"datastax\",\r\n                      \"couchbase\",\r\n                      \"scalegrid\",\r\n                      \"checkpoint\",\r\n                      \"paloaltonetworks\",\r\n                      \"debian\"\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"CentOS*\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"6*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Oracle\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Oracle-Linux\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"6*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-HA\",\r\n                          \"RHEL-SAP\",\r\n                          \"RHEL-SAP-APPS\",\r\n                          \"RHEL-SAP-HA\",\r\n                          \"RHEL-SAP-HANA\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"6*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"osa\",\r\n                          \"rhel-byos\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"center-for-internet-security-inc\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"cis-centos-7-l1\",\r\n                          \"cis-centos-7-v2-1-1-l1\",\r\n                          \"cis-centos-8-l1\",\r\n                          \"cis-debian-linux-8-l1\",\r\n                          \"cis-debian-linux-9-l1\",\r\n                          \"cis-nginx-centos-7-v1-1-0-l1\",\r\n                          \"cis-oracle-linux-7-v2-0-0-l1\",\r\n                          \"cis-oracle-linux-8-l1\",\r\n                          \"cis-postgresql-11-centos-linux-7-level-1\",\r\n                          \"cis-rhel-7-l2\",\r\n                          \"cis-rhel-7-v2-2-0-l1\",\r\n                          \"cis-rhel-8-l1\",\r\n                          \"cis-suse-linux-12-v2-0-0-l1\",\r\n                          \"cis-ubuntu-linux-1604-v1-0-0-l1\",\r\n                          \"cis-ubuntu-linux-1804-l1\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"credativ\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Debian\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"7*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Suse\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"SLES*\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"11*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"12*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-dsvm\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"linux-data-science-vm-ubuntu\",\r\n                          \"azureml\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-centos-os\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"6*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-altus-centos-os\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"linux*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/virtualMachines/osProfile.linuxConfiguration\",\r\n                            \"exists\": \"true\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                            \"like\": \"Linux*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"exists\": \"false\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"notIn\": [\r\n                              \"OpenLogic\",\r\n                              \"RedHat\",\r\n                              \"credativ\",\r\n                              \"Suse\",\r\n                              \"Canonical\",\r\n                              \"microsoft-dsvm\",\r\n                              \"cloudera\",\r\n                              \"microsoft-ads\",\r\n                              \"center-for-internet-security-inc\",\r\n                              \"Oracle\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"name\": \"AzurePolicyforLinux\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.GuestConfiguration\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"ConfigurationforLinux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforLinux')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforLinux\",\r\n                          \"typeHandlerVersion\": \"1.0\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/331e8ea8-378a-410f-a2e5-ae22f38bb0da\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"331e8ea8-378a-410f-a2e5-ae22f38bb0da\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"App Service apps should enable outbound non-RFC 1918 traffic to Azure Virtual Network\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"By default, if one uses regional Azure Virtual Network (VNET) integration, the app only routes RFC1918 traffic into that respective virtual network. Using the API to set 'vnetRouteAllEnabled' to true enables all outbound traffic into the Azure Virtual Network. This setting allows features like network security groups and user defined routes to be used for all outbound traffic from the App Service app.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Web/sites\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/config/vnetRouteAllEnabled\",\r\n                \"equals\": \"true\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/33228571-70a4-4fa1-8ca1-26d0aba8d6ef\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"33228571-70a4-4fa1-8ca1-26d0aba8d6ef\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"MySQL server should use a virtual network service endpoint\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Virtual network based firewall rules are used to enable traffic from a specific subnet to Azure Database for MySQL while ensuring the traffic stays within the Azure boundary. This policy provides a way to audit if the Azure Database for MySQL has virtual network service endpoint being used.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.2\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.DBforMySQL/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.DBforMySQL/servers/virtualNetworkRules\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.DBforMySQL/servers/virtualNetworkRules/virtualNetworkSubnetId\",\r\n                \"exists\": \"true\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3375856c-3824-4e0e-ae6a-79e011dd4c47\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3375856c-3824-4e0e-ae6a-79e011dd4c47\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'Security Options - Audit'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'Security Options - Audit' for forcing audit policy subcategory and shutting down if unable to log security audits. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_SecurityOptionsAudit\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"AuditShutDownSystemImmediatelyIfUnableToLogSecurityAudits\": \"Audit: Shut down system immediately if unable to log security audits;ExpectedValue\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"AuditShutDownSystemImmediatelyIfUnableToLogSecurityAudits\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit: Shut down system immediately if unable to log security audits\",\r\n              \"description\": \"Audits if the system will shut down when unable to log Security events.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsAudit\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('Audit: Shut down system immediately if unable to log security audits;ExpectedValue', '=', parameters('AuditShutDownSystemImmediatelyIfUnableToLogSecurityAudits')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/33936777-f2ac-45aa-82ec-07958ec9ade4\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"33936777-f2ac-45aa-82ec-07958ec9ade4\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Configure backup on virtual machines with a given tag to an existing recovery services vault in the same location\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enforce backup for all virtual machines by backing them up to an existing central recovery services vault in the same location and subscription as the virtual machine. Doing this is useful when there is a central team in your organization managing backups for all resources in a subscription. You can optionally include virtual machines containing a specified tag to control the scope of assignment. See https://aka.ms/AzureVMCentralBackupIncludeTag.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0-preview\",\r\n          \"preview\": true,\r\n          \"category\": \"Backup\"\r\n        },\r\n        \"parameters\": {\r\n          \"vaultLocation\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Location (Specify the location of the VMs that you want to protect)\",\r\n              \"description\": \"Specify the location of the VMs that you want to protect. VMs should be backed up to a vault in the same location. For example - CanadaCentral\",\r\n              \"strongType\": \"location\"\r\n            }\r\n          },\r\n          \"inclusionTagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Inclusion Tag Name\",\r\n              \"description\": \"Name of the tag to use for including VMs in the scope of this policy. This should be used along with the Inclusion Tag Value parameter. Learn more at https://aka.ms/AppCentricVMBackupPolicy\"\r\n            },\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"inclusionTagValue\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Inclusion Tag Values\",\r\n              \"description\": \"Value of the tag to use for including VMs in the scope of this policy (in case of multiple values, use a comma-separated list). This should be used along with the Inclusion Tag Name parameter. Learn more at https://aka.ms/AppCentricVMBackupPolicy.\"\r\n            }\r\n          },\r\n          \"backupPolicyId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Backup Policy (of type Azure VM from a vault in the location chosen above)\",\r\n              \"description\": \"Specify the ID of the Azure Backup policy to configure backup of the virtual machines. The selected Azure Backup policy should be of type Azure Virtual Machine. This policy needs to be in a vault that is present in the location chosen above. For example - /subscriptions/<SubscriptionId>/resourceGroups/<resourceGroupName>/providers/Microsoft.RecoveryServices/vaults/<VaultName>/backupPolicies/<BackupPolicyName>\",\r\n              \"strongType\": \"Microsoft.RecoveryServices/vaults/backupPolicies\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"deployIfNotExists\",\r\n              \"auditIfNotExists\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"deployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"id\",\r\n                \"notContains\": \"/resourceGroups/databricks-rg-\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"equals\": \"[parameters('vaultLocation')]\"\r\n              },\r\n              {\r\n                \"field\": \"[concat('tags[', parameters('inclusionTagName'), ']')]\",\r\n                \"in\": \"[parameters('inclusionTagValue')]\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2008-R2-SP1\",\r\n                          \"2008-R2-SP1-smalldisk\",\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\",\r\n                          \"2019-Datacenter\",\r\n                          \"2019-Datacenter-Core\",\r\n                          \"2019-Datacenter-Core-smalldisk\",\r\n                          \"2019-Datacenter-Core-with-Containers\",\r\n                          \"2019-Datacenter-Core-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-smalldisk\",\r\n                          \"2019-Datacenter-with-Containers\",\r\n                          \"2019-Datacenter-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-zhcn\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerSemiAnnual\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"Datacenter-Core-1709-smalldisk\",\r\n                          \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                          \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerHPCPack\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2019\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016-BYOL\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2-BYOL\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftRServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"MLServer-WS2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftVisualStudio\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"VisualStudio\",\r\n                          \"Windows\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"windows-data-science-vm\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsDesktop\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Windows-10\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-SAP-HANA\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"SLES\",\r\n                          \"SLES-HPC\",\r\n                          \"SLES-HPC-Priority\",\r\n                          \"SLES-SAP\",\r\n                          \"SLES-SAP-BYOS\",\r\n                          \"SLES-Priority\",\r\n                          \"SLES-BYOS\",\r\n                          \"SLES-SAPCAL\",\r\n                          \"SLES-Standard\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"12*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"contains\": \"ubuntu\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"14.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"16.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"18.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"*20_04-lts\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"20_04-lts*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Oracle\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Oracle-Linux\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7.*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"CentOS\",\r\n                          \"Centos-LVM\",\r\n                          \"CentOS-SRIOV\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-centos-os\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"like\": \"7*\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/5e467623-bb1f-42f4-a55d-6e525e11384b\"\r\n              ],\r\n              \"type\": \"Microsoft.RecoveryServices/backupprotecteditems\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"backupPolicyId\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"fabricName\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"protectionContainers\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"protectedItems\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"sourceResourceId\": {\r\n                        \"type\": \"String\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2017-05-10\",\r\n                        \"name\": \"[concat('DeployProtection-',uniqueString(parameters('protectedItems')))]\",\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"resourceGroup\": \"[first(skip(split(parameters('backupPolicyId'), '/'), 4))]\",\r\n                        \"subscriptionId\": \"[first(skip(split(parameters('backupPolicyId'), '/'), 2))]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"backupPolicyId\": {\r\n                                \"type\": \"String\"\r\n                              },\r\n                              \"fabricName\": {\r\n                                \"type\": \"String\"\r\n                              },\r\n                              \"protectionContainers\": {\r\n                                \"type\": \"String\"\r\n                              },\r\n                              \"protectedItems\": {\r\n                                \"type\": \"String\"\r\n                              },\r\n                              \"sourceResourceId\": {\r\n                                \"type\": \"String\"\r\n                              }\r\n                            },\r\n                            \"resources\": [\r\n                              {\r\n                                \"type\": \"Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems\",\r\n                                \"name\": \"[concat(first(skip(split(parameters('backupPolicyId'), '/'), 8)), '/', parameters('fabricName'), '/',parameters('protectionContainers'), '/', parameters('protectedItems'))]\",\r\n                                \"apiVersion\": \"2016-06-01\",\r\n                                \"properties\": {\r\n                                  \"protectedItemType\": \"Microsoft.Compute/virtualMachines\",\r\n                                  \"policyId\": \"[parameters('backupPolicyId')]\",\r\n                                  \"sourceResourceId\": \"[parameters('sourceResourceId')]\"\r\n                                }\r\n                              }\r\n                            ]\r\n                          },\r\n                          \"parameters\": {\r\n                            \"backupPolicyId\": {\r\n                              \"value\": \"[parameters('backupPolicyId')]\"\r\n                            },\r\n                            \"fabricName\": {\r\n                              \"value\": \"[parameters('fabricName')]\"\r\n                            },\r\n                            \"protectionContainers\": {\r\n                              \"value\": \"[parameters('protectionContainers')]\"\r\n                            },\r\n                            \"protectedItems\": {\r\n                              \"value\": \"[parameters('protectedItems')]\"\r\n                            },\r\n                            \"sourceResourceId\": {\r\n                              \"value\": \"[parameters('sourceResourceId')]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"backupPolicyId\": {\r\n                      \"value\": \"[parameters('backupPolicyId')]\"\r\n                    },\r\n                    \"fabricName\": {\r\n                      \"value\": \"Azure\"\r\n                    },\r\n                    \"protectionContainers\": {\r\n                      \"value\": \"[concat('iaasvmcontainer;iaasvmcontainerv2;', resourceGroup().name, ';' ,field('name'))]\"\r\n                    },\r\n                    \"protectedItems\": {\r\n                      \"value\": \"[concat('vm;iaasvmcontainerv2;', resourceGroup().name, ';' ,field('name'))]\"\r\n                    },\r\n                    \"sourceResourceId\": {\r\n                      \"value\": \"[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Compute/virtualMachines/',field('name'))]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/345fa903-145c-4fe1-8bcd-93ec2adccde8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"345fa903-145c-4fe1-8bcd-93ec2adccde8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Linux VMs that have accounts without passwords\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Linux virtual machines that have accounts without passwords. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"microsoft-aks\",\r\n                          \"qubole-inc\",\r\n                          \"datastax\",\r\n                          \"couchbase\",\r\n                          \"scalegrid\",\r\n                          \"checkpoint\",\r\n                          \"paloaltonetworks\",\r\n                          \"debian\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"OpenLogic\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"CentOS*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Oracle\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Oracle-Linux\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"RHEL\",\r\n                              \"RHEL-HA\",\r\n                              \"RHEL-SAP\",\r\n                              \"RHEL-SAP-APPS\",\r\n                              \"RHEL-SAP-HA\",\r\n                              \"RHEL-SAP-HANA\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"osa\",\r\n                              \"rhel-byos\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"cis-centos-7-l1\",\r\n                              \"cis-centos-7-v2-1-1-l1\",\r\n                              \"cis-centos-8-l1\",\r\n                              \"cis-debian-linux-8-l1\",\r\n                              \"cis-debian-linux-9-l1\",\r\n                              \"cis-nginx-centos-7-v1-1-0-l1\",\r\n                              \"cis-oracle-linux-7-v2-0-0-l1\",\r\n                              \"cis-oracle-linux-8-l1\",\r\n                              \"cis-postgresql-11-centos-linux-7-level-1\",\r\n                              \"cis-rhel-7-l2\",\r\n                              \"cis-rhel-7-v2-2-0-l1\",\r\n                              \"cis-rhel-8-l1\",\r\n                              \"cis-suse-linux-12-v2-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1604-v1-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1804-l1\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"credativ\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Debian\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"7*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Suse\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"SLES*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"11*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Canonical\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"UbuntuServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"12*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"linux-data-science-vm-ubuntu\",\r\n                              \"azureml\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-centos-os\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-altus-centos-os\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"linux*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.linuxConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Linux*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"notIn\": [\r\n                                  \"OpenLogic\",\r\n                                  \"RedHat\",\r\n                                  \"credativ\",\r\n                                  \"Suse\",\r\n                                  \"Canonical\",\r\n                                  \"microsoft-dsvm\",\r\n                                  \"cloudera\",\r\n                                  \"microsoft-ads\",\r\n                                  \"center-for-internet-security-inc\",\r\n                                  \"Oracle\"\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"linux*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"PasswordPolicy_msid232\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"PasswordPolicy_msid232\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforLinux')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforLinux\",\r\n                          \"typeHandlerVersion\": \"1.0\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3470477a-b35a-49db-aca5-1073d04524fe\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3470477a-b35a-49db-aca5-1073d04524fe\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Synapse workspaces should allow outbound data traffic only to approved targets\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Increase security of your Synapse workspace by allowing outbound data traffic only to approved targets. This helps prevention against data exfiltration by validating the target before sending data.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Synapse\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\",\r\n              \"Deny\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Synapse/workspaces\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Synapse/workspaces/managedVirtualNetworkSettings.preventDataExfiltration\",\r\n                \"notEquals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3484ce98-c0c5-4c83-994b-c5ac24785218\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3484ce98-c0c5-4c83-994b-c5ac24785218\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Storage accounts should restrict network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Network access to storage accounts should be restricted. Configure network rules so only applications from allowed networks can access the storage account. To allow connections from specific internet or on-premises clients, access can be granted to traffic from specific Azure virtual networks or to public internet IP address ranges\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.1\",\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Storage/storageAccounts/networkAcls.defaultAction\",\r\n                \"notEquals\": \"Deny\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/34c877ad-507e-4c82-993e-3452a6e0ad3c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"34c877ad-507e-4c82-993e-3452a6e0ad3c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Resource logs in Logic Apps should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised\",\r\n        \"metadata\": {\r\n          \"version\": \"4.0.1\",\r\n          \"category\": \"Logic Apps\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"requiredRetentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Required retention (days)\",\r\n              \"description\": \"The required resource logs retention in days\"\r\n            },\r\n            \"defaultValue\": \"365\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Logic/workflows\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*]\",\r\n                  \"where\": {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                            \"equals\": \"true\"\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                                \"equals\": \"0\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                                \"greaterOrEquals\": \"[parameters('requiredRetentionDays')]\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                            \"equals\": \"true\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                            \"equals\": \"true\"\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                                \"notEquals\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/storageAccountId\",\r\n                                \"exists\": false\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                \"greaterOrEquals\": 1\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/34f95f76-5386-4de7-b824-0d8478470c9d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"34f95f76-5386-4de7-b824-0d8478470c9d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs that do not have a maximum password age of 70 days\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines that do not have a maximum password age of 70 days. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"2.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"MaximumPasswordAge\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"MaximumPasswordAge\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/356a906e-05e5-4625-8729-90771e0ee934\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"356a906e-05e5-4625-8729-90771e0ee934\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'System Audit Policies - Object Access'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'System Audit Policies - Object Access' for auditing file, registry, SAM, storage, filtering, kernel, and other system types. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_SystemAuditPoliciesObjectAccess\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"AuditDetailedFileShare\": \"Audit Detailed File Share;ExpectedValue\",\r\n              \"AuditFileShare\": \"Audit File Share;ExpectedValue\",\r\n              \"AuditFileSystem\": \"Audit File System;ExpectedValue\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"AuditDetailedFileShare\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit Detailed File Share\",\r\n              \"description\": \"If this policy setting is enabled, access to all shared files and folders on the system is audited. Auditing for Success can lead to very high volumes of events.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"No Auditing\",\r\n              \"Success\",\r\n              \"Failure\",\r\n              \"Success and Failure\"\r\n            ],\r\n            \"defaultValue\": \"No Auditing\"\r\n          },\r\n          \"AuditFileShare\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit File Share\",\r\n              \"description\": \"Specifies whether to audit events related to file shares: creation, deletion, modification, and access attempts. Also, it shows failed SMB SPN checks. Event volumes can be high on DCs and File Servers.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"No Auditing\",\r\n              \"Success\",\r\n              \"Failure\",\r\n              \"Success and Failure\"\r\n            ],\r\n            \"defaultValue\": \"No Auditing\"\r\n          },\r\n          \"AuditFileSystem\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit File System\",\r\n              \"description\": \"Specifies whether audit events are generated when users attempt to access file system objects. Audit events are generated only for objects that have configured system access control lists (SACLs).\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"No Auditing\",\r\n              \"Success\",\r\n              \"Failure\",\r\n              \"Success and Failure\"\r\n            ],\r\n            \"defaultValue\": \"No Auditing\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SystemAuditPoliciesObjectAccess\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('Audit Detailed File Share;ExpectedValue', '=', parameters('AuditDetailedFileShare'), ',', 'Audit File Share;ExpectedValue', '=', parameters('AuditFileShare'), ',', 'Audit File System;ExpectedValue', '=', parameters('AuditFileSystem')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/35781875-8026-4628-b19b-f6efb4d88a1d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"35781875-8026-4628-b19b-f6efb4d88a1d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"CORS should not allow every resource to access your API App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Cross-Origin Resource Sharing (CORS) should not allow all domains to access your API app. Allow only required domains to interact with your API app.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"*api\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/config/web.cors.allowedOrigins[*]\",\r\n                \"notEquals\": \"*\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/358c20a6-3f9e-4f0e-97ff-c6ce485e2aac\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"358c20a6-3f9e-4f0e-97ff-c6ce485e2aac\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'Windows Firewall Properties'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'Windows Firewall Properties' for firewall state, connections, rule management, and notifications. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_WindowsFirewallProperties\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"WindowsFirewallDomainUseProfileSettings\": \"Windows Firewall: Domain: Firewall state;ExpectedValue\",\r\n              \"WindowsFirewallDomainBehaviorForOutboundConnections\": \"Windows Firewall: Domain: Outbound connections;ExpectedValue\",\r\n              \"WindowsFirewallDomainApplyLocalConnectionSecurityRules\": \"Windows Firewall: Domain: Settings: Apply local connection security rules;ExpectedValue\",\r\n              \"WindowsFirewallDomainApplyLocalFirewallRules\": \"Windows Firewall: Domain: Settings: Apply local firewall rules;ExpectedValue\",\r\n              \"WindowsFirewallDomainDisplayNotifications\": \"Windows Firewall: Domain: Settings: Display a notification;ExpectedValue\",\r\n              \"WindowsFirewallPrivateUseProfileSettings\": \"Windows Firewall: Private: Firewall state;ExpectedValue\",\r\n              \"WindowsFirewallPrivateBehaviorForOutboundConnections\": \"Windows Firewall: Private: Outbound connections;ExpectedValue\",\r\n              \"WindowsFirewallPrivateApplyLocalConnectionSecurityRules\": \"Windows Firewall: Private: Settings: Apply local connection security rules;ExpectedValue\",\r\n              \"WindowsFirewallPrivateApplyLocalFirewallRules\": \"Windows Firewall: Private: Settings: Apply local firewall rules;ExpectedValue\",\r\n              \"WindowsFirewallPrivateDisplayNotifications\": \"Windows Firewall: Private: Settings: Display a notification;ExpectedValue\",\r\n              \"WindowsFirewallPublicUseProfileSettings\": \"Windows Firewall: Public: Firewall state;ExpectedValue\",\r\n              \"WindowsFirewallPublicBehaviorForOutboundConnections\": \"Windows Firewall: Public: Outbound connections;ExpectedValue\",\r\n              \"WindowsFirewallPublicApplyLocalConnectionSecurityRules\": \"Windows Firewall: Public: Settings: Apply local connection security rules;ExpectedValue\",\r\n              \"WindowsFirewallPublicApplyLocalFirewallRules\": \"Windows Firewall: Public: Settings: Apply local firewall rules;ExpectedValue\",\r\n              \"WindowsFirewallPublicDisplayNotifications\": \"Windows Firewall: Public: Settings: Display a notification;ExpectedValue\",\r\n              \"WindowsFirewallDomainAllowUnicastResponse\": \"Windows Firewall: Domain: Allow unicast response;ExpectedValue\",\r\n              \"WindowsFirewallPrivateAllowUnicastResponse\": \"Windows Firewall: Private: Allow unicast response;ExpectedValue\",\r\n              \"WindowsFirewallPublicAllowUnicastResponse\": \"Windows Firewall: Public: Allow unicast response;ExpectedValue\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"WindowsFirewallDomainUseProfileSettings\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Domain): Use profile settings\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security uses the settings for the Domain profile to filter network traffic. If you select Off, Windows Firewall with Advanced Security will not use any of the firewall rules or connection security rules for this profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallDomainBehaviorForOutboundConnections\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Domain): Behavior for outbound connections\",\r\n              \"description\": \"Specifies the behavior for outbound connections for the Domain profile that do not match an outbound firewall rule. The default value of 0 means to allow connections, and a value of 1 means to block connections.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"WindowsFirewallDomainApplyLocalConnectionSecurityRules\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Domain): Apply local connection security rules\",\r\n              \"description\": \"Specifies whether local administrators are allowed to create connection security rules that apply together with connection security rules configured by Group Policy for the Domain profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallDomainApplyLocalFirewallRules\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Domain): Apply local firewall rules\",\r\n              \"description\": \"Specifies whether local administrators are allowed to create local firewall rules that apply together with firewall rules configured by Group Policy for the Domain profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallDomainDisplayNotifications\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Domain): Display notifications\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security displays notifications to the user when a program is blocked from receiving inbound connections, for the Domain profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallPrivateUseProfileSettings\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Private): Use profile settings\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security uses the settings for the Private profile to filter network traffic. If you select Off, Windows Firewall with Advanced Security will not use any of the firewall rules or connection security rules for this profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallPrivateBehaviorForOutboundConnections\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Private): Behavior for outbound connections\",\r\n              \"description\": \"Specifies the behavior for outbound connections for the Private profile that do not match an outbound firewall rule. The default value of 0 means to allow connections, and a value of 1 means to block connections.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"WindowsFirewallPrivateApplyLocalConnectionSecurityRules\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Private): Apply local connection security rules\",\r\n              \"description\": \"Specifies whether local administrators are allowed to create connection security rules that apply together with connection security rules configured by Group Policy for the Private profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallPrivateApplyLocalFirewallRules\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Private): Apply local firewall rules\",\r\n              \"description\": \"Specifies whether local administrators are allowed to create local firewall rules that apply together with firewall rules configured by Group Policy for the Private profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallPrivateDisplayNotifications\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Private): Display notifications\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security displays notifications to the user when a program is blocked from receiving inbound connections, for the Private profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallPublicUseProfileSettings\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Public): Use profile settings\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security uses the settings for the Public profile to filter network traffic. If you select Off, Windows Firewall with Advanced Security will not use any of the firewall rules or connection security rules for this profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallPublicBehaviorForOutboundConnections\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Public): Behavior for outbound connections\",\r\n              \"description\": \"Specifies the behavior for outbound connections for the Public profile that do not match an outbound firewall rule. The default value of 0 means to allow connections, and a value of 1 means to block connections.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"WindowsFirewallPublicApplyLocalConnectionSecurityRules\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Public): Apply local connection security rules\",\r\n              \"description\": \"Specifies whether local administrators are allowed to create connection security rules that apply together with connection security rules configured by Group Policy for the Public profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallPublicApplyLocalFirewallRules\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Public): Apply local firewall rules\",\r\n              \"description\": \"Specifies whether local administrators are allowed to create local firewall rules that apply together with firewall rules configured by Group Policy for the Public profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallPublicDisplayNotifications\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Public): Display notifications\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security displays notifications to the user when a program is blocked from receiving inbound connections, for the Public profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallDomainAllowUnicastResponse\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall: Domain: Allow unicast response\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security permits the local computer to receive unicast responses to its outgoing multicast or broadcast messages; for the Domain profile.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"WindowsFirewallPrivateAllowUnicastResponse\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall: Private: Allow unicast response\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security permits the local computer to receive unicast responses to its outgoing multicast or broadcast messages; for the Private profile.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"WindowsFirewallPublicAllowUnicastResponse\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall: Public: Allow unicast response\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security permits the local computer to receive unicast responses to its outgoing multicast or broadcast messages; for the Public profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_WindowsFirewallProperties\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('Windows Firewall: Domain: Firewall state;ExpectedValue', '=', parameters('WindowsFirewallDomainUseProfileSettings'), ',', 'Windows Firewall: Domain: Outbound connections;ExpectedValue', '=', parameters('WindowsFirewallDomainBehaviorForOutboundConnections'), ',', 'Windows Firewall: Domain: Settings: Apply local connection security rules;ExpectedValue', '=', parameters('WindowsFirewallDomainApplyLocalConnectionSecurityRules'), ',', 'Windows Firewall: Domain: Settings: Apply local firewall rules;ExpectedValue', '=', parameters('WindowsFirewallDomainApplyLocalFirewallRules'), ',', 'Windows Firewall: Domain: Settings: Display a notification;ExpectedValue', '=', parameters('WindowsFirewallDomainDisplayNotifications'), ',', 'Windows Firewall: Private: Firewall state;ExpectedValue', '=', parameters('WindowsFirewallPrivateUseProfileSettings'), ',', 'Windows Firewall: Private: Outbound connections;ExpectedValue', '=', parameters('WindowsFirewallPrivateBehaviorForOutboundConnections'), ',', 'Windows Firewall: Private: Settings: Apply local connection security rules;ExpectedValue', '=', parameters('WindowsFirewallPrivateApplyLocalConnectionSecurityRules'), ',', 'Windows Firewall: Private: Settings: Apply local firewall rules;ExpectedValue', '=', parameters('WindowsFirewallPrivateApplyLocalFirewallRules'), ',', 'Windows Firewall: Private: Settings: Display a notification;ExpectedValue', '=', parameters('WindowsFirewallPrivateDisplayNotifications'), ',', 'Windows Firewall: Public: Firewall state;ExpectedValue', '=', parameters('WindowsFirewallPublicUseProfileSettings'), ',', 'Windows Firewall: Public: Outbound connections;ExpectedValue', '=', parameters('WindowsFirewallPublicBehaviorForOutboundConnections'), ',', 'Windows Firewall: Public: Settings: Apply local connection security rules;ExpectedValue', '=', parameters('WindowsFirewallPublicApplyLocalConnectionSecurityRules'), ',', 'Windows Firewall: Public: Settings: Apply local firewall rules;ExpectedValue', '=', parameters('WindowsFirewallPublicApplyLocalFirewallRules'), ',', 'Windows Firewall: Public: Settings: Display a notification;ExpectedValue', '=', parameters('WindowsFirewallPublicDisplayNotifications'), ',', 'Windows Firewall: Domain: Allow unicast response;ExpectedValue', '=', parameters('WindowsFirewallDomainAllowUnicastResponse'), ',', 'Windows Firewall: Private: Allow unicast response;ExpectedValue', '=', parameters('WindowsFirewallPrivateAllowUnicastResponse'), ',', 'Windows Firewall: Public: Allow unicast response;ExpectedValue', '=', parameters('WindowsFirewallPublicAllowUnicastResponse')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/35d9882c-993d-44e6-87d2-db66ce21b636\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"35d9882c-993d-44e6-87d2-db66ce21b636\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Gateway subnets should not be configured with a network security group\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy denies if a gateway subnet is configured with a network security group. Assigning a network security group to a gateway subnet will cause the gateway to stop functioning.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/virtualNetworks/subnets\"\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"equals\": \"GatewaySubnet\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Network/virtualNetworks/subnets/networkSecurityGroup.id\",\r\n                \"exists\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/35f9c03a-cc27-418e-9c0c-539ff999d010\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"35f9c03a-cc27-418e-9c0c-539ff999d010\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Advanced Threat Protection on storage accounts\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy enables Advanced Threat Protection on storage accounts.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/advancedThreatProtectionSettings\",\r\n              \"name\": \"current\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/advancedThreatProtectionSettings/isEnabled\",\r\n                \"equals\": \"true\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/fb1c8493-542b-48eb-b624-b4c8fea62acd\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"storageAccountName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2019-01-01\",\r\n                        \"type\": \"Microsoft.Storage/storageAccounts/providers/advancedThreatProtectionSettings\",\r\n                        \"name\": \"[concat(parameters('storageAccountName'), '/Microsoft.Security/current')]\",\r\n                        \"properties\": {\r\n                          \"isEnabled\": true\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"storageAccountName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/361c2074-3595-4e5d-8cab-4f21dffc835c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"361c2074-3595-4e5d-8cab-4f21dffc835c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Automation account variables should be encrypted\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"It is important to enable encryption of Automation account variable assets when storing sensitive data\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.0\",\r\n          \"category\": \"Automation\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Automation/automationAccounts/variables\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Automation/automationAccounts/variables/isEncrypted\",\r\n                \"notEquals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3657f5a0-770e-44a3-b44e-9431ba1e9735\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3657f5a0-770e-44a3-b44e-9431ba1e9735\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Threat Detection on SQL servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy ensures that Threat Detection is enabled on SQL Servers.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"notContains\": \"analytics\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"DeployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/securityAlertPolicies\",\r\n              \"name\": \"Default\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Sql/securityAlertPolicies.state\",\r\n                \"equals\": \"Enabled\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/056cd41c-7e88-42e1-933e-88ba6a50c9c3\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"serverName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('serverName'), '/Default')]\",\r\n                        \"type\": \"Microsoft.Sql/servers/securityAlertPolicies\",\r\n                        \"apiVersion\": \"2017-03-01-preview\",\r\n                        \"properties\": {\r\n                          \"state\": \"Enabled\",\r\n                          \"emailAccountAdmins\": false\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"serverName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/36d49e87-48c4-4f2e-beed-ba4ed02b71f5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"36d49e87-48c4-4f2e-beed-ba4ed02b71f5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs configurations in 'Security Options - Network Security'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Network Security'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"NetworkSecurityConfigureEncryptionTypesAllowedForKerberos\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network Security: Configure encryption types allowed for Kerberos\",\r\n              \"description\": \"Specifies the encryption types that Kerberos is allowed to use.\"\r\n            },\r\n            \"defaultValue\": \"2147483644\"\r\n          },\r\n          \"NetworkSecurityLANManagerAuthenticationLevel\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network security: LAN Manager authentication level\",\r\n              \"description\": \"Specify which challenge-response authentication protocol is used for network logons. This choice affects the level of authentication protocol used by clients, the level of session security negotiated, and the level of authentication accepted by servers.\"\r\n            },\r\n            \"defaultValue\": \"5\"\r\n          },\r\n          \"NetworkSecurityLDAPClientSigningRequirements\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network security: LDAP client signing requirements\",\r\n              \"description\": \"Specify the level of data signing that is requested on behalf of clients that issue LDAP BIND requests.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCClients\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network security: Minimum session security for NTLM SSP based (including secure RPC) clients\",\r\n              \"description\": \"Specifies which behaviors are allowed by clients for applications using the NTLM Security Support Provider (SSP). The SSP Interface (SSPI) is used by applications that need authentication services. See https://docs.microsoft.com/en-us/windows/security/threat-protection/security-policy-settings/network-security-minimum-session-security-for-ntlm-ssp-based-including-secure-rpc-servers for more information.\"\r\n            },\r\n            \"defaultValue\": \"537395200\"\r\n          },\r\n          \"NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCServers\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network security: Minimum session security for NTLM SSP based (including secure RPC) servers\",\r\n              \"description\": \"Specifies which behaviors are allowed by servers for applications using the NTLM Security Support Provider (SSP). The SSP Interface (SSPI) is used by applications that need authentication services.\"\r\n            },\r\n            \"defaultValue\": \"537395200\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsNetworkSecurity\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('Network Security: Configure encryption types allowed for Kerberos;ExpectedValue', '=', parameters('NetworkSecurityConfigureEncryptionTypesAllowedForKerberos'), ',', 'Network security: LAN Manager authentication level;ExpectedValue', '=', parameters('NetworkSecurityLANManagerAuthenticationLevel'), ',', 'Network security: LDAP client signing requirements;ExpectedValue', '=', parameters('NetworkSecurityLDAPClientSigningRequirements'), ',', 'Network security: Minimum session security for NTLM SSP based (including secure RPC) clients;ExpectedValue', '=', parameters('NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCClients'), ',', 'Network security: Minimum session security for NTLM SSP based (including secure RPC) servers;ExpectedValue', '=', parameters('NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCServers')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AzureBaseline_SecurityOptionsNetworkSecurity\"\r\n                    },\r\n                    \"NetworkSecurityConfigureEncryptionTypesAllowedForKerberos\": {\r\n                      \"value\": \"[parameters('NetworkSecurityConfigureEncryptionTypesAllowedForKerberos')]\"\r\n                    },\r\n                    \"NetworkSecurityLANManagerAuthenticationLevel\": {\r\n                      \"value\": \"[parameters('NetworkSecurityLANManagerAuthenticationLevel')]\"\r\n                    },\r\n                    \"NetworkSecurityLDAPClientSigningRequirements\": {\r\n                      \"value\": \"[parameters('NetworkSecurityLDAPClientSigningRequirements')]\"\r\n                    },\r\n                    \"NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCClients\": {\r\n                      \"value\": \"[parameters('NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCClients')]\"\r\n                    },\r\n                    \"NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCServers\": {\r\n                      \"value\": \"[parameters('NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCServers')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"NetworkSecurityConfigureEncryptionTypesAllowedForKerberos\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"NetworkSecurityLANManagerAuthenticationLevel\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"NetworkSecurityLDAPClientSigningRequirements\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCClients\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCServers\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Network Security: Configure encryption types allowed for Kerberos;ExpectedValue\",\r\n                                \"value\": \"[parameters('NetworkSecurityConfigureEncryptionTypesAllowedForKerberos')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Network security: LAN Manager authentication level;ExpectedValue\",\r\n                                \"value\": \"[parameters('NetworkSecurityLANManagerAuthenticationLevel')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Network security: LDAP client signing requirements;ExpectedValue\",\r\n                                \"value\": \"[parameters('NetworkSecurityLDAPClientSigningRequirements')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Network security: Minimum session security for NTLM SSP based (including secure RPC) clients;ExpectedValue\",\r\n                                \"value\": \"[parameters('NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCClients')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Network security: Minimum session security for NTLM SSP based (including secure RPC) servers;ExpectedValue\",\r\n                                \"value\": \"[parameters('NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCServers')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Network Security: Configure encryption types allowed for Kerberos;ExpectedValue\",\r\n                                \"value\": \"[parameters('NetworkSecurityConfigureEncryptionTypesAllowedForKerberos')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Network security: LAN Manager authentication level;ExpectedValue\",\r\n                                \"value\": \"[parameters('NetworkSecurityLANManagerAuthenticationLevel')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Network security: LDAP client signing requirements;ExpectedValue\",\r\n                                \"value\": \"[parameters('NetworkSecurityLDAPClientSigningRequirements')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Network security: Minimum session security for NTLM SSP based (including secure RPC) clients;ExpectedValue\",\r\n                                \"value\": \"[parameters('NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCClients')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Network security: Minimum session security for NTLM SSP based (including secure RPC) servers;ExpectedValue\",\r\n                                \"value\": \"[parameters('NetworkSecurityMinimumSessionSecurityForNTLMSSPBasedIncludingSecureRPCServers')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/36e17963-7202-494a-80c3-f508211c826b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"36e17963-7202-494a-80c3-f508211c826b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Modify - Configure Azure Event Grid topics to disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disable public network access for Azure Event Grid resource so that it isn't accessible over the public internet. This will help protect them against data leakage risks. You can limit exposure of the your resources by creating private endpoints instead. Learn more at: https://aka.ms/privateendpoints.\",\r\n        \"metadata\": {\r\n          \"category\": \"Event Grid\",\r\n          \"version\": \"1.0.0\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Modify\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Modify\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.EventGrid/topics\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"notEquals\": \"AzureArc\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.EventGrid/topics/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/1e241071-0855-49ea-94dc-649edcd759de\"\r\n              ],\r\n              \"conflictEffect\": \"audit\",\r\n              \"operations\": [\r\n                {\r\n                  \"condition\": \"[greaterOrEquals(requestContext().apiVersion, '2020-04-01-preview')]\",\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.EventGrid/topics/publicNetworkAccess\",\r\n                  \"value\": \"Disabled\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/36ea4b4b-0f7f-4a54-89fa-ab18f555a172\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"36ea4b4b-0f7f-4a54-89fa-ab18f555a172\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy - Configure Azure Event Grid domains with private endpoints\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoints lets you connect your virtual network to Azure services without a public IP address at the source or destination. By mapping private endpoints to your resources, they'll be protected against data leakage risks. Learn more at: https://aka.ms/privateendpoints.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Event Grid\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateEndpointSubnetId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private endpoint subnet id\",\r\n              \"description\": \"Specifies the subnet to use to configure private endpoint\",\r\n              \"strongType\": \"Microsoft.Network/virtualNetworks/subnets\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.EventGrid/domains\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.EventGrid/domains/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.EventGrid/domains/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7\",\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/1e241071-0855-49ea-94dc-649edcd759de\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"name\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"serviceId\": {\r\n                      \"value\": \"[field('id')]\"\r\n                    },\r\n                    \"privateEndpointSubnetId\": {\r\n                      \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"name\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"serviceId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointSubnetId\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"privateEndpointName\": \"[concat('pe-',substring(parameters('name'),0,min(length(parameters('name')),50)),'-',uniquestring(deployment().name))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('privateEndpointName')]\",\r\n                        \"apiVersion\": \"2020-06-01\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"expressionEvaluationOptions\": {\r\n                            \"scope\": \"inner\"\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"serviceId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"privateEndpointSubnetId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"subnetLocation\": {\r\n                                \"type\": \"string\"\r\n                              }\r\n                            },\r\n                            \"variables\": {\r\n                              \"privateEndpointName\": \"[deployment().name]\"\r\n                            },\r\n                            \"resources\": [\r\n                              {\r\n                                \"name\": \"[variables('privateEndpointName')]\",\r\n                                \"type\": \"Microsoft.Network/privateEndpoints\",\r\n                                \"apiVersion\": \"2020-07-01\",\r\n                                \"location\": \"[parameters('subnetLocation')]\",\r\n                                \"tags\": {},\r\n                                \"properties\": {\r\n                                  \"subnet\": {\r\n                                    \"id\": \"[parameters('privateEndpointSubnetId')]\"\r\n                                  },\r\n                                  \"privateLinkServiceConnections\": [\r\n                                    {\r\n                                      \"name\": \"[variables('privateEndpointName')]\",\r\n                                      \"properties\": {\r\n                                        \"privateLinkServiceId\": \"[parameters('serviceId')]\",\r\n                                        \"groupIds\": [\r\n                                          \"domain\"\r\n                                        ],\r\n                                        \"requestMessage\": \"autoapprove\"\r\n                                      }\r\n                                    }\r\n                                  ],\r\n                                  \"manualPrivateLinkServiceConnections\": []\r\n                                }\r\n                              }\r\n                            ]\r\n                          },\r\n                          \"parameters\": {\r\n                            \"serviceId\": {\r\n                              \"value\": \"[parameters('serviceId')]\"\r\n                            },\r\n                            \"privateEndpointSubnetId\": {\r\n                              \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                            },\r\n                            \"subnetLocation\": {\r\n                              \"value\": \"[reference(first(take(split(parameters('privateEndpointSubnetId'),'/subnets'),1)),'2020-07-01','Full').location]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/36f4658a-848a-467b-881c-e6fa20cf75fc\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"36f4658a-848a-467b-881c-e6fa20cf75fc\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs configurations in 'Security Options - Interactive Logon'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Interactive Logon'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsInteractiveLogon\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AzureBaseline_SecurityOptionsInteractiveLogon\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3750712b-43d0-478e-9966-d2c26f6141b9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3750712b-43d0-478e-9966-d2c26f6141b9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Storage accounts should be migrated to new Azure Resource Manager resources\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use new Azure Resource Manager for your storage accounts to provide security enhancements such as: stronger access control (RBAC), better auditing, Azure Resource Manager based deployment and governance, access to managed identities, access to key vault for secrets, Azure AD-based authentication and support for tags and resource groups for easier security management\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"in\": [\r\n                  \"Microsoft.ClassicStorage/storageAccounts\",\r\n                  \"Microsoft.Storage/StorageAccounts\"\r\n                ]\r\n              },\r\n              {\r\n                \"value\": \"[field('type')]\",\r\n                \"equals\": \"Microsoft.ClassicStorage/storageAccounts\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/37e0d2fe-28a5-43d6-a273-67d37d1f5606\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"37e0d2fe-28a5-43d6-a273-67d37d1f5606\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Resource logs in IoT Hub should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.1\",\r\n          \"category\": \"Internet of Things\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"requiredRetentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Required retention (days)\",\r\n              \"description\": \"The required resource logs retention in days\"\r\n            },\r\n            \"defaultValue\": \"365\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Devices/IotHubs\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*]\",\r\n                  \"where\": {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                            \"equals\": \"true\"\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                                \"equals\": \"0\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                                \"greaterOrEquals\": \"[parameters('requiredRetentionDays')]\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                            \"equals\": \"true\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"not\": {\r\n                              \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                              \"equals\": \"true\"\r\n                            }\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                            \"equals\": \"true\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                \"greaterOrEquals\": 1\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/383856f8-de7f-44a2-81fc-e5135b5c2aa4\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"383856f8-de7f-44a2-81fc-e5135b5c2aa4\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy the Windows Guest Configuration extension to enable Guest Configuration assignments on Windows VMs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy deploys the Windows Guest Configuration extension to Windows virtual machines hosted in Azure that are supported by Guest Configuration. The Windows Guest Configuration extension is a prerequisite for all Windows Guest Configuration assignments and must deployed to machines before using any Windows Guest Configuration policy definition. For more information on Guest Configuration, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.1\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                    \"in\": [\r\n                      \"esri\",\r\n                      \"incredibuild\",\r\n                      \"MicrosoftDynamicsAX\",\r\n                      \"MicrosoftSharepoint\",\r\n                      \"MicrosoftVisualStudio\",\r\n                      \"MicrosoftWindowsDesktop\",\r\n                      \"MicrosoftWindowsServerHPCPack\"\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"2008*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"notLike\": \"SQL2008*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-dsvm\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"dsvm-windows\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"standard-data-science-vm\",\r\n                          \"windows-data-science-vm\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"batch\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"rendering-windows2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"center-for-internet-security-inc\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"cis-windows-server-201*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"pivotal\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"bosh-windows-server*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloud-infrastructure-services\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"ad*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                            \"exists\": \"true\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                            \"like\": \"Windows*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"exists\": \"false\"\r\n                          },\r\n                          {\r\n                            \"allOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"notLike\": \"2008*\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                \"notLike\": \"SQL2008*\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"name\": \"AzurePolicyforWindows\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.GuestConfiguration\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"ConfigurationforWindows\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/385f5831-96d4-41db-9a3c-cd3af78aaae6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"385f5831-96d4-41db-9a3c-cd3af78aaae6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Synapse workspaces should disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disabling public network access improves security by ensuring that the Synapse workspace isn't exposed on the public internet. Creating private endpoints can limit exposure of your Synapse workspaces. Learn more at: https://docs.microsoft.com/azure/synapse-analytics/security/connectivity-settings.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Synapse\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Synapse/workspaces\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Synapse/workspaces/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/38d8df46-cf4e-4073-8e03-48c24b29de0d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"38d8df46-cf4e-4073-8e03-48c24b29de0d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Advanced data security settings for SQL Managed Instance should contain an email address for security alerts\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Ensure that an email address is provided for the 'Send alerts to' field in the advanced data security settings. This email address receives alert notifications when anomalous activities are detected on SQL Managed Instance.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1-deprecated\",\r\n          \"category\": \"SQL\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Disabled\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/managedInstances\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/managedInstances/securityAlertPolicies\",\r\n              \"name\": \"default\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/managedInstances/securityAlertPolicies/emailAddresses[*]\",\r\n                    \"notEquals\": \"\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/managedInstances/securityAlertPolicies/emailAddresses[*]\",\r\n                    \"exists\": \"true\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3965c43d-b5f4-482e-b74a-d89ee0e0b3a8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3965c43d-b5f4-482e-b74a-d89ee0e0b3a8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"FTPS only should be required in your Function App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enable FTPS enforcement for enhanced security\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"functionapp*\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/config/ftpsState\",\r\n                \"in\": [\r\n                  \"FtpsOnly\",\r\n                  \"Disabled\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/399b2637-a50f-4f95-96f8-3a145476eb15\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"399b2637-a50f-4f95-96f8-3a145476eb15\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Synapse managed private endpoints should only connect to resources in approved Azure Active Directory tenants\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Protect your Synapse workspace by only allowing connections to resources in approved Azure Active Directory (Azure AD) tenants. The approved Azure AD tenants can be defined during policy assignment.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Synapse\"\r\n        },\r\n        \"parameters\": {\r\n          \"allowedTenantIds\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"List of Allowed Tenant Ids for private endpoint creation\",\r\n              \"description\": \"This parameter defines the list of Allowed Tenant Ids that are allowed to create managed private endpoints in the workspaces\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\",\r\n              \"Deny\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Synapse/workspaces\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Synapse/workspaces/managedVirtualNetworkSettings.allowedAadTenantIdsForLinking[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.Synapse/workspaces/managedVirtualNetworkSettings.allowedAadTenantIdsForLinking[*]\",\r\n                    \"notIn\": \"[parameters('allowedTenantIds')]\"\r\n                  }\r\n                },\r\n                \"greater\": 0\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3a003702-13d2-4679-941b-937e58c443f0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3a003702-13d2-4679-941b-937e58c443f0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Infrastructure encryption should be enabled for Azure Database for MySQL servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enable infrastructure encryption for Azure Database for MySQL servers to have higher level of assurance that the data is secure. When infrastructure encryption is enabled, the data at rest is encrypted twice using FIPS 140-2 compliant Microsoft managed keys.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DBforMySQL/servers\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DBforMySQL/servers/infrastructureEncryption\",\r\n                \"notEquals\": \"Enabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3a58212a-c829-4f13-9872-6371df2fd0b4\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3a58212a-c829-4f13-9872-6371df2fd0b4\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'Administrative Templates - Control Panel'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'Administrative Templates - Control Panel' for input personalization and prevention of enabling lock screens. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_AdministrativeTemplatesControlPanel\",\r\n            \"version\": \"1.*\"\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_AdministrativeTemplatesControlPanel\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3aa2661b-02d7-4ba6-99bc-dc36b10489fd\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3aa2661b-02d7-4ba6-99bc-dc36b10489fd\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Active Directory Domain Services managed domains should use TLS 1.2 only mode\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use TLS 1.2 only mode for your managed domains. By default, Azure AD Domain Services enables the use of ciphers such as NTLM v1 and TLS v1. These ciphers may be required for some legacy applications, but are considered weak and can be disabled if you don't need them. When TLS 1.2 only mode is enabled, any client making a request that is not using TLS 1.2 will fail. Learn more at https://docs.microsoft.com/azure/active-directory-domain-services/secure-your-domain.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.0\",\r\n          \"category\": \"Azure Active Directory\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.AAD/domainServices\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.AAD/domainServices/domainSecuritySettings.tlsV1\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3aa87b5a-7813-4b57-8a43-42dd9df5aaa7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3aa87b5a-7813-4b57-8a43-42dd9df5aaa7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Pod Security Policies should be defined on Kubernetes Services\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Define Pod Security Policies to reduce the attack vector by removing unnecessary application privileges. It is recommended to configure Pod Security Policies to only allow pods to access the resources which they have permissions to access.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Disabled\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ContainerService/managedClusters\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.ContainerService/managedClusters/enablePodSecurityPolicy\",\r\n                    \"exists\": \"false\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.ContainerService/managedClusters/enablePodSecurityPolicy\",\r\n                    \"equals\": \"false\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3abeb944-26af-43ee-b83d-32aaf060fb94\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3abeb944-26af-43ee-b83d-32aaf060fb94\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Azure Synapse workspaces with private endpoints\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoints connect your virtual network to Azure services without a public IP address at the source or destination. By mapping private endpoints to Azure Synapse workspaces, you can reduce data leakage risks. Learn more about private links at: https://docs.microsoft.com/azure/synapse-analytics/security/how-to-connect-to-workspace-with-private-links.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Synapse\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateEndpointSubnetId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private endpoint subnet id\",\r\n              \"description\": \"A subnet with private endpoint network policies disabled\",\r\n              \"strongType\": \"Microsoft.Network/virtualNetworks/subnets\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Synapse/workspaces\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Synapse/workspaces/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Synapse/workspaces/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"name\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"serviceId\": {\r\n                      \"value\": \"[field('id')]\"\r\n                    },\r\n                    \"privateEndpointSubnetId\": {\r\n                      \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"name\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"serviceId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointSubnetId\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"privateEndpointName\": \"[concat('pe-',substring(parameters('name'),0,min(length(parameters('name')),50)),'-',uniquestring(deployment().name))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('privateEndpointName')]\",\r\n                        \"apiVersion\": \"2020-06-01\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"expressionEvaluationOptions\": {\r\n                            \"scope\": \"inner\"\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"serviceId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"privateEndpointSubnetId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"subnetLocation\": {\r\n                                \"type\": \"string\"\r\n                              }\r\n                            },\r\n                            \"variables\": {\r\n                              \"privateEndpointName\": \"[deployment().name]\"\r\n                            },\r\n                            \"resources\": [\r\n                              {\r\n                                \"name\": \"[variables('privateEndpointName')]\",\r\n                                \"type\": \"Microsoft.Network/privateEndpoints\",\r\n                                \"apiVersion\": \"2020-07-01\",\r\n                                \"location\": \"[parameters('subnetLocation')]\",\r\n                                \"tags\": {},\r\n                                \"properties\": {\r\n                                  \"subnet\": {\r\n                                    \"id\": \"[parameters('privateEndpointSubnetId')]\"\r\n                                  },\r\n                                  \"privateLinkServiceConnections\": [\r\n                                    {\r\n                                      \"name\": \"[variables('privateEndpointName')]\",\r\n                                      \"properties\": {\r\n                                        \"privateLinkServiceId\": \"[parameters('serviceId')]\",\r\n                                        \"groupIds\": [\r\n                                          \"Dev\"\r\n                                        ],\r\n                                        \"requestMessage\": \"Auto approved by policy assignment\"\r\n                                      }\r\n                                    }\r\n                                  ],\r\n                                  \"manualPrivateLinkServiceConnections\": []\r\n                                }\r\n                              }\r\n                            ]\r\n                          },\r\n                          \"parameters\": {\r\n                            \"serviceId\": {\r\n                              \"value\": \"[parameters('serviceId')]\"\r\n                            },\r\n                            \"privateEndpointSubnetId\": {\r\n                              \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                            },\r\n                            \"subnetLocation\": {\r\n                              \"value\": \"[reference(first(take(split(parameters('privateEndpointSubnetId'),'/subnets'),1)),'2020-07-01','Full').location]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3b3b0c27-08d2-4b32-879d-19930bee3266\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3b3b0c27-08d2-4b32-879d-19930bee3266\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"An activity log alert should exist for specific Security operations\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy audits specific Security operations with no activity log alerts configured.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"operationName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Operation Name\",\r\n              \"description\": \"Security Operation name for which activity log alert should exist\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Microsoft.Security/policies/write\",\r\n              \"Microsoft.Security/securitySolutions/write\",\r\n              \"Microsoft.Security/securitySolutions/delete\"\r\n            ]\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Resources/subscriptions\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/ActivityLogAlerts\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/ActivityLogAlerts/enabled\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"count\": {\r\n                      \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*]\",\r\n                      \"where\": {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"allOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].field\",\r\n                                \"equals\": \"category\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].equals\",\r\n                                \"equals\": \"Security\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"allOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].field\",\r\n                                \"equals\": \"operationName\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].equals\",\r\n                                \"equals\": \"[parameters('operationName')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    },\r\n                    \"equals\": 2\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].field\",\r\n                      \"equals\": \"category\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/ActivityLogAlerts/condition.allOf[*].field\",\r\n                      \"equals\": \"operationName\"\r\n                    }\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3b980d31-7904-4bb7-8575-5665739a8052\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3b980d31-7904-4bb7-8575-5665739a8052\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy - Configure Dependency agent to be enabled on Windows virtual machine scale sets\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Dependency agent for Windows virtual machine scale sets if the virtual machine image is in the list defined and the agent is not installed. If your scale set upgradePolicy is set to Manual, you need to apply the extension to all the virtual machines in the set by updating them.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfImageIdToInclude\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of virtual machine images that have supported Windows OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageId\",\r\n                    \"in\": \"[parameters('listOfImageIdToInclude')]\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2008-R2-SP1\",\r\n                          \"2008-R2-SP1-smalldisk\",\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\",\r\n                          \"2019-Datacenter\",\r\n                          \"2019-Datacenter-Core\",\r\n                          \"2019-Datacenter-Core-smalldisk\",\r\n                          \"2019-Datacenter-Core-with-Containers\",\r\n                          \"2019-Datacenter-Core-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-smalldisk\",\r\n                          \"2019-Datacenter-with-Containers\",\r\n                          \"2019-Datacenter-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-zhcn\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerSemiAnnual\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"Datacenter-Core-1709-smalldisk\",\r\n                          \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                          \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerHPCPack\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016-BYOL\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2-BYOL\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftRServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"MLServer-WS2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftVisualStudio\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"VisualStudio\",\r\n                          \"Windows\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-V4\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"windows-data-science-vm\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsDesktop\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Windows-10\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\r\n                    \"equals\": \"DependencyAgentWindows\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Monitoring.DependencyAgent\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"DependencyAgentWindows\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.Azure.Monitoring.DependencyAgent\",\r\n                      \"vmExtensionType\": \"DependencyAgentWindows\",\r\n                      \"vmExtensionTypeHandlerVersion\": \"9.7\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"typeHandlerVersion\": \"[variables('vmExtensionTypeHandlerVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for: ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3be22e3b-d919-47aa-805e-8985dbeb0ad9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3be22e3b-d919-47aa-805e-8985dbeb0ad9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"PostgreSQL server should use a virtual network service endpoint\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Virtual network based firewall rules are used to enable traffic from a specific subnet to Azure Database for PostgreSQL while ensuring the traffic stays within the Azure boundary. This policy provides a way to audit if the Azure Database for PostgreSQL has virtual network service endpoint being used.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.2\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.DBforPostgreSQL/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.DBforPostgreSQL/servers/virtualNetworkRules\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.DBforPostgreSQL/servers/virtualNetworkRules/virtualNetworkSubnetId\",\r\n                \"exists\": \"true\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3c14b034-bcb6-4905-94e7-5b8e98a47b65\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3c14b034-bcb6-4905-94e7-5b8e98a47b65\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy - Configure Log Analytics agent to be enabled on Windows virtual machine scale sets\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Log Analytics agent for Windows virtual machine scale sets if the virtual machine image is in the list defined and the agent is not installed. If your scale set upgradePolicy is set to Manual, you need to apply the extension to all the virtual machine in the set by updating them.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Log Analytics workspace is used to receive performance data. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"listOfImageIdToInclude\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of virtual machine images that have supported Windows OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageId\",\r\n                    \"in\": \"[parameters('listOfImageIdToInclude')]\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2008-R2-SP1\",\r\n                          \"2008-R2-SP1-smalldisk\",\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\",\r\n                          \"2019-Datacenter\",\r\n                          \"2019-Datacenter-Core\",\r\n                          \"2019-Datacenter-Core-smalldisk\",\r\n                          \"2019-Datacenter-Core-with-Containers\",\r\n                          \"2019-Datacenter-Core-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-smalldisk\",\r\n                          \"2019-Datacenter-with-Containers\",\r\n                          \"2019-Datacenter-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-zhcn\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerSemiAnnual\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"Datacenter-Core-1709-smalldisk\",\r\n                          \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                          \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerHPCPack\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016-BYOL\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2-BYOL\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftRServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"MLServer-WS2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftVisualStudio\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"VisualStudio\",\r\n                          \"Windows\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-V4\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"windows-data-science-vm\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsDesktop\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Windows-10\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\r\n                    \"equals\": \"MicrosoftMonitoringAgent\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"MicrosoftMonitoringAgent\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.EnterpriseCloud.Monitoring\",\r\n                      \"vmExtensionType\": \"MicrosoftMonitoringAgent\",\r\n                      \"vmExtensionTypeHandlerVersion\": \"1.0\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"typeHandlerVersion\": \"[variables('vmExtensionTypeHandlerVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"workspaceId\": \"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\",\r\n                            \"stopOnMultipleConnections\": \"true\"\r\n                          },\r\n                          \"protectedSettings\": {\r\n                            \"workspaceKey\": \"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"\r\n                          }\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for: ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3c1b3629-c8f8-4bf6-862c-037cb9094038\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3c1b3629-c8f8-4bf6-862c-037cb9094038\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Vulnerabilities in security configuration on your virtual machine scale sets should be remediated\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit the OS vulnerabilities on your virtual machine scale sets to protect them from attacks.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"8941d121-f740-35f6-952c-6561d2b38d36\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3c735d8a-a4ba-4a3a-b7cf-db7754cf57f4\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3c735d8a-a4ba-4a3a-b7cf-db7754cf57f4\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Add system-assigned managed identity to enable Guest Configuration assignments on virtual machines with no identities\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy adds a system-assigned managed identity to virtual machines hosted in Azure that are supported by Guest Configuration but do not have any managed identities. A system-assigned managed identity is a prerequisite for all Guest Configuration assignments and must be added to machines before using any Guest Configuration policy definitions. For more information on Guest Configuration, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.0\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"microsoft-aks\",\r\n                          \"qubole-inc\",\r\n                          \"datastax\",\r\n                          \"couchbase\",\r\n                          \"scalegrid\",\r\n                          \"checkpoint\",\r\n                          \"paloaltonetworks\",\r\n                          \"debian\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"OpenLogic\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"CentOS*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Oracle\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Oracle-Linux\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"RHEL\",\r\n                              \"RHEL-HA\",\r\n                              \"RHEL-SAP\",\r\n                              \"RHEL-SAP-APPS\",\r\n                              \"RHEL-SAP-HA\",\r\n                              \"RHEL-SAP-HANA\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"osa\",\r\n                              \"rhel-byos\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"cis-centos-7-l1\",\r\n                              \"cis-centos-7-v2-1-1-l1\",\r\n                              \"cis-centos-8-l1\",\r\n                              \"cis-debian-linux-8-l1\",\r\n                              \"cis-debian-linux-9-l1\",\r\n                              \"cis-nginx-centos-7-v1-1-0-l1\",\r\n                              \"cis-oracle-linux-7-v2-0-0-l1\",\r\n                              \"cis-oracle-linux-8-l1\",\r\n                              \"cis-postgresql-11-centos-linux-7-level-1\",\r\n                              \"cis-rhel-7-l2\",\r\n                              \"cis-rhel-7-v2-2-0-l1\",\r\n                              \"cis-rhel-8-l1\",\r\n                              \"cis-suse-linux-12-v2-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1604-v1-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1804-l1\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"credativ\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Debian\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"7*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Suse\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"SLES*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"11*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Canonical\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"UbuntuServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"12*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"linux-data-science-vm-ubuntu\",\r\n                              \"azureml\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-centos-os\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-altus-centos-os\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"linux*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.linuxConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Linux*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"notIn\": [\r\n                                  \"OpenLogic\",\r\n                                  \"RedHat\",\r\n                                  \"credativ\",\r\n                                  \"Suse\",\r\n                                  \"Canonical\",\r\n                                  \"microsoft-dsvm\",\r\n                                  \"cloudera\",\r\n                                  \"microsoft-ads\",\r\n                                  \"center-for-internet-security-inc\",\r\n                                  \"Oracle\"\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"value\": \"[requestContext().apiVersion]\",\r\n                \"greaterOrEquals\": \"2018-10-01\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"identity.type\",\r\n                    \"exists\": \"false\"\r\n                  },\r\n                  {\r\n                    \"field\": \"identity.type\",\r\n                    \"equals\": \"None\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"modify\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"operations\": [\r\n                {\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"identity.type\",\r\n                  \"value\": \"SystemAssigned\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3cf2ab00-13f1-4d0c-8971-2ac904541a7e\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3cf2ab00-13f1-4d0c-8971-2ac904541a7e\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit Windows machines that have extra accounts in the Administrators group\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if the local Administrators group contains members that are not listed in the policy parameter.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AdministratorsGroupMembers\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"Members\": \"[LocalGroup]AdministratorsGroup;Members\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"Members\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Members\",\r\n              \"description\": \"A semicolon-separated list of all the expected members of the Administrators local group. Ex: Administrator; myUser1; myUser2\"\r\n            },\r\n            \"allowedValues\": [],\r\n            \"defaultValue\": \"Administrator\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AdministratorsGroupMembers\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('[LocalGroup]AdministratorsGroup;Members', '=', parameters('Members')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3d2a3320-2a72-4c67-ac5f-caa40fbee2b2\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3d2a3320-2a72-4c67-ac5f-caa40fbee2b2\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Diagnostic Settings for Search Services to Event Hub\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploys the diagnostic settings for Search Services to stream to a regional Event Hub when any Search Services which is missing this diagnostic settings is created or updated.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          },\r\n          \"profileName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Profile name\",\r\n              \"description\": \"The diagnostic settings profile name\"\r\n            },\r\n            \"defaultValue\": \"setbypolicy_eventHub\"\r\n          },\r\n          \"eventHubRuleId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Event Hub Authorization Rule Id\",\r\n              \"description\": \"The Event Hub authorization rule Id for Azure Diagnostics. The authorization rule needs to be at Event Hub namespace level. e.g. /subscriptions/{subscription Id}/resourceGroups/{resource group}/providers/Microsoft.EventHub/namespaces/{Event Hub namespace}/authorizationrules/{authorization rule}\",\r\n              \"strongType\": \"Microsoft.EventHub/Namespaces/AuthorizationRules\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"eventHubLocation\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Event Hub Location\",\r\n              \"description\": \"The location the Event Hub resides in. Only Search Services in this location will be linked to this Event Hub.\",\r\n              \"strongType\": \"location\"\r\n            },\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"metricsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable metrics\",\r\n              \"description\": \"Whether to enable metrics stream to the Event Hub - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"False\"\r\n          },\r\n          \"logsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable logs\",\r\n              \"description\": \"Whether to enable logs stream to the Event Hub  - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Search/searchServices\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('eventHubLocation')]\",\r\n                    \"equals\": \"\"\r\n                  },\r\n                  {\r\n                    \"field\": \"location\",\r\n                    \"equals\": \"[parameters('eventHubLocation')]\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"name\": \"[parameters('profileName')]\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                    \"equals\": \"[parameters('logsEnabled')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\r\n                    \"equals\": \"[parameters('metricsEnabled')]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"resourceName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"eventHubRuleId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"metricsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"profileName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Search/searchServices/providers/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"dependsOn\": [],\r\n                        \"properties\": {\r\n                          \"eventHubAuthorizationRuleId\": \"[parameters('eventHubRuleId')]\",\r\n                          \"metrics\": [\r\n                            {\r\n                              \"category\": \"AllMetrics\",\r\n                              \"enabled\": \"[parameters('metricsEnabled')]\",\r\n                              \"retentionPolicy\": {\r\n                                \"enabled\": false,\r\n                                \"days\": 0\r\n                              }\r\n                            }\r\n                          ],\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"OperationLogs\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {}\r\n                  },\r\n                  \"parameters\": {\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"resourceName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"eventHubRuleId\": {\r\n                      \"value\": \"[parameters('eventHubRuleId')]\"\r\n                    },\r\n                    \"metricsEnabled\": {\r\n                      \"value\": \"[parameters('metricsEnabled')]\"\r\n                    },\r\n                    \"logsEnabled\": {\r\n                      \"value\": \"[parameters('logsEnabled')]\"\r\n                    },\r\n                    \"profileName\": {\r\n                      \"value\": \"[parameters('profileName')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3d5da587-71bd-41f5-ac95-dd3330c2d58d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3d5da587-71bd-41f5-ac95-dd3330c2d58d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs configurations in 'Security Options - Devices'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Devices'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsDevices\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3d7b154e-2700-4c8c-9e46-cb65ac1578c2\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3d7b154e-2700-4c8c-9e46-cb65ac1578c2\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy default Log Analytics Agent for Ubuntu VMs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy deploys the Log Analytics Agent on Ubuntu VMs, and connects to the selected Log Analytics workspace\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Compute\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                \"equals\": \"Canonical\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                \"equals\": \"UbuntuServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                \"in\": [\r\n                  \"18.04-LTS\",\r\n                  \"16.04-LTS\",\r\n                  \"16.04.0-LTS\",\r\n                  \"14.04.2-LTS\",\r\n                  \"12.04.5-LTS\"\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"OmsAgentForLinux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('vmName'),'/omsPolicy')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"apiVersion\": \"2017-12-01\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.EnterpriseCloud.Monitoring\",\r\n                          \"type\": \"OmsAgentForLinux\",\r\n                          \"typeHandlerVersion\": \"1.4\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"workspaceId\": \"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\"\r\n                          },\r\n                          \"protectedSettings\": {\r\n                            \"workspaceKey\": \"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"\r\n                          }\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled monitoring for Linux VM', ': ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3d8640fc-63f6-4734-8dcb-cfd3d8c78f38\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3d8640fc-63f6-4734-8dcb-cfd3d8c78f38\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"App Configuration should disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disabling public network access improves security by ensuring that the resource isn't exposed on the public internet. You can limit exposure of your resources by creating private endpoints instead. Learn more at: https://aka.ms/appconfig/private-endpoint.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Configuration\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.AppConfiguration/configurationStores\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.AppConfiguration/configurationStores/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3d9f5e4c-9947-4579-9539-2a7695fbc187\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3d9f5e4c-9947-4579-9539-2a7695fbc187\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit Windows machines that do not have the specified Windows PowerShell modules installed\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if a module isn't available in a location specified by the environment variable PSModulePath.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"WindowsPowerShellModules\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"Modules\": \"[PowerShellModules]PowerShellModules1;Modules\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"Modules\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"PowerShell Modules\",\r\n              \"description\": \"A semicolon-separated list of the names of the PowerShell modules that should be installed. You may also specify a specific version of a module that should be installed by including a comma after the module name, followed by the desired version. Example: PSDscResources; SqlServerDsc, 12.0.0.0; ComputerManagementDsc, 6.1.0.0\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsPowerShellModules\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('[PowerShellModules]PowerShellModules1;Modules', '=', parameters('Modules')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3e4e2bd5-15a2-4628-b3e1-58977e9793f3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3e4e2bd5-15a2-4628-b3e1-58977e9793f3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Monitor solution 'Security and Audit' must be deployed\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy ensures that Security and Audit is deployed.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.OperationsManagement/solutions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.OperationsManagement/solutions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  },\r\n                  {\r\n                    \"field\": \"name\",\r\n                    \"like\": \"Security(*)\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3e596b57-105f-48a6-be97-03e9243bad6e\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3e596b57-105f-48a6-be97-03e9243bad6e\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Audit API Applications that are not using latest supported PHP Framework\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use the latest supported PHP version for the latest security classes. Using older classes and types can make your application vulnerable.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyof\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"api\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"apiApp\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UseLatestPHP\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"in\": [\r\n                  \"OffByPolicy\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3fe37002-5d00-4b37-a301-da09e3a0ca66\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3fe37002-5d00-4b37-a301-da09e3a0ca66\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'Security Options - Network Access'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'Security Options - Network Access' for including access for anonymous users, local accounts, and remote access to the registry. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_SecurityOptionsNetworkAccess\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"NetworkAccessRemotelyAccessibleRegistryPaths\": \"Network access: Remotely accessible registry paths;ExpectedValue\",\r\n              \"NetworkAccessRemotelyAccessibleRegistryPathsAndSubpaths\": \"Network access: Remotely accessible registry paths and sub-paths;ExpectedValue\",\r\n              \"NetworkAccessSharesThatCanBeAccessedAnonymously\": \"Network access: Shares that can be accessed anonymously;ExpectedValue\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"NetworkAccessRemotelyAccessibleRegistryPaths\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network access: Remotely accessible registry paths\",\r\n              \"description\": \"Specifies which registry paths will be accessible over the network, regardless of the users or groups listed in the access control list (ACL) of the `winreg` registry key.\"\r\n            },\r\n            \"defaultValue\": \"System\\\\CurrentControlSet\\\\Control\\\\ProductOptions|#|System\\\\CurrentControlSet\\\\Control\\\\Server Applications|#|Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\"\r\n          },\r\n          \"NetworkAccessRemotelyAccessibleRegistryPathsAndSubpaths\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network access: Remotely accessible registry paths and sub-paths\",\r\n              \"description\": \"Specifies which registry paths and sub-paths will be accessible over the network, regardless of the users or groups listed in the access control list (ACL) of the `winreg` registry key.\"\r\n            },\r\n            \"defaultValue\": \"System\\\\CurrentControlSet\\\\Control\\\\Print\\\\Printers|#|System\\\\CurrentControlSet\\\\Services\\\\Eventlog|#|Software\\\\Microsoft\\\\OLAP Server|#|Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Print|#|Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Windows|#|System\\\\CurrentControlSet\\\\Control\\\\ContentIndex|#|System\\\\CurrentControlSet\\\\Control\\\\Terminal Server|#|System\\\\CurrentControlSet\\\\Control\\\\Terminal Server\\\\UserConfig|#|System\\\\CurrentControlSet\\\\Control\\\\Terminal Server\\\\DefaultUserConfiguration|#|Software\\\\Microsoft\\\\Windows NT\\\\CurrentVersion\\\\Perflib|#|System\\\\CurrentControlSet\\\\Services\\\\SysmonLog\"\r\n          },\r\n          \"NetworkAccessSharesThatCanBeAccessedAnonymously\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network access: Shares that can be accessed anonymously\",\r\n              \"description\": \"Specifies which network shares can be accessed by anonymous users. The default configuration for this policy setting has little effect because all users have to be authenticated before they can access shared resources on the server.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsNetworkAccess\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('Network access: Remotely accessible registry paths;ExpectedValue', '=', parameters('NetworkAccessRemotelyAccessibleRegistryPaths'), ',', 'Network access: Remotely accessible registry paths and sub-paths;ExpectedValue', '=', parameters('NetworkAccessRemotelyAccessibleRegistryPathsAndSubpaths'), ',', 'Network access: Shares that can be accessed anonymously;ExpectedValue', '=', parameters('NetworkAccessSharesThatCanBeAccessedAnonymously')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3ff60f98-7fa4-410a-9f7f-0b00f5afdbdd\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3ff60f98-7fa4-410a-9f7f-0b00f5afdbdd\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Secure transfer to storage accounts should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit requirement of Secure transfer in your storage account. Secure transfer is an option that forces your storage account to accept requests only from secure connections (HTTPS). Use of HTTPS ensures authentication between the server and the service and protects data in transit from network layer attacks such as man-in-the-middle, eavesdropping, and session-hijacking\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"value\": \"[requestContext().apiVersion]\",\r\n                        \"less\": \"2019-04-01\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Storage/storageAccounts/supportsHttpsTrafficOnly\",\r\n                        \"exists\": \"false\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Storage/storageAccounts/supportsHttpsTrafficOnly\",\r\n                    \"equals\": \"false\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/404c3081-a854-4457-ae30-26a93ef643f9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"404c3081-a854-4457-ae30-26a93ef643f9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs configurations in 'Administrative Templates - System'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Administrative Templates - System'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"AlwaysUseClassicLogon\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Always use classic logon\",\r\n              \"description\": \"Specifies whether to force the user to log on to the computer using the classic logon screen. This setting only works when the computer is not on a domain.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"BootStartDriverInitializationPolicy\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Boot-Start Driver Initialization Policy\",\r\n              \"description\": \"Specifies which boot-start drivers are initialized based on a classification determined by an Early Launch Antimalware boot-start driver.\"\r\n            },\r\n            \"defaultValue\": \"3\"\r\n          },\r\n          \"EnableWindowsNTPClient\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable Windows NTP Client\",\r\n              \"description\": \"Specifies whether the Windows NTP Client is enabled. Enabling the Windows NTP Client allows your computer to synchronize its computer clock with other NTP servers.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"TurnOnConveniencePINSignin\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Turn on convenience PIN sign-in\",\r\n              \"description\": \"Specifies whether a domain user can sign in using a convenience PIN.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_AdministrativeTemplatesSystem\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('Always use classic logon;ExpectedValue', '=', parameters('AlwaysUseClassicLogon'), ',', 'Boot-Start Driver Initialization Policy;ExpectedValue', '=', parameters('BootStartDriverInitializationPolicy'), ',', 'Enable Windows NTP Client;ExpectedValue', '=', parameters('EnableWindowsNTPClient'), ',', 'Turn on convenience PIN sign-in;ExpectedValue', '=', parameters('TurnOnConveniencePINSignin')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AzureBaseline_AdministrativeTemplatesSystem\"\r\n                    },\r\n                    \"AlwaysUseClassicLogon\": {\r\n                      \"value\": \"[parameters('AlwaysUseClassicLogon')]\"\r\n                    },\r\n                    \"BootStartDriverInitializationPolicy\": {\r\n                      \"value\": \"[parameters('BootStartDriverInitializationPolicy')]\"\r\n                    },\r\n                    \"EnableWindowsNTPClient\": {\r\n                      \"value\": \"[parameters('EnableWindowsNTPClient')]\"\r\n                    },\r\n                    \"TurnOnConveniencePINSignin\": {\r\n                      \"value\": \"[parameters('TurnOnConveniencePINSignin')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AlwaysUseClassicLogon\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"BootStartDriverInitializationPolicy\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"EnableWindowsNTPClient\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"TurnOnConveniencePINSignin\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Always use classic logon;ExpectedValue\",\r\n                                \"value\": \"[parameters('AlwaysUseClassicLogon')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Boot-Start Driver Initialization Policy;ExpectedValue\",\r\n                                \"value\": \"[parameters('BootStartDriverInitializationPolicy')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Enable Windows NTP Client;ExpectedValue\",\r\n                                \"value\": \"[parameters('EnableWindowsNTPClient')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Turn on convenience PIN sign-in;ExpectedValue\",\r\n                                \"value\": \"[parameters('TurnOnConveniencePINSignin')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Always use classic logon;ExpectedValue\",\r\n                                \"value\": \"[parameters('AlwaysUseClassicLogon')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Boot-Start Driver Initialization Policy;ExpectedValue\",\r\n                                \"value\": \"[parameters('BootStartDriverInitializationPolicy')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Enable Windows NTP Client;ExpectedValue\",\r\n                                \"value\": \"[parameters('EnableWindowsNTPClient')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Turn on convenience PIN sign-in;ExpectedValue\",\r\n                                \"value\": \"[parameters('TurnOnConveniencePINSignin')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/40917425-69db-4018-8dae-2a0556cef899\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"40917425-69db-4018-8dae-2a0556cef899\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Machine Learning workspaces should use private link\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to Azure Machine Learning workspaces, data leakage risks are reduced. Learn more about private links at: https://docs.microsoft.com/azure/machine-learning/how-to-configure-private-link.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.0\",\r\n          \"category\": \"Machine Learning\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.MachineLearningServices/workspaces\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.MachineLearningServices/workspaces/privateEndpointConnections[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.MachineLearningServices/workspaces/privateEndpointConnections[*].privateLinkServiceConnectionState.status\",\r\n                    \"equals\": \"Approved\"\r\n                  }\r\n                },\r\n                \"less\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/40cec1dd-a100-4920-b15b-3024fe8901ab\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"40cec1dd-a100-4920-b15b-3024fe8901ab\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Inherit a tag from the subscription if missing\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Adds the specified tag with its value from the containing subscription when any resource missing this tag is created or updated. Existing resources can be remediated by triggering a remediation task. If the tag exists with a different value it will not be changed.\",\r\n        \"metadata\": {\r\n          \"category\": \"Tags\",\r\n          \"version\": \"1.0.0\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                \"exists\": \"false\"\r\n              },\r\n              {\r\n                \"value\": \"[subscription().tags[parameters('tagName')]]\",\r\n                \"notEquals\": \"\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"modify\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"operations\": [\r\n                {\r\n                  \"operation\": \"add\",\r\n                  \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                  \"value\": \"[subscription().tags[parameters('tagName')]]\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/40df99da-1232-49b1-a39a-6da8d878f469\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"40df99da-1232-49b1-a39a-6da8d878f469\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Monitor should collect activity logs from all regions\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy audits the Azure Monitor log profile which does not export activities from all Azure supported regions including global.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/logProfiles\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"australiacentral\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"australiacentral2\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"australiaeast\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"australiasoutheast\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"brazilsouth\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"brazilsoutheast\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"canadacentral\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"canadaeast\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"centralindia\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"centralus\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"eastasia\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"eastus\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"eastus2\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"francecentral\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"francesouth\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"germanynorth\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"germanywestcentral\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"japaneast\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"japanwest\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"jioindiawest\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"koreacentral\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"koreasouth\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"northcentralus\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"northeurope\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"norwayeast\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"norwaywest\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"southafricanorth\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"southafricawest\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"southcentralus\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"southeastasia\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"southindia\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"switzerlandnorth\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"switzerlandwest\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"uaecentral\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"uaenorth\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"uksouth\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"ukwest\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"westcentralus\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"westeurope\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"westindia\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"westus\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"westus2\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"westus3\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Insights/logProfiles/locations[*]\",\r\n                      \"notEquals\": \"global\"\r\n                    }\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/41388f1c-2db0-4c25-95b2-35d7f5ccbfa9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"41388f1c-2db0-4c25-95b2-35d7f5ccbfa9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Temp disks and cache for agent node pools in Azure Kubernetes Service clusters should be encrypted at host\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"To enhance data security, the data stored on the virtual machine (VM) host of your Azure Kubernetes Service nodes VMs should be encrypted at rest. This is a common requirement in many regulatory and industry compliance standards.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Kubernetes\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"'Audit' allows a non-compliant resource to be created or updated, but flags it as non-compliant. 'Deny' blocks the non-compliant resource creation or update. 'Disabled' turns off the policy.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ContainerService/managedClusters\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.ContainerService/managedClusters/agentPoolProfiles[*]\",\r\n                  \"where\": {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.ContainerService/managedClusters/agentPoolProfiles[*].enableEncryptionAtHost\",\r\n                        \"exists\": \"False\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.ContainerService/managedClusters/agentPoolProfiles[*].enableEncryptionAtHost\",\r\n                        \"equals\": \"\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.ContainerService/managedClusters/agentPoolProfiles[*].enableEncryptionAtHost\",\r\n                        \"equals\": \"false\"\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                \"greater\": 0\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/41425d9f-d1a5-499a-9932-f8ed8453932c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"41425d9f-d1a5-499a-9932-f8ed8453932c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit Windows VMs with a pending reboot\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if the machine is pending reboot for any of the following reasons: component based servicing, Windows Update, pending file rename, pending computer rename, configuration manager pending reboot. Each detection has a unique registry path.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"WindowsPendingReboot\",\r\n            \"version\": \"1.*\"\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsPendingReboot\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4221adbc-5c0f-474f-88b7-037a99e6114c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4221adbc-5c0f-474f-88b7-037a99e6114c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Web Application Firewall (WAF) should use the specified mode for Azure Front Door Service\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Mandates the use of 'Detection' or 'Prevention' mode to be active on all Web Application Firewall policies for Azure Front Door Service.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          },\r\n          \"modeRequirement\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Mode Requirement\",\r\n              \"description\": \"Mode required for all WAF policies\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Prevention\",\r\n              \"Detection\"\r\n            ],\r\n            \"defaultValue\": \"Detection\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/frontdoorwebapplicationfirewallpolicies\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Network/frontdoorWebApplicationFirewallPolicies/policySettings.mode\",\r\n                \"notEquals\": \"[parameters('modeRequirement')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/425bea59-a659-4cbb-8d31-34499bd030b8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"425bea59-a659-4cbb-8d31-34499bd030b8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Resource logs in Batch accounts should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised\",\r\n        \"metadata\": {\r\n          \"version\": \"4.0.1\",\r\n          \"category\": \"Batch\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"requiredRetentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Required retention (days)\",\r\n              \"description\": \"The required resource logs retention in days\"\r\n            },\r\n            \"defaultValue\": \"365\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Batch/batchAccounts\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*]\",\r\n                  \"where\": {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                            \"equals\": \"true\"\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                                \"equals\": \"0\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                                \"greaterOrEquals\": \"[parameters('requiredRetentionDays')]\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                            \"equals\": \"true\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                            \"equals\": \"true\"\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                                \"notEquals\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/storageAccountId\",\r\n                                \"exists\": false\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                \"greaterOrEquals\": 1\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/428256e6-1fac-4f48-a757-df34c2b3336d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"428256e6-1fac-4f48-a757-df34c2b3336d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs configurations in 'System Audit Policies - Detailed Tracking'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Detailed Tracking'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"AuditProcessTermination\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit Process Termination\",\r\n              \"description\": \"Specifies whether audit events are generated when a process has exited. Recommended for monitoring termination of critical processes.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"No Auditing\",\r\n              \"Success\",\r\n              \"Failure\",\r\n              \"Success and Failure\"\r\n            ],\r\n            \"defaultValue\": \"No Auditing\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SystemAuditPoliciesDetailedTracking\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('Audit Process Termination;ExpectedValue', '=', parameters('AuditProcessTermination')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AzureBaseline_SystemAuditPoliciesDetailedTracking\"\r\n                    },\r\n                    \"AuditProcessTermination\": {\r\n                      \"value\": \"[parameters('AuditProcessTermination')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AuditProcessTermination\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Audit Process Termination;ExpectedValue\",\r\n                                \"value\": \"[parameters('AuditProcessTermination')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Audit Process Termination;ExpectedValue\",\r\n                                \"value\": \"[parameters('AuditProcessTermination')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/42a07bbf-ffcf-459a-b4b1-30ecd118a505\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"42a07bbf-ffcf-459a-b4b1-30ecd118a505\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs configurations in 'Security Options - System settings'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - System settings'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"SystemSettingsUseCertificateRulesOnWindowsExecutablesForSoftwareRestrictionPolicies\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"System settings: Use Certificate Rules on Windows Executables for Software Restriction Policies\",\r\n              \"description\": \"Specifies whether digital certificates are processed when software restriction policies are enabled and a user or process attempts to run software with an .exe file name extension. It enables or disables certificate rules (a type of software restriction policies rule). For certificate rules to take effect in software restriction policies, you must enable this policy setting.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsSystemsettings\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('System settings: Use Certificate Rules on Windows Executables for Software Restriction Policies;ExpectedValue', '=', parameters('SystemSettingsUseCertificateRulesOnWindowsExecutablesForSoftwareRestrictionPolicies')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AzureBaseline_SecurityOptionsSystemsettings\"\r\n                    },\r\n                    \"SystemSettingsUseCertificateRulesOnWindowsExecutablesForSoftwareRestrictionPolicies\": {\r\n                      \"value\": \"[parameters('SystemSettingsUseCertificateRulesOnWindowsExecutablesForSoftwareRestrictionPolicies')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"SystemSettingsUseCertificateRulesOnWindowsExecutablesForSoftwareRestrictionPolicies\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"System settings: Use Certificate Rules on Windows Executables for Software Restriction Policies;ExpectedValue\",\r\n                                \"value\": \"[parameters('SystemSettingsUseCertificateRulesOnWindowsExecutablesForSoftwareRestrictionPolicies')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"System settings: Use Certificate Rules on Windows Executables for Software Restriction Policies;ExpectedValue\",\r\n                                \"value\": \"[parameters('SystemSettingsUseCertificateRulesOnWindowsExecutablesForSoftwareRestrictionPolicies')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/437a1f8f-8552-47a8-8b12-a2fee3269dd5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"437a1f8f-8552-47a8-8b12-a2fee3269dd5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'System Audit Policies - Account Logon'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'System Audit Policies - Account Logon' for auditing credential validation and other account logon events. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_SystemAuditPoliciesAccountLogon\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"AuditCredentialValidation\": \"Audit Credential Validation;ExpectedValue\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"AuditCredentialValidation\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit Credential Validation\",\r\n              \"description\": \"Specifies whether audit events are generated when credentials are submitted for a user account logon request.  This setting is especially useful for monitoring unsuccessful attempts, to find brute-force attacks, account enumeration, and potential account compromise events on domain controllers.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"No Auditing\",\r\n              \"Success\",\r\n              \"Failure\",\r\n              \"Success and Failure\"\r\n            ],\r\n            \"defaultValue\": \"Success and Failure\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SystemAuditPoliciesAccountLogon\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('Audit Credential Validation;ExpectedValue', '=', parameters('AuditCredentialValidation')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/43bb60fe-1d7e-4b82-9e93-496bfc99e7d5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"43bb60fe-1d7e-4b82-9e93-496bfc99e7d5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Monitor permissive network access in Azure Security Center\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Network Security Groups with too permissive rules will be monitored by Azure Security Center as recommendations\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.ClassicCompute/virtualMachines\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"permissiveNetworkAccess\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"in\": [\r\n                  \"OffByPolicy\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/44452482-524f-4bf4-b852-0bff7cc4a3ed\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"44452482-524f-4bf4-b852-0bff7cc4a3ed\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure SignalR Service should use a Private Link enabled SKU\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination which protect your resources against public data leakage risks. The policy limits you to Private Link enabled SKUs for Azure SignalR Service. Learn more about private link at: https://aka.ms/asrs/privatelink.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"SignalR\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.SignalRService/SignalR\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.SignalRService/SignalR/sku.tier\",\r\n                \"equals\": \"Free\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/464a1620-21b5-448d-8ce6-d4ac6d1bc49a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"464a1620-21b5-448d-8ce6-d4ac6d1bc49a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Require SQL Server version 12.0\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy ensures all SQL servers use version 12.0. This policy is deprecated because it is no longer possible to create an Azure SQL server with any version other than 12.0.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"SQL\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Sql/servers/version\",\r\n                  \"equals\": \"12.0\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/464dbb85-3d5f-4a1d-bb09-95a9b5dd19cf\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"464dbb85-3d5f-4a1d-bb09-95a9b5dd19cf\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Audit Web Applications that are not using latest supported Python Framework\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use the latest supported Python version for the latest security classes. Using older classes and types can make your application vulnerable.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyof\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"WebApp\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UseLatestPython\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"in\": [\r\n                  \"OffByPolicy\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/46544d7b-1f0d-46f5-81da-5c1351de1b06\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"46544d7b-1f0d-46f5-81da-5c1351de1b06\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Require automatic OS image patching on Virtual Machine Scale Sets\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy enforces enabling automatic OS image patching on Virtual Machine Scale Sets to always keep Virtual Machines secure by safely applying latest security patches every month.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/VirtualMachineScaleSets/upgradePolicy.automaticOSUpgradePolicy.enableAutomaticOSUpgrade\",\r\n                \"notEquals\": \"True\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/VirtualMachineScaleSets/upgradePolicy.automaticOSUpgrade\",\r\n                \"notEquals\": \"True\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/465f0161-0087-490a-9ad9-ad6217f4f43a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"465f0161-0087-490a-9ad9-ad6217f4f43a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Cognitive Services accounts should use customer owned storage\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use customer owned storage to control the data stored at rest in Cognitive Services. To learn more about customer owned storage, visit https://aka.ms/cogsvc-cmk.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Cognitive Services\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.CognitiveServices/accounts\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.CognitiveServices/accounts/userOwnedStorage[*]\"\r\n                },\r\n                \"less\": 1\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.CognitiveServices/accounts/capabilities[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.CognitiveServices/accounts/capabilities[*].name\",\r\n                    \"equals\": \"CustomerManagedStorage\"\r\n                  }\r\n                },\r\n                \"greater\": 0\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/46aa9b05-0e60-4eae-a88b-1e9d374fa515\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"46aa9b05-0e60-4eae-a88b-1e9d374fa515\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: IoT Hub device provisioning service data should be encrypted using customer-managed keys (CMK)\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use customer-managed keys to manage the encryption at rest of your IoT Hub device provisioning service. The data is automatically encrypted at rest with service-managed keys, but customer-managed keys (CMK) are commonly required to meet regulatory compliance standards. CMKs enable the data to be encrypted with an Azure Key Vault key created and owned by you. Learn more about CMK encryption at https://aka.ms/dps/CMK.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-preview\",\r\n          \"category\": \"Internet of Things\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Devices/provisioningServices\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Devices/provisioningServices/encryption.keyVaultProperties[*]\",\r\n                  \"where\": {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Devices/provisioningServices/encryption.keyVaultProperties[*].keyIdentifier\",\r\n                        \"exists\": \"true\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Devices/provisioningServices/encryption.keyVaultProperties[*].keyIdentifier\",\r\n                        \"notequals\": \"\"\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                \"less\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/47031206-ce96-41f8-861b-6a915f3de284\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"47031206-ce96-41f8-861b-6a915f3de284\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Cache for Redis should disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disabling public network access improves security by ensuring that the Azure Cache for Redis isn't exposed on the public internet. You can limit exposure of your Azure Cache for Redis by creating private endpoints instead. Learn more at: https://docs.microsoft.com/azure/azure-cache-for-redis/cache-private-link.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Cache\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Cache/Redis\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Cache/Redis/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/470baccb-7e51-4549-8b1a-3e5be069f663\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"470baccb-7e51-4549-8b1a-3e5be069f663\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Storage accounts should have infrastructure encryption\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enable infrastructure encryption for higher level of assurance that the data is secure. When infrastructure encryption is enabled, data in a storage account is encrypted twice.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the audit policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Storage/storageAccounts/encryption.requireInfrastructureEncryption\",\r\n                \"notEquals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4733ea7b-a883-42fe-8cac-97454c2a9e4a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4733ea7b-a883-42fe-8cac-97454c2a9e4a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Cosmos DB key based metadata write access should be disabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy enables you to ensure all Azure Cosmos DB accounts disable key based metadata write access.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Cosmos DB\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DocumentDB/databaseAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DocumentDB/databaseAccounts/disableKeyBasedMetadataWriteAccess\",\r\n                \"notEquals\": true\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"Microsoft.DocumentDB/databaseAccounts/disableKeyBasedMetadataWriteAccess\",\r\n                \"value\": true\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4750c32b-89c0-46af-bfcb-2e4541a818d5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4750c32b-89c0-46af-bfcb-2e4541a818d5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Auto provisioning of the Log Analytics agent should be enabled on your subscription\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"To monitor for security vulnerabilities and threats, Azure Security Center collects data from your Azure virtual machines. Data is collected by the Log Analytics agent, formerly known as the Microsoft Monitoring Agent (MMA), which reads various security-related configurations and event logs from the machine and copies the data to your Log Analytics workspace for analysis. We recommend enabling auto provisioning to automatically deploy the agent to all supported Azure VMs and any new ones that are created.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/autoProvisioningSettings\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/autoProvisioningSettings/autoProvision\",\r\n                \"equals\": \"On\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/475aae12-b88a-4572-8b36-9b712b2b3a17\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"475aae12-b88a-4572-8b36-9b712b2b3a17\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Adaptive application controls for defining safe applications should be enabled on your machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Enable application controls to define the list of known-safe applications running on your machines, and alert you when other applications run. This helps harden your machines against malware. To simplify the process of configuring and maintaining your rules, Security Center uses machine learning to analyze the applications running on each machine and suggest the list of known-safe applications.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.ClassicCompute/virtualMachines\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"35f45c95-27cf-4e52-891f-8390d1de5828\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/47a6b606-51aa-4496-8bb7-64b11cf66adc\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"47a6b606-51aa-4496-8bb7-64b11cf66adc\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Cognitive Services accounts to disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disable public network access for your Cognitive Services resource so that it's not accessible over the public internet. This can reduce data leakage risks. Learn more at: https://go.microsoft.com/fwlink/?linkid=2129800.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Cognitive Services\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Disabled\",\r\n              \"Modify\"\r\n            ],\r\n            \"defaultValue\": \"Modify\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.CognitiveServices/accounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.CognitiveServices/accounts/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"conflictEffect\": \"audit\",\r\n              \"operations\": [\r\n                {\r\n                  \"condition\": \"[greaterOrEquals(requestContext().apiVersion, '2017-04-18')]\",\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.CognitiveServices/accounts/publicNetworkAccess\",\r\n                  \"value\": \"Disabled\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/47ba1dd7-28d9-4b07-a8d5-9813bed64e0c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"47ba1dd7-28d9-4b07-a8d5-9813bed64e0c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Private endpoints for Guest Configuration assignments should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Private endpoint connections enforce secure communication by enabling private connectivity to Guest Configuration for virtual machines. Virtual machines will be non-compliant unless they have the tag, 'EnablePrivateNetworkGC'. This tag enforces secure communication through private connectivity to Guest Configuration for Virtual Machines. Private connectivity limits access to traffic coming only from known networks and prevents access from all other IP addresses, including within Azure.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Guest Configuration\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\"\r\n              },\r\n              {\r\n                \"field\": \"id\",\r\n                \"contains\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"anyof\": [\r\n                    {\r\n                      \"field\": \"[concat('tags[', 'EnablePrivateNeworkGC', ']')]\",\r\n                      \"equals\": \"TRUE\"\r\n                    },\r\n                    {\r\n                      \"field\": \"[concat('tags[', 'EnablePrivateNetworkGC', ']')]\",\r\n                      \"equals\": \"TRUE\"\r\n                    }\r\n                  ]\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/480d0f91-30af-4a76-9afb-f5710ac52b09\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"480d0f91-30af-4a76-9afb-f5710ac52b09\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Audit IP restrictions configuration for an API App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"IP Restrictions allow you to define a list of IP addresses that are allowed to access your app. Use of IP Restrictions protects an API app from common attacks.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyof\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"api\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"apiApp\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"ConfigureIPRestrictions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"in\": [\r\n                  \"OffByPolicy\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/48893b84-a2c8-4d9a-badf-835d5d1b7d53\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"48893b84-a2c8-4d9a-badf-835d5d1b7d53\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Geo-redundant backup should be enabled for Azure Database for PostgreSQL\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Database for PostgreSQL allows you to choose the redundancy option for your database server. It can be set to a geo-redundant backup storage in which the data is not only stored within the region in which your server is hosted, but is also replicated to a paired region to provide recovery option in case of a region failure. Configuring geo-redundant storage for backup is only allowed during server create.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DBforPostgreSQL/servers\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DBforPostgreSQL/servers/storageProfile.geoRedundantBackup\",\r\n                \"notEquals\": \"Enabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/48af4db5-9b8b-401c-8e74-076be876a430\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"48af4db5-9b8b-401c-8e74-076be876a430\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'Security Options - User Account Control'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'Security Options - User Account Control' for mode for admins, behavior of elevation prompt, and virtualizing file and registry write failures. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_SecurityOptionsUserAccountControl\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"UACAdminApprovalModeForTheBuiltinAdministratorAccount\": \"User Account Control: Admin Approval Mode for the Built-in Administrator account;ExpectedValue\",\r\n              \"UACBehaviorOfTheElevationPromptForAdministratorsInAdminApprovalMode\": \"User Account Control: Behavior of the elevation prompt for administrators in Admin Approval Mode;ExpectedValue\",\r\n              \"UACDetectApplicationInstallationsAndPromptForElevation\": \"User Account Control: Detect application installations and prompt for elevation;ExpectedValue\",\r\n              \"UACRunAllAdministratorsInAdminApprovalMode\": \"User Account Control: Run all administrators in Admin Approval Mode;ExpectedValue\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"UACAdminApprovalModeForTheBuiltinAdministratorAccount\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"UAC: Admin Approval Mode for the Built-in Administrator account\",\r\n              \"description\": \"Specifies the behavior of Admin Approval Mode for the built-in Administrator account.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"UACBehaviorOfTheElevationPromptForAdministratorsInAdminApprovalMode\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"UAC: Behavior of the elevation prompt for administrators in Admin Approval Mode\",\r\n              \"description\": \"Specifies the behavior of the elevation prompt for administrators.\"\r\n            },\r\n            \"defaultValue\": \"2\"\r\n          },\r\n          \"UACDetectApplicationInstallationsAndPromptForElevation\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"UAC: Detect application installations and prompt for elevation\",\r\n              \"description\": \"Specifies the behavior of application installation detection for the computer.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"UACRunAllAdministratorsInAdminApprovalMode\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"UAC: Run all administrators in Admin Approval Mode\",\r\n              \"description\": \"Specifies the behavior of all User Account Control (UAC) policy settings for the computer.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsUserAccountControl\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('User Account Control: Admin Approval Mode for the Built-in Administrator account;ExpectedValue', '=', parameters('UACAdminApprovalModeForTheBuiltinAdministratorAccount'), ',', 'User Account Control: Behavior of the elevation prompt for administrators in Admin Approval Mode;ExpectedValue', '=', parameters('UACBehaviorOfTheElevationPromptForAdministratorsInAdminApprovalMode'), ',', 'User Account Control: Detect application installations and prompt for elevation;ExpectedValue', '=', parameters('UACDetectApplicationInstallationsAndPromptForElevation'), ',', 'User Account Control: Run all administrators in Admin Approval Mode;ExpectedValue', '=', parameters('UACRunAllAdministratorsInAdminApprovalMode')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/492a29ed-d143-4f03-b6a4-705ce081b463\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"492a29ed-d143-4f03-b6a4-705ce081b463\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Ensure that 'Java version' is the latest, if used as a part of the Web app\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Periodically, newer versions are released for Java software either due to security flaws or to include additional functionality. Using the latest Java version for web apps is recommended in order to take advantage of security fixes, if any, and/or new functionalities of the latest version. Currently, this policy only applies to Linux web apps.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"JavaLatestVersion\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Latest Java version\",\r\n              \"description\": \"Latest supported Java version for App Services\"\r\n            },\r\n            \"defaultValue\": \"11\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"app*\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"contains\": \"linux\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/web.linuxFxVersion\",\r\n                    \"notContains\": \"JAVA\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/web.linuxFxVersion\",\r\n                    \"like\": \"[concat('*', parameters('JavaLatestVersion'))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/496223c3-ad65-4ecd-878a-bae78737e9ed\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"496223c3-ad65-4ecd-878a-bae78737e9ed\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure private endpoints for Data factories\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoints connect your virtual network to Azure services without a public IP address at the source or destination.  By mapping private endpoints to your Azure Data Factory, you can reduce data leakage risks.  Learn more at: https://docs.microsoft.com/azure/data-factory/data-factory-private-link.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Data Factory\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateEndpointSubnetId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private endpoint subnet ID\",\r\n              \"description\": \"A subnet with private endpoint network policies disabled.\",\r\n              \"strongType\": \"Microsoft.Network/virtualNetworks/subnets\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          },\r\n          \"groupId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"description\": \"The group Id that can be specified for Private Endpoints.\",\r\n              \"displayName\": \"Allowed group Id\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"dataFactory\",\r\n              \"portal\"\r\n            ],\r\n            \"defaultValue\": \"dataFactory\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.DataFactory/factories\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.DataFactory/factories/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.DataFactory/factories/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/673868aa-7521-48a0-acc6-0f60742d39f5\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"name\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"serviceId\": {\r\n                      \"value\": \"[field('id')]\"\r\n                    },\r\n                    \"privateEndpointSubnetId\": {\r\n                      \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                    },\r\n                    \"groupId\": {\r\n                      \"value\": \"[parameters('groupId')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"name\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"serviceId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointSubnetId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"groupId\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"privateEndpointName\": \"[concat('pe-',substring(parameters('name'),0,min(length(parameters('name')),50)),'-',uniquestring(deployment().name))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('privateEndpointName')]\",\r\n                        \"apiVersion\": \"2020-06-01\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"expressionEvaluationOptions\": {\r\n                            \"scope\": \"inner\"\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"serviceId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"privateEndpointSubnetId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"subnetLocation\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"groupId\": {\r\n                                \"type\": \"string\"\r\n                              }\r\n                            },\r\n                            \"variables\": {\r\n                              \"privateEndpointName\": \"[deployment().name]\"\r\n                            },\r\n                            \"resources\": [\r\n                              {\r\n                                \"name\": \"[variables('privateEndpointName')]\",\r\n                                \"type\": \"Microsoft.Network/privateEndpoints\",\r\n                                \"apiVersion\": \"2020-07-01\",\r\n                                \"location\": \"[parameters('subnetLocation')]\",\r\n                                \"tags\": {},\r\n                                \"properties\": {\r\n                                  \"subnet\": {\r\n                                    \"id\": \"[parameters('privateEndpointSubnetId')]\"\r\n                                  },\r\n                                  \"privateLinkServiceConnections\": [\r\n                                    {\r\n                                      \"name\": \"[variables('privateEndpointName')]\",\r\n                                      \"properties\": {\r\n                                        \"privateLinkServiceId\": \"[parameters('serviceId')]\",\r\n                                        \"groupId\": [\r\n                                          \"[parameters('groupId')]\"\r\n                                        ],\r\n                                        \"requestMessage\": \"autoapprove\"\r\n                                      }\r\n                                    }\r\n                                  ],\r\n                                  \"manualPrivateLinkServiceConnections\": []\r\n                                }\r\n                              }\r\n                            ]\r\n                          },\r\n                          \"parameters\": {\r\n                            \"serviceId\": {\r\n                              \"value\": \"[parameters('serviceId')]\"\r\n                            },\r\n                            \"privateEndpointSubnetId\": {\r\n                              \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                            },\r\n                            \"subnetLocation\": {\r\n                              \"value\": \"[reference(first(take(split(parameters('privateEndpointSubnetId'),'/subnets'),1)),'2020-07-01','Full').location]\"\r\n                            },\r\n                            \"groupId\": {\r\n                              \"value\": \"[parameters('groupId')]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/496ca26b-f669-4322-a1ad-06b7b5e41882\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"496ca26b-f669-4322-a1ad-06b7b5e41882\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Add system-assigned managed identity to enable Guest Configuration assignments on VMs with a user-assigned identity\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy adds a system-assigned managed identity to virtual machines hosted in Azure that are supported by Guest Configuration and have at least one user-assigned identity but do not have a system-assigned managed identity. A system-assigned managed identity is a prerequisite for all Guest Configuration assignments and must be added to machines before using any Guest Configuration policy definitions. For more information on Guest Configuration, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.0\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"microsoft-aks\",\r\n                          \"qubole-inc\",\r\n                          \"datastax\",\r\n                          \"couchbase\",\r\n                          \"scalegrid\",\r\n                          \"checkpoint\",\r\n                          \"paloaltonetworks\",\r\n                          \"debian\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"OpenLogic\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"CentOS*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Oracle\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Oracle-Linux\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"RHEL\",\r\n                              \"RHEL-HA\",\r\n                              \"RHEL-SAP\",\r\n                              \"RHEL-SAP-APPS\",\r\n                              \"RHEL-SAP-HA\",\r\n                              \"RHEL-SAP-HANA\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"osa\",\r\n                              \"rhel-byos\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"cis-centos-7-l1\",\r\n                              \"cis-centos-7-v2-1-1-l1\",\r\n                              \"cis-centos-8-l1\",\r\n                              \"cis-debian-linux-8-l1\",\r\n                              \"cis-debian-linux-9-l1\",\r\n                              \"cis-nginx-centos-7-v1-1-0-l1\",\r\n                              \"cis-oracle-linux-7-v2-0-0-l1\",\r\n                              \"cis-oracle-linux-8-l1\",\r\n                              \"cis-postgresql-11-centos-linux-7-level-1\",\r\n                              \"cis-rhel-7-l2\",\r\n                              \"cis-rhel-7-v2-2-0-l1\",\r\n                              \"cis-rhel-8-l1\",\r\n                              \"cis-suse-linux-12-v2-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1604-v1-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1804-l1\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"credativ\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Debian\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"7*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Suse\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"SLES*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"11*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Canonical\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"UbuntuServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"12*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"linux-data-science-vm-ubuntu\",\r\n                              \"azureml\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-centos-os\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-altus-centos-os\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"linux*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.linuxConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Linux*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"notIn\": [\r\n                                  \"OpenLogic\",\r\n                                  \"RedHat\",\r\n                                  \"credativ\",\r\n                                  \"Suse\",\r\n                                  \"Canonical\",\r\n                                  \"microsoft-dsvm\",\r\n                                  \"cloudera\",\r\n                                  \"microsoft-ads\",\r\n                                  \"center-for-internet-security-inc\",\r\n                                  \"Oracle\"\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"value\": \"[requestContext().apiVersion]\",\r\n                \"greaterOrEquals\": \"2018-10-01\"\r\n              },\r\n              {\r\n                \"field\": \"identity.type\",\r\n                \"contains\": \"UserAssigned\"\r\n              },\r\n              {\r\n                \"field\": \"identity.type\",\r\n                \"notContains\": \"SystemAssigned\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"modify\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"operations\": [\r\n                {\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"identity.type\",\r\n                  \"value\": \"[concat(field('identity.type'), ',SystemAssigned')]\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/497dff13-db2a-4c0f-8603-28fa3b331ab6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"497dff13-db2a-4c0f-8603-28fa3b331ab6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs configurations in 'Security Options - Audit'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Audit'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"AuditShutDownSystemImmediatelyIfUnableToLogSecurityAudits\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit: Shut down system immediately if unable to log security audits\",\r\n              \"description\": \"Audits if the system will shut down when unable to log Security events.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsAudit\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('Audit: Shut down system immediately if unable to log security audits;ExpectedValue', '=', parameters('AuditShutDownSystemImmediatelyIfUnableToLogSecurityAudits')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AzureBaseline_SecurityOptionsAudit\"\r\n                    },\r\n                    \"AuditShutDownSystemImmediatelyIfUnableToLogSecurityAudits\": {\r\n                      \"value\": \"[parameters('AuditShutDownSystemImmediatelyIfUnableToLogSecurityAudits')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AuditShutDownSystemImmediatelyIfUnableToLogSecurityAudits\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Audit: Shut down system immediately if unable to log security audits;ExpectedValue\",\r\n                                \"value\": \"[parameters('AuditShutDownSystemImmediatelyIfUnableToLogSecurityAudits')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Audit: Shut down system immediately if unable to log security audits;ExpectedValue\",\r\n                                \"value\": \"[parameters('AuditShutDownSystemImmediatelyIfUnableToLogSecurityAudits')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/498b810c-59cd-4222-9338-352ba146ccf3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"498b810c-59cd-4222-9338-352ba146ccf3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Append a tag and its value to resource groups\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Appends the specified tag and value when any resource group which is missing this tag is created or updated. Does not modify the tags of resource groups created before this policy was applied until those resource groups are changed. New 'modify' effect policies are available that support remediation of tags on existing resources (see https://aka.ms/modifydoc).\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Tags\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            }\r\n          },\r\n          \"tagValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Value\",\r\n              \"description\": \"Value of the tag, such as 'production'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Resources/subscriptions/resourceGroups\"\r\n              },\r\n              {\r\n                \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                \"exists\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                \"value\": \"[parameters('tagValue')]\"\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/49c88fc8-6fd1-46fd-a676-f12d1d3a4c71\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"49c88fc8-6fd1-46fd-a676-f12d1d3a4c71\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Event Grid topics should use private link\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your Event Grid topic instead of the entire service, you'll also be protected against data leakage risks. Learn more at: https://aka.ms/privateendpoints.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.2\",\r\n          \"category\": \"Event Grid\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.EventGrid/topics\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"notEquals\": \"AzureArc\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.EventGrid/topics/privateEndpointConnections[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.EventGrid/topics/privateEndpointConnections[*].privateLinkServiceConnectionState.status\",\r\n                    \"equals\": \"Approved\"\r\n                  }\r\n                },\r\n                \"less\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4b90e17e-8448-49db-875e-bd83fb6f804f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4b90e17e-8448-49db-875e-bd83fb6f804f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit Windows machines that do not have a maximum password age of 70 days\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if Windows machines that do not have a maximum password age of 70 days\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"MaximumPasswordAge\",\r\n            \"version\": \"1.*\"\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"MaximumPasswordAge\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4ceb8dc2-559c-478b-a15b-733fbf1e3738\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4ceb8dc2-559c-478b-a15b-733fbf1e3738\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Function apps should use an Azure file share for its content directory\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"The content directory of a function app should be located on an Azure file share. The storage account information for the file share must be provided before any publishing activity. To learn more about using Azure Files for hosting app service content refer to https://go.microsoft.com/fwlink/?linkid=2151594.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"functionapp*\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Web/sites/storageAccountRequired\",\r\n                \"equals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4d0bc837-6eff-477e-9ecd-33bf8d4212a5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4d0bc837-6eff-477e-9ecd-33bf8d4212a5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Linux VMs that do not have the specified applications installed\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Linux virtual machines that do not have the specified applications installed. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"ApplicationName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Application names\",\r\n              \"description\": \"A semicolon-separated list of the names of the applications that should be installed. e.g. 'python; powershell'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"microsoft-aks\",\r\n                          \"qubole-inc\",\r\n                          \"datastax\",\r\n                          \"couchbase\",\r\n                          \"scalegrid\",\r\n                          \"checkpoint\",\r\n                          \"paloaltonetworks\",\r\n                          \"debian\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"OpenLogic\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"CentOS*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Oracle\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Oracle-Linux\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"RHEL\",\r\n                              \"RHEL-HA\",\r\n                              \"RHEL-SAP\",\r\n                              \"RHEL-SAP-APPS\",\r\n                              \"RHEL-SAP-HA\",\r\n                              \"RHEL-SAP-HANA\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"osa\",\r\n                              \"rhel-byos\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"cis-centos-7-l1\",\r\n                              \"cis-centos-7-v2-1-1-l1\",\r\n                              \"cis-centos-8-l1\",\r\n                              \"cis-debian-linux-8-l1\",\r\n                              \"cis-debian-linux-9-l1\",\r\n                              \"cis-nginx-centos-7-v1-1-0-l1\",\r\n                              \"cis-oracle-linux-7-v2-0-0-l1\",\r\n                              \"cis-oracle-linux-8-l1\",\r\n                              \"cis-postgresql-11-centos-linux-7-level-1\",\r\n                              \"cis-rhel-7-l2\",\r\n                              \"cis-rhel-7-v2-2-0-l1\",\r\n                              \"cis-rhel-8-l1\",\r\n                              \"cis-suse-linux-12-v2-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1604-v1-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1804-l1\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"credativ\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Debian\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"7*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Suse\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"SLES*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"11*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Canonical\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"UbuntuServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"12*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"linux-data-science-vm-ubuntu\",\r\n                              \"azureml\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-centos-os\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-altus-centos-os\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"linux*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.linuxConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Linux*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"notIn\": [\r\n                                  \"OpenLogic\",\r\n                                  \"RedHat\",\r\n                                  \"credativ\",\r\n                                  \"Suse\",\r\n                                  \"Canonical\",\r\n                                  \"microsoft-dsvm\",\r\n                                  \"cloudera\",\r\n                                  \"microsoft-ads\",\r\n                                  \"center-for-internet-security-inc\",\r\n                                  \"Oracle\"\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"linux*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"installed_application_linux\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('[ChefInSpec]InstalledApplicationLinuxResource1;AttributesYmlContent', '=', concat('packages: [', replace(parameters('ApplicationName'), ';', ','), ']')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"installed_application_linux\"\r\n                    },\r\n                    \"ApplicationName\": {\r\n                      \"value\": \"[parameters('ApplicationName')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ApplicationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[ChefInSpec]InstalledApplicationLinuxResource1;AttributesYmlContent\",\r\n                                \"value\": \"[concat('packages: [', replace(parameters('ApplicationName'), ';', ','), ']')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[ChefInSpec]InstalledApplicationLinuxResource1;AttributesYmlContent\",\r\n                                \"value\": \"[concat('packages: [', replace(parameters('ApplicationName'), ';', ','), ']')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforLinux')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforLinux\",\r\n                          \"typeHandlerVersion\": \"1.0\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4d1c04de-2172-403f-901b-90608c35c721\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4d1c04de-2172-403f-901b-90608c35c721\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"FTPS should be required in your Web App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enable FTPS enforcement for enhanced security\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"app*\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/config/ftpsState\",\r\n                \"in\": [\r\n                  \"FtpsOnly\",\r\n                  \"Disabled\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4d24b6d4-5e53-4a4f-a7f4-618fa573ee4b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4d24b6d4-5e53-4a4f-a7f4-618fa573ee4b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Dependency agent for Linux virtual machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Dependency agent for Linux virtual machines if the VM Image (OS) is in the list defined and the agent is not installed.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.3.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfImageIdToInclude\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Linux OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageId\",\r\n                    \"in\": \"[parameters('listOfImageIdToInclude')]\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"14.04.0-LTS\",\r\n                              \"14.04.1-LTS\",\r\n                              \"14.04.5-LTS\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"16.04-LTS\",\r\n                              \"16.04.0-LTS\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"18.04-LTS\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-SAP-HANA\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"SLES\",\r\n                          \"SLES-HPC\",\r\n                          \"SLES-HPC-Priority\",\r\n                          \"SLES-SAP\",\r\n                          \"SLES-SAP-BYOS\",\r\n                          \"SLES-Priority\",\r\n                          \"SLES-BYOS\",\r\n                          \"SLES-SAPCAL\",\r\n                          \"SLES-Standard\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"12-SP2\",\r\n                              \"12-SP3\",\r\n                              \"12-SP4\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"CentOS\",\r\n                          \"Centos-LVM\",\r\n                          \"CentOS-SRIOV\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-centos-os\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"like\": \"7*\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"DependencyAgentLinux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Monitoring.DependencyAgent\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"DependencyAgentLinux\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.Azure.Monitoring.DependencyAgent\",\r\n                      \"vmExtensionType\": \"DependencyAgentLinux\",\r\n                      \"vmExtensionTypeHandlerVersion\": \"9.6\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"typeHandlerVersion\": \"[variables('vmExtensionTypeHandlerVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for VM', ': ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4da21710-ce6f-4e06-8cdb-5cc4c93ffbee\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4da21710-ce6f-4e06-8cdb-5cc4c93ffbee\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Defender for servers should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Azure Defender for servers provides real-time threat protection for server workloads and generates hardening recommendations as well as alerts about suspicious activities.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.3\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/pricings\",\r\n              \"name\": \"VirtualMachines\",\r\n              \"existenceScope\": \"subscription\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/pricings/pricingTier\",\r\n                \"equals\": \"Standard\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4da35fc9-c9e7-4960-aec9-797fe7d9051d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4da35fc9-c9e7-4960-aec9-797fe7d9051d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Diagnostic Settings for Data Lake Analytics to Event Hub\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploys the diagnostic settings for Data Lake Analytics to stream to a regional Event Hub when any Data Lake Analytics which is missing this diagnostic settings is created or updated.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          },\r\n          \"profileName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Profile name\",\r\n              \"description\": \"The diagnostic settings profile name\"\r\n            },\r\n            \"defaultValue\": \"setbypolicy_eventHub\"\r\n          },\r\n          \"eventHubRuleId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Event Hub Authorization Rule Id\",\r\n              \"description\": \"The Event Hub authorization rule Id for Azure Diagnostics. The authorization rule needs to be at Event Hub namespace level. e.g. /subscriptions/{subscription Id}/resourceGroups/{resource group}/providers/Microsoft.EventHub/namespaces/{Event Hub namespace}/authorizationrules/{authorization rule}\",\r\n              \"strongType\": \"Microsoft.EventHub/Namespaces/AuthorizationRules\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"eventHubLocation\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Event Hub Location\",\r\n              \"description\": \"The location the Event Hub resides in. Only Data Lake Analytics in this location will be linked to this Event Hub.\",\r\n              \"strongType\": \"location\"\r\n            },\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"metricsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable metrics\",\r\n              \"description\": \"Whether to enable metrics stream to the Event Hub - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"False\"\r\n          },\r\n          \"logsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable logs\",\r\n              \"description\": \"Whether to enable logs stream to the Event Hub  - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DataLakeAnalytics/accounts\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('eventHubLocation')]\",\r\n                    \"equals\": \"\"\r\n                  },\r\n                  {\r\n                    \"field\": \"location\",\r\n                    \"equals\": \"[parameters('eventHubLocation')]\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"name\": \"[parameters('profileName')]\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                    \"equals\": \"[parameters('logsEnabled')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\r\n                    \"equals\": \"[parameters('metricsEnabled')]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"resourceName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"eventHubRuleId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"metricsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"profileName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.DataLakeAnalytics/accounts/providers/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"dependsOn\": [],\r\n                        \"properties\": {\r\n                          \"eventHubAuthorizationRuleId\": \"[parameters('eventHubRuleId')]\",\r\n                          \"metrics\": [\r\n                            {\r\n                              \"category\": \"AllMetrics\",\r\n                              \"enabled\": \"[parameters('metricsEnabled')]\",\r\n                              \"retentionPolicy\": {\r\n                                \"enabled\": false,\r\n                                \"days\": 0\r\n                              }\r\n                            }\r\n                          ],\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"Audit\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"Requests\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {}\r\n                  },\r\n                  \"parameters\": {\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"resourceName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"eventHubRuleId\": {\r\n                      \"value\": \"[parameters('eventHubRuleId')]\"\r\n                    },\r\n                    \"metricsEnabled\": {\r\n                      \"value\": \"[parameters('metricsEnabled')]\"\r\n                    },\r\n                    \"logsEnabled\": {\r\n                      \"value\": \"[parameters('logsEnabled')]\"\r\n                    },\r\n                    \"profileName\": {\r\n                      \"value\": \"[parameters('profileName')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4daddf25-4823-43d4-88eb-2419eb6dcc08\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4daddf25-4823-43d4-88eb-2419eb6dcc08\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Cloud Services (extended support) role instances should have system updates installed\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Secure your Cloud Services (extended support) role instances by ensuring the latest security and critical updates are installed on them.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Compute/cloudServices\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"bd20bd91-aaf1-7f14-b6e4-866de2f43146\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4df26ba8-026d-45b0-9521-bffa44d741d2\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4df26ba8-026d-45b0-9521-bffa44d741d2\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy - Configure private DNS zones for private endpoints that connect to Batch accounts\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private DNS records allow private connections to private endpoints. Private endpoint connections allow secure communication by enabling private connectivity to Batch accounts without a need for public IP addresses at the source or destination. For more information on private endpoints and DNS zones in Batch, see https://docs.microsoft.com/azure/batch/private-connectivity.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Batch\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateDnsZoneId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private DNS Zone\",\r\n              \"strongType\": \"Microsoft.Network/privateDnsZones\",\r\n              \"description\": \"The private DNS zone to deploy in a new private DNS zone group and link to the private endpoint\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/privateEndpoints\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*].groupIds[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*].groupIds[*]\",\r\n                    \"equals\": \"batchAccount\"\r\n                  }\r\n                },\r\n                \"greaterOrEquals\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Network/privateEndpoints/privateDnsZoneGroups\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"privateDnsZoneId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('privateEndpointName'), '/deployedByPolicy')]\",\r\n                        \"type\": \"Microsoft.Network/privateEndpoints/privateDnsZoneGroups\",\r\n                        \"apiVersion\": \"2020-03-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"privateDnsZoneConfigs\": [\r\n                            {\r\n                              \"name\": \"batchAccount-privateDnsZone\",\r\n                              \"properties\": {\r\n                                \"privateDnsZoneId\": \"[parameters('privateDnsZoneId')]\"\r\n                              }\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"privateDnsZoneId\": {\r\n                      \"value\": \"[parameters('privateDnsZoneId')]\"\r\n                    },\r\n                    \"privateEndpointName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4ec38ebc-381f-45ee-81a4-acbc4be878f8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4ec38ebc-381f-45ee-81a4-acbc4be878f8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure data factories should be encrypted with a customer-managed key\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use customer-managed keys to manage the encryption at rest of your Azure Data Factory. By default, customer data is encrypted with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more at https://aka.ms/adf-cmk.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"Data Factory\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DataFactory/factories\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DataFactory/factories/encryption.vaultBaseUrl\",\r\n                \"exists\": false\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4ec52d6d-beb7-40c4-9a9e-fe753254690e\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4ec52d6d-beb7-40c4-9a9e-fe753254690e\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"A maximum of 3 owners should be designated for your subscription\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"It is recommended to designate up to 3 subscription owners in order to reduce the potential for breach by a compromised owner.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"6f90a6d6-d4d6-0794-0ec1-98fa77878c2e\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4f11b553-d42e-4e3a-89be-32ca364cad4c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4f11b553-d42e-4e3a-89be-32ca364cad4c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Subscriptions should have a contact email address for security issues\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"To ensure the relevant people in your organization are notified when there is a potential security breach in one of your subscriptions, set a security contact to receive email notifications from Security Center.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/securityContacts\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/securityContacts/email\",\r\n                \"notEquals\": \"\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4f4f78b8-e367-4b10-a341-d9a4ad5cf1c7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4f4f78b8-e367-4b10-a341-d9a4ad5cf1c7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Add a tag to resources\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Adds the specified tag and value when any resource missing this tag is created or updated. Existing resources can be remediated by triggering a remediation task. If the tag exists with a different value it will not be changed. Does not modify tags on resource groups.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Tags\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            }\r\n          },\r\n          \"tagValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Value\",\r\n              \"description\": \"Value of the tag, such as 'production'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n            \"exists\": \"false\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"modify\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"operations\": [\r\n                {\r\n                  \"operation\": \"add\",\r\n                  \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                  \"value\": \"[parameters('tagValue')]\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4f9dc7db-30c1-420c-b61a-e1d640128d26\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4f9dc7db-30c1-420c-b61a-e1d640128d26\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Storage account public access should be disallowed\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Anonymous public read access to containers and blobs in Azure Storage is a convenient way to share data but might present security risks. To prevent data breaches caused by undesired anonymous access, Microsoft recommends preventing public access to a storage account unless your scenario requires it.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.1-preview\",\r\n          \"category\": \"Storage\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"audit\",\r\n              \"deny\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"id\",\r\n                \"notContains\": \"/resourceGroups/databricks-rg-\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Storage/storageAccounts/allowBlobPublicAccess\",\r\n                  \"equals\": \"false\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4fa4b6c0-31ca-4c0d-b10d-24b96f62a751\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4fa4b6c0-31ca-4c0d-b10d-24b96f62a751\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"A vulnerability assessment solution should be enabled on your virtual machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Audits virtual machines to detect whether they are running a supported vulnerability assessment solution. A core component of every cyber risk and security program is the identification and analysis of vulnerabilities. Azure Security Center's standard pricing tier includes vulnerability scanning for your virtual machines at no extra cost. Additionally, Security Center can automatically deploy this tool for you.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.ClassicCompute/virtualMachines\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"ffff0522-1e88-47fc-8382-2a80ba848f5d\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/501541f7-f7e7-4cd6-868c-4190fdad3ac9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"501541f7-f7e7-4cd6-868c-4190fdad3ac9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Workflow Automation for Azure Security Center regulatory compliance\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Enable automation of Azure Security Center regulatory compliance. This policy deploys a workflow automation with your conditions and triggers on the assigned scope. To deploy this policy on newly created subscriptions, open the Compliance tab, select the relevant non-compliant assignment and create a remediation task.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"Security Center\",\r\n          \"preview \": true\r\n        },\r\n        \"parameters\": {\r\n          \"automationName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Automation name\",\r\n              \"description\": \"This is the automation name.\"\r\n            }\r\n          },\r\n          \"resourceGroupName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Resource group name\",\r\n              \"description\": \"The resource group name where the workflow automation is created. If you enter a name for a resource group that doesn't exist, it'll be created in the subscription.\"\r\n            }\r\n          },\r\n          \"resourceGroupLocation\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Resource group location\",\r\n              \"description\": \"The location where the resource group and the workflow automation are created.\",\r\n              \"strongType\": \"location\"\r\n            }\r\n          },\r\n          \"regulatoryComplianceStandards\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Compliance standards names\",\r\n              \"description\": \"For all compliance standards, leave it empty. For specific compliance standards, enter a list of standards names separated by semicolons (';'). Compliance standards names are available through the regulatory compliance standards API (https://docs.microsoft.com/rest/api/securitycenter/regulatorycompliancestandards), or Azure Resource Graph Explorer, choose securityresources and microsoft.security/regulatorycompliancestandards.\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"regulatoryComplianceControlStates\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Compliance control states\",\r\n              \"description\": \"Determines compliance control states.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Failed\",\r\n              \"Passed\",\r\n              \"Skipped\",\r\n              \"Unsupported\"\r\n            ],\r\n            \"defaultValue\": [\r\n              \"Failed\",\r\n              \"Passed\",\r\n              \"Skipped\",\r\n              \"Unsupported\"\r\n            ]\r\n          },\r\n          \"logicAppResourceId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Logic App\",\r\n              \"description\": \"The Logic App that is triggered.\",\r\n              \"strongType\": \"Microsoft.Logic/workflows\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"logicAppTrigger\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Logic app trigger\",\r\n              \"description\": \"The trigger connector of the logic app that is triggered. Possible values: 'Manual (Incoming HTTP request)', 'When an Azure Security Center regulatory compliance assessment is created or triggered'.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Manual (Incoming HTTP request)\",\r\n              \"When an Azure Security Center regulatory compliance assessment is created or triggered\"\r\n            ]\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/automations\",\r\n              \"name\": \"[parameters('automationName')]\",\r\n              \"existenceScope\": \"resourcegroup\",\r\n              \"ResourceGroupName\": \"[parameters('resourceGroupName')]\",\r\n              \"deploymentScope\": \"subscription\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Security/automations/isEnabled\",\r\n                    \"equals\": true\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Security/automations/sources[*].ruleSets\",\r\n                            \"exists\": false\r\n                          },\r\n                          {\r\n                            \"value\": \"[length(parameters('regulatoryComplianceStandards'))]\",\r\n                            \"equals\": 0\r\n                          },\r\n                          {\r\n                            \"value\": \"[length(parameters('regulatoryComplianceControlStates'))]\",\r\n                            \"equals\": 4\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"value\": \"[length(parameters('regulatoryComplianceStandards'))]\",\r\n                            \"equals\": 0\r\n                          },\r\n                          {\r\n                            \"value\": \"[length(parameters('regulatoryComplianceControlStates'))]\",\r\n                            \"less\": 4\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*].expectedValue\",\r\n                            \"in\": \"[parameters('regulatoryComplianceControlStates')]\"\r\n                          },\r\n                          {\r\n                            \"count\": {\r\n                              \"value\": \"[parameters('regulatoryComplianceControlStates')]\",\r\n                              \"name\": \"regulatoryComplianceControlState\",\r\n                              \"where\": {\r\n                                \"count\": {\r\n                                  \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*]\",\r\n                                  \"where\": {\r\n                                    \"allOf\": [\r\n                                      {\r\n                                        \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*].propertyJPath\",\r\n                                        \"equals\": \"properties.state\"\r\n                                      },\r\n                                      {\r\n                                        \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*].expectedValue\",\r\n                                        \"equals\": \"[current('regulatoryComplianceControlState')]\"\r\n                                      }\r\n                                    ]\r\n                                  }\r\n                                },\r\n                                \"equals\": 1\r\n                              }\r\n                            },\r\n                            \"equals\": \"[length(parameters('regulatoryComplianceControlStates'))]\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"value\": \"[length(parameters('regulatoryComplianceStandards'))]\",\r\n                            \"notEquals\": 0\r\n                          },\r\n                          {\r\n                            \"value\": \"[length(parameters('regulatoryComplianceControlStates'))]\",\r\n                            \"equals\": 4\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*].expectedValue\",\r\n                            \"in\": \"[parameters('regulatoryComplianceStandards')]\"\r\n                          },\r\n                          {\r\n                            \"count\": {\r\n                              \"value\": \"[parameters('regulatoryComplianceStandards')]\",\r\n                              \"name\": \"regulatoryComplianceStandard\",\r\n                              \"where\": {\r\n                                \"count\": {\r\n                                  \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*]\",\r\n                                  \"where\": {\r\n                                    \"allOf\": [\r\n                                      {\r\n                                        \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*].propertyJPath\",\r\n                                        \"equals\": \"id\"\r\n                                      },\r\n                                      {\r\n                                        \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*].expectedValue\",\r\n                                        \"equals\": \"[current('regulatoryComplianceStandard')]\"\r\n                                      }\r\n                                    ]\r\n                                  }\r\n                                },\r\n                                \"equals\": 1\r\n                              }\r\n                            },\r\n                            \"equals\": \"[length(parameters('regulatoryComplianceStandards'))]\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"value\": \"[length(parameters('regulatoryComplianceStandards'))]\",\r\n                            \"notEquals\": 0\r\n                          },\r\n                          {\r\n                            \"value\": \"[length(parameters('regulatoryComplianceControlStates'))]\",\r\n                            \"notEquals\": 4\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*].expectedValue\",\r\n                            \"in\": \"[union(parameters('regulatoryComplianceStandards'),parameters('regulatoryComplianceControlStates'))]\"\r\n                          },\r\n                          {\r\n                            \"count\": {\r\n                              \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*]\"\r\n                            },\r\n                            \"equals\": \"[mul(2,mul(length(parameters('regulatoryComplianceStandards')),length(parameters('regulatoryComplianceControlStates'))))]\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"location\": \"westeurope\",\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"automationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"resourceGroupName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"resourceGroupLocation\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"regulatoryComplianceStandards\": {\r\n                        \"type\": \"array\"\r\n                      },\r\n                      \"regulatoryComplianceControlStates\": {\r\n                        \"type\": \"array\"\r\n                      },\r\n                      \"logicAppResourceId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logicAppTrigger\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"guidValue\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"[newGuid()]\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"scopeDescription\": \"scope for subscription {0}\",\r\n                      \"regulatoryComplianceStandardsLength\": \"[length(parameters('regulatoryComplianceStandards'))]\",\r\n                      \"regulatoryComplianceControlStatesLength\": \"[length(parameters('regulatoryComplianceControlStates'))]\",\r\n                      \"regulatoryComplianceStandardsLengthIfEmpty\": \"[if(equals(variables('regulatoryComplianceStandardsLength'), 0), 1, variables('regulatoryComplianceStandardsLength'))]\",\r\n                      \"regulatoryComplianceControlStatesLengthIfEmpty\": \"[if(equals(variables('regulatoryComplianceControlStatesLength'), 0), 1, variables('regulatoryComplianceControlStatesLength'))]\",\r\n                      \"stateMap\": {\r\n                        \"Failed\": \"failed\",\r\n                        \"Passed\": \"passed\",\r\n                        \"Skipped\": \"skipped\",\r\n                        \"Unsupported\": \"unsupported\"\r\n                      },\r\n                      \"triggerMap\": {\r\n                        \"Manual (Incoming HTTP request)\": \"manual\",\r\n                        \"When an Azure Security Center regulatory compliance assessment is created or triggered\": \"When_a_Security_Center_Regulatory_Compliance_Assessment_is_created_or_triggered\"\r\n                      },\r\n                      \"doesAllStatesSelected\": \"[if(equals(length(parameters('regulatoryComplianceControlStates')),length(variables('stateMap'))),bool('true'),bool('false'))]\",\r\n                      \"doesAllStandardsSelected\": \"[if(equals(variables('regulatoryComplianceStandardsLength'),0),bool('true'),bool('false'))]\",\r\n                      \"allRegulatoryComplianceRuleSets\": [],\r\n                      \"customStandardsOrCustomStateRuleSets\": {\r\n                        \"copy\": [\r\n                          {\r\n                            \"name\": \"customStandardsOrCustomStateRuleSetsArr\",\r\n                            \"count\": \"[if(not(variables('doesAllStandardsSelected')),variables('regulatoryComplianceStandardsLength'),if(not(variables('doesAllStatesSelected')),variables('regulatoryComplianceControlStatesLength'),1))]\",\r\n                            \"input\": {\r\n                              \"rules\": [\r\n                                {\r\n                                  \"propertyJPath\": \"[if(not(variables('doesAllStandardsSelected')),'id',if(not(variables('doesAllStatesSelected')),'properties.state',json('null')))]\",\r\n                                  \"propertyType\": \"string\",\r\n                                  \"expectedValue\": \"[if(not(variables('doesAllStandardsSelected')),parameters('regulatoryComplianceStandards')[copyIndex('customStandardsOrCustomStateRuleSetsArr')],if(not(variables('doesAllStatesSelected')),parameters('regulatoryComplianceControlStates')[copyIndex('customStandardsOrCustomStateRuleSetsArr')],json('null')))]\",\r\n                                  \"operator\": \"[if(not(variables('doesAllStandardsSelected')),'Contains',if(not(variables('doesAllStatesSelected')),'Equals',json('null')))]\"\r\n                                }\r\n                              ]\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"customStandardsAndCustomStateRuleSets\": {\r\n                        \"copy\": [\r\n                          {\r\n                            \"name\": \"customStandardsAndCustomStateRuleSetsArr\",\r\n                            \"count\": \"[if(and(not(variables('doesAllStandardsSelected')),not(variables('doesAllStatesSelected'))),mul(variables('regulatoryComplianceStandardsLength'),variables('regulatoryComplianceControlStatesLength')),1)]\",\r\n                            \"input\": {\r\n                              \"rules\": [\r\n                                {\r\n                                  \"propertyJPath\": \"id\",\r\n                                  \"propertyType\": \"string\",\r\n                                  \"expectedValue\": \"[if(not(variables('doesAllStandardsSelected')),parameters('regulatoryComplianceStandards')[mod(div(copyIndex('customStandardsAndCustomStateRuleSetsArr'), variables('regulatoryComplianceControlStatesLength')), variables('regulatoryComplianceStandardsLength'))],json('null'))]\",\r\n                                  \"operator\": \"Contains\"\r\n                                },\r\n                                {\r\n                                  \"propertyJPath\": \"properties.state\",\r\n                                  \"propertyType\": \"string\",\r\n                                  \"expectedValue\": \"[if(not(variables('doesAllStatesSelected')),parameters('regulatoryComplianceControlStates')[mod(copyIndex('customStandardsAndCustomStateRuleSetsArr'), variables('regulatoryComplianceControlStatesLength'))],json('null'))]\",\r\n                                  \"operator\": \"Equals\"\r\n                                }\r\n                              ]\r\n                            }\r\n                          }\r\n                        ]\r\n                      },\r\n                      \"sourceRuleSets\": \"[if(and(variables('doesAllStandardsSelected'),variables('doesAllStatesSelected')),variables('allRegulatoryComplianceRuleSets'),if(and(not(variables('doesAllStandardsSelected')),not(variables('doesAllStatesSelected'))),variables('customStandardsAndCustomStateRuleSets').customStandardsAndCustomStateRuleSetsArr,variables('customStandardsOrCustomStateRuleSets').customStandardsOrCustomStateRuleSetsArr))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[parameters('resourceGroupName')]\",\r\n                        \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                        \"apiVersion\": \"2019-10-01\",\r\n                        \"location\": \"[parameters('resourceGroupLocation')]\",\r\n                        \"tags\": {},\r\n                        \"properties\": {}\r\n                      },\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"apiVersion\": \"2019-10-01\",\r\n                        \"name\": \"[concat('nestedAutomationDeployment', '_', parameters('guidValue'))]\",\r\n                        \"resourceGroup\": \"[parameters('resourceGroupName')]\",\r\n                        \"dependsOn\": [\r\n                          \"[resourceId('Microsoft.Resources/resourceGroups/', parameters('resourceGroupName'))]\"\r\n                        ],\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {},\r\n                            \"variables\": {},\r\n                            \"resources\": [\r\n                              {\r\n                                \"tags\": {},\r\n                                \"apiVersion\": \"2019-01-01-preview\",\r\n                                \"location\": \"[parameters('resourceGroupLocation')]\",\r\n                                \"name\": \"[parameters('automationName')]\",\r\n                                \"type\": \"Microsoft.Security/automations\",\r\n                                \"dependsOn\": [],\r\n                                \"properties\": {\r\n                                  \"description\": \"Workflow Automation for Azure Security Center recommendations via policy\",\r\n                                  \"isEnabled\": true,\r\n                                  \"scopes\": [\r\n                                    {\r\n                                      \"description\": \"[replace(variables('scopeDescription'),'{0}', subscription().subscriptionId)]\",\r\n                                      \"scopePath\": \"[subscription().id]\"\r\n                                    }\r\n                                  ],\r\n                                  \"sources\": [\r\n                                    {\r\n                                      \"eventSource\": \"RegulatoryComplianceAssessment\",\r\n                                      \"ruleSets\": \"[variables('sourceRuleSets')]\"\r\n                                    }\r\n                                  ],\r\n                                  \"actions\": [\r\n                                    {\r\n                                      \"actionType\": \"LogicApp\",\r\n                                      \"logicAppResourceId\": \"[parameters('logicAppResourceId')]\",\r\n                                      \"uri\": \"[listCallbackUrl(concat(parameters('logicAppResourceId'), '/triggers/', variables('triggerMap')[parameters('logicAppTrigger')]),'2016-06-01').value]\"\r\n                                    }\r\n                                  ]\r\n                                }\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"automationName\": {\r\n                      \"value\": \"[parameters('automationName')]\"\r\n                    },\r\n                    \"resourceGroupName\": {\r\n                      \"value\": \"[parameters('resourceGroupName')]\"\r\n                    },\r\n                    \"resourceGroupLocation\": {\r\n                      \"value\": \"[parameters('resourceGroupLocation')]\"\r\n                    },\r\n                    \"regulatoryComplianceStandards\": {\r\n                      \"value\": \"[parameters('regulatoryComplianceStandards')]\"\r\n                    },\r\n                    \"regulatoryComplianceControlStates\": {\r\n                      \"value\": \"[parameters('regulatoryComplianceControlStates')]\"\r\n                    },\r\n                    \"logicAppResourceId\": {\r\n                      \"value\": \"[parameters('logicAppResourceId')]\"\r\n                    },\r\n                    \"logicAppTrigger\": {\r\n                      \"value\": \"[parameters('logicAppTrigger')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/509122b9-ddd9-47ba-a5f1-d0dac20be63c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"509122b9-ddd9-47ba-a5f1-d0dac20be63c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"A custom IPsec/IKE policy must be applied to all Azure virtual network gateway connections\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy ensures that all Azure virtual network gateway connections use a custom Internet Protocol Security(Ipsec)/Internet Key Exchange(IKE) policy. Supported algorithms and key strengths - https://aka.ms/AA62kb0\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          },\r\n          \"IPsecEncryption\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"IPsec Encryption\",\r\n              \"description\": \"IPsec Encryption\"\r\n            }\r\n          },\r\n          \"IPsecIntegrity\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"IPsec Integrity\",\r\n              \"description\": \"IPsec Integrity\"\r\n            }\r\n          },\r\n          \"IKEEncryption\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"IKE Encryption\",\r\n              \"description\": \"IKE Encryption\"\r\n            }\r\n          },\r\n          \"IKEIntegrity\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"IKE Integrity\",\r\n              \"description\": \"IKE Integrity\"\r\n            }\r\n          },\r\n          \"DHGroup\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"DH Group\",\r\n              \"description\": \"DH Group\"\r\n            }\r\n          },\r\n          \"PFSGroup\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"PFS Group\",\r\n              \"description\": \"PFS Group\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/connections\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Network/connections/ipsecPolicies[*].ipsecEncryption\",\r\n                    \"notIn\": \"[parameters('IPsecEncryption')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/connections/ipsecPolicies[*].ipsecIntegrity\",\r\n                    \"notIn\": \"[parameters('IPsecIntegrity')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/connections/ipsecPolicies[*].ikeEncryption\",\r\n                    \"notIn\": \"[parameters('IKEEncryption')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/connections/ipsecPolicies[*].ikeIntegrity\",\r\n                    \"notIn\": \"[parameters('IKEIntegrity')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/connections/ipsecPolicies[*].dhGroup\",\r\n                    \"notIn\": \"[parameters('DHGroup')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/connections/ipsecPolicies[*].pfsGroup\",\r\n                    \"notIn\": \"[parameters('PFSGroup')]\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/50b83b09-03da-41c1-b656-c293c914862b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"50b83b09-03da-41c1-b656-c293c914862b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Bot Service should be encrypted with a customer-managed key\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Bot Service automatically encrypts your resource to protect your data and meet organizational security and compliance commitments. By default, Microsoft-managed encryption keys are used. For greater flexibility in managing keys or controlling access to your subscription, select customer-managed keys, also known as bring your own key (BYOK). Learn more about Azure Bot Service encryption: https://docs.microsoft.com/azure/bot-service/bot-service-encryption.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Bot Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The desired effect of the policy.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"audit\",\r\n              \"deny\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.BotService/botServices\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.BotService/botServices/isCmekEnabled\",\r\n                \"notEquals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/51522a96-0869-4791-82f3-981000c2c67f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"51522a96-0869-4791-82f3-981000c2c67f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Bot Service should have isolated mode enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Bots should be set to 'isolated only' mode. This setting configures Bot Service channels that require traffic over the public internet to be disabled.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Bot Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The desired effect of the policy.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"audit\",\r\n              \"deny\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.BotService/botServices\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.BotService/botServices/isIsolated\",\r\n                \"notEquals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/52152f42-0dda-40d9-976e-abb1acdd611e\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"52152f42-0dda-40d9-976e-abb1acdd611e\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Defender for Kubernetes should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Azure Defender for Kubernetes provides real-time threat protection for containerized environments and generates alerts for suspicious activities.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.3\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/pricings\",\r\n              \"name\": \"KubernetesService\",\r\n              \"existenceScope\": \"subscription\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/pricings/pricingTier\",\r\n                \"equals\": \"Standard\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/523b5cd1-3e23-492f-a539-13118b6d1e3a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"523b5cd1-3e23-492f-a539-13118b6d1e3a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Synapse workspaces with SQL auditing to storage account destination should be configured with 90 days retention or higher\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"For incident investigation purposes, we recommend setting the data retention for your Synapse workspace' SQL auditing to storage account destination to at least 90 days. Confirm that you are meeting the necessary retention rules for the regions in which you are operating. This is sometimes required for compliance with regulatory standards.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Synapse\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Synapse/workspaces\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Synapse/workspaces/auditingSettings\",\r\n              \"name\": \"default\",\r\n              \"existenceCondition\": {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Synapse/workspaces/auditingSettings/isAzureMonitorTargetEnabled\",\r\n                        \"equals\": true\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Synapse/workspaces/auditingSettings/storageEndpoint\",\r\n                        \"equals\": \"\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Synapse/workspaces/auditingSettings/retentionDays\",\r\n                    \"equals\": 0\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Synapse/workspaces/auditingSettings/retentionDays\",\r\n                    \"greaterOrEquals\": 90\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/529ea018-6afc-4ed4-95bd-7c9ee47b00bc\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"529ea018-6afc-4ed4-95bd-7c9ee47b00bc\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Connection throttling should be enabled for PostgreSQL database servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy helps audit any PostgreSQL databases in your environment without Connection throttling enabled. This setting enables temporary connection throttling per IP for too many invalid password login failures.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.DBforPostgreSQL/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.DBforPostgreSQL/servers/configurations\",\r\n              \"name\": \"connection_throttling\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.DBforPostgreSQL/servers/configurations/value\",\r\n                \"equals\": \"ON\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5345bb39-67dc-4960-a1bf-427e16b9a0bd\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5345bb39-67dc-4960-a1bf-427e16b9a0bd\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure SignalR Service should use private link\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The private link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your Azure SignalR Service resource instead of the entire service, you'll reduce your data leakage risks. Learn more about private links at: https://aka.ms/asrs/privatelink.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"SignalR\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.SignalRService/SignalR\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.SignalRService/SignalR/privateEndpointConnections[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.SignalRService/SignalR/privateEndpointConnections[*].privateLinkServiceConnectionState.status\",\r\n                    \"equals\": \"Approved\"\r\n                  }\r\n                },\r\n                \"less\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/53503636-bcc9-4748-9663-5348217f160f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"53503636-bcc9-4748-9663-5348217f160f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Azure Key Vault should disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disable public network access for your key vault so that it's not accessible over the public internet. This can reduce data leakage risks. Learn more at: https://aka.ms/akvprivatelink.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.0-preview\",\r\n          \"category\": \"Key Vault\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.KeyVault/vaults\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.KeyVault/vaults/networkAcls.defaultAction\",\r\n                \"notEquals\": \"Deny\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/55615ac9-af46-4a59-874e-391cc3dfb490\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"55615ac9-af46-4a59-874e-391cc3dfb490\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Web Application Firewall (WAF) should be enabled for Application Gateway\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Azure Web Application Firewall (WAF) in front of public facing web applications for additional inspection of incoming traffic. Web Application Firewall (WAF) provides centralized protection of your web applications from common exploits and vulnerabilities such as SQL injections, Cross-Site Scripting, local and remote file executions. You can also restrict access to your web applications by countries, IP address ranges, and other http(s) parameters via custom rules.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/applicationGateways\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Network/applicationGateways/webApplicationFirewallConfiguration\",\r\n                \"exists\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/564feb30-bf6a-4854-b4bb-0d2d2d1e6c66\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"564feb30-bf6a-4854-b4bb-0d2d2d1e6c66\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Automation accounts should use customer-managed keys to encrypt data at rest\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use customer-managed keys to manage the encryption at rest of your Azure Automation Accounts. By default, customer data is encrypted with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more at https://aka.ms/automation-cmk.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Automation\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"'Audit' allows a non-compliant resource to be created or updated, but flags it as non-compliant. 'Deny' blocks the non-compliant resource creation or update. 'Disabled' turns off the policy.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Automation/automationAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Automation/automationAccounts/encryption.keySource\",\r\n                \"notEquals\": \"Microsoft.Keyvault\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/56a5ee18-2ae6-4810-86f7-18e39ce5629b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"56a5ee18-2ae6-4810-86f7-18e39ce5629b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"IP firewall rules on Azure Synapse workspaces should be removed\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Removing all IP firewall rules improves security by ensuring your Azure Synapse workspace can only be accessed from a private endpoint. This configuration audits creation of firewall rules that allow public network access on the workspace.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Synapse\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Synapse/workspaces/firewallrules\"\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"exists\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/56fd377d-098c-4f02-8406-81eb055902b8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"56fd377d-098c-4f02-8406-81eb055902b8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"CORS should not allow every resource to access your Web Applications\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Cross-Origin Resource Sharing (CORS) should not allow all domains to access your web application. Allow only required domains to interact with your web app.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"app*\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/config/web.cors.allowedOrigins[*]\",\r\n                \"notEquals\": \"*\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5744710e-cc2f-4ee8-8809-3b11e89f4bc9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5744710e-cc2f-4ee8-8809-3b11e89f4bc9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows web servers should be configured to use secure communication protocols\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"To protect the privacy of information communicated over the Internet, your web servers should use the latest version of the industry-standard cryptographic protocol, Transport Layer Security (TLS). TLS secures communications over a network by using security certificates to encrypt a connection between machines.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"3.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AuditSecureProtocol\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"MinimumTLSVersion\": \"[SecureWebServer]s1;MinimumTLSVersion\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"MinimumTLSVersion\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Minimum TLS version\",\r\n              \"description\": \"The minimum TLS protocol version that should be enabled. Windows web servers with lower TLS versions will be marked as non-compliant.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"1.1\",\r\n              \"1.2\"\r\n            ],\r\n            \"defaultValue\": \"1.1\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AuditSecureProtocol\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('[SecureWebServer]s1;MinimumTLSVersion', '=', parameters('MinimumTLSVersion')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5752e6d6-1206-46d8-8ab1-ecc2f71a8112\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5752e6d6-1206-46d8-8ab1-ecc2f71a8112\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Configure supported Linux virtual machine scale sets to automatically install the Guest Attestation extension\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Configure supported Linux virtual machines scale sets to automatically install the Guest Attestation extension to allow Azure Security Center to proactively attest and monitor the boot integrity. Boot integrity is attested via Remote Attestation.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"version\": \"1.0.0-preview\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"like\": \"18_04-lts-gen2\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"0001-com-ubuntu-server-focal\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"like\": \"20_04-lts-gen2\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"RHEL\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"like\": \"83-gen2\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"SLES-15-SP2\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"like\": \"gen2\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachineScaleSets/virtualMachineProfile.securityProfile.uefiSettings\",\r\n                \"exists\": \"true\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachineScaleSets/virtualMachineProfile.securityProfile.uefiSettings.vTpmEnabled\",\r\n                \"equals\": \"true\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachineScaleSets/virtualMachineProfile.securityProfile.uefiSettings.secureBootEnabled\",\r\n                \"equals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Security.LinuxAttestation\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\r\n                    \"equals\": \"GuestAttestation\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/provisioningState\",\r\n                    \"in\": [\r\n                      \"Succeeded\",\r\n                      \"Provisioning succeeded\"\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmssName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmssName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"extensionName\": \"GuestAttestation\",\r\n                      \"extensionPublisher\": \"Microsoft.Azure.Security.LinuxAttestation\",\r\n                      \"extensionVersion\": \"1.0\",\r\n                      \"maaTenantName\": \"GuestAttestation\",\r\n                      \"ascReportingEndpoint\": \"https://eus2.service.attest.azure.net/\",\r\n                      \"maaEndpoint\": \"https://sharedeus2.eus2.attest.azure.net/\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n                        \"apiVersion\": \"2018-10-01\",\r\n                        \"name\": \"[concat(parameters('vmssName'), '/', variables('extensionName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('extensionPublisher')]\",\r\n                          \"type\": \"[variables('extensionName')]\",\r\n                          \"typeHandlerVersion\": \"[variables('extensionVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"AttestationConfig\": {\r\n                              \"MaaSettings\": {\r\n                                \"maaEndpoint\": \"[variables('maaEndpoint')]\",\r\n                                \"maaTenantName\": \"[variables('maaTenantName')]\"\r\n                              },\r\n                              \"AscSettings\": {\r\n                                \"ascReportingEndpoint\": \"[variables('ascReportingEndpoint')]\",\r\n                                \"ascReportingFrequency\": \"\"\r\n                              },\r\n                              \"useCustomToken\": \"false\",\r\n                              \"disableAlerts\": \"false\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/57c2e3f0-98cf-4c3b-aa6b-e8f70726e74e\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"57c2e3f0-98cf-4c3b-aa6b-e8f70726e74e\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure disk access resources with private endpoints\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoints connect your virtual networks to Azure services without a public IP address at the source or destination. By mapping private endpoints to disk access resources, you can reduce data leakage risks. Learn more about private links at: https://aka.ms/disksprivatelinksdoc.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          },\r\n          \"location\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Location\",\r\n              \"strongType\": \"location\",\r\n              \"description\": \"All disk access resources in this region are validated and private endpoints are created in this region.\"\r\n            }\r\n          },\r\n          \"privateEndpointSubnetId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private endpoint subnet ID\",\r\n              \"description\": \"A subnet with private endpoint network policies disabled.\",\r\n              \"strongType\": \"Microsoft.Network/virtualNetworks/subnets\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/diskAccesses\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"equals\": \"[parameters('location')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/diskAccesses/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Compute/diskAccesses/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"name\": {\r\n                      \"value\": \"[concat('pe','-',field('name'))]\"\r\n                    },\r\n                    \"serviceId\": {\r\n                      \"value\": \"[field('id')]\"\r\n                    },\r\n                    \"privateEndpointSubnetId\": {\r\n                      \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"name\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"serviceId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointSubnetId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[parameters('name')]\",\r\n                        \"type\": \"Microsoft.Network/privateEndpoints\",\r\n                        \"apiVersion\": \"2019-11-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"tags\": {},\r\n                        \"properties\": {\r\n                          \"subnet\": {\r\n                            \"id\": \"[parameters('privateEndpointSubnetId')]\"\r\n                          },\r\n                          \"privateLinkServiceConnections\": [\r\n                            {\r\n                              \"name\": \"[parameters('name')]\",\r\n                              \"properties\": {\r\n                                \"privateLinkServiceId\": \"[parameters('serviceId')]\",\r\n                                \"groupIds\": [\r\n                                  \"disks\"\r\n                                ]\r\n                              }\r\n                            }\r\n                          ],\r\n                          \"manualPrivateLinkServiceConnections\": []\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/582bd7a6-a5f6-4dc6-b9dc-9cb81fe0d4c5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"582bd7a6-a5f6-4dc6-b9dc-9cb81fe0d4c5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'System Audit Policies - Detailed Tracking'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'System Audit Policies - Detailed Tracking' for auditing DPAPI, process creation/termination, RPC events, and PNP activity. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_SystemAuditPoliciesDetailedTracking\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"AuditProcessTermination\": \"Audit Process Termination;ExpectedValue\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"AuditProcessTermination\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit Process Termination\",\r\n              \"description\": \"Specifies whether audit events are generated when a process has exited. Recommended for monitoring termination of critical processes.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"No Auditing\",\r\n              \"Success\",\r\n              \"Failure\",\r\n              \"Success and Failure\"\r\n            ],\r\n            \"defaultValue\": \"No Auditing\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SystemAuditPoliciesDetailedTracking\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('Audit Process Termination;ExpectedValue', '=', parameters('AuditProcessTermination')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/58383b73-94a9-4414-b382-4146eb02611b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"58383b73-94a9-4414-b382-4146eb02611b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"CosmosDB accounts should use private link\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your CosmosDB account, data leakage risks are reduced. Learn more about private links at: https://docs.microsoft.com/azure/cosmos-db/how-to-configure-private-endpoints.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Cosmos DB\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DocumentDB/databaseAccounts\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.DocumentDB/databaseAccounts/privateEndpointConnections[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/privateEndpointConnections[*].privateLinkServiceConnectionState.status\",\r\n                    \"equals\": \"Approved\"\r\n                  }\r\n                },\r\n                \"less\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/58440f8a-10c5-4151-bdce-dfbaad4a20b7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"58440f8a-10c5-4151-bdce-dfbaad4a20b7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit Windows machines on which Windows Serial Console is not enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if the machine does not have the Serial Console software installed or if the EMS port number or baud rate are not configured with the same values as the policy parameters.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"WindowsSerialConsole\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"EMSPortNumber\": \"[WindowsSerialConsole]WindowsSerialConsole;EMSPortNumber\",\r\n              \"EMSBaudRate\": \"[WindowsSerialConsole]WindowsSerialConsole;EMSBaudRate\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"EMSPortNumber\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"EMS Port Number\",\r\n              \"description\": \"An integer indicating the COM port to be used for the Emergency Management Services (EMS) console redirection. For more information on EMS settings, please visit https://aka.ms/gcpolwsc\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"1\",\r\n              \"2\",\r\n              \"3\",\r\n              \"4\"\r\n            ],\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"EMSBaudRate\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"EMS Baud Rate\",\r\n              \"description\": \"An integer indicating the baud rate to be used for the Emergency Management Services (EMS) console redirection. For more information on EMS settings, please visit https://aka.ms/gcpolwsc\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"9600\",\r\n              \"19200\",\r\n              \"38400\",\r\n              \"57600\",\r\n              \"115200\"\r\n            ],\r\n            \"defaultValue\": \"115200\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsSerialConsole\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('[WindowsSerialConsole]WindowsSerialConsole;EMSPortNumber', '=', parameters('EMSPortNumber'), ',', '[WindowsSerialConsole]WindowsSerialConsole;EMSBaudRate', '=', parameters('EMSBaudRate')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/58c460e9-7573-4bb2-9676-339c2f2486bb\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"58c460e9-7573-4bb2-9676-339c2f2486bb\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Ensure Function app is using the latest version of TLS encryption\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Please use /providers/Microsoft.Authorization/policyDefinitions/f9d614c5-c173-4d56-95a7-b4437057d193 instead. The TLS(Transport Layer Security) protocol secures transmission of data over the internet using standard encryption technology. Encryption should be set with the latest version of TLS. App service allows TLS 1.2 by default, which is the recommended TLS level by industry standards, such as PCI DSS\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"App Service\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"functionapp*\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/config/web.minTlsVersion\",\r\n                \"equals\": \"1.2\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/58d94fc1-a072-47c2-bd37-9cdb38e77453\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"58d94fc1-a072-47c2-bd37-9cdb38e77453\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Operating system version should be the most current version for your cloud service roles\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Keeping the operating system (OS) on the most recent supported version for your cloud service roles enhances the systems security posture.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.ClassicCompute/domainNames/slots/roles\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"8bc390da-9eb6-938d-25ed-44a35d9bcc9d\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5a913c68-0590-402c-a531-e57e19379da3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5a913c68-0590-402c-a531-e57e19379da3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs that do not have a minimum password age of 1 day\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that do not have a minimum password age of 1 day. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"MinimumPasswordAge\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5aa11bbc-5c76-4302-80e5-aba46a4282e7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5aa11bbc-5c76-4302-80e5-aba46a4282e7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs that do not restrict the minimum password length to 14 characters\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that do not restrict the minimum password length to 14 characters. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"MinimumPasswordLength\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5aebc8d1-020d-4037-89a0-02043a7524ec\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5aebc8d1-020d-4037-89a0-02043a7524ec\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit Windows machines that allow re-use of the previous 24 passwords\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if Windows machines that allow re-use of the previous 24 passwords\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"EnforcePasswordHistory\",\r\n            \"version\": \"1.*\"\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"EnforcePasswordHistory\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5b054a0d-39e2-4d53-bea3-9734cad2c69b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5b054a0d-39e2-4d53-bea3-9734cad2c69b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Linux VMs that have the specified applications installed\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Linux virtual machines that have the specified applications installed. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"microsoft-aks\",\r\n                          \"qubole-inc\",\r\n                          \"datastax\",\r\n                          \"couchbase\",\r\n                          \"scalegrid\",\r\n                          \"checkpoint\",\r\n                          \"paloaltonetworks\",\r\n                          \"debian\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"OpenLogic\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"CentOS*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Oracle\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Oracle-Linux\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"RHEL\",\r\n                              \"RHEL-HA\",\r\n                              \"RHEL-SAP\",\r\n                              \"RHEL-SAP-APPS\",\r\n                              \"RHEL-SAP-HA\",\r\n                              \"RHEL-SAP-HANA\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"osa\",\r\n                              \"rhel-byos\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"cis-centos-7-l1\",\r\n                              \"cis-centos-7-v2-1-1-l1\",\r\n                              \"cis-centos-8-l1\",\r\n                              \"cis-debian-linux-8-l1\",\r\n                              \"cis-debian-linux-9-l1\",\r\n                              \"cis-nginx-centos-7-v1-1-0-l1\",\r\n                              \"cis-oracle-linux-7-v2-0-0-l1\",\r\n                              \"cis-oracle-linux-8-l1\",\r\n                              \"cis-postgresql-11-centos-linux-7-level-1\",\r\n                              \"cis-rhel-7-l2\",\r\n                              \"cis-rhel-7-v2-2-0-l1\",\r\n                              \"cis-rhel-8-l1\",\r\n                              \"cis-suse-linux-12-v2-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1604-v1-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1804-l1\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"credativ\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Debian\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"7*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Suse\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"SLES*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"11*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Canonical\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"UbuntuServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"12*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"linux-data-science-vm-ubuntu\",\r\n                              \"azureml\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-centos-os\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-altus-centos-os\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"linux*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.linuxConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Linux*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"notIn\": [\r\n                                  \"OpenLogic\",\r\n                                  \"RedHat\",\r\n                                  \"credativ\",\r\n                                  \"Suse\",\r\n                                  \"Canonical\",\r\n                                  \"microsoft-dsvm\",\r\n                                  \"cloudera\",\r\n                                  \"microsoft-ads\",\r\n                                  \"center-for-internet-security-inc\",\r\n                                  \"Oracle\"\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"linux*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"not_installed_application_linux\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5b842acb-0fe7-41b0-9f40-880ec4ad84d8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5b842acb-0fe7-41b0-9f40-880ec4ad84d8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Container registries should be encrypted with a customer-managed key\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use customer-managed keys to manage the encryption at rest of the contents of your registries. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more at https://aka.ms/acr/CMK.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.2\",\r\n          \"category\": \"Container Registry\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ContainerRegistry/registries\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.ContainerRegistry/registries/encryption.status\",\r\n                \"notEquals\": \"enabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5b9159ae-1701-4a6f-9a7a-aa9c8ddd0580\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5b9159ae-1701-4a6f-9a7a-aa9c8ddd0580\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Ensure WEB app has 'Client Certificates (Incoming client certificates)' set to 'On'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Client certificates allow for the app to request a certificate for incoming requests. Only clients that have a valid certificate will be able to reach the app.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"app*\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Web/sites/clientCertEnabled\",\r\n                \"equals\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5bb220d9-2698-4ee4-8404-b9c30c9df609\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5bb220d9-2698-4ee4-8404-b9c30c9df609\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs on which the remote connection status does not match the specified one\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines on which the remote host connection status does not match the specified one. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"host\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Remote Host Name\",\r\n              \"description\": \"Specifies the Domain Name System (DNS) name or IP address of the remote host machine.\"\r\n            }\r\n          },\r\n          \"port\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Port\",\r\n              \"description\": \"The TCP port number on the remote host name.\"\r\n            }\r\n          },\r\n          \"shouldConnect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Should connect to remote host\",\r\n              \"description\": \"Must be 'True' or 'False'. 'True' indicates that the virtual machine should be able to establish a connection with the remote host specified, so the machine will be non-compliant if it cannot establish a connection. 'False' indicates that the virtual machine should not be able to establish a connection with the remote host specified, so the machine will be non-compliant if it can establish a connection.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"False\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsRemoteConnection\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('[WindowsRemoteConnection]WindowsRemoteConnection1;host', '=', parameters('host'), ',', '[WindowsRemoteConnection]WindowsRemoteConnection1;port', '=', parameters('port'), ',', '[WindowsRemoteConnection]WindowsRemoteConnection1;shouldConnect', '=', parameters('shouldConnect')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"WindowsRemoteConnection\"\r\n                    },\r\n                    \"host\": {\r\n                      \"value\": \"[parameters('host')]\"\r\n                    },\r\n                    \"port\": {\r\n                      \"value\": \"[parameters('port')]\"\r\n                    },\r\n                    \"shouldConnect\": {\r\n                      \"value\": \"[parameters('shouldConnect')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"host\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"port\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"shouldConnect\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[WindowsRemoteConnection]WindowsRemoteConnection1;host\",\r\n                                \"value\": \"[parameters('host')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"[WindowsRemoteConnection]WindowsRemoteConnection1;port\",\r\n                                \"value\": \"[parameters('port')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"[WindowsRemoteConnection]WindowsRemoteConnection1;shouldConnect\",\r\n                                \"value\": \"[parameters('shouldConnect')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[WindowsRemoteConnection]WindowsRemoteConnection1;host\",\r\n                                \"value\": \"[parameters('host')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"[WindowsRemoteConnection]WindowsRemoteConnection1;port\",\r\n                                \"value\": \"[parameters('port')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"[WindowsRemoteConnection]WindowsRemoteConnection1;shouldConnect\",\r\n                                \"value\": \"[parameters('shouldConnect')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5bb36dda-8a78-4df9-affd-4f05a8612a8a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5bb36dda-8a78-4df9-affd-4f05a8612a8a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs configurations in 'Security Options - Network Security'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Network Security'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsNetworkSecurity\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5c028d2a-1889-45f6-b821-31f42711ced8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5c028d2a-1889-45f6-b821-31f42711ced8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Log Analytics agent should be enabled in virtual machine scale sets for listed virtual machine images\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Reports virtual machine scale sets as non-compliant if the virtual machine image is not in the list defined and the agent is not installed.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfImageIdToInclude_windows\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of virtual machine images that have supported Windows OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"listOfImageIdToInclude_linux\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of virtual machine images that have supported Linux OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"anyOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageId\",\r\n                      \"in\": \"[parameters('listOfImageIdToInclude_windows')]\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageId\",\r\n                      \"in\": \"[parameters('listOfImageIdToInclude_linux')]\"\r\n                    },\r\n                    {\r\n                      \"anyOf\": [\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"2008-R2-SP1\",\r\n                                \"2008-R2-SP1-smalldisk\",\r\n                                \"2012-Datacenter\",\r\n                                \"2012-Datacenter-smalldisk\",\r\n                                \"2012-R2-Datacenter\",\r\n                                \"2012-R2-Datacenter-smalldisk\",\r\n                                \"2016-Datacenter\",\r\n                                \"2016-Datacenter-Server-Core\",\r\n                                \"2016-Datacenter-Server-Core-smalldisk\",\r\n                                \"2016-Datacenter-smalldisk\",\r\n                                \"2016-Datacenter-with-Containers\",\r\n                                \"2016-Datacenter-with-RDSH\",\r\n                                \"2019-Datacenter\",\r\n                                \"2019-Datacenter-Core\",\r\n                                \"2019-Datacenter-Core-smalldisk\",\r\n                                \"2019-Datacenter-Core-with-Containers\",\r\n                                \"2019-Datacenter-Core-with-Containers-smalldisk\",\r\n                                \"2019-Datacenter-smalldisk\",\r\n                                \"2019-Datacenter-with-Containers\",\r\n                                \"2019-Datacenter-with-Containers-smalldisk\",\r\n                                \"2019-Datacenter-zhcn\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServerSemiAnnual\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"Datacenter-Core-1709-smalldisk\",\r\n                                \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                                \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServerHPCPack\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftSQLServer\"\r\n                            },\r\n                            {\r\n                              \"anyOf\": [\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2016\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2016-BYOL\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2012R2\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2012R2-BYOL\"\r\n                                }\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftRServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"MLServer-WS2016\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftVisualStudio\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"in\": [\r\n                                \"VisualStudio\",\r\n                                \"Windows\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftDynamicsAX\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"Dynamics\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftDynamicsAX\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"Dynamics\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"equals\": \"Pre-Req-AX7-Onebox-V4\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"microsoft-ads\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"windows-data-science-vm\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsDesktop\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"Windows-10\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"RedHat\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"RHEL\",\r\n                            \"RHEL-SAP-HANA\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"SUSE\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"SLES\",\r\n                            \"SLES-HPC\",\r\n                            \"SLES-HPC-Priority\",\r\n                            \"SLES-SAP\",\r\n                            \"SLES-SAP-BYOS\",\r\n                            \"SLES-Priority\",\r\n                            \"SLES-BYOS\",\r\n                            \"SLES-SAPCAL\",\r\n                            \"SLES-Standard\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"12*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"Canonical\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"UbuntuServer\"\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"14.04*LTS\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"16.04*LTS\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"18.04*LTS\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"Oracle\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"Oracle-Linux\"\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7.*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"OpenLogic\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"CentOS\",\r\n                            \"Centos-LVM\",\r\n                            \"CentOS-SRIOV\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"cloudera\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"cloudera-centos-os\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSKU\",\r\n                          \"like\": \"7*\"\r\n                        }\r\n                      ]\r\n                    }\r\n                  ]\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5c3bc7b8-a64c-4e08-a9cd-7ff0f31e1138\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5c3bc7b8-a64c-4e08-a9cd-7ff0f31e1138\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"External accounts with write permissions should be removed from your subscription\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"External accounts with write privileges should be removed from your subscription in order to prevent unmonitored access.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"04e7147b-0deb-9796-2e5c-0336343ceb3d\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5c607a2e-c700-4744-8254-d77e7c9eb5e4\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5c607a2e-c700-4744-8254-d77e7c9eb5e4\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Azure Synapse workspaces to disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disable public network access for your Synapse workspace so that it is not accessible over the public internet. This can reduce data leakage risks. Learn more at: https://docs.microsoft.com/azure/synapse-analytics/security/connectivity-settings.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Synapse\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Modify\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Modify\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Synapse/workspaces\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Synapse/workspaces/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"conflictEffect\": \"audit\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"operations\": [\r\n                {\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.Synapse/workspaces/publicNetworkAccess\",\r\n                  \"value\": \"Disabled\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5c8cad01-ef30-4891-b230-652dadb4876a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5c8cad01-ef30-4891-b230-652dadb4876a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Function App should only be accessible over HTTPS\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyof\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"OnlyHttpsForFunctionApp\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"in\": [\r\n                  \"OffByPolicy\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5df82f4f-773a-4a2d-97a2-422a806f1a55\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5df82f4f-773a-4a2d-97a2-422a806f1a55\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure network security groups to use specific workspace for traffic analytics\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"If it already has traffic analytics enabled, then policy will overwrite its existing settings with the ones provided during policy creation. Traffic analytics is a cloud-based solution that provides visibility into user and application activity in cloud networks.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          },\r\n          \"nsgRegion\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network security group Region\",\r\n              \"description\": \"Configures for network security groups in the selected region only.\",\r\n              \"strongType\": \"location\"\r\n            }\r\n          },\r\n          \"storageId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Storage Resource ID\",\r\n              \"description\": \"Resource ID of the storage account where the flow logs are written. Make sure this storage account is located in the selected network security group region. The format must be: '/subscriptions/{subscription id}/resourceGroups/{resourceGroup name}/providers/Microsoft.Storage/storageAccounts/{storage account name}\",\r\n              \"assignPermissions\": \"true\"\r\n            }\r\n          },\r\n          \"timeInterval\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Traffic analytics processing interval in minutes\",\r\n              \"description\": \"Traffic analytics processes blobs at the selected frequency.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"10\",\r\n              \"60\"\r\n            ],\r\n            \"defaultValue\": \"60\"\r\n          },\r\n          \"workspaceResourceId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Workspace resource ID\",\r\n              \"description\": \"Log Analytics workspace resource id\",\r\n              \"assignPermissions\": \"true\"\r\n            }\r\n          },\r\n          \"workspaceRegion\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Workspace region\",\r\n              \"description\": \"Log Analytics workspace region\",\r\n              \"strongType\": \"location\"\r\n            }\r\n          },\r\n          \"workspaceId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Workspace ID\",\r\n              \"description\": \"Log Analytics workspace GUID\"\r\n            }\r\n          },\r\n          \"networkWatcherRG\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network Watcher resource group\",\r\n              \"description\": \"The Network Watcher regional instance is present in this resource group. The network security group flow logs resources are also created. This is used only if a deployment is required. By default, it is named 'NetworkWatcherRG'.\",\r\n              \"strongType\": \"existingResourceGroups\"\r\n            }\r\n          },\r\n          \"networkWatcherName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Network Watcher name\",\r\n              \"description\": \"The name of the network watcher under which the flow log resources are created. Make sure it belongs to the same region as the network security group.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/networkSecurityGroups\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"equals\": \"[parameters('nsgRegion')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Network/networkWatchers/flowlogs\",\r\n              \"resourceGroupName\": \"[if(empty(coalesce(field('Microsoft.Network/networkSecurityGroups/flowLogs'))), parameters('networkWatcherRG'), split(first(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id')), '/')[4])]\",\r\n              \"name\": \"[if(empty(coalesce(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id'))), 'null/null', concat(split(first(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id')), '/')[8], '/', split(first(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id')), '/')[10]))]\",\r\n              \"existenceCondition\": {\r\n                \"anyof\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkWatchers/flowLogs/enabled\",\r\n                    \"equals\": \"false\"\r\n                  },\r\n                  {\r\n                    \"allof\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkWatchers/flowLogs/enabled\",\r\n                        \"equals\": \"true\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkWatchers/flowLogs/storageId\",\r\n                        \"equals\": \"[parameters('storageId')]\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkWatchers/flowLogs/flowAnalyticsConfiguration.networkWatcherFlowAnalyticsConfiguration.enabled\",\r\n                        \"equals\": \"true\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkWatchers/flowLogs/flowAnalyticsConfiguration.networkWatcherFlowAnalyticsConfiguration.trafficAnalyticsInterval\",\r\n                        \"in\": [\r\n                          \"10\",\r\n                          \"60\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkWatchers/flowLogs/flowAnalyticsConfiguration.networkWatcherFlowAnalyticsConfiguration.workspaceId\",\r\n                        \"equals\": \"[parameters('workspaceId')]\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"storageId\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"timeInterval\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"workspaceId\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"workspaceRegion\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"workspaceResourceId\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"networkWatcherRG\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"networkWatcherName\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"flowlogName\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"targetResource\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[concat('flowlogDeployment-', uniqueString(parameters('flowlogName')))]\",\r\n                        \"apiVersion\": \"2019-10-01\",\r\n                        \"resourceGroup\": \"[parameters('networkWatcherRG')]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"incremental\",\r\n                          \"parameters\": {},\r\n                          \"template\": {\r\n                            \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {},\r\n                            \"resources\": [\r\n                              {\r\n                                \"type\": \"Microsoft.Network/networkWatchers/flowLogs\",\r\n                                \"name\": \"[concat(parameters('networkWatcherName'), '/', parameters('flowlogName'))]\",\r\n                                \"apiVersion\": \"2019-11-01\",\r\n                                \"location\": \"[parameters('location')]\",\r\n                                \"properties\": {\r\n                                  \"targetResourceId\": \"[parameters('targetResource')]\",\r\n                                  \"storageId\": \"[parameters('storageId')]\",\r\n                                  \"enabled\": \"true\",\r\n                                  \"flowAnalyticsConfiguration\": {\r\n                                    \"networkWatcherFlowAnalyticsConfiguration\": {\r\n                                      \"enabled\": true,\r\n                                      \"workspaceId\": \"[parameters('workspaceId')]\",\r\n                                      \"workspaceRegion\": \"[parameters('workspaceRegion')]\",\r\n                                      \"workspaceResourceId\": \"[parameters('workspaceResourceId')]\",\r\n                                      \"trafficAnalyticsInterval\": \"[parameters('timeInterval')]\"\r\n                                    }\r\n                                  },\r\n                                  \"retentionPolicy\": {\r\n                                    \"days\": \"0\",\r\n                                    \"enabled\": \"false\"\r\n                                  },\r\n                                  \"format\": {\r\n                                    \"type\": \"JSON\",\r\n                                    \"version\": 2\r\n                                  }\r\n                                }\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"storageId\": {\r\n                      \"value\": \"[parameters('storageId')]\"\r\n                    },\r\n                    \"timeInterval\": {\r\n                      \"value\": \"[parameters('timeInterval')]\"\r\n                    },\r\n                    \"workspaceId\": {\r\n                      \"value\": \"[parameters('workspaceId')]\"\r\n                    },\r\n                    \"workspaceRegion\": {\r\n                      \"value\": \"[parameters('workspaceRegion')]\"\r\n                    },\r\n                    \"workspaceResourceId\": {\r\n                      \"value\": \"[parameters('workspaceResourceId')]\"\r\n                    },\r\n                    \"networkWatcherRG\": {\r\n                      \"value\": \"[if(empty(coalesce(field('Microsoft.Network/networkSecurityGroups/flowLogs'))), parameters('networkWatcherRG'), split(first(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id')), '/')[4])]\"\r\n                    },\r\n                    \"networkWatcherName\": {\r\n                      \"value\": \"[if(empty(coalesce(field('Microsoft.Network/networkSecurityGroups/flowLogs'))), parameters('networkWatcherName'), split(first(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id')), '/')[8])]\"\r\n                    },\r\n                    \"flowlogName\": {\r\n                      \"value\": \"[if(empty(coalesce(field('Microsoft.Network/networkSecurityGroups/flowLogs'))), concat(field('name'), '-', resourceGroup().name, '-', 'flowlog'), split(first(field('Microsoft.Network/networkSecurityGroups/flowLogs[*].id')), '/')[10])]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"targetResource\": {\r\n                      \"value\": \"[concat(resourceGroup().id, '/providers/Microsoft.Network/networkSecurityGroups/', field('name'))]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5e1cd26a-5090-4fdb-9d6a-84a90335e22d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5e1cd26a-5090-4fdb-9d6a-84a90335e22d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Public network access should be disabled for PostgreSQL flexible servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disabling the public network access property improves security by ensuring your Azure Database for PostgreSQL flexible servers can only be accessed from a private endpoint. This configuration strictly disables access from any public address space outside of Azure IP range and denies all logins that match IP or virtual network-based firewall rules.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DBforPostgreSQL/flexibleServers\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DBforPostgreSQL/flexibleServers/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5e1de0e3-42cb-4ebc-a86d-61d0c619ca48\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5e1de0e3-42cb-4ebc-a86d-61d0c619ca48\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Audit Web Applications that are not using latest supported .NET Framework\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use the latest supported .NET Framework version for the latest security classes. Using older classes and types can make your application vulnerable.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyof\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"WebApp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UseLatestDotNet\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"in\": [\r\n                  \"OffByPolicy\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5e3315e0-a414-4efb-a4d2-c7bd2b0443d2\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5e3315e0-a414-4efb-a4d2-c7bd2b0443d2\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs that do not have the specified applications installed\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that do not have the specified applications installed. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WhitelistedApplication\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5e393799-e3ca-4e43-a9a5-0ec4648a57d9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5e393799-e3ca-4e43-a9a5-0ec4648a57d9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Allow resource creation only in India data centers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Allows resource creation in the following locations only: West India, South India, Central India\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"General\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": [\r\n                \"westindia\",\r\n                \"southindia\",\r\n                \"centralindia\"\r\n              ]\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5ee85ce5-e7eb-44d6-b4a2-32a24be1ca54\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5ee85ce5-e7eb-44d6-b4a2-32a24be1ca54\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Log Analytics agent for Linux virtual machine scale sets\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Log Analytics agent for Linux virtual machine scale sets if the VM Image (OS) is in the list defined and the agent is not installed. Note: if your scale set upgradePolicy is set to Manual, you need to apply the extension to the all VMs in the set by calling upgrade on them. In CLI this would be az vmss update-instances.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"listOfImageIdToInclude\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Linux OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageId\",\r\n                    \"in\": \"[parameters('listOfImageIdToInclude')]\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-SAP-HANA\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"8*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"allOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                \"in\": [\r\n                                  \"SLES\",\r\n                                  \"SLES-HPC\",\r\n                                  \"SLES-HPC-Priority\",\r\n                                  \"SLES-SAP\",\r\n                                  \"SLES-SAP-BYOS\",\r\n                                  \"SLES-Priority\",\r\n                                  \"SLES-BYOS\",\r\n                                  \"SLES-SAPCAL\",\r\n                                  \"SLES-Standard\"\r\n                                ]\r\n                              },\r\n                              {\r\n                                \"anyOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"like\": \"12*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"like\": \"15*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"allOf\": [\r\n                              {\r\n                                \"anyOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"like\": \"sles-12-sp*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"like\": \"sles-15-sp*\"\r\n                                  }\r\n                                ]\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"in\": [\r\n                                  \"gen1\",\r\n                                  \"gen2\"\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"UbuntuServer\",\r\n                          \"0001-com-ubuntu-server-focal\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"14.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"16.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"16_04*lts-gen2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"18.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"18_04*lts-gen2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"20_04*lts\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"20_04*lts-gen2\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"credativ\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Debian\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"8*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"9*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Oracle\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Oracle-Linux\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7.*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"CentOS\",\r\n                          \"Centos-LVM\",\r\n                          \"CentOS-SRIOV\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"8*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-centos-os\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"like\": \"7*\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\r\n                    \"equals\": \"OmsAgentForLinux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"OMSAgentForLinux\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.EnterpriseCloud.Monitoring\",\r\n                      \"vmExtensionType\": \"OmsAgentForLinux\",\r\n                      \"vmExtensionTypeHandlerVersion\": \"1.13\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"typeHandlerVersion\": \"[variables('vmExtensionTypeHandlerVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"workspaceId\": \"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\",\r\n                            \"stopOnMultipleConnections\": \"true\"\r\n                          },\r\n                          \"protectedSettings\": {\r\n                            \"workspaceKey\": \"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"\r\n                          }\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for: ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5ee9e9ed-0b42-41b7-8c9c-3cfb2fbe2069\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5ee9e9ed-0b42-41b7-8c9c-3cfb2fbe2069\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Private endpoint should be configured for Key Vault\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private link provides a way to connect Key Vault to your Azure resources without sending traffic over the public internet. Private link provides defense in depth protection against data exfiltration.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.0-preview\",\r\n          \"category\": \"Key Vault\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.KeyVault/vaults\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.KeyVault/vaults/privateEndpointConnections\",\r\n                    \"exists\": \"false\"\r\n                  },\r\n                  {\r\n                    \"count\": {\r\n                      \"field\": \"Microsoft.KeyVault/vaults/privateEndpointConnections[*]\"\r\n                    },\r\n                    \"equals\": 0\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5f0bc445-3935-4915-9981-011aa2b46147\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5f0bc445-3935-4915-9981-011aa2b46147\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Machine Learning workspaces should use user-assigned managed identity\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Manange access to Azure ML workspace and associated resources, Azure Container Registry, KeyVault, Storage, and App Insights using user-assigned managed identity. By default, system-assigned managed identity is used by Azure ML workspace to access the associated resources. User-assigned managed identity allows you to create the identity as an Azure resource and maintain the life cycle of that identity. Learn more at https://docs.microsoft.com/azure/machine-learning/how-to-use-managed-identities?tabs=python.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Machine Learning\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.MachineLearningServices/workspaces\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.MachineLearningServices/workspaces/primaryUserAssignedIdentity\",\r\n                    \"exists\": false\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.MachineLearningServices/workspaces/primaryUserAssignedIdentity\",\r\n                    \"equals\": \"\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5f0c7d88-c7de-45b8-ac49-db49e72eaa78\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5f0c7d88-c7de-45b8-ac49-db49e72eaa78\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Vulnerabilities in Azure Container Registry images should be remediated\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Container image vulnerability assessment scans your registry for security vulnerabilities on each pushed container image and exposes detailed findings for each image (powered by Qualys). Resolving the vulnerabilities can greatly improve your containers' security posture and protect them from attacks.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.ContainerRegistry/registries\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"dbd0cb49-b563-45e7-9724-889e799fa648\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5f0f936f-2f01-4bf5-b6be-d423792fa562\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5f0f936f-2f01-4bf5-b6be-d423792fa562\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"External accounts with read permissions should be removed from your subscription\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"External accounts with read privileges should be removed from your subscription in order to prevent unmonitored access.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"a8c6a4ad-d51e-88fe-2979-d3ee3c864f8b\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5f76cf89-fbf2-47fd-a3f4-b891fa780b60\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5f76cf89-fbf2-47fd-a3f4-b891fa780b60\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Configure supported Linux virtual machines to automatically install the Azure Security agent\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Configure supported Linux virtual machines to automatically install the Azure Security agent. Security Center collects events from the agent and uses them to provide security alerts and tailored hardening tasks (recommendations). Create a resource group and Log Analytics workspace in the same region as the virtual machine to store audit records. Target virtual machines must be in a supported location.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"version\": \"2.0.0-preview\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"in\": [\r\n                  \"australiacentral\",\r\n                  \"australiaeast\",\r\n                  \"australiasoutheast\",\r\n                  \"centralindia\",\r\n                  \"centralus\",\r\n                  \"eastasia\",\r\n                  \"eastus\",\r\n                  \"eastus2\",\r\n                  \"germanywestcentral\",\r\n                  \"japaneast\",\r\n                  \"northcentralus\",\r\n                  \"northeurope\",\r\n                  \"southcentralus\",\r\n                  \"southeastasia\",\r\n                  \"uksouth\",\r\n                  \"westcentralus\",\r\n                  \"westeurope\",\r\n                  \"westus\",\r\n                  \"westus2\"\r\n                ]\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-SAP-HANA\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"SLES\",\r\n                          \"SLES-HPC\",\r\n                          \"SLES-HPC-Priority\",\r\n                          \"SLES-SAP\",\r\n                          \"SLES-SAP-BYOS\",\r\n                          \"SLES-Priority\",\r\n                          \"SLES-BYOS\",\r\n                          \"SLES-SAPCAL\",\r\n                          \"SLES-Standard\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"12*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"14.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"16.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"18.04*LTS\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Oracle\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Oracle-Linux\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"7.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"CentOS\",\r\n                          \"Centos-LVM\",\r\n                          \"CentOS-SRIOV\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-centos-os\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"like\": \"7*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"credativ\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"debian\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"8\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSku\",\r\n                            \"like\": \"9\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Debian\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"debian-10\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"like\": \"10\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"allOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"equals\": \"Canonical\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                \"equals\": \"UbuntuServer\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSku\",\r\n                                \"like\": \"18_04-lts-gen2\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"allOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"equals\": \"Canonical\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                \"equals\": \"0001-com-ubuntu-server-focal\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSku\",\r\n                                \"like\": \"20_04-lts-gen2\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"allOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"equals\": \"RedHat\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                \"equals\": \"RHEL\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSku\",\r\n                                \"like\": \"83-gen2\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"allOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"equals\": \"SUSE\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                \"equals\": \"SLES-15-SP2\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSku\",\r\n                                \"like\": \"gen2\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings\",\r\n                        \"exists\": \"true\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"AzureSecurityLinuxAgent\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/Publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Security.Monitoring\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"in\": [\r\n                      \"Succeeded\",\r\n                      \"Provisioning succeeded\"\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"deploymentScope\": \"subscription\",\r\n              \"deployment\": {\r\n                \"location\": \"eastus\",\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"resourceGroup\": {\r\n                      \"value\": \"[resourceGroup().name]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"resourceGroup\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"pairedLocations\": {\r\n                        \"australiacentral\": \"australiacentral\",\r\n                        \"australiaeast\": \"australiaeast\",\r\n                        \"australiasoutheast\": \"australiasoutheast\",\r\n                        \"centralindia\": \"centralindia\",\r\n                        \"centralus\": \"centralus\",\r\n                        \"eastasia\": \"eastasia\",\r\n                        \"eastus\": \"eastus\",\r\n                        \"eastus2\": \"eastus2\",\r\n                        \"germanywestcentral\": \"germanywestcentral\",\r\n                        \"japaneast\": \"japaneast\",\r\n                        \"northcentralus\": \"northcentralus\",\r\n                        \"northeurope\": \"northeurope\",\r\n                        \"southcentralus\": \"southcentralus\",\r\n                        \"southeastasia\": \"southeastasia\",\r\n                        \"uksouth\": \"uksouth\",\r\n                        \"westcentralus\": \"westcentralus\",\r\n                        \"westeurope\": \"westeurope\",\r\n                        \"westus\": \"westus\",\r\n                        \"westus2\": \"westus2\"\r\n                      },\r\n                      \"locationLongNameToShortMap\": {\r\n                        \"australiacentral\": \"CAU\",\r\n                        \"australiaeast\": \"EAU\",\r\n                        \"australiasoutheast\": \"SEAU\",\r\n                        \"centralindia\": \"CIN\",\r\n                        \"centralus\": \"CUS\",\r\n                        \"eastasia\": \"EA\",\r\n                        \"eastus\": \"EUS\",\r\n                        \"eastus2\": \"EUS2\",\r\n                        \"germanywestcentral\": \"DEWC\",\r\n                        \"japaneast\": \"EJP\",\r\n                        \"northcentralus\": \"NCUS\",\r\n                        \"northeurope\": \"NEU\",\r\n                        \"southcentralus\": \"SCUS\",\r\n                        \"southeastasia\": \"SEA\",\r\n                        \"uksouth\": \"SUK\",\r\n                        \"westcentralus\": \"WCUS\",\r\n                        \"westeurope\": \"WEU\",\r\n                        \"westus\": \"WUS\",\r\n                        \"westus2\": \"WUS2\"\r\n                      },\r\n                      \"locationCode\": \"[variables('locationLongNameToShortMap')[variables('pairedLocations')[parameters('location')]]]\",\r\n                      \"subscriptionId\": \"[subscription().subscriptionId]\",\r\n                      \"defaultRGName\": \"[concat('DefaultResourceGroup-', variables('locationCode'))]\",\r\n                      \"defaultRGLocation\": \"[variables('pairedLocations')[parameters('location')]]\",\r\n                      \"workspaceName\": \"[concat('defaultWorkspace-', variables('subscriptionId'),'-', variables('locationCode'))]\",\r\n                      \"dcrName\": \"[concat('Microsoft-Security-', variables('locationCode'), '-dcr')]\",\r\n                      \"dcrId\": \"[concat('/subscriptions/', variables('subscriptionId'), '/resourceGroups/', variables('defaultRGName'), '/providers/Microsoft.Insights/dataCollectionRules/', variables('dcrName'))]\",\r\n                      \"dcraName\": \"[concat(parameters('vmName'),'/Microsoft.Insights/Security-RulesAssociation')]\",\r\n                      \"deployAzureSecurityLinuxAgent\": \"[concat('deployAzureSecurityLinuxAgent-', uniqueString(deployment().name))]\",\r\n                      \"deployDefaultAscResourceGroup\": \"[concat('deployDefaultAscResourceGroup-', uniqueString(deployment().name))]\",\r\n                      \"deployDataCollectionRulesAssociation\": \"[concat('deployDataCollectionRulesAssociation-', uniqueString(deployment().name))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('deployAzureSecurityLinuxAgent')]\",\r\n                        \"apiVersion\": \"2020-06-01\",\r\n                        \"resourceGroup\": \"[parameters('resourceGroup')]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"expressionEvaluationOptions\": {\r\n                            \"scope\": \"inner\"\r\n                          },\r\n                          \"parameters\": {\r\n                            \"location\": {\r\n                              \"value\": \"[parameters('location')]\"\r\n                            },\r\n                            \"vmName\": {\r\n                              \"value\": \"[parameters('vmName')]\"\r\n                            }\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"location\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"vmName\": {\r\n                                \"type\": \"string\"\r\n                              }\r\n                            },\r\n                            \"variables\": {},\r\n                            \"resources\": [\r\n                              {\r\n                                \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                                \"name\": \"[concat(parameters('vmName'), '/', 'AzureSecurityLinuxAgent')]\",\r\n                                \"apiVersion\": \"2019-03-01\",\r\n                                \"location\": \"[parameters('location')]\",\r\n                                \"properties\": {\r\n                                  \"publisher\": \"Microsoft.Azure.Security.Monitoring\",\r\n                                  \"type\": \"AzureSecurityLinuxAgent\",\r\n                                  \"typeHandlerVersion\": \"2.0\",\r\n                                  \"autoUpgradeMinorVersion\": \"true\",\r\n                                  \"settings\": {},\r\n                                  \"protectedsettings\": {}\r\n                                }\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                        \"name\": \"[variables('defaultRGName')]\",\r\n                        \"apiVersion\": \"2019-05-01\",\r\n                        \"location\": \"[variables('defaultRGLocation')]\"\r\n                      },\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('deployDefaultAscResourceGroup')]\",\r\n                        \"apiVersion\": \"2020-06-01\",\r\n                        \"resourceGroup\": \"[variables('defaultRGName')]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"expressionEvaluationOptions\": {\r\n                            \"scope\": \"inner\"\r\n                          },\r\n                          \"parameters\": {\r\n                            \"defaultRGLocation\": {\r\n                              \"value\": \"[variables('defaultRGLocation')]\"\r\n                            },\r\n                            \"workspaceName\": {\r\n                              \"value\": \"[variables('workspaceName')]\"\r\n                            },\r\n                            \"dcrName\": {\r\n                              \"value\": \"[variables('dcrName')]\"\r\n                            }\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"defaultRGLocation\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"workspaceName\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"dcrName\": {\r\n                                \"type\": \"string\"\r\n                              }\r\n                            },\r\n                            \"variables\": {\r\n                              \"securitySolution\": {\r\n                                \"Name\": \"[Concat('Security', '(', parameters('workspaceName'), ')')]\",\r\n                                \"GalleryName\": \"Security\"\r\n                              },\r\n                              \"securityCenterFreeSolution\": {\r\n                                \"Name\": \"[Concat('SecurityCenterFree', '(', parameters('workspaceName'), ')')]\",\r\n                                \"GalleryName\": \"SecurityCenterFree\"\r\n                              }\r\n                            },\r\n                            \"resources\": [\r\n                              {\r\n                                \"type\": \"Microsoft.OperationalInsights/workspaces\",\r\n                                \"name\": \"[parameters('workspaceName')]\",\r\n                                \"apiVersion\": \"2015-11-01-preview\",\r\n                                \"location\": \"[parameters('defaultRGLocation')]\",\r\n                                \"properties\": {\r\n                                  \"sku\": {\r\n                                    \"name\": \"pernode\"\r\n                                  },\r\n                                  \"retentionInDays\": 30,\r\n                                  \"features\": {\r\n                                    \"searchVersion\": 1\r\n                                  }\r\n                                }\r\n                              },\r\n                              {\r\n                                \"type\": \"Microsoft.OperationsManagement/solutions\",\r\n                                \"name\": \"[variables('securitySolution').Name]\",\r\n                                \"apiVersion\": \"2015-11-01-preview\",\r\n                                \"location\": \"[parameters('defaultRGLocation')]\",\r\n                                \"dependsOn\": [\r\n                                  \"[parameters('workspaceName')]\"\r\n                                ],\r\n                                \"properties\": {\r\n                                  \"workspaceResourceId\": \"[resourceId('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]\"\r\n                                },\r\n                                \"plan\": {\r\n                                  \"name\": \"[variables('securitySolution').Name]\",\r\n                                  \"publisher\": \"Microsoft\",\r\n                                  \"product\": \"[Concat('OMSGallery/', variables('securitySolution').GalleryName)]\",\r\n                                  \"promotionCode\": \"\"\r\n                                }\r\n                              },\r\n                              {\r\n                                \"type\": \"Microsoft.OperationsManagement/solutions\",\r\n                                \"name\": \"[variables('securityCenterFreeSolution').Name]\",\r\n                                \"apiVersion\": \"2015-11-01-preview\",\r\n                                \"location\": \"[parameters('defaultRGLocation')]\",\r\n                                \"dependsOn\": [\r\n                                  \"[parameters('workspaceName')]\"\r\n                                ],\r\n                                \"properties\": {\r\n                                  \"workspaceResourceId\": \"[resourceId('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]\"\r\n                                },\r\n                                \"plan\": {\r\n                                  \"name\": \"[variables('securityCenterFreeSolution').Name]\",\r\n                                  \"publisher\": \"Microsoft\",\r\n                                  \"product\": \"[Concat('OMSGallery/', variables('securityCenterFreeSolution').GalleryName)]\",\r\n                                  \"promotionCode\": \"\"\r\n                                }\r\n                              },\r\n                              {\r\n                                \"type\": \"Microsoft.Insights/dataCollectionRules\",\r\n                                \"name\": \"[parameters('dcrName')]\",\r\n                                \"apiVersion\": \"2019-11-01-preview\",\r\n                                \"location\": \"[parameters('defaultRGLocation')]\",\r\n                                \"dependsOn\": [\r\n                                  \"[parameters('workspaceName')]\"\r\n                                ],\r\n                                \"properties\": {\r\n                                  \"description\": \"Data collection rule for Azure Security Center. Deleting this rule will break the detection of security vulnerabilities.\",\r\n                                  \"dataSources\": {\r\n                                    \"windowsEventLogs\": [\r\n                                      {\r\n                                        \"name\": \"RomeDetectionEventDataSource\",\r\n                                        \"streams\": [\r\n                                          \"Microsoft-RomeDetectionEvent\"\r\n                                        ],\r\n                                        \"scheduledTransferPeriod\": \"PT5M\",\r\n                                        \"xPathQueries\": [\r\n                                          \"Security!*\",\r\n                                          \"Microsoft-Windows-AppLocker/EXE and DLL!*\"\r\n                                        ]\r\n                                      }\r\n                                    ],\r\n                                    \"syslog\": [\r\n                                      {\r\n                                        \"name\": \"SyslogDataSource\",\r\n                                        \"streams\": [\r\n                                          \"Microsoft-Syslog\"\r\n                                        ],\r\n                                        \"facilityNames\": [\r\n                                          \"kern\",\r\n                                          \"auth\",\r\n                                          \"authpriv\",\r\n                                          \"cron\",\r\n                                          \"user\",\r\n                                          \"daemon\",\r\n                                          \"syslog\",\r\n                                          \"local0\"\r\n                                        ],\r\n                                        \"logLevels\": [\r\n                                          \"Debug\",\r\n                                          \"Critical\",\r\n                                          \"Emergency\"\r\n                                        ]\r\n                                      }\r\n                                    ],\r\n                                    \"extensions\": [\r\n                                      {\r\n                                        \"extensionName\": \"AzureSecurityLinuxAgent\",\r\n                                        \"name\": \"AscLinuxDataSource\",\r\n                                        \"streams\": [\r\n                                          \"Microsoft-OperationLog\",\r\n                                          \"Microsoft-SecurityBaseline\",\r\n                                          \"Microsoft-SecurityBaselineSummary\",\r\n                                          \"Microsoft-ProcessInvestigator\",\r\n                                          \"Microsoft-Auditd\",\r\n                                          \"Microsoft-ProtectionStatus\",\r\n                                          \"Microsoft-Heartbeat\"\r\n                                        ],\r\n                                        \"extensionSettings\": {\r\n                                          \"scanners\": [\r\n                                            {\r\n                                              \"name\": \"heartbeat\",\r\n                                              \"frequency\": \"PT1H\"\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"time\",\r\n                                              \"frequency\": \"PT8H\"\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"antimalware\",\r\n                                              \"frequency\": \"PT8H\"\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"codeintegrity\",\r\n                                              \"frequency\": \"P1D\"\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"processinvestigator\",\r\n                                              \"frequency\": \"PT1H\"\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"baseline\",\r\n                                              \"frequency\": \"P1D\",\r\n                                              \"options\": [\r\n                                                {\r\n                                                  \"name\": \"Baseline\",\r\n                                                  \"value\": \"Azure.Ubuntu\"\r\n                                                },\r\n                                                {\r\n                                                  \"name\": \"AscBaseline\",\r\n                                                  \"value\": \"OMS.Linux\"\r\n                                                }\r\n                                              ]\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"docker\",\r\n                                              \"frequency\": \"P1D\",\r\n                                              \"options\": [\r\n                                                {\r\n                                                  \"name\": \"Baseline\",\r\n                                                  \"value\": \"Azure.Docker.Linux\"\r\n                                                },\r\n                                                {\r\n                                                  \"name\": \"AscBaseline\",\r\n                                                  \"value\": \"OMS.Docker.Linux\"\r\n                                                }\r\n                                              ]\r\n                                            }\r\n                                          ]\r\n                                        }\r\n                                      },\r\n                                      {\r\n                                        \"extensionName\": \"AzureSecurityWindowsAgent\",\r\n                                        \"name\": \"AsaWindowsDataSource\",\r\n                                        \"streams\": [\r\n                                          \"Microsoft-OperationLog\",\r\n                                          \"Microsoft-SecurityBaseline\",\r\n                                          \"Microsoft-ProcessInvestigator\",\r\n                                          \"Microsoft-ProtectionStatus\",\r\n                                          \"Microsoft-SecurityBaselineSummary\"\r\n                                        ],\r\n                                        \"extensionSettings\": {\r\n                                          \"scanners\": [\r\n                                            {\r\n                                              \"name\": \"heartbeat\",\r\n                                              \"frequency\": \"PT1H\"\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"baseline\",\r\n                                              \"frequency\": \"P1D\"\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"antimalware\",\r\n                                              \"frequency\": \"P1D\"\r\n                                            },\r\n                                            {\r\n                                              \"name\": \"processinvestigator\",\r\n                                              \"frequency\": \"PT1H\"\r\n                                            }\r\n                                          ]\r\n                                        }\r\n                                      }\r\n                                    ]\r\n                                  },\r\n                                  \"destinations\": {\r\n                                    \"logAnalytics\": [\r\n                                      {\r\n                                        \"workspaceResourceId\": \"[resourceId('Microsoft.OperationalInsights/workspaces/', parameters('workspaceName'))]\",\r\n                                        \"name\": \"LogAnalyticsDest\"\r\n                                      }\r\n                                    ]\r\n                                  },\r\n                                  \"dataFlows\": [\r\n                                    {\r\n                                      \"streams\": [\r\n                                        \"Microsoft-Syslog\",\r\n                                        \"Microsoft-OperationLog\",\r\n                                        \"Microsoft-SecurityBaseline\",\r\n                                        \"Microsoft-SecurityBaselineSummary\",\r\n                                        \"Microsoft-RomeDetectionEvent\",\r\n                                        \"Microsoft-ProcessInvestigator\",\r\n                                        \"Microsoft-Auditd\",\r\n                                        \"Microsoft-ProtectionStatus\",\r\n                                        \"Microsoft-Heartbeat\"\r\n                                      ],\r\n                                      \"destinations\": [\r\n                                        \"LogAnalyticsDest\"\r\n                                      ]\r\n                                    }\r\n                                  ]\r\n                                }\r\n                              }\r\n                            ]\r\n                          }\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[resourceId('Microsoft.Resources/resourceGroups', variables('defaultRGName'))]\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('deployDataCollectionRulesAssociation')]\",\r\n                        \"apiVersion\": \"2020-06-01\",\r\n                        \"resourceGroup\": \"[parameters('resourceGroup')]\",\r\n                        \"dependsOn\": [\r\n                          \"[variables('deployDefaultAscResourceGroup')]\"\r\n                        ],\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"expressionEvaluationOptions\": {\r\n                            \"scope\": \"inner\"\r\n                          },\r\n                          \"parameters\": {\r\n                            \"location\": {\r\n                              \"value\": \"[parameters('location')]\"\r\n                            },\r\n                            \"vmName\": {\r\n                              \"value\": \"[parameters('vmName')]\"\r\n                            },\r\n                            \"dcrId\": {\r\n                              \"value\": \"[variables('dcrId')]\"\r\n                            },\r\n                            \"dcraName\": {\r\n                              \"value\": \"[variables('dcraName')]\"\r\n                            }\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"location\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"vmName\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"dcrId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"dcraName\": {\r\n                                \"type\": \"string\"\r\n                              }\r\n                            },\r\n                            \"variables\": {},\r\n                            \"resources\": [\r\n                              {\r\n                                \"type\": \"Microsoft.Compute/virtualMachines/providers/dataCollectionRuleAssociations\",\r\n                                \"name\": \"[parameters('dcraName')]\",\r\n                                \"apiVersion\": \"2019-11-01-preview\",\r\n                                \"properties\": {\r\n                                  \"description\": \"Association of data collection rule for Azure Security Center. Deleting this association will break the detection of security vulnerabilities for this virtual machine.\",\r\n                                  \"dataCollectionRuleId\": \"[parameters('dcrId')]\"\r\n                                }\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5f8eb305-9c9f-4abe-9bb0-df220d9faba2\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5f8eb305-9c9f-4abe-9bb0-df220d9faba2\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Audit Windows virtual machines on which the Windows Guest Configuration extension is not enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy audits Windows virtual machines hosted in Azure that are supported by Guest Configuration but do not have the Guest Configuration extension enabled. For more information on Guest Configuration, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                    \"in\": [\r\n                      \"esri\",\r\n                      \"incredibuild\",\r\n                      \"MicrosoftDynamicsAX\",\r\n                      \"MicrosoftSharepoint\",\r\n                      \"MicrosoftVisualStudio\",\r\n                      \"MicrosoftWindowsDesktop\",\r\n                      \"MicrosoftWindowsServerHPCPack\"\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"notLike\": \"2008*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"notLike\": \"SQL2008*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-dsvm\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"dsvm-windows\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"standard-data-science-vm\",\r\n                          \"windows-data-science-vm\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"batch\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"rendering-windows2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"center-for-internet-security-inc\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"cis-windows-server-201*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"pivotal\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"bosh-windows-server*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloud-infrastructure-services\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"like\": \"ad*\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                            \"exists\": \"true\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                            \"like\": \"Windows*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"exists\": \"false\"\r\n                          },\r\n                          {\r\n                            \"allOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"notLike\": \"2008*\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                \"notLike\": \"SQL2008*\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"name\": \"AzurePolicyforWindows\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.GuestConfiguration\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"ConfigurationforWindows\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5fc23db3-dd4d-4c56-bcc7-43626243e601\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5fc23db3-dd4d-4c56-bcc7-43626243e601\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Add or replace a tag on resources\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Adds or replaces the specified tag and value when any resource is created or updated. Existing resources can be remediated by triggering a remediation task. Does not modify tags on resource groups.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Tags\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            }\r\n          },\r\n          \"tagValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Value\",\r\n              \"description\": \"Value of the tag, such as 'production'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n            \"notEquals\": \"[parameters('tagValue')]\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"modify\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"operations\": [\r\n                {\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                  \"value\": \"[parameters('tagValue')]\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5ffd78d9-436d-4b41-a421-5baa819e3008\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5ffd78d9-436d-4b41-a421-5baa819e3008\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Configure supported Linux virtual machines to automatically install the Guest Attestation extension\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Configure supported Linux virtual machines to automatically install the Guest Attestation extension to allow Azure Security Center to proactively attest and monitor the boot integrity. Boot integrity is attested via Remote Attestation.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"version\": \"1.0.0-preview\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"like\": \"18_04-lts-gen2\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"0001-com-ubuntu-server-focal\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"like\": \"20_04-lts-gen2\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"RHEL\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"like\": \"83-gen2\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"SLES-15-SP2\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"like\": \"gen2\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings\",\r\n                \"exists\": \"true\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings.vTpmEnabled\",\r\n                \"equals\": \"true\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings.secureBootEnabled\",\r\n                \"equals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Security.LinuxAttestation\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"GuestAttestation\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"in\": [\r\n                      \"Succeeded\",\r\n                      \"Provisioning succeeded\"\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"extensionName\": \"GuestAttestation\",\r\n                      \"extensionPublisher\": \"Microsoft.Azure.Security.LinuxAttestation\",\r\n                      \"extensionVersion\": \"1.0\",\r\n                      \"maaTenantName\": \"GuestAttestation\",\r\n                      \"ascReportingEndpoint\": \"https://eus2.service.attest.azure.net/\",\r\n                      \"maaEndpoint\": \"https://sharedeus2.eus2.attest.azure.net/\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"apiVersion\": \"2018-10-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('extensionName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('extensionPublisher')]\",\r\n                          \"type\": \"[variables('extensionName')]\",\r\n                          \"typeHandlerVersion\": \"[variables('extensionVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"AttestationConfig\": {\r\n                              \"MaaSettings\": {\r\n                                \"maaEndpoint\": \"[variables('maaEndpoint')]\",\r\n                                \"maaTenantName\": \"[variables('maaTenantName')]\"\r\n                              },\r\n                              \"AscSettings\": {\r\n                                \"ascReportingEndpoint\": \"[variables('ascReportingEndpoint')]\",\r\n                                \"ascReportingFrequency\": \"\"\r\n                              },\r\n                              \"useCustomToken\": \"false\",\r\n                              \"disableAlerts\": \"false\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6074e9a3-c711-4856-976d-24d51f9e065b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6074e9a3-c711-4856-976d-24d51f9e065b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs configurations in 'System Audit Policies - Object Access'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Object Access'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SystemAuditPoliciesObjectAccess\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/60aeaf73-a074-417a-905f-7ce9df0ff77b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"60aeaf73-a074-417a-905f-7ce9df0ff77b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Storage Accounts should use a virtual network service endpoint\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy audits any Storage Account not configured to use a virtual network service endpoint.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Storage/storageAccounts/networkAcls.defaultAction\",\r\n                    \"notEquals\": \"Deny\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Storage/storageAccounts/networkAcls.virtualNetworkRules[*].id\",\r\n                    \"exists\": \"false\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/60d21c4f-21a3-4d94-85f4-b924e6aeeda4\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"60d21c4f-21a3-4d94-85f4-b924e6aeeda4\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows web servers that are not using secure communication protocols\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows web servers that are not using secure communication protocols (TLS 1.1 or TLS 1.2). For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AuditSecureProtocol\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/60ffe3e2-4604-4460-8f22-0f1da058266c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"60ffe3e2-4604-4460-8f22-0f1da058266c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Advanced Data Security on SQL servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy enables Advanced Data Security on SQL Servers. This includes turning on Threat Detection and Vulnerability Assessment. It will automatically create a storage account in the same region and resource group as the SQL server to store scan results, with a 'sqlva' prefix.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.0\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"DeployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/securityAlertPolicies\",\r\n              \"name\": \"Default\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Sql/securityAlertPolicies.state\",\r\n                \"equals\": \"Enabled\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/056cd41c-7e88-42e1-933e-88ba6a50c9c3\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/17d1049b-9a84-46fb-8f53-869881c3d3ab\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"serverName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"serverResourceGroupName\": \"[resourceGroup().name]\",\r\n                      \"subscriptionId\": \"[subscription().subscriptionId]\",\r\n                      \"uniqueStorage\": \"[uniqueString(variables('subscriptionId'), variables('serverResourceGroupName'), parameters('location'))]\",\r\n                      \"storageName\": \"[tolower(concat('sqlva', variables('uniqueStorage')))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Storage/storageAccounts\",\r\n                        \"name\": \"[variables('storageName')]\",\r\n                        \"apiVersion\": \"2019-04-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"sku\": {\r\n                          \"name\": \"Standard_LRS\"\r\n                        },\r\n                        \"kind\": \"StorageV2\",\r\n                        \"properties\": {\r\n                          \"minimumTlsVersion\": \"TLS1_2\"\r\n                        }\r\n                      },\r\n                      {\r\n                        \"name\": \"[concat(parameters('serverName'), '/Default')]\",\r\n                        \"type\": \"Microsoft.Sql/servers/securityAlertPolicies\",\r\n                        \"apiVersion\": \"2017-03-01-preview\",\r\n                        \"properties\": {\r\n                          \"state\": \"Enabled\",\r\n                          \"emailAccountAdmins\": true\r\n                        }\r\n                      },\r\n                      {\r\n                        \"name\": \"[concat(parameters('serverName'), '/Default')]\",\r\n                        \"type\": \"Microsoft.Sql/servers/vulnerabilityAssessments\",\r\n                        \"apiVersion\": \"2018-06-01-preview\",\r\n                        \"properties\": {\r\n                          \"storageContainerPath\": \"[concat(reference(resourceId('Microsoft.Storage/storageAccounts', variables('storageName'))).primaryEndpoints.blob, 'vulnerability-assessment')]\",\r\n                          \"storageAccountAccessKey\": \"[listKeys(resourceId('Microsoft.Storage/storageAccounts', variables('storageName')), '2018-02-01').keys[0].value]\",\r\n                          \"recurringScans\": {\r\n                            \"isEnabled\": true,\r\n                            \"emailSubscriptionAdmins\": true,\r\n                            \"emails\": []\r\n                          }\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Storage/storageAccounts/', variables('storageName'))]\",\r\n                          \"[concat('Microsoft.Sql/servers/', parameters('serverName'), '/securityAlertPolicies/Default')]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"serverName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6134c3db-786f-471e-87bc-8f479dc890f6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6134c3db-786f-471e-87bc-8f479dc890f6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure time zone on Windows machines.\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to set specified time zone on Windows virtual machines.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.0\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ]\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"TimeZone\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Time zone\",\r\n              \"description\": \"The expected time zone\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"(UTC-12:00) International Date Line West\",\r\n              \"(UTC-11:00) Coordinated Universal Time-11\",\r\n              \"(UTC-10:00) Aleutian Islands\",\r\n              \"(UTC-10:00) Hawaii\",\r\n              \"(UTC-09:30) Marquesas Islands\",\r\n              \"(UTC-09:00) Alaska\",\r\n              \"(UTC-09:00) Coordinated Universal Time-09\",\r\n              \"(UTC-08:00) Baja California\",\r\n              \"(UTC-08:00) Coordinated Universal Time-08\",\r\n              \"(UTC-08:00) Pacific Time (US & Canada)\",\r\n              \"(UTC-07:00) Arizona\",\r\n              \"(UTC-07:00) Chihuahua, La Paz, Mazatlan\",\r\n              \"(UTC-07:00) Mountain Time (US & Canada)\",\r\n              \"(UTC-06:00) Central America\",\r\n              \"(UTC-06:00) Central Time (US & Canada)\",\r\n              \"(UTC-06:00) Easter Island\",\r\n              \"(UTC-06:00) Guadalajara, Mexico City, Monterrey\",\r\n              \"(UTC-06:00) Saskatchewan\",\r\n              \"(UTC-05:00) Bogota, Lima, Quito, Rio Branco\",\r\n              \"(UTC-05:00) Chetumal\",\r\n              \"(UTC-05:00) Eastern Time (US & Canada)\",\r\n              \"(UTC-05:00) Haiti\",\r\n              \"(UTC-05:00) Havana\",\r\n              \"(UTC-05:00) Indiana (East)\",\r\n              \"(UTC-05:00) Turks and Caicos\",\r\n              \"(UTC-04:00) Asuncion\",\r\n              \"(UTC-04:00) Atlantic Time (Canada)\",\r\n              \"(UTC-04:00) Caracas\",\r\n              \"(UTC-04:00) Cuiaba\",\r\n              \"(UTC-04:00) Georgetown, La Paz, Manaus, San Juan\",\r\n              \"(UTC-04:00) Santiago\",\r\n              \"(UTC-03:30) Newfoundland\",\r\n              \"(UTC-03:00) Araguaina\",\r\n              \"(UTC-03:00) Brasilia\",\r\n              \"(UTC-03:00) Cayenne, Fortaleza\",\r\n              \"(UTC-03:00) City of Buenos Aires\",\r\n              \"(UTC-03:00) Greenland\",\r\n              \"(UTC-03:00) Montevideo\",\r\n              \"(UTC-03:00) Punta Arenas\",\r\n              \"(UTC-03:00) Saint Pierre and Miquelon\",\r\n              \"(UTC-03:00) Salvador\",\r\n              \"(UTC-02:00) Coordinated Universal Time-02\",\r\n              \"(UTC-02:00) Mid-Atlantic - Old\",\r\n              \"(UTC-01:00) Azores\",\r\n              \"(UTC-01:00) Cabo Verde Is.\",\r\n              \"(UTC) Coordinated Universal Time\",\r\n              \"(UTC+00:00) Dublin, Edinburgh, Lisbon, London\",\r\n              \"(UTC+00:00) Monrovia, Reykjavik\",\r\n              \"(UTC+00:00) Sao Tome\",\r\n              \"(UTC+01:00) Casablanca\",\r\n              \"(UTC+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna\",\r\n              \"(UTC+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague\",\r\n              \"(UTC+01:00) Brussels, Copenhagen, Madrid, Paris\",\r\n              \"(UTC+01:00) Sarajevo, Skopje, Warsaw, Zagreb\",\r\n              \"(UTC+01:00) West Central Africa\",\r\n              \"(UTC+02:00) Amman\",\r\n              \"(UTC+02:00) Athens, Bucharest\",\r\n              \"(UTC+02:00) Beirut\",\r\n              \"(UTC+02:00) Cairo\",\r\n              \"(UTC+02:00) Chisinau\",\r\n              \"(UTC+02:00) Damascus\",\r\n              \"(UTC+02:00) Gaza, Hebron\",\r\n              \"(UTC+02:00) Harare, Pretoria\",\r\n              \"(UTC+02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius\",\r\n              \"(UTC+02:00) Jerusalem\",\r\n              \"(UTC+02:00) Kaliningrad\",\r\n              \"(UTC+02:00) Khartoum\",\r\n              \"(UTC+02:00) Tripoli\",\r\n              \"(UTC+02:00) Windhoek\",\r\n              \"(UTC+03:00) Baghdad\",\r\n              \"(UTC+03:00) Istanbul\",\r\n              \"(UTC+03:00) Kuwait, Riyadh\",\r\n              \"(UTC+03:00) Minsk\",\r\n              \"(UTC+03:00) Moscow, St. Petersburg\",\r\n              \"(UTC+03:00) Nairobi\",\r\n              \"(UTC+03:30) Tehran\",\r\n              \"(UTC+04:00) Abu Dhabi, Muscat\",\r\n              \"(UTC+04:00) Astrakhan, Ulyanovsk\",\r\n              \"(UTC+04:00) Baku\",\r\n              \"(UTC+04:00) Izhevsk, Samara\",\r\n              \"(UTC+04:00) Port Louis\",\r\n              \"(UTC+04:00) Saratov\",\r\n              \"(UTC+04:00) Tbilisi\",\r\n              \"(UTC+04:00) Volgograd\",\r\n              \"(UTC+04:00) Yerevan\",\r\n              \"(UTC+04:30) Kabul\",\r\n              \"(UTC+05:00) Ashgabat, Tashkent\",\r\n              \"(UTC+05:00) Ekaterinburg\",\r\n              \"(UTC+05:00) Islamabad, Karachi\",\r\n              \"(UTC+05:00) Qyzylorda\",\r\n              \"(UTC+05:30) Chennai, Kolkata, Mumbai, New Delhi\",\r\n              \"(UTC+05:30) Sri Jayawardenepura\",\r\n              \"(UTC+05:45) Kathmandu\",\r\n              \"(UTC+06:00) Astana\",\r\n              \"(UTC+06:00) Dhaka\",\r\n              \"(UTC+06:00) Omsk\",\r\n              \"(UTC+06:30) Yangon (Rangoon)\",\r\n              \"(UTC+07:00) Bangkok, Hanoi, Jakarta\",\r\n              \"(UTC+07:00) Barnaul, Gorno-Altaysk\",\r\n              \"(UTC+07:00) Hovd\",\r\n              \"(UTC+07:00) Krasnoyarsk\",\r\n              \"(UTC+07:00) Novosibirsk\",\r\n              \"(UTC+07:00) Tomsk\",\r\n              \"(UTC+08:00) Beijing, Chongqing, Hong Kong, Urumqi\",\r\n              \"(UTC+08:00) Irkutsk\",\r\n              \"(UTC+08:00) Kuala Lumpur, Singapore\",\r\n              \"(UTC+08:00) Perth\",\r\n              \"(UTC+08:00) Taipei\",\r\n              \"(UTC+08:00) Ulaanbaatar\",\r\n              \"(UTC+08:45) Eucla\",\r\n              \"(UTC+09:00) Chita\",\r\n              \"(UTC+09:00) Osaka, Sapporo, Tokyo\",\r\n              \"(UTC+09:00) Pyongyang\",\r\n              \"(UTC+09:00) Seoul\",\r\n              \"(UTC+09:00) Yakutsk\",\r\n              \"(UTC+09:30) Adelaide\",\r\n              \"(UTC+09:30) Darwin\",\r\n              \"(UTC+10:00) Brisbane\",\r\n              \"(UTC+10:00) Canberra, Melbourne, Sydney\",\r\n              \"(UTC+10:00) Guam, Port Moresby\",\r\n              \"(UTC+10:00) Hobart\",\r\n              \"(UTC+10:00) Vladivostok\",\r\n              \"(UTC+10:30) Lord Howe Island\",\r\n              \"(UTC+11:00) Bougainville Island\",\r\n              \"(UTC+11:00) Chokurdakh\",\r\n              \"(UTC+11:00) Magadan\",\r\n              \"(UTC+11:00) Norfolk Island\",\r\n              \"(UTC+11:00) Sakhalin\",\r\n              \"(UTC+11:00) Solomon Is., New Caledonia\",\r\n              \"(UTC+12:00) Anadyr, Petropavlovsk-Kamchatsky\",\r\n              \"(UTC+12:00) Auckland, Wellington\",\r\n              \"(UTC+12:00) Coordinated Universal Time+12\",\r\n              \"(UTC+12:00) Fiji\",\r\n              \"(UTC+12:00) Petropavlovsk-Kamchatsky - Old\",\r\n              \"(UTC+12:45) Chatham Islands\",\r\n              \"(UTC+13:00) Coordinated Universal Time+13\",\r\n              \"(UTC+13:00) Nuku'alofa\",\r\n              \"(UTC+13:00) Samoa\",\r\n              \"(UTC+14:00) Kiritimati Island\"\r\n            ]\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"SetWindowsTimeZone\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('[WindowsTimeZone]WindowsTimeZone1;TimeZone', '=', parameters('TimeZone')))]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"SetWindowsTimeZone\"\r\n                    },\r\n                    \"TimeZone\": {\r\n                      \"value\": \"[parameters('TimeZone')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"TimeZone\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"assignmentType\": \"DeployAndAutoCorrect\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[WindowsTimeZone]WindowsTimeZone1;TimeZone\",\r\n                                \"value\": \"[parameters('TimeZone')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"assignmentType\": \"DeployAndAutoCorrect\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[WindowsTimeZone]WindowsTimeZone1;TimeZone\",\r\n                                \"value\": \"[parameters('TimeZone')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6141c932-9384-44c6-a395-59e4c057d7c9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6141c932-9384-44c6-a395-59e4c057d7c9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure private endpoints for App Configuration\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoints let you connect your virtual network to Azure services without a public IP address at the source or destination. By mapping private endpoints to your app configuration instances, data leakage risks are reduced. Learn more at: https://aka.ms/appconfig/private-endpoint.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Configuration\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateEndpointSubnetId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private endpoint subnet id\",\r\n              \"description\": \"A subnet with private endpoint network policies disabled.\",\r\n              \"strongType\": \"Microsoft.Network/virtualNetworks/subnets\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.AppConfiguration/configurationStores\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.AppConfiguration/configurationStores/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.AppConfiguration/configurationStores/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"name\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"serviceId\": {\r\n                      \"value\": \"[field('id')]\"\r\n                    },\r\n                    \"privateEndpointSubnetId\": {\r\n                      \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"name\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"serviceId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointSubnetId\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"privateEndpointName\": \"[concat('pe-',substring(parameters('name'),0,min(length(parameters('name')),50)),'-',uniquestring(deployment().name))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('privateEndpointName')]\",\r\n                        \"apiVersion\": \"2020-06-01\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"expressionEvaluationOptions\": {\r\n                            \"scope\": \"inner\"\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"serviceId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"privateEndpointSubnetId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"subnetLocation\": {\r\n                                \"type\": \"string\"\r\n                              }\r\n                            },\r\n                            \"variables\": {\r\n                              \"privateEndpointName\": \"[deployment().name]\"\r\n                            },\r\n                            \"resources\": [\r\n                              {\r\n                                \"name\": \"[variables('privateEndpointName')]\",\r\n                                \"type\": \"Microsoft.Network/privateEndpoints\",\r\n                                \"apiVersion\": \"2020-07-01\",\r\n                                \"location\": \"[parameters('subnetLocation')]\",\r\n                                \"tags\": {},\r\n                                \"properties\": {\r\n                                  \"subnet\": {\r\n                                    \"id\": \"[parameters('privateEndpointSubnetId')]\"\r\n                                  },\r\n                                  \"privateLinkServiceConnections\": [\r\n                                    {\r\n                                      \"name\": \"[variables('privateEndpointName')]\",\r\n                                      \"properties\": {\r\n                                        \"privateLinkServiceId\": \"[parameters('serviceId')]\",\r\n                                        \"groupIds\": [\r\n                                          \"configurationStores\"\r\n                                        ],\r\n                                        \"requestMessage\": \"autoapprove\"\r\n                                      }\r\n                                    }\r\n                                  ],\r\n                                  \"manualPrivateLinkServiceConnections\": []\r\n                                }\r\n                              }\r\n                            ]\r\n                          },\r\n                          \"parameters\": {\r\n                            \"serviceId\": {\r\n                              \"value\": \"[parameters('serviceId')]\"\r\n                            },\r\n                            \"privateEndpointSubnetId\": {\r\n                              \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                            },\r\n                            \"subnetLocation\": {\r\n                              \"value\": \"[reference(first(take(split(parameters('privateEndpointSubnetId'),'/subnets'),1)),'2020-07-01','Full').location]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/614ffa75-862c-456e-ad8b-eaa1b0844b07\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"614ffa75-862c-456e-ad8b-eaa1b0844b07\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Bot Service endpoint should be a valid HTTPS URI\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Data can be tampered with during transmission. Protocols exist that provide encryption to address problems of misuse and tampering. To ensure your bots are communicating only over encrypted channels, set the endpoint to a valid HTTPS URI. This ensures the HTTPS protocol is used to encrypt your data in transit and is also often a requirement for compliance with regulatory or industry standards. Please visit: https://docs.microsoft.com/azure/bot-service/bot-builder-security-guidelines.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"Bot Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The desired effect of the policy.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"audit\",\r\n              \"deny\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.BotService/botServices\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.BotService/botServices/endpoint\",\r\n                \"notLike\": \"https://*\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6164527b-e1ee-4882-8673-572f425f5e0a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6164527b-e1ee-4882-8673-572f425f5e0a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Service Fabric clusters should have the ClusterProtectionLevel property set to EncryptAndSign\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Service Fabric provides three levels of protection (None, Sign and EncryptAndSign) for node-to-node communication using a primary cluster certificate. Set the protection level to ensure that all node-to-node messages are encrypted and digitally signed\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.0\",\r\n          \"category\": \"Service Fabric\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ServiceFabric/clusters\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.ServiceFabric/clusters/fabricSettings[*].name\",\r\n                    \"notEquals\": \"Security\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.ServiceFabric/clusters/fabricSettings[*].parameters[*].name\",\r\n                    \"notEquals\": \"ClusterProtectionLevel\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.ServiceFabric/clusters/fabricSettings[*].parameters[*].value\",\r\n                    \"notEquals\": \"EncryptAndSign\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/617c02be-7f02-4efd-8836-3180d47b6c68\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"617c02be-7f02-4efd-8836-3180d47b6c68\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Add or replace a tag on subscriptions\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Adds or replaces the specified tag and value on subscriptions via a remediation task. Existing resource groups can be remediated by triggering a remediation task. See https://aka.ms/azurepolicyremediation for more information on policy remediation.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Tags\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            }\r\n          },\r\n          \"tagValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Value\",\r\n              \"description\": \"Value of the tag, such as 'production'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Resources/subscriptions\"\r\n              },\r\n              {\r\n                \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                \"notEquals\": \"[parameters('tagValue')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"modify\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/4a9ae827-6dc8-4573-8ac7-8239d42aa03f\"\r\n              ],\r\n              \"operations\": [\r\n                {\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                  \"value\": \"[parameters('tagValue')]\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/61a4d60b-7326-440e-8051-9f94394d4dd1\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"61a4d60b-7326-440e-8051-9f94394d4dd1\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs configurations in 'Security Options - System objects'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - System objects'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsSystemobjects\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/620e58b5-ac75-49b4-993f-a9d4f0459636\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"620e58b5-ac75-49b4-993f-a9d4f0459636\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit Windows machines on which the Log Analytics agent is not connected as expected\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if the agent is not installed, or if it is installed but the COM object AgentConfigManager.MgmtSvcCfg returns that it is registered to a workspace other than the ID specified in the policy parameter.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"WindowsLogAnalyticsAgentConnection\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"WorkspaceId\": \"[LogAnalyticsAgent]LogAnalyticsAgent1;WorkspaceId\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"WorkspaceId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Connected workspace IDs\",\r\n              \"description\": \"A semicolon-separated list of the workspace IDs that the Log Analytics agent should be connected to\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsLogAnalyticsAgentConnection\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('[LogAnalyticsAgent]LogAnalyticsAgent1;WorkspaceId', '=', parameters('WorkspaceId')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6265018c-d7e2-432f-a75d-094d5f6f4465\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6265018c-d7e2-432f-a75d-094d5f6f4465\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Modify Azure SignalR Service resources to disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"To improve the security of Azure SignalR Service resource, ensure that it isn't exposed to the public internet and can only be accessed from a private endpoint. Disable the public network access property as described in https://aka.ms/asrs/networkacls. This option disables access from any public address space outside the Azure IP range, and denies all logins that match IP or virtual network-based firewall rules. This reduces data leakage risks.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"SignalR\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Modify\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Modify\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.SignalRService/SignalR\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.SignalRService/SignalR/networkACLs.defaultAction\",\r\n                    \"equals\": \"Allow\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.SignalRService/SignalR/networkACLs.publicNetwork.allow\",\r\n                    \"exists\": false\r\n                  },\r\n                  {\r\n                    \"count\": {\r\n                      \"field\": \"Microsoft.SignalRService/SignalR/networkACLs.publicNetwork.allow[*]\"\r\n                    },\r\n                    \"greater\": 0\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"conflictEffect\": \"Audit\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/8cf5e20a-e4b2-4e9d-b3a1-5ceb692c2761\"\r\n              ],\r\n              \"operations\": [\r\n                {\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.SignalRService/SignalR/networkACLs.defaultAction\",\r\n                  \"value\": \"Deny\"\r\n                },\r\n                {\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.SignalRService/SignalR/networkACLs.publicNetwork.allow\",\r\n                  \"value\": []\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/62a3ae95-8169-403e-a2d2-b82141448092\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"62a3ae95-8169-403e-a2d2-b82141448092\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit Windows machines network connectivity\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if a network connection status to an IP and TCP port does not match the policy parameter.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"WindowsRemoteConnection\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"host\": \"[WindowsRemoteConnection]WindowsRemoteConnection1;host\",\r\n              \"port\": \"[WindowsRemoteConnection]WindowsRemoteConnection1;port\",\r\n              \"shouldConnect\": \"[WindowsRemoteConnection]WindowsRemoteConnection1;shouldConnect\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"host\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Remote Host Name\",\r\n              \"description\": \"Specifies the Domain Name System (DNS) name or IP address of the remote host machine.\"\r\n            }\r\n          },\r\n          \"port\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Port\",\r\n              \"description\": \"The TCP port number on the remote host name.\"\r\n            }\r\n          },\r\n          \"shouldConnect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Should connect to remote host\",\r\n              \"description\": \"The machine will be non-compliant if it can't establish a connection.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"False\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsRemoteConnection\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('[WindowsRemoteConnection]WindowsRemoteConnection1;host', '=', parameters('host'), ',', '[WindowsRemoteConnection]WindowsRemoteConnection1;port', '=', parameters('port'), ',', '[WindowsRemoteConnection]WindowsRemoteConnection1;shouldConnect', '=', parameters('shouldConnect')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/630ac30f-a234-4533-ac2d-e0df77acda51\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"630ac30f-a234-4533-ac2d-e0df77acda51\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Authentication to Linux machines should require SSH keys\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Although SSH itself provides an encrypted connection, using passwords with SSH still leaves the VM vulnerable to brute-force attacks. The most secure option for authenticating to an Azure Linux virtual machine over SSH is with a public-private key pair, also known as SSH keys. Learn more: https://docs.microsoft.com/azure/virtual-machines/linux/create-ssh-keys-detailed.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.1\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"LinuxNoPasswordForSSH\",\r\n            \"version\": \"1.*\"\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"microsoft-aks\",\r\n                          \"qubole-inc\",\r\n                          \"datastax\",\r\n                          \"couchbase\",\r\n                          \"scalegrid\",\r\n                          \"checkpoint\",\r\n                          \"paloaltonetworks\",\r\n                          \"debian\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"OpenLogic\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"CentOS*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Oracle\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Oracle-Linux\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"RHEL\",\r\n                              \"RHEL-HA\",\r\n                              \"RHEL-SAP\",\r\n                              \"RHEL-SAP-APPS\",\r\n                              \"RHEL-SAP-HA\",\r\n                              \"RHEL-SAP-HANA\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"osa\",\r\n                              \"rhel-byos\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"cis-centos-7-l1\",\r\n                              \"cis-centos-7-v2-1-1-l1\",\r\n                              \"cis-centos-8-l1\",\r\n                              \"cis-debian-linux-8-l1\",\r\n                              \"cis-debian-linux-9-l1\",\r\n                              \"cis-nginx-centos-7-v1-1-0-l1\",\r\n                              \"cis-oracle-linux-7-v2-0-0-l1\",\r\n                              \"cis-oracle-linux-8-l1\",\r\n                              \"cis-postgresql-11-centos-linux-7-level-1\",\r\n                              \"cis-rhel-7-l2\",\r\n                              \"cis-rhel-7-v2-2-0-l1\",\r\n                              \"cis-rhel-8-l1\",\r\n                              \"cis-suse-linux-12-v2-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1604-v1-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1804-l1\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"credativ\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Debian\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"7*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Suse\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"SLES*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"11*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Canonical\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"UbuntuServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"12*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"linux-data-science-vm-ubuntu\",\r\n                              \"azureml\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-centos-os\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-altus-centos-os\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"linux*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.linuxConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Linux*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"notIn\": [\r\n                                  \"OpenLogic\",\r\n                                  \"RedHat\",\r\n                                  \"credativ\",\r\n                                  \"Suse\",\r\n                                  \"Canonical\",\r\n                                  \"microsoft-dsvm\",\r\n                                  \"cloudera\",\r\n                                  \"microsoft-ads\",\r\n                                  \"center-for-internet-security-inc\",\r\n                                  \"Oracle\"\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"linux*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"LinuxNoPasswordForSSH\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/630c64f9-8b6b-4c64-b511-6544ceff6fd6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"630c64f9-8b6b-4c64-b511-6544ceff6fd6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs configurations in 'Security Options - Devices'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Devices'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"DevicesAllowedToFormatAndEjectRemovableMedia\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Devices: Allowed to format and eject removable media\",\r\n              \"description\": \"Specifies who is allowed to format and eject removable NTFS media. You can use this policy setting to prevent unauthorized users from removing data on one computer to access it on another computer on which they have local administrator privileges.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsDevices\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('Devices: Allowed to format and eject removable media;ExpectedValue', '=', parameters('DevicesAllowedToFormatAndEjectRemovableMedia')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AzureBaseline_SecurityOptionsDevices\"\r\n                    },\r\n                    \"DevicesAllowedToFormatAndEjectRemovableMedia\": {\r\n                      \"value\": \"[parameters('DevicesAllowedToFormatAndEjectRemovableMedia')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"DevicesAllowedToFormatAndEjectRemovableMedia\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Devices: Allowed to format and eject removable media;ExpectedValue\",\r\n                                \"value\": \"[parameters('DevicesAllowedToFormatAndEjectRemovableMedia')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Devices: Allowed to format and eject removable media;ExpectedValue\",\r\n                                \"value\": \"[parameters('DevicesAllowedToFormatAndEjectRemovableMedia')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6481cc21-ed6e-4480-99dd-ea7c5222e897\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6481cc21-ed6e-4480-99dd-ea7c5222e897\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure HDInsight clusters should use customer-managed keys to encrypt data at rest\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use customer-managed keys to manage the encryption at rest of your Azure HDInsight clusters. By default, customer data is encrypted with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more at https://aka.ms/hdi.cmk.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"HDInsight\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.HDInsight/clusters\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.HDInsight/clusters/diskEncryptionProperties.keyName\",\r\n                \"exists\": false\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/64d314f6-6062-4780-a861-c23e8951bee5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"64d314f6-6062-4780-a861-c23e8951bee5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Audit missing blob encryption for storage accounts\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy is no longer necessary because storage blob encryption is enabled by default and cannot be turned off.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Storage/storageAccounts/enableBlobEncryption\",\r\n                  \"equals\": \"True\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/655cb504-bcee-4362-bd4c-402e6aa38759\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"655cb504-bcee-4362-bd4c-402e6aa38759\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Defender for SQL servers on machines should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Azure Defender for SQL provides functionality for surfacing and mitigating potential database vulnerabilities, detecting anomalous activities that could indicate threats to SQL databases, and discovering and classifying sensitive data.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.2\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/pricings\",\r\n              \"name\": \"SqlServerVirtualMachines\",\r\n              \"existenceScope\": \"subscription\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/pricings/pricingTier\",\r\n                \"equals\": \"Standard\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6581d072-105e-4418-827f-bd446d56421b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6581d072-105e-4418-827f-bd446d56421b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Audit IP restrictions configuration for a Function App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"IP Restrictions allow you to define a list of IP addresses that are allowed to access your app. Use of IP Restrictions protects a Function app from common attacks.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyof\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"ConfigureIPRestrictions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"in\": [\r\n                  \"OffByPolicy\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/664346d9-be92-43fb-a219-d595eeb76a90\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"664346d9-be92-43fb-a219-d595eeb76a90\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Service principals should be used to protect your subscriptions instead of management certificates\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Management certificates allow anyone who authenticates with them to manage the subscription(s) they are associated with. To manage subscriptions more securely, use of service principals with Resource Manager is recommended to limit the impact of a certificate compromise.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Resources/subscriptions\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"2acd365d-e8b5-4094-bce4-244b7c51d67c\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6646a0bd-e110-40ca-bb97-84fcee63c414\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6646a0bd-e110-40ca-bb97-84fcee63c414\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Cognitive Services accounts should enable data encryption with a customer-managed key\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data stored in Cognitive Services to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more about customer-managed keys at https://go.microsoft.com/fwlink/?linkid=2121321.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Cognitive Services\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.CognitiveServices/accounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.CognitiveServices/accounts/encryption.keySource\",\r\n                \"notEquals\": \"Microsoft.KeyVault\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.CognitiveServices/accounts/capabilities[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.CognitiveServices/accounts/capabilities[*].name\",\r\n                    \"equals\": \"CustomerManagedKey\"\r\n                  }\r\n                },\r\n                \"greater\": 0\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/67121cc7-ff39-4ab8-b7e3-95b84dab487d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"67121cc7-ff39-4ab8-b7e3-95b84dab487d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Guest Attestation extension should be installed on supported Linux virtual machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Install Guest Attestation extension on supported Linux virtual machines to allow Azure Security Center to proactively attest and monitor the boot integrity. Once installed, boot integrity will be attested via Remote Attestation. This assessment only applies to trusted launch enabled Linux virtual machines.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"version\": \"1.0.0-preview\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"like\": \"18_04-lts-gen2\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"0001-com-ubuntu-server-focal\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"like\": \"20_04-lts-gen2\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"RHEL\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"like\": \"83-gen2\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"SLES-15-SP2\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSku\",\r\n                        \"like\": \"gen2\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings\",\r\n                \"exists\": \"true\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings.secureBootEnabled\",\r\n                \"equals\": \"true\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings.vTpmEnabled\",\r\n                \"equals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Security.LinuxAttestation\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"GuestAttestation\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"in\": [\r\n                      \"Succeeded\",\r\n                      \"Provisioning succeeded\"\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/672fe5a1-2fcd-42d7-b85d-902b6e28c6ff\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"672fe5a1-2fcd-42d7-b85d-902b6e28c6ff\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'Administrative Templates - Network'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'Administrative Templates - Network' for guest logons, simultaneous connections, network bridge, ICS, and multicast name resolution. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_AdministrativeTemplatesNetwork\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"EnableInsecureGuestLogons\": \"Enable insecure guest logons;ExpectedValue\",\r\n              \"AllowSimultaneousConnectionsToTheInternetOrAWindowsDomain\": \"Minimize the number of simultaneous connections to the Internet or a Windows Domain;ExpectedValue\",\r\n              \"TurnOffMulticastNameResolution\": \"Turn off multicast name resolution;ExpectedValue\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"EnableInsecureGuestLogons\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable insecure guest logons\",\r\n              \"description\": \"Specifies whether the SMB client will allow insecure guest logons to an SMB server.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"AllowSimultaneousConnectionsToTheInternetOrAWindowsDomain\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allow simultaneous connections to the Internet or a Windows Domain\",\r\n              \"description\": \"Specify whether to prevent computers from connecting to both a domain based network and a non-domain based network at the same time. A value of 0 allows simultaneous connections, and a value of 1 blocks them.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"TurnOffMulticastNameResolution\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Turn off multicast name resolution\",\r\n              \"description\": \"Specifies whether LLMNR, a secondary name resolution protocol that transmits using multicast over a local subnet link on a single subnet, is enabled.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_AdministrativeTemplatesNetwork\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('Enable insecure guest logons;ExpectedValue', '=', parameters('EnableInsecureGuestLogons'), ',', 'Minimize the number of simultaneous connections to the Internet or a Windows Domain;ExpectedValue', '=', parameters('AllowSimultaneousConnectionsToTheInternetOrAWindowsDomain'), ',', 'Turn off multicast name resolution;ExpectedValue', '=', parameters('TurnOffMulticastNameResolution')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/67e010c1-640d-438e-a3a5-feaccb533a98\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"67e010c1-640d-438e-a3a5-feaccb533a98\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Azure Data Factory linked service resource type should be in allow list\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Define the allow list of Azure Data Factory linked service types. Restricting allowed resource types enables control over the boundary of data movement. For example, restrict a scope to only allow blob storage with Data Lake Storage Gen1 and Gen2 for analytics or a scope to only allow SQL and Kusto access for real-time queries.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-preview\",\r\n          \"category\": \"Data Factory\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          },\r\n          \"allowedLinkedServiceResourceTypes\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed linked service resource types\",\r\n              \"description\": \"The list of allowed linked service resource types.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AdlsGen2CosmosStructuredStream\",\r\n              \"AdobeExperiencePlatform\",\r\n              \"AdobeIntegration\",\r\n              \"AmazonRedshift\",\r\n              \"AmazonS3\",\r\n              \"AzureBlobFS\",\r\n              \"AzureBlobStorage\",\r\n              \"AzureDataExplorer\",\r\n              \"AzureDataLakeStore\",\r\n              \"AzureDataLakeStoreCosmosStructuredStream\",\r\n              \"AzureDataShare\",\r\n              \"AzureFileStorage\",\r\n              \"AzureKeyVault\",\r\n              \"AzureMariaDB\",\r\n              \"AzureMySql\",\r\n              \"AzurePostgreSql\",\r\n              \"AzureSearch\",\r\n              \"AzureSqlDatabase\",\r\n              \"AzureSqlDW\",\r\n              \"AzureSqlMI\",\r\n              \"AzureTableStorage\",\r\n              \"Cassandra\",\r\n              \"CommonDataServiceForApps\",\r\n              \"CosmosDb\",\r\n              \"CosmosDbMongoDbApi\",\r\n              \"Db2\",\r\n              \"DynamicsCrm\",\r\n              \"FileServer\",\r\n              \"FtpServer\",\r\n              \"GitHub\",\r\n              \"GoogleCloudStorage\",\r\n              \"Hdfs\",\r\n              \"Hive\",\r\n              \"HttpServer\",\r\n              \"Informix\",\r\n              \"Kusto\",\r\n              \"MicrosoftAccess\",\r\n              \"MySql\",\r\n              \"Netezza\",\r\n              \"Odata\",\r\n              \"Odbc\",\r\n              \"Office365\",\r\n              \"Oracle\",\r\n              \"PostgreSql\",\r\n              \"Salesforce\",\r\n              \"SalesforceServiceCloud\",\r\n              \"SapBw\",\r\n              \"SapHana\",\r\n              \"SapOpenHub\",\r\n              \"SapTable\",\r\n              \"Sftp\",\r\n              \"SharePointOnlineList\",\r\n              \"Snowflake\",\r\n              \"SqlServer\",\r\n              \"Sybase\",\r\n              \"Teradata\",\r\n              \"HDInsightOnDemand\",\r\n              \"HDInsight\",\r\n              \"AzureDataLakeAnalytics\",\r\n              \"AzureBatch\",\r\n              \"AzureFunction\",\r\n              \"AzureML\",\r\n              \"AzureMLService\",\r\n              \"MongoDb\",\r\n              \"GoogleBigQuery\",\r\n              \"Impala\",\r\n              \"ServiceNow\",\r\n              \"Dynamics\",\r\n              \"AzureDatabricks\",\r\n              \"AmazonMWS\",\r\n              \"SapCloudForCustomer\",\r\n              \"SapEcc\",\r\n              \"Web\",\r\n              \"MongoDbAtlas\",\r\n              \"HBase\",\r\n              \"Spark\",\r\n              \"Phoenix\",\r\n              \"PayPal\",\r\n              \"Marketo\",\r\n              \"Responsys\",\r\n              \"SalesforceMarketingCloud\",\r\n              \"Presto\",\r\n              \"Square\",\r\n              \"Xero\",\r\n              \"Jira\",\r\n              \"Magento\",\r\n              \"Shopify\",\r\n              \"Concur\",\r\n              \"Hubspot\",\r\n              \"Zoho\",\r\n              \"Eloqua\",\r\n              \"QuickBooks\",\r\n              \"Couchbase\",\r\n              \"Drill\",\r\n              \"Greenplum\",\r\n              \"MariaDB\",\r\n              \"Vertica\",\r\n              \"MongoDbV2\",\r\n              \"OracleServiceCloud\",\r\n              \"GoogleAdWords\",\r\n              \"RestService\",\r\n              \"DynamicsAX\",\r\n              \"AzureDataCatalog\",\r\n              \"AzureDatabricksDeltaLake\"\r\n            ]\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DataFactory/factories/linkedservices\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DataFactory/factories/linkedservices/type\",\r\n                \"notIn\": \"[parameters('allowedLinkedServiceResourceTypes')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6809a3d0-d354-42fb-b955-783d207c62a8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6809a3d0-d354-42fb-b955-783d207c62a8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs on which the Log Analytics agent is not connected as expected\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines on which the Log Analytics agent is not connected to the specified workspaces. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"WorkspaceId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Connected workspace IDs\",\r\n              \"description\": \"A semicolon-separated list of the workspace IDs that the Log Analytics agent should be connected to\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsLogAnalyticsAgentConnection\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('[LogAnalyticsAgent]LogAnalyticsAgent1;WorkspaceId', '=', parameters('WorkspaceId')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"WindowsLogAnalyticsAgentConnection\"\r\n                    },\r\n                    \"WorkspaceId\": {\r\n                      \"value\": \"[parameters('WorkspaceId')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WorkspaceId\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[LogAnalyticsAgent]LogAnalyticsAgent1;WorkspaceId\",\r\n                                \"value\": \"[parameters('WorkspaceId')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[LogAnalyticsAgent]LogAnalyticsAgent1;WorkspaceId\",\r\n                                \"value\": \"[parameters('WorkspaceId')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/68511db2-bd02-41c4-ae6b-1900a012968a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"68511db2-bd02-41c4-ae6b-1900a012968a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Log Analytics agent on Azure Arc enabled Windows servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enable VM insights on servers and machines connected to Azure through Arc enabled servers by installing the Log Analytics agent virtual machine extension. VM insights uses the Log Analytics agent to collect the guest OS performance data, and provides insights into their performance. See more - https://aka.ms/vminsightsdocs.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Specify the Log Analytics workspace the agent should be connected to. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.HybridCompute/machines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                \"like\": \"windows*\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.HybridCompute/machines/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/machines/extensions/type\",\r\n                    \"equals\": \"MicrosoftMonitoringAgent\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/machines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/machines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"MicrosoftMonitoringAgent\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.EnterpriseCloud.Monitoring\",\r\n                      \"vmExtensionType\": \"MicrosoftMonitoringAgent\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"apiVersion\": \"2019-12-12\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"settings\": {\r\n                            \"workspaceId\": \"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\",\r\n                            \"stopOnMultipleConnections\": \"true\"\r\n                          },\r\n                          \"protectedSettings\": {\r\n                            \"workspaceKey\": \"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"\r\n                          }\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for VM', ': ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/69af7d4a-7b18-4044-93a9-2651498ef203\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"69af7d4a-7b18-4044-93a9-2651498ef203\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit Windows machines that have the specified members in the Administrators group\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if the local Administrators group contains one or more of the members listed in the policy parameter.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AdministratorsGroupMembersToExclude\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"MembersToExclude\": \"[LocalGroup]AdministratorsGroup;MembersToExclude\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"MembersToExclude\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Members to exclude\",\r\n              \"description\": \"A semicolon-separated list of members that should be excluded in the Administrators local group. Ex: Administrator; myUser1; myUser2\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AdministratorsGroupMembersToExclude\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('[LocalGroup]AdministratorsGroup;MembersToExclude', '=', parameters('MembersToExclude')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/69bf4abd-ca1e-4cf6-8b5a-762d42e61d4f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"69bf4abd-ca1e-4cf6-8b5a-762d42e61d4f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs on which Windows Defender Exploit Guard is not enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines on which Windows Defender Exploit Guard is not enabled. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"NotAvailableMachineState\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"State in which to show VMs on which Windows Defender Exploit Guard is not available\",\r\n              \"description\": \"Windows Defender Exploit Guard is only available starting with Windows 10/Windows Server with update 1709. Setting this value to 'Non-Compliant' will make machines with older versions on which Windows Defender Exploit Guard is not available (such as Windows Server 2012 R2) non-compliant. Setting this value to 'Compliant' will make these machines compliant.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Compliant\",\r\n              \"Non-Compliant\"\r\n            ],\r\n            \"defaultValue\": \"Non-Compliant\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsDefenderExploitGuard\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('[WindowsDefenderExploitGuard]WindowsDefenderExploitGuard1;NotAvailableMachineState', '=', parameters('NotAvailableMachineState')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"WindowsDefenderExploitGuard\"\r\n                    },\r\n                    \"NotAvailableMachineState\": {\r\n                      \"value\": \"[parameters('NotAvailableMachineState')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"NotAvailableMachineState\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[WindowsDefenderExploitGuard]WindowsDefenderExploitGuard1;NotAvailableMachineState\",\r\n                                \"value\": \"[parameters('NotAvailableMachineState')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[WindowsDefenderExploitGuard]WindowsDefenderExploitGuard1;NotAvailableMachineState\",\r\n                                \"value\": \"[parameters('NotAvailableMachineState')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2015-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6a7a2bcf-f9be-4e35-9734-4f9657a70f1d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6a7a2bcf-f9be-4e35-9734-4f9657a70f1d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Audit IP restrictions configuration for a Web Application\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"IP Restrictions allow you to define a list of IP addresses that are allowed to access your app. Use of IP Restrictions protects a web application from common attacks.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyof\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"WebApp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"ConfigureIPRestrictions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"in\": [\r\n                  \"OffByPolicy\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6a8450e2-6c61-43b4-be65-62e3a197bffe\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6a8450e2-6c61-43b4-be65-62e3a197bffe\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Ensure WEB app is using the latest version of TLS encryption \",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Please use /providers/Microsoft.Authorization/policyDefinitions/f0e6e85b-9b9f-4a4b-b67b-f730d42f1b0b instead. The TLS(Transport Layer Security) protocol secures transmission of data over the internet using standard encryption technology. Encryption should be set with the latest version of TLS. App service allows TLS 1.2 by default, which is the recommended TLS level by industry standards, such as PCI DSS.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"App Service\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"app*\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/config/web.minTlsVersion\",\r\n                \"equals\": \"1.2\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6ad61431-88ce-4357-a0e1-6da43f292bd7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6ad61431-88ce-4357-a0e1-6da43f292bd7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deprecated accounts should be removed from your subscription\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Deprecated accounts should be removed from your subscriptions.  Deprecated accounts are accounts that have been blocked from signing in.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"00c6d40b-e990-6acf-d4f3-471e747a27c4\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6b1cbf55-e8b6-442f-ba4c-7246b6381474\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6b1cbf55-e8b6-442f-ba4c-7246b6381474\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Diagnostic Settings for Service Bus to Event Hub\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploys the diagnostic settings for Service Bus to stream to a regional Event Hub when any Service Bus which is missing this diagnostic settings is created or updated.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          },\r\n          \"profileName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Profile name\",\r\n              \"description\": \"The diagnostic settings profile name\"\r\n            },\r\n            \"defaultValue\": \"setbypolicy_eventHub\"\r\n          },\r\n          \"eventHubRuleId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Event Hub Authorization Rule Id\",\r\n              \"description\": \"The Event Hub authorization rule Id for Azure Diagnostics. The authorization rule needs to be at Event Hub namespace level. e.g. /subscriptions/{subscription Id}/resourceGroups/{resource group}/providers/Microsoft.EventHub/namespaces/{Event Hub namespace}/authorizationrules/{authorization rule}\",\r\n              \"strongType\": \"Microsoft.EventHub/Namespaces/AuthorizationRules\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"eventHubLocation\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Event Hub Location\",\r\n              \"description\": \"The location the Event Hub resides in. Only Service Bus in this location will be linked to this Event Hub.\",\r\n              \"strongType\": \"location\"\r\n            },\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"metricsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable metrics\",\r\n              \"description\": \"Whether to enable metrics stream to the Event Hub - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"False\"\r\n          },\r\n          \"logsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable logs\",\r\n              \"description\": \"Whether to enable logs stream to the Event Hub  - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ServiceBus/namespaces\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('eventHubLocation')]\",\r\n                    \"equals\": \"\"\r\n                  },\r\n                  {\r\n                    \"field\": \"location\",\r\n                    \"equals\": \"[parameters('eventHubLocation')]\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"name\": \"[parameters('profileName')]\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                    \"equals\": \"[parameters('logsEnabled')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\r\n                    \"equals\": \"[parameters('metricsEnabled')]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"resourceName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"eventHubRuleId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"metricsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"profileName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.ServiceBus/namespaces/providers/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"dependsOn\": [],\r\n                        \"properties\": {\r\n                          \"eventHubAuthorizationRuleId\": \"[parameters('eventHubRuleId')]\",\r\n                          \"metrics\": [\r\n                            {\r\n                              \"category\": \"AllMetrics\",\r\n                              \"enabled\": \"[parameters('metricsEnabled')]\",\r\n                              \"retentionPolicy\": {\r\n                                \"enabled\": false,\r\n                                \"days\": 0\r\n                              }\r\n                            }\r\n                          ],\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"OperationalLogs\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {}\r\n                  },\r\n                  \"parameters\": {\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"resourceName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"eventHubRuleId\": {\r\n                      \"value\": \"[parameters('eventHubRuleId')]\"\r\n                    },\r\n                    \"metricsEnabled\": {\r\n                      \"value\": \"[parameters('metricsEnabled')]\"\r\n                    },\r\n                    \"logsEnabled\": {\r\n                      \"value\": \"[parameters('logsEnabled')]\"\r\n                    },\r\n                    \"profileName\": {\r\n                      \"value\": \"[parameters('profileName')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6b51af03-9277-49a9-a3f8-1c69c9ff7403\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6b51af03-9277-49a9-a3f8-1c69c9ff7403\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"SQL servers on machines should have vulnerability findings resolved\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"SQL vulnerability assessment scans your database for security vulnerabilities, and exposes any deviations from best practices such as misconfigurations, excessive permissions, and unprotected sensitive data. Resolving the vulnerabilities found can greatly improve your database security posture.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.HybridCompute/machines\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"f97aa83c-9b63-4f9a-99f6-b22c4398f936\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6ba6d016-e7c3-4842-b8f2-4992ebc0d72d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6ba6d016-e7c3-4842-b8f2-4992ebc0d72d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Not allowed resource types\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Restrict which resource types can be deployed in your environment. Limiting resource types can reduce the complexity and attack surface of your environment while also helping to manage costs. Compliance results are only shown for non-compliant resources.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"General\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfResourceTypesNotAllowed\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"description\": \"The list of resource types that cannot be deployed.\",\r\n              \"displayName\": \"Not allowed resource types\",\r\n              \"strongType\": \"resourceTypes\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Deny\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"in\": \"[parameters('listOfResourceTypesNotAllowed')]\"\r\n              },\r\n              {\r\n                \"value\": \"[field('type')]\",\r\n                \"exists\": true\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6c112d4e-5bc7-47ae-a041-ea2d9dccd749\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6c112d4e-5bc7-47ae-a041-ea2d9dccd749\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Log Analytics workspaces should block log ingestion and querying from public networks\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Improve workspace security by blocking log ingestion and querying from public networks. Only private-link connected networks will be able to ingest and query logs on this workspace. Learn more at https://aka.ms/AzMonPrivateLink#configure-log-analytics.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"audit\",\r\n              \"deny\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.OperationalInsights/workspaces\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.OperationalInsights/workspaces/publicNetworkAccessForIngestion\",\r\n                    \"notEquals\": \"disabled\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.OperationalInsights/workspaces/publicNetworkAccessForQuery\",\r\n                    \"notEquals\": \"disabled\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6c53d030-cc64-46f0-906d-2bc061cd1334\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6c53d030-cc64-46f0-906d-2bc061cd1334\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy - Configure diagnostic settings for Azure Kubernetes Service to Log Analytics workspace\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploys the diagnostic settings for Azure Kubernetes Service to stream resource logs to a Log Analytics workspace.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Kubernetes\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          },\r\n          \"diagnosticsSettingNameToUse\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Setting name\",\r\n              \"description\": \"Name of the diagnostic settings.\"\r\n            },\r\n            \"defaultValue\": \"AzureKubernetesDiagnosticsLogsToWorkspace\"\r\n          },\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Specify the Log Analytics workspace the Azure Kubernetes Service should be connected to\",\r\n              \"strongType\": \"omsWorkspace\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"AllMetrics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"AllMetrics - Enabled\",\r\n              \"description\": \"Whether to stream AllMetrics logs to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          },\r\n          \"kube-apiserver\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"kube-apiserver - Enabled\",\r\n              \"description\": \"Whether to stream kube-apiserver logs to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          },\r\n          \"kube-audit\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"kube-audit - Enabled\",\r\n              \"description\": \"Whether to stream kube-audit logs to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          },\r\n          \"kube-controller-manager\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"kube-controller-manager - Enabled\",\r\n              \"description\": \"Whether to stream kube-controller-manager logs to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          },\r\n          \"kube-scheduler\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"kube-scheduler - Enabled\",\r\n              \"description\": \"Whether to stream kube-scheduler logs to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          },\r\n          \"cluster-autoscaler\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"cluster-autoscaler - Enabled\",\r\n              \"description\": \"Whether to stream cluster-autoscaler logs to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          },\r\n          \"kube-audit-admin\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"kube-audit-admin - Enabled\",\r\n              \"description\": \"Whether to stream kube-audit-admin logs to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          },\r\n          \"guard\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"guard - Enabled\",\r\n              \"description\": \"Whether to stream guard logs to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.ContainerService/managedClusters\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                    \"equals\": \"True\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\r\n                    \"equals\": \"True\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/workspaceId\",\r\n                    \"equals\": \"[parameters('logAnalytics')]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"diagnosticsSettingNameToUse\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"resourceName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AllMetrics\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"kube-apiserver\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"kube-audit\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"kube-controller-manager\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"kube-scheduler\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"cluster-autoscaler\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"kube-audit-admin\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"guard\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.ContainerService/managedClusters/providers/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('diagnosticsSettingNameToUse'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"dependsOn\": [],\r\n                        \"properties\": {\r\n                          \"workspaceId\": \"[parameters('logAnalytics')]\",\r\n                          \"metrics\": [\r\n                            {\r\n                              \"category\": \"AllMetrics\",\r\n                              \"enabled\": \"[parameters('AllMetrics')]\"\r\n                            }\r\n                          ],\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"kube-apiserver\",\r\n                              \"enabled\": \"[parameters('kube-apiserver')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"kube-audit\",\r\n                              \"enabled\": \"[parameters('kube-audit')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"kube-controller-manager\",\r\n                              \"enabled\": \"[parameters('kube-controller-manager')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"kube-scheduler\",\r\n                              \"enabled\": \"[parameters('kube-scheduler')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"cluster-autoscaler\",\r\n                              \"enabled\": \"[parameters('cluster-autoscaler')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"kube-audit-admin\",\r\n                              \"enabled\": \"[parameters('kube-audit-admin')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"guard\",\r\n                              \"enabled\": \"[parameters('guard')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {}\r\n                  },\r\n                  \"parameters\": {\r\n                    \"diagnosticsSettingNameToUse\": {\r\n                      \"value\": \"[parameters('diagnosticsSettingNameToUse')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"resourceName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"guard\": {\r\n                      \"value\": \"[parameters('guard')]\"\r\n                    },\r\n                    \"AllMetrics\": {\r\n                      \"value\": \"[parameters('AllMetrics')]\"\r\n                    },\r\n                    \"kube-apiserver\": {\r\n                      \"value\": \"[parameters('kube-apiserver')]\"\r\n                    },\r\n                    \"kube-audit\": {\r\n                      \"value\": \"[parameters('kube-audit')]\"\r\n                    },\r\n                    \"kube-scheduler\": {\r\n                      \"value\": \"[parameters('kube-scheduler')]\"\r\n                    },\r\n                    \"kube-controller-manager\": {\r\n                      \"value\": \"[parameters('kube-controller-manager')]\"\r\n                    },\r\n                    \"cluster-autoscaler\": {\r\n                      \"value\": \"[parameters('cluster-autoscaler')]\"\r\n                    },\r\n                    \"kube-audit-admin\": {\r\n                      \"value\": \"[parameters('kube-audit-admin')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6c66c325-74c8-42fd-a286-a74b0e2939d8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6c66c325-74c8-42fd-a286-a74b0e2939d8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Function App should only be accessible over HTTPS\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"functionapp*\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Web/sites/httpsOnly\",\r\n                \"equals\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6d555dd1-86f2-4f1c-8ed7-5abae7c6cbab\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6d555dd1-86f2-4f1c-8ed7-5abae7c6cbab\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Azure Automation accounts with private DNS zones\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use private DNS zones to override the DNS resolution for a private endpoint. You need private DNS zone properly configured to connect to Azure Automation account via Azure Private Link. Learn more at: https://aka.ms/privatednszone.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Automation\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateDnsZoneId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private DNS zone ID\",\r\n              \"description\": \"Specifies the private DNS zone to use to configure private endpoint\",\r\n              \"strongType\": \"Microsoft.Network/privateDnsZones\"\r\n            }\r\n          },\r\n          \"privateEndpointGroupId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private endpoint group id\",\r\n              \"description\": \"A group Id for the private endpoint\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/privateEndpoints\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*].groupIds[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*].groupIds[*]\",\r\n                    \"equals\": \"[parameters('privateEndpointGroupId')]\"\r\n                  }\r\n                },\r\n                \"greaterOrEquals\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Network/privateEndpoints/privateDnsZoneGroups\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"privateDnsZoneId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointGroupId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('privateEndpointName'), '/deployedByPolicy')]\",\r\n                        \"type\": \"Microsoft.Network/privateEndpoints/privateDnsZoneGroups\",\r\n                        \"apiVersion\": \"2020-03-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"privateDnsZoneConfigs\": [\r\n                            {\r\n                              \"name\": \"automationAccounts-privateDnsZone\",\r\n                              \"properties\": {\r\n                                \"privateDnsZoneId\": \"[parameters('privateDnsZoneId')]\"\r\n                              }\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"privateDnsZoneId\": {\r\n                      \"value\": \"[parameters('privateDnsZoneId')]\"\r\n                    },\r\n                    \"privateEndpointName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"privateEndpointGroupId\": {\r\n                      \"value\": \"[parameters('privateEndpointGroupId')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6dd01e4f-1be1-4e80-9d0b-d109e04cb064\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6dd01e4f-1be1-4e80-9d0b-d109e04cb064\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Enable Security Center's auto provisioning of the Log Analytics agent on your subscriptions with default workspace.\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Allow Security Center to auto provision the Log Analytics agent on your subscriptions to monitor and collect security data using ASC default workspace.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/autoProvisioningSettings\",\r\n              \"deploymentScope\": \"Subscription\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/autoProvisioningSettings/autoProvision\",\r\n                \"equals\": \"On\"\r\n              },\r\n              \"deployment\": {\r\n                \"location\": \"westus\",\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {},\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Security/autoProvisioningSettings\",\r\n                        \"name\": \"default\",\r\n                        \"apiVersion\": \"2017-08-01-preview\",\r\n                        \"properties\": {\r\n                          \"autoProvision\": \"On\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6df2fee6-a9ed-4fef-bced-e13be1b25f1c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6df2fee6-a9ed-4fef-bced-e13be1b25f1c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Email notification for high severity alerts should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"To ensure the relevant people in your organization are notified when there is a potential security breach in one of your subscriptions, enable email notifications for high severity alerts in Security Center.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/securityContacts\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/securityContacts/alertNotifications\",\r\n                \"notEquals\": \"Off\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6e2593d9-add6-4083-9c9b-4b7d2188c899\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6e2593d9-add6-4083-9c9b-4b7d2188c899\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Storage accounts should use private link\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your storage account, data leakage risks are reduced. Learn more about private links at - https://aka.ms/azureprivatelinkoverview\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Storage/storageAccounts/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Storage/storageAccounts/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6edd7eda-6dd8-40f7-810d-67160c639cd9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6edd7eda-6dd8-40f7-810d-67160c639cd9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure diagnostic settings for storage accounts to Log Analytics workspace\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploys the diagnostic settings for storage accounts to stream resource logs to a Log Analytics workspace when any storage account which is missing this diagnostic settings is created or updated.\",\r\n        \"metadata\": {\r\n          \"category\": \"Storage\",\r\n          \"version\": \"1.3.0\"\r\n        },\r\n        \"parameters\": {\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Specify the Log Analytics workspace the storage account should be connected to.\",\r\n              \"strongType\": \"omsWorkspace\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"servicesToDeploy\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Storage services to deploy\",\r\n              \"description\": \"List of Storage services to deploy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"storageAccounts\",\r\n              \"blobServices\",\r\n              \"fileServices\",\r\n              \"tableServices\",\r\n              \"queueServices\"\r\n            ],\r\n            \"defaultValue\": [\r\n              \"storageAccounts\",\r\n              \"blobServices\",\r\n              \"fileServices\",\r\n              \"tableServices\",\r\n              \"queueServices\"\r\n            ]\r\n          },\r\n          \"diagnosticsSettingNameToUse\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Setting name\",\r\n              \"description\": \"Name of the diagnostic settings.\"\r\n            },\r\n            \"defaultValue\": \"storageAccountsDiagnosticsLogsToWorkspace\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          },\r\n          \"StorageDelete\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"StorageDelete - Enabled\",\r\n              \"description\": \"Whether to stream StorageDelete logs to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          },\r\n          \"StorageWrite\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"StorageWrite - Enabled\",\r\n              \"description\": \"Whether to stream StorageWrite logs to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          },\r\n          \"StorageRead\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"StorageRead - Enabled\",\r\n              \"description\": \"Whether to stream StorageRead logs to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          },\r\n          \"Transaction\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Transaction - Enabled\",\r\n              \"description\": \"Whether to stream Transaction logs to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"anyof\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\r\n                        \"equals\": \"True\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                        \"equals\": \"True\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/workspaceId\",\r\n                    \"equals\": \"[parameters('logAnalytics')]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"servicesToDeploy\": {\r\n                        \"type\": \"array\"\r\n                      },\r\n                      \"diagnosticsSettingNameToUse\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"resourceName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"Transaction\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"StorageRead\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"StorageWrite\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"StorageDelete\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[contains(parameters('servicesToDeploy'), 'blobServices')]\",\r\n                        \"type\": \"Microsoft.Storage/storageAccounts/blobServices/providers/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('resourceName'), '/default/', 'Microsoft.Insights/', parameters('diagnosticsSettingNameToUse'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"dependsOn\": [],\r\n                        \"properties\": {\r\n                          \"workspaceId\": \"[parameters('logAnalytics')]\",\r\n                          \"metrics\": [\r\n                            {\r\n                              \"category\": \"Transaction\",\r\n                              \"enabled\": \"[parameters('Transaction')]\",\r\n                              \"retentionPolicy\": {\r\n                                \"days\": 0,\r\n                                \"enabled\": false\r\n                              },\r\n                              \"timeGrain\": null\r\n                            }\r\n                          ],\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"StorageRead\",\r\n                              \"enabled\": \"[parameters('StorageRead')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"StorageWrite\",\r\n                              \"enabled\": \"[parameters('StorageWrite')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"StorageDelete\",\r\n                              \"enabled\": \"[parameters('StorageDelete')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[contains(parameters('servicesToDeploy'), 'fileServices')]\",\r\n                        \"type\": \"Microsoft.Storage/storageAccounts/fileServices/providers/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('resourceName'), '/default/', 'Microsoft.Insights/', parameters('diagnosticsSettingNameToUse'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"dependsOn\": [],\r\n                        \"properties\": {\r\n                          \"workspaceId\": \"[parameters('logAnalytics')]\",\r\n                          \"metrics\": [\r\n                            {\r\n                              \"category\": \"Transaction\",\r\n                              \"enabled\": \"[parameters('Transaction')]\",\r\n                              \"retentionPolicy\": {\r\n                                \"days\": 0,\r\n                                \"enabled\": false\r\n                              },\r\n                              \"timeGrain\": null\r\n                            }\r\n                          ],\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"StorageRead\",\r\n                              \"enabled\": \"[parameters('StorageRead')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"StorageWrite\",\r\n                              \"enabled\": \"[parameters('StorageWrite')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"StorageDelete\",\r\n                              \"enabled\": \"[parameters('StorageDelete')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[contains(parameters('servicesToDeploy'), 'tableServices')]\",\r\n                        \"type\": \"Microsoft.Storage/storageAccounts/tableServices/providers/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('resourceName'), '/default/', 'Microsoft.Insights/', parameters('diagnosticsSettingNameToUse'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"dependsOn\": [],\r\n                        \"properties\": {\r\n                          \"workspaceId\": \"[parameters('logAnalytics')]\",\r\n                          \"metrics\": [\r\n                            {\r\n                              \"category\": \"Transaction\",\r\n                              \"enabled\": \"[parameters('Transaction')]\",\r\n                              \"retentionPolicy\": {\r\n                                \"days\": 0,\r\n                                \"enabled\": false\r\n                              },\r\n                              \"timeGrain\": null\r\n                            }\r\n                          ],\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"StorageRead\",\r\n                              \"enabled\": \"[parameters('StorageRead')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"StorageWrite\",\r\n                              \"enabled\": \"[parameters('StorageWrite')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"StorageDelete\",\r\n                              \"enabled\": \"[parameters('StorageDelete')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[contains(parameters('servicesToDeploy'), 'queueServices')]\",\r\n                        \"type\": \"Microsoft.Storage/storageAccounts/queueServices/providers/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('resourceName'), '/default/', 'Microsoft.Insights/', parameters('diagnosticsSettingNameToUse'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"dependsOn\": [],\r\n                        \"properties\": {\r\n                          \"workspaceId\": \"[parameters('logAnalytics')]\",\r\n                          \"metrics\": [\r\n                            {\r\n                              \"category\": \"Transaction\",\r\n                              \"enabled\": \"[parameters('Transaction')]\",\r\n                              \"retentionPolicy\": {\r\n                                \"days\": 0,\r\n                                \"enabled\": false\r\n                              },\r\n                              \"timeGrain\": null\r\n                            }\r\n                          ],\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"StorageRead\",\r\n                              \"enabled\": \"[parameters('StorageRead')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"StorageWrite\",\r\n                              \"enabled\": \"[parameters('StorageWrite')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"StorageDelete\",\r\n                              \"enabled\": \"[parameters('StorageDelete')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[contains(parameters('servicesToDeploy'), 'storageAccounts')]\",\r\n                        \"type\": \"Microsoft.Storage/storageAccounts/providers/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('diagnosticsSettingNameToUse'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"dependsOn\": [],\r\n                        \"properties\": {\r\n                          \"workspaceId\": \"[parameters('logAnalytics')]\",\r\n                          \"metrics\": [\r\n                            {\r\n                              \"category\": \"Transaction\",\r\n                              \"enabled\": \"[parameters('Transaction')]\",\r\n                              \"retentionPolicy\": {\r\n                                \"days\": 0,\r\n                                \"enabled\": false\r\n                              },\r\n                              \"timeGrain\": null\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {}\r\n                  },\r\n                  \"parameters\": {\r\n                    \"diagnosticsSettingNameToUse\": {\r\n                      \"value\": \"[parameters('diagnosticsSettingNameToUse')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"resourceName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"Transaction\": {\r\n                      \"value\": \"[parameters('Transaction')]\"\r\n                    },\r\n                    \"StorageDelete\": {\r\n                      \"value\": \"[parameters('StorageDelete')]\"\r\n                    },\r\n                    \"StorageWrite\": {\r\n                      \"value\": \"[parameters('StorageWrite')]\"\r\n                    },\r\n                    \"StorageRead\": {\r\n                      \"value\": \"[parameters('StorageRead')]\"\r\n                    },\r\n                    \"servicesToDeploy\": {\r\n                      \"value\": \"[parameters('servicesToDeploy')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6f8f98a4-f108-47cb-8e98-91a0d85cd474\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6f8f98a4-f108-47cb-8e98-91a0d85cd474\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Storage accounts should use customer-managed key for encryption\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Secure your storage account with greater flexibility using customer-managed keys. When you specify a customer-managed key, that key is used to protect and control access to the key that encrypts your data. Using customer-managed keys provides additional capabilities to control rotation of the key encryption key or cryptographically erase data.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.2\",\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Storage/storageAccounts/encryption.keySource\",\r\n                  \"equals\": \"Microsoft.Keyvault\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6fac406b-40ca-413b-bf8e-0bf964659c25\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6fac406b-40ca-413b-bf8e-0bf964659c25\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Workbooks should be saved to storage accounts that you control\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"With bring your own storage (BYOS), your workbooks are uploaded into a storage account that you control. That means you control the encryption-at-rest policy, the lifetime management policy, and network access. You will, however, be responsible for the costs associated with that storage account. For more information, visit https://aka.ms/workbooksByos\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Audit, Deny, or Disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"deny\",\r\n              \"audit\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.insights/workbooks\"\r\n              },\r\n              {\r\n                \"field\": \"microsoft.insights/workbooks/storageUri\",\r\n                \"exists\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6fc8115b-2008-441f-8c61-9b722c1e537f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6fc8115b-2008-441f-8c61-9b722c1e537f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy - Configure Azure Event Grid topics with private endpoints\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoints lets you connect your virtual network to Azure services without a public IP address at the source or destination. By mapping private endpoints to your resources, they'll be protected against data leakage risks. Learn more at: https://aka.ms/privateendpoints.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Event Grid\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateEndpointSubnetId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private endpoint subnet id\",\r\n              \"description\": \"Specifies the subnet to use to configure private endpoint\",\r\n              \"strongType\": \"Microsoft.Network/virtualNetworks/subnets\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.EventGrid/topics\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"notEquals\": \"AzureArc\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.EventGrid/topics/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.EventGrid/topics/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7\",\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/1e241071-0855-49ea-94dc-649edcd759de\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"name\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"serviceId\": {\r\n                      \"value\": \"[field('id')]\"\r\n                    },\r\n                    \"privateEndpointSubnetId\": {\r\n                      \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"name\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"serviceId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointSubnetId\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"privateEndpointName\": \"[concat('pe-',substring(parameters('name'),0,min(length(parameters('name')),50)),'-',uniquestring(deployment().name))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('privateEndpointName')]\",\r\n                        \"apiVersion\": \"2020-06-01\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"expressionEvaluationOptions\": {\r\n                            \"scope\": \"inner\"\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"serviceId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"privateEndpointSubnetId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"subnetLocation\": {\r\n                                \"type\": \"string\"\r\n                              }\r\n                            },\r\n                            \"variables\": {\r\n                              \"privateEndpointName\": \"[deployment().name]\"\r\n                            },\r\n                            \"resources\": [\r\n                              {\r\n                                \"name\": \"[variables('privateEndpointName')]\",\r\n                                \"type\": \"Microsoft.Network/privateEndpoints\",\r\n                                \"apiVersion\": \"2020-07-01\",\r\n                                \"location\": \"[parameters('subnetLocation')]\",\r\n                                \"tags\": {},\r\n                                \"properties\": {\r\n                                  \"subnet\": {\r\n                                    \"id\": \"[parameters('privateEndpointSubnetId')]\"\r\n                                  },\r\n                                  \"privateLinkServiceConnections\": [\r\n                                    {\r\n                                      \"name\": \"[variables('privateEndpointName')]\",\r\n                                      \"properties\": {\r\n                                        \"privateLinkServiceId\": \"[parameters('serviceId')]\",\r\n                                        \"groupIds\": [\r\n                                          \"topic\"\r\n                                        ],\r\n                                        \"requestMessage\": \"autoapprove\"\r\n                                      }\r\n                                    }\r\n                                  ],\r\n                                  \"manualPrivateLinkServiceConnections\": []\r\n                                }\r\n                              }\r\n                            ]\r\n                          },\r\n                          \"parameters\": {\r\n                            \"serviceId\": {\r\n                              \"value\": \"[parameters('serviceId')]\"\r\n                            },\r\n                            \"privateEndpointSubnetId\": {\r\n                              \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                            },\r\n                            \"subnetLocation\": {\r\n                              \"value\": \"[reference(first(take(split(parameters('privateEndpointSubnetId'),'/subnets'),1)),'2020-07-01','Full').location]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6fcec95c-fbdf-45e8-91e1-e3175d9c9eca\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6fcec95c-fbdf-45e8-91e1-e3175d9c9eca\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs configurations in 'Security Options - Microsoft Network Server'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Microsoft Network Server'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsMicrosoftNetworkServer\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6fe4ef56-7576-4dc4-8e9c-26bad4b087ce\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6fe4ef56-7576-4dc4-8e9c-26bad4b087ce\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Ensure that 'Python version' is the latest, if used as a part of the Web app\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Periodically, newer versions are released for Python software either due to security flaws or to include additional functionality. Using the latest Python version for web apps is recommended in order to take advantage of security fixes, if any, and/or new functionalities of the latest version. Currently, this policy only applies to Linux web apps.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"WindowsPythonLatestVersion\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"[Deprecated]: Latest Windows Python version\",\r\n              \"description\": \"Latest supported Python version for App Services\",\r\n              \"deprecated\": true\r\n            },\r\n            \"defaultValue\": \"3.6\"\r\n          },\r\n          \"LinuxPythonLatestVersion\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Linux Latest Python version\",\r\n              \"description\": \"Latest supported Python version for App Services\"\r\n            },\r\n            \"defaultValue\": \"3.9\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"app*\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"contains\": \"linux\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/web.linuxFxVersion\",\r\n                    \"notContains\": \"PYTHON\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/web.linuxFxVersion\",\r\n                    \"equals\": \"[concat('PYTHON|', parameters('LinuxPythonLatestVersion'))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7008174a-fd10-4ef0-817e-fc820a951d73\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7008174a-fd10-4ef0-817e-fc820a951d73\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"OS and data disks should be encrypted with a customer-managed key\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use customer-managed keys to manage the encryption at rest of the contents of your managed disks. By default, the data is encrypted at rest with platform-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more at https://aka.ms/disks-cmk.\",\r\n        \"metadata\": {\r\n          \"category\": \"Compute\",\r\n          \"version\": \"2.0.0\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.managedDisk.diskEncryptionSet.id\",\r\n                    \"exists\": \"False\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[length(field('Microsoft.Compute/virtualMachines/storageProfile.dataDisks'))]\",\r\n                    \"greater\": 0\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.dataDisks[*].managedDisk.id\",\r\n                    \"exists\": \"False\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.dataDisks[*].managedDisk.diskEncryptionSet.id\",\r\n                    \"exists\": \"False\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/virtualMachineProfile.storageProfile.osDisk.managedDisk.diskEncryptionSet.id\",\r\n                    \"exists\": \"False\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n                  },\r\n                  {\r\n                    \"count\": {\r\n                      \"field\": \"Microsoft.Compute/virtualMachineScaleSets/virtualMachineProfile.storageProfile.dataDisks[*]\"\r\n                    },\r\n                    \"greater\": 0\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Compute/virtualMachineScaleSets/virtualMachineProfile.storageProfile.dataDisks[*].managedDisk.diskEncryptionSet.id\",\r\n                      \"exists\": \"true\"\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/disks\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/disks/managedBy\",\r\n                    \"exists\": \"False\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/disks/encryption.diskEncryptionSetId\",\r\n                    \"exists\": \"False\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/galleries/images/versions\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[length(field('Microsoft.Compute/galleries/images/versions/publishingProfile.targetRegions[*].encryption.osDiskImage.diskEncryptionSetId'))]\",\r\n                    \"notEquals\": \"[length(field('Microsoft.Compute/galleries/images/versions/publishingProfile.targetRegions[*]'))]\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/galleries/images/versions\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[length(field('Microsoft.Compute/galleries/images/versions/storageProfile.dataDiskImages[*]'))]\",\r\n                    \"greater\": 0\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"count\": {\r\n                          \"field\": \"Microsoft.Compute/galleries/images/versions/publishingProfile.targetRegions[*]\",\r\n                          \"where\": {\r\n                            \"value\": \"[length(current('Microsoft.Compute/galleries/images/versions/publishingProfile.targetRegions[*].encryption.dataDiskImages[*].diskEncryptionSetId'))]\",\r\n                            \"notEquals\": \"[length(field('Microsoft.Compute/galleries/images/versions/storageProfile.dataDiskImages[*]'))]\"\r\n                          }\r\n                        },\r\n                        \"greater\": 0\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.Compute/galleries/images/versions/publishingProfile.targetRegions[*].encryption.dataDiskImages[*].diskEncryptionSetId\",\r\n                          \"exists\": \"true\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/images\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/images/storageProfile.osDisk.diskEncryptionSet.id\",\r\n                    \"exists\": \"False\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/images\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[length(field('Microsoft.Compute/images/storageProfile.dataDisks[*]'))]\",\r\n                    \"greater\": 0\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Compute/images/storageProfile.dataDisks[*].diskEncryptionSet.id\",\r\n                      \"exists\": \"true\"\r\n                    }\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/702dd420-7fcc-42c5-afe8-4026edd20fe0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"702dd420-7fcc-42c5-afe8-4026edd20fe0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs configurations in 'Windows Components'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Windows Components'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"SendFileSamplesWhenFurtherAnalysisIsRequired\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Send file samples when further analysis is required\",\r\n              \"description\": \"Specifies whether and how Windows Defender will submit samples of suspected malware  to Microsoft for further analysis when opt-in for MAPS telemetry is set.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"AllowIndexingOfEncryptedFiles\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allow indexing of encrypted files\",\r\n              \"description\": \"Specifies whether encrypted items are allowed to be indexed.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"AllowTelemetry\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allow Telemetry\",\r\n              \"description\": \"Specifies configuration of the amount of diagnostic and usage data reported to Microsoft. The data is transmitted securely and sensitive data is not sent.\"\r\n            },\r\n            \"defaultValue\": \"2\"\r\n          },\r\n          \"AllowUnencryptedTraffic\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allow unencrypted traffic\",\r\n              \"description\": \"Specifies whether the Windows Remote Management (WinRM) service sends and receives unencrypted messages over the network.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"AlwaysInstallWithElevatedPrivileges\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Always install with elevated privileges\",\r\n              \"description\": \"Specifies whether Windows Installer should use system permissions when it installs any program on the system.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"AlwaysPromptForPasswordUponConnection\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Always prompt for password upon connection\",\r\n              \"description\": \"Specifies whether Terminal Services/Remote Desktop Connection always prompts the client computer for a password upon connection.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"ApplicationSpecifyTheMaximumLogFileSizeKB\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Application: Specify the maximum log file size (KB)\",\r\n              \"description\": \"Specifies the maximum size for the Application event log in kilobytes.\"\r\n            },\r\n            \"defaultValue\": \"32768\"\r\n          },\r\n          \"AutomaticallySendMemoryDumpsForOSgeneratedErrorReports\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Automatically send memory dumps for OS-generated error reports\",\r\n              \"description\": \"Specifies if memory dumps in support of OS-generated error reports can be sent to Microsoft automatically.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"ConfigureDefaultConsent\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Configure Default consent\",\r\n              \"description\": \"Specifies setting of the default consent handling for error reports sent to Microsoft.\"\r\n            },\r\n            \"defaultValue\": \"4\"\r\n          },\r\n          \"ConfigureWindowsSmartScreen\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Configure Windows SmartScreen\",\r\n              \"description\": \"Specifies how to manage the behavior of Windows SmartScreen. Windows SmartScreen helps keep PCs safer by warning users before running unrecognized programs downloaded from the Internet. Some information is sent to Microsoft about files and programs run on PCs with this feature enabled.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"DisallowDigestAuthentication\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Disallow Digest authentication\",\r\n              \"description\": \"Specifies whether the Windows Remote Management (WinRM) client will not use Digest authentication.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"DisallowWinRMFromStoringRunAsCredentials\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Disallow WinRM from storing RunAs credentials\",\r\n              \"description\": \"Specifies whether the Windows Remote Management (WinRM) service will not allow RunAs credentials to be stored for any plug-ins.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"DoNotAllowPasswordsToBeSaved\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Do not allow passwords to be saved\",\r\n              \"description\": \"Specifies whether to prevent Remote Desktop Services - Terminal Services clients from saving passwords on a computer.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"SecuritySpecifyTheMaximumLogFileSizeKB\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Security: Specify the maximum log file size (KB)\",\r\n              \"description\": \"Specifies the maximum size for the Security event log in kilobytes.\"\r\n            },\r\n            \"defaultValue\": \"196608\"\r\n          },\r\n          \"SetClientConnectionEncryptionLevel\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Set client connection encryption level\",\r\n              \"description\": \"Specifies whether to require the use of a specific encryption level to secure communications between client computers and RD Session Host servers during Remote Desktop Protocol (RDP) connections. This policy only applies when you are using native RDP encryption.\"\r\n            },\r\n            \"defaultValue\": \"3\"\r\n          },\r\n          \"SetTheDefaultBehaviorForAutoRun\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Set the default behavior for AutoRun\",\r\n              \"description\": \"Specifies the default behavior for Autorun commands. Autorun commands are generally stored in autorun.inf files. They often launch the installation program or other routines.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"SetupSpecifyTheMaximumLogFileSizeKB\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Setup: Specify the maximum log file size (KB)\",\r\n              \"description\": \"Specifies the maximum size for the Setup event log in kilobytes.\"\r\n            },\r\n            \"defaultValue\": \"32768\"\r\n          },\r\n          \"SystemSpecifyTheMaximumLogFileSizeKB\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"System: Specify the maximum log file size (KB)\",\r\n              \"description\": \"Specifies the maximum size for the System event log in kilobytes.\"\r\n            },\r\n            \"defaultValue\": \"32768\"\r\n          },\r\n          \"TurnOffDataExecutionPreventionForExplorer\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Turn off Data Execution Prevention for Explorer\",\r\n              \"description\": \"Specifies whether to turn off Data Execution Prevention for Windows File Explorer. Disabling data execution prevention can allow certain legacy plug-in applications to function without terminating Explorer.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"SpecifyTheIntervalToCheckForDefinitionUpdates\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Specify the interval to check for definition updates\",\r\n              \"description\": \"Specifies an interval at which to check for Windows Defender definition updates. The time value is represented as the number of hours between update checks.\"\r\n            },\r\n            \"defaultValue\": \"8\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_WindowsComponents\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('Send file samples when further analysis is required;ExpectedValue', '=', parameters('SendFileSamplesWhenFurtherAnalysisIsRequired'), ',', 'Allow indexing of encrypted files;ExpectedValue', '=', parameters('AllowIndexingOfEncryptedFiles'), ',', 'Allow Telemetry;ExpectedValue', '=', parameters('AllowTelemetry'), ',', 'Allow unencrypted traffic;ExpectedValue', '=', parameters('AllowUnencryptedTraffic'), ',', 'Always install with elevated privileges;ExpectedValue', '=', parameters('AlwaysInstallWithElevatedPrivileges'), ',', 'Always prompt for password upon connection;ExpectedValue', '=', parameters('AlwaysPromptForPasswordUponConnection'), ',', 'Application: Specify the maximum log file size (KB);ExpectedValue', '=', parameters('ApplicationSpecifyTheMaximumLogFileSizeKB'), ',', 'Automatically send memory dumps for OS-generated error reports;ExpectedValue', '=', parameters('AutomaticallySendMemoryDumpsForOSgeneratedErrorReports'), ',', 'Configure Default consent;ExpectedValue', '=', parameters('ConfigureDefaultConsent'), ',', 'Configure Windows SmartScreen;ExpectedValue', '=', parameters('ConfigureWindowsSmartScreen'), ',', 'Disallow Digest authentication;ExpectedValue', '=', parameters('DisallowDigestAuthentication'), ',', 'Disallow WinRM from storing RunAs credentials;ExpectedValue', '=', parameters('DisallowWinRMFromStoringRunAsCredentials'), ',', 'Do not allow passwords to be saved;ExpectedValue', '=', parameters('DoNotAllowPasswordsToBeSaved'), ',', 'Security: Specify the maximum log file size (KB);ExpectedValue', '=', parameters('SecuritySpecifyTheMaximumLogFileSizeKB'), ',', 'Set client connection encryption level;ExpectedValue', '=', parameters('SetClientConnectionEncryptionLevel'), ',', 'Set the default behavior for AutoRun;ExpectedValue', '=', parameters('SetTheDefaultBehaviorForAutoRun'), ',', 'Setup: Specify the maximum log file size (KB);ExpectedValue', '=', parameters('SetupSpecifyTheMaximumLogFileSizeKB'), ',', 'System: Specify the maximum log file size (KB);ExpectedValue', '=', parameters('SystemSpecifyTheMaximumLogFileSizeKB'), ',', 'Turn off Data Execution Prevention for Explorer;ExpectedValue', '=', parameters('TurnOffDataExecutionPreventionForExplorer'), ',', 'Specify the interval to check for definition updates;ExpectedValue', '=', parameters('SpecifyTheIntervalToCheckForDefinitionUpdates')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AzureBaseline_WindowsComponents\"\r\n                    },\r\n                    \"SendFileSamplesWhenFurtherAnalysisIsRequired\": {\r\n                      \"value\": \"[parameters('SendFileSamplesWhenFurtherAnalysisIsRequired')]\"\r\n                    },\r\n                    \"AllowIndexingOfEncryptedFiles\": {\r\n                      \"value\": \"[parameters('AllowIndexingOfEncryptedFiles')]\"\r\n                    },\r\n                    \"AllowTelemetry\": {\r\n                      \"value\": \"[parameters('AllowTelemetry')]\"\r\n                    },\r\n                    \"AllowUnencryptedTraffic\": {\r\n                      \"value\": \"[parameters('AllowUnencryptedTraffic')]\"\r\n                    },\r\n                    \"AlwaysInstallWithElevatedPrivileges\": {\r\n                      \"value\": \"[parameters('AlwaysInstallWithElevatedPrivileges')]\"\r\n                    },\r\n                    \"AlwaysPromptForPasswordUponConnection\": {\r\n                      \"value\": \"[parameters('AlwaysPromptForPasswordUponConnection')]\"\r\n                    },\r\n                    \"ApplicationSpecifyTheMaximumLogFileSizeKB\": {\r\n                      \"value\": \"[parameters('ApplicationSpecifyTheMaximumLogFileSizeKB')]\"\r\n                    },\r\n                    \"AutomaticallySendMemoryDumpsForOSgeneratedErrorReports\": {\r\n                      \"value\": \"[parameters('AutomaticallySendMemoryDumpsForOSgeneratedErrorReports')]\"\r\n                    },\r\n                    \"ConfigureDefaultConsent\": {\r\n                      \"value\": \"[parameters('ConfigureDefaultConsent')]\"\r\n                    },\r\n                    \"ConfigureWindowsSmartScreen\": {\r\n                      \"value\": \"[parameters('ConfigureWindowsSmartScreen')]\"\r\n                    },\r\n                    \"DisallowDigestAuthentication\": {\r\n                      \"value\": \"[parameters('DisallowDigestAuthentication')]\"\r\n                    },\r\n                    \"DisallowWinRMFromStoringRunAsCredentials\": {\r\n                      \"value\": \"[parameters('DisallowWinRMFromStoringRunAsCredentials')]\"\r\n                    },\r\n                    \"DoNotAllowPasswordsToBeSaved\": {\r\n                      \"value\": \"[parameters('DoNotAllowPasswordsToBeSaved')]\"\r\n                    },\r\n                    \"SecuritySpecifyTheMaximumLogFileSizeKB\": {\r\n                      \"value\": \"[parameters('SecuritySpecifyTheMaximumLogFileSizeKB')]\"\r\n                    },\r\n                    \"SetClientConnectionEncryptionLevel\": {\r\n                      \"value\": \"[parameters('SetClientConnectionEncryptionLevel')]\"\r\n                    },\r\n                    \"SetTheDefaultBehaviorForAutoRun\": {\r\n                      \"value\": \"[parameters('SetTheDefaultBehaviorForAutoRun')]\"\r\n                    },\r\n                    \"SetupSpecifyTheMaximumLogFileSizeKB\": {\r\n                      \"value\": \"[parameters('SetupSpecifyTheMaximumLogFileSizeKB')]\"\r\n                    },\r\n                    \"SystemSpecifyTheMaximumLogFileSizeKB\": {\r\n                      \"value\": \"[parameters('SystemSpecifyTheMaximumLogFileSizeKB')]\"\r\n                    },\r\n                    \"TurnOffDataExecutionPreventionForExplorer\": {\r\n                      \"value\": \"[parameters('TurnOffDataExecutionPreventionForExplorer')]\"\r\n                    },\r\n                    \"SpecifyTheIntervalToCheckForDefinitionUpdates\": {\r\n                      \"value\": \"[parameters('SpecifyTheIntervalToCheckForDefinitionUpdates')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"SendFileSamplesWhenFurtherAnalysisIsRequired\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AllowIndexingOfEncryptedFiles\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AllowTelemetry\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AllowUnencryptedTraffic\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AlwaysInstallWithElevatedPrivileges\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AlwaysPromptForPasswordUponConnection\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ApplicationSpecifyTheMaximumLogFileSizeKB\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AutomaticallySendMemoryDumpsForOSgeneratedErrorReports\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ConfigureDefaultConsent\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ConfigureWindowsSmartScreen\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"DisallowDigestAuthentication\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"DisallowWinRMFromStoringRunAsCredentials\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"DoNotAllowPasswordsToBeSaved\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"SecuritySpecifyTheMaximumLogFileSizeKB\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"SetClientConnectionEncryptionLevel\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"SetTheDefaultBehaviorForAutoRun\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"SetupSpecifyTheMaximumLogFileSizeKB\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"SystemSpecifyTheMaximumLogFileSizeKB\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"TurnOffDataExecutionPreventionForExplorer\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"SpecifyTheIntervalToCheckForDefinitionUpdates\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Send file samples when further analysis is required;ExpectedValue\",\r\n                                \"value\": \"[parameters('SendFileSamplesWhenFurtherAnalysisIsRequired')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Allow indexing of encrypted files;ExpectedValue\",\r\n                                \"value\": \"[parameters('AllowIndexingOfEncryptedFiles')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Allow Telemetry;ExpectedValue\",\r\n                                \"value\": \"[parameters('AllowTelemetry')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Allow unencrypted traffic;ExpectedValue\",\r\n                                \"value\": \"[parameters('AllowUnencryptedTraffic')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Always install with elevated privileges;ExpectedValue\",\r\n                                \"value\": \"[parameters('AlwaysInstallWithElevatedPrivileges')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Always prompt for password upon connection;ExpectedValue\",\r\n                                \"value\": \"[parameters('AlwaysPromptForPasswordUponConnection')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Application: Specify the maximum log file size (KB);ExpectedValue\",\r\n                                \"value\": \"[parameters('ApplicationSpecifyTheMaximumLogFileSizeKB')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Automatically send memory dumps for OS-generated error reports;ExpectedValue\",\r\n                                \"value\": \"[parameters('AutomaticallySendMemoryDumpsForOSgeneratedErrorReports')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Configure Default consent;ExpectedValue\",\r\n                                \"value\": \"[parameters('ConfigureDefaultConsent')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Configure Windows SmartScreen;ExpectedValue\",\r\n                                \"value\": \"[parameters('ConfigureWindowsSmartScreen')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Disallow Digest authentication;ExpectedValue\",\r\n                                \"value\": \"[parameters('DisallowDigestAuthentication')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Disallow WinRM from storing RunAs credentials;ExpectedValue\",\r\n                                \"value\": \"[parameters('DisallowWinRMFromStoringRunAsCredentials')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Do not allow passwords to be saved;ExpectedValue\",\r\n                                \"value\": \"[parameters('DoNotAllowPasswordsToBeSaved')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Security: Specify the maximum log file size (KB);ExpectedValue\",\r\n                                \"value\": \"[parameters('SecuritySpecifyTheMaximumLogFileSizeKB')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Set client connection encryption level;ExpectedValue\",\r\n                                \"value\": \"[parameters('SetClientConnectionEncryptionLevel')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Set the default behavior for AutoRun;ExpectedValue\",\r\n                                \"value\": \"[parameters('SetTheDefaultBehaviorForAutoRun')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Setup: Specify the maximum log file size (KB);ExpectedValue\",\r\n                                \"value\": \"[parameters('SetupSpecifyTheMaximumLogFileSizeKB')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"System: Specify the maximum log file size (KB);ExpectedValue\",\r\n                                \"value\": \"[parameters('SystemSpecifyTheMaximumLogFileSizeKB')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Turn off Data Execution Prevention for Explorer;ExpectedValue\",\r\n                                \"value\": \"[parameters('TurnOffDataExecutionPreventionForExplorer')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Specify the interval to check for definition updates;ExpectedValue\",\r\n                                \"value\": \"[parameters('SpecifyTheIntervalToCheckForDefinitionUpdates')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Send file samples when further analysis is required;ExpectedValue\",\r\n                                \"value\": \"[parameters('SendFileSamplesWhenFurtherAnalysisIsRequired')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Allow indexing of encrypted files;ExpectedValue\",\r\n                                \"value\": \"[parameters('AllowIndexingOfEncryptedFiles')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Allow Telemetry;ExpectedValue\",\r\n                                \"value\": \"[parameters('AllowTelemetry')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Allow unencrypted traffic;ExpectedValue\",\r\n                                \"value\": \"[parameters('AllowUnencryptedTraffic')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Always install with elevated privileges;ExpectedValue\",\r\n                                \"value\": \"[parameters('AlwaysInstallWithElevatedPrivileges')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Always prompt for password upon connection;ExpectedValue\",\r\n                                \"value\": \"[parameters('AlwaysPromptForPasswordUponConnection')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Application: Specify the maximum log file size (KB);ExpectedValue\",\r\n                                \"value\": \"[parameters('ApplicationSpecifyTheMaximumLogFileSizeKB')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Automatically send memory dumps for OS-generated error reports;ExpectedValue\",\r\n                                \"value\": \"[parameters('AutomaticallySendMemoryDumpsForOSgeneratedErrorReports')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Configure Default consent;ExpectedValue\",\r\n                                \"value\": \"[parameters('ConfigureDefaultConsent')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Configure Windows SmartScreen;ExpectedValue\",\r\n                                \"value\": \"[parameters('ConfigureWindowsSmartScreen')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Disallow Digest authentication;ExpectedValue\",\r\n                                \"value\": \"[parameters('DisallowDigestAuthentication')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Disallow WinRM from storing RunAs credentials;ExpectedValue\",\r\n                                \"value\": \"[parameters('DisallowWinRMFromStoringRunAsCredentials')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Do not allow passwords to be saved;ExpectedValue\",\r\n                                \"value\": \"[parameters('DoNotAllowPasswordsToBeSaved')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Security: Specify the maximum log file size (KB);ExpectedValue\",\r\n                                \"value\": \"[parameters('SecuritySpecifyTheMaximumLogFileSizeKB')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Set client connection encryption level;ExpectedValue\",\r\n                                \"value\": \"[parameters('SetClientConnectionEncryptionLevel')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Set the default behavior for AutoRun;ExpectedValue\",\r\n                                \"value\": \"[parameters('SetTheDefaultBehaviorForAutoRun')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Setup: Specify the maximum log file size (KB);ExpectedValue\",\r\n                                \"value\": \"[parameters('SetupSpecifyTheMaximumLogFileSizeKB')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"System: Specify the maximum log file size (KB);ExpectedValue\",\r\n                                \"value\": \"[parameters('SystemSpecifyTheMaximumLogFileSizeKB')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Turn off Data Execution Prevention for Explorer;ExpectedValue\",\r\n                                \"value\": \"[parameters('TurnOffDataExecutionPreventionForExplorer')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Specify the interval to check for definition updates;ExpectedValue\",\r\n                                \"value\": \"[parameters('SpecifyTheIntervalToCheckForDefinitionUpdates')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7040a231-fb65-4412-8c0a-b365f4866c24\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7040a231-fb65-4412-8c0a-b365f4866c24\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs configurations in 'System Audit Policies - System'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - System'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SystemAuditPoliciesSystem\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7066131b-61a6-4917-a7e4-72e8983f0aa6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7066131b-61a6-4917-a7e4-72e8983f0aa6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs on which the DSC configuration is not compliant\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows VMs on which the Desired State Configuration (DSC) configuration is not compliant. This policy is only applicable to machines with WMF 4 and above. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsDscConfiguration\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7227ebe5-9ff7-47ab-b823-171cd02fb90f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7227ebe5-9ff7-47ab-b823-171cd02fb90f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs configurations in 'Administrative Templates - Network'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Administrative Templates - Network'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_AdministrativeTemplatesNetwork\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7229bd6a-693d-478a-87f0-1dc1af06f3b8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7229bd6a-693d-478a-87f0-1dc1af06f3b8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Ensure that 'Python version' is the latest, if used as a part of the Function app\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Periodically, newer versions are released for Python software either due to security flaws or to include additional functionality. Using the latest Python version for Function apps is recommended in order to take advantage of security fixes, if any, and/or new functionalities of the latest version. Currently, this policy only applies to Linux web apps.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"WindowsPythonLatestVersion\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"[Deprecated]: Latest Windows Python version\",\r\n              \"description\": \"Latest supported Python version for App Services\",\r\n              \"deprecated\": true\r\n            },\r\n            \"defaultValue\": \"3.6\"\r\n          },\r\n          \"LinuxPythonLatestVersion\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Linux Latest Python version\",\r\n              \"description\": \"Latest supported Python version for App Services\"\r\n            },\r\n            \"defaultValue\": \"3.9\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"functionapp*\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"contains\": \"linux\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/web.linuxFxVersion\",\r\n                    \"notContains\": \"PYTHON\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/web.linuxFxVersion\",\r\n                    \"equals\": \"[concat('PYTHON|', parameters('LinuxPythonLatestVersion'))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7238174a-fd10-4ef0-817e-fc820a951d73\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7238174a-fd10-4ef0-817e-fc820a951d73\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Ensure that 'PHP version' is the latest, if used as a part of the WEB app\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Periodically, newer versions are released for PHP software either due to security flaws or to include additional functionality. Using the latest PHP version for web apps is recommended in order to take advantage of security fixes, if any, and/or new functionalities of the latest version. Currently, this policy only applies to Linux web apps.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.1.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"PHPLatestVersion\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Latest PHP version\",\r\n              \"description\": \"Latest supported PHP version for App Services\"\r\n            },\r\n            \"defaultValue\": \"7.4\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"app*\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"contains\": \"linux\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/web.linuxFxVersion\",\r\n                    \"notContains\": \"PHP\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/web.linuxFxVersion\",\r\n                    \"equals\": \"[concat('PHP|', parameters('PHPLatestVersion'))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7261b898-8a84-4db8-9e04-18527132abb3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7261b898-8a84-4db8-9e04-18527132abb3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Windows machines should meet requirements of the Azure compute security baseline\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if the machine is not configured correctly for one of the recommendations in the Azure compute security baseline.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.1-preview\",\r\n          \"preview\": true,\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureWindowsBaseline\",\r\n            \"version\": \"1.*\"\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureWindowsBaseline\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/72650e9f-97bc-4b2a-ab5f-9781a9fcecbc\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"72650e9f-97bc-4b2a-ab5f-9781a9fcecbc\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs that allow re-use of the previous 24 passwords\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines that allow re-use of the previous 24 passwords. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"2.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"EnforcePasswordHistory\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"EnforcePasswordHistory\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/726671ac-c4de-4908-8c7d-6043ae62e3b6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"726671ac-c4de-4908-8c7d-6043ae62e3b6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Add a tag to resource groups\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Adds the specified tag and value when any resource group missing this tag is created or updated. Existing resource groups can be remediated by triggering a remediation task. If the tag exists with a different value it will not be changed.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Tags\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            }\r\n          },\r\n          \"tagValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Value\",\r\n              \"description\": \"Value of the tag, such as 'production'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Resources/subscriptions/resourceGroups\"\r\n              },\r\n              {\r\n                \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                \"exists\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"modify\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"operations\": [\r\n                {\r\n                  \"operation\": \"add\",\r\n                  \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                  \"value\": \"[parameters('tagValue')]\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/726aca4c-86e9-4b04-b0c5-073027359532\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"726aca4c-86e9-4b04-b0c5-073027359532\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Synapse workspaces should use private link\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to Azure Synapse workspace, data leakage risks are reduced. Learn more about private links at: https://docs.microsoft.com/azure/synapse-analytics/security/how-to-connect-to-workspace-with-private-links.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"Synapse\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Synapse/workspaces\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Synapse/workspaces/privateEndpointConnections[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.Synapse/workspaces/privateEndpointConnections[*].privateLinkServiceConnectionState.status\",\r\n                    \"equals\": \"Approved\"\r\n                  }\r\n                },\r\n                \"less\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/72d11df1-dd8a-41f7-8925-b05b960ebafc\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"72d11df1-dd8a-41f7-8925-b05b960ebafc\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure App Configuration to disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disable public network access for App Configuration so that it isn't accessible over the public internet. This configuration helps protect them against data leakage risks. You can limit exposure of the your resources by creating private endpoints instead. Learn more at: https://aka.ms/appconfig/private-endpoint.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Configuration\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Modify\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Modify\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.AppConfiguration/configurationStores\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.AppConfiguration/configurationStores/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"conflictEffect\": \"audit\",\r\n              \"operations\": [\r\n                {\r\n                  \"condition\": \"[greater(requestContext().apiVersion, '2019-10-01')]\",\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.AppConfiguration/configurationStores/publicNetworkAccess\",\r\n                  \"value\": \"Disabled\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/73290fa2-dfa7-4bbb-945d-a5e23b75df2c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"73290fa2-dfa7-4bbb-945d-a5e23b75df2c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Workflow Automation for Azure Security Center recommendations\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Enable automation of Azure Security Center recommendations. This policy deploys a workflow automation with your conditions and triggers on the assigned scope. To deploy this policy on newly created subscriptions, open the Compliance tab, select the relevant non-compliant assignment and create a remediation task.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"automationName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Automation name\",\r\n              \"description\": \"This is the automation name.\"\r\n            }\r\n          },\r\n          \"resourceGroupName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Resource group name\",\r\n              \"description\": \"The resource group name where the workflow automation is created. If you enter a name for a resource group that doesn't exist, it'll be created in the subscription.\"\r\n            }\r\n          },\r\n          \"resourceGroupLocation\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Resource group location\",\r\n              \"description\": \"The location where the resource group and the workflow automation are created.\",\r\n              \"strongType\": \"location\"\r\n            }\r\n          },\r\n          \"recommendationNames\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Recommendation IDs\",\r\n              \"description\": \"For all recommendations, leave empty. For specific recommendations, enter a list of recommendation IDs separated by semicolons (';'). Recommendation IDs are available through the Assessments API (https://docs.microsoft.com/en-us/rest/api/securitycenter/assessments), or Azure Resource Graph Explorer, choose securityresources and microsoft.security/assessments.\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"recommendationSeverities\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Recommendation severities\",\r\n              \"description\": \"Determines recommendation severities. Example: High;Medium;Low;\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"High\",\r\n              \"Medium\",\r\n              \"Low\"\r\n            ],\r\n            \"defaultValue\": [\r\n              \"High\",\r\n              \"Medium\",\r\n              \"Low\"\r\n            ]\r\n          },\r\n          \"recommendationStates\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Recommendation states\",\r\n              \"description\": \"Determines recommendation states. Recommendations with unhealthy state require your attention to resolve. When a recommendation state is healthy, it no longer applies to the resource as Security Center detects it as healthy. A recommendation is not-applicable if, for example, it was disabled in the Security Policy. Example: Healthy;Unhealthy;Not Applicable;\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Healthy\",\r\n              \"Unhealthy\",\r\n              \"Not Applicable\"\r\n            ],\r\n            \"defaultValue\": [\r\n              \"Healthy\",\r\n              \"Unhealthy\",\r\n              \"Not Applicable\"\r\n            ]\r\n          },\r\n          \"logicAppResourceId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Logic App\",\r\n              \"description\": \"The Logic App that is triggered.\",\r\n              \"strongType\": \"Microsoft.Logic/workflows\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"logicAppTrigger\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Logic app trigger\",\r\n              \"description\": \"The trigger connector of the logic app that is triggered. Possible values: 'Manual (Incoming HTTP request)', 'When an Azure Security Center Recommendation is created or triggered'.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Manual (Incoming HTTP request)\",\r\n              \"When an Azure Security Center Recommendation is created or triggered\"\r\n            ]\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/automations\",\r\n              \"name\": \"[parameters('automationName')]\",\r\n              \"existenceScope\": \"resourcegroup\",\r\n              \"ResourceGroupName\": \"[parameters('resourceGroupName')]\",\r\n              \"deploymentScope\": \"subscription\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Security/automations/isEnabled\",\r\n                    \"equals\": true\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*].expectedValue\",\r\n                    \"in\": \"[union(if(equals(length(parameters('recommendationNames')),0),array('Microsoft.Security/assessments'),parameters('recommendationNames')),parameters('recommendationSeverities'),if(contains(parameters('recommendationStates'),'Not Applicable'),union(parameters('recommendationStates'), array('notapplicable')),parameters('recommendationStates')))]\"\r\n                  },\r\n                  {\r\n                    \"count\": {\r\n                      \"value\": \"[parameters('recommendationSeverities')]\",\r\n                      \"name\": \"recommendationSeverity\",\r\n                      \"where\": {\r\n                        \"count\": {\r\n                          \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*]\",\r\n                          \"where\": {\r\n                            \"allOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*].propertyJPath\",\r\n                                \"equals\": \"properties.metadata.severity\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*].expectedValue\",\r\n                                \"equals\": \"[current('recommendationSeverity')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        },\r\n                        \"equals\": \"[mul(max(1,length(parameters('recommendationNames'))),length(parameters('recommendationStates')))]\"\r\n                      }\r\n                    },\r\n                    \"equals\": \"[length(parameters('recommendationSeverities'))]\"\r\n                  },\r\n                  {\r\n                    \"count\": {\r\n                      \"value\": \"[parameters('recommendationStates')]\",\r\n                      \"name\": \"recommendationState\",\r\n                      \"where\": {\r\n                        \"count\": {\r\n                          \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*]\",\r\n                          \"where\": {\r\n                            \"allOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*].propertyJPath\",\r\n                                \"equals\": \"properties.status.code\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*].expectedValue\",\r\n                                \"equals\": \"[replace(current('recommendationState'), ' ','')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        },\r\n                        \"equals\": \"[mul(max(1,length(parameters('recommendationNames'))),length(parameters('recommendationSeverities')))]\"\r\n                      }\r\n                    },\r\n                    \"equals\": \"[length(parameters('recommendationStates'))]\"\r\n                  },\r\n                  {\r\n                    \"count\": {\r\n                      \"value\": \"[parameters('recommendationNames')]\",\r\n                      \"name\": \"recommendationName\",\r\n                      \"where\": {\r\n                        \"count\": {\r\n                          \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*]\",\r\n                          \"where\": {\r\n                            \"allOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*].propertyJPath\",\r\n                                \"equals\": \"name\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Security/automations/sources[*].ruleSets[*].rules[*].expectedValue\",\r\n                                \"equals\": \"[current('recommendationName')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        },\r\n                        \"equals\": \"[mul(length(parameters('recommendationSeverities')),length(parameters('recommendationStates')))]\"\r\n                      }\r\n                    },\r\n                    \"equals\": \"[length(parameters('recommendationNames'))]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"location\": \"westeurope\",\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"automationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"resourceGroupName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"resourceGroupLocation\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"recommendationNames\": {\r\n                        \"type\": \"array\"\r\n                      },\r\n                      \"recommendationSeverities\": {\r\n                        \"type\": \"array\"\r\n                      },\r\n                      \"recommendationStates\": {\r\n                        \"type\": \"array\"\r\n                      },\r\n                      \"logicAppResourceId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logicAppTrigger\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"guidValue\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"[newGuid()]\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"scopeDescription\": \"scope for subscription {0}\",\r\n                      \"recommendationNamesLength\": \"[length(parameters('recommendationNames'))]\",\r\n                      \"recommendationSeveritiesLength\": \"[length(parameters('recommendationSeverities'))]\",\r\n                      \"recommendationStatesLength\": \"[length(parameters('recommendationStates'))]\",\r\n                      \"recommendationNamesLengthIfEmpty\": \"[if(equals(variables('recommendationNamesLength'), 0), 1, variables('recommendationNamesLength'))]\",\r\n                      \"recommendationSeveritiesLengthIfEmpty\": \"[if(equals(variables('recommendationSeveritiesLength'), 0), 1, variables('recommendationSeveritiesLength'))]\",\r\n                      \"recommendationStatesLengthIfEmpty\": \"[if(equals(variables('recommendationStatesLength'), 0), 1, variables('recommendationStatesLength'))]\",\r\n                      \"totalRuleCombinationsForOneRecommendationName\": \"[mul(variables('recommendationSeveritiesLengthIfEmpty'),variables('recommendationStatesLengthIfEmpty'))]\",\r\n                      \"totalRuleCombinationsForOneRecommendationSeverity\": \"[variables('recommendationStatesLengthIfEmpty')]\",\r\n                      \"totalRuleCombinationsForOneRecommendationState\": 1,\r\n                      \"stateMap\": {\r\n                        \"Healthy\": \"healthy\",\r\n                        \"Unhealthy\": \"unhealthy\",\r\n                        \"Not Applicable\": \"notapplicable\"\r\n                      },\r\n                      \"triggerMap\": {\r\n                        \"Manual (Incoming HTTP request)\": \"manual\",\r\n                        \"When an Azure Security Center Recommendation is created or triggered\": \"When_an_Azure_Security_Center_Recommendation_is_created_or_triggered\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[parameters('resourceGroupName')]\",\r\n                        \"type\": \"Microsoft.Resources/resourceGroups\",\r\n                        \"apiVersion\": \"2019-10-01\",\r\n                        \"location\": \"[parameters('resourceGroupLocation')]\",\r\n                        \"tags\": {},\r\n                        \"properties\": {}\r\n                      },\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"apiVersion\": \"2019-10-01\",\r\n                        \"name\": \"[concat('nestedAutomationDeployment', '_', parameters('guidValue'))]\",\r\n                        \"resourceGroup\": \"[parameters('resourceGroupName')]\",\r\n                        \"dependsOn\": [\r\n                          \"[resourceId('Microsoft.Resources/resourceGroups/', parameters('resourceGroupName'))]\"\r\n                        ],\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {},\r\n                            \"variables\": {},\r\n                            \"resources\": [\r\n                              {\r\n                                \"tags\": {},\r\n                                \"apiVersion\": \"2019-01-01-preview\",\r\n                                \"location\": \"[parameters('resourceGroupLocation')]\",\r\n                                \"name\": \"[parameters('automationName')]\",\r\n                                \"type\": \"Microsoft.Security/automations\",\r\n                                \"dependsOn\": [],\r\n                                \"properties\": {\r\n                                  \"description\": \"Workflow Automation for Azure Security Center recommendations via policy\",\r\n                                  \"isEnabled\": true,\r\n                                  \"scopes\": [\r\n                                    {\r\n                                      \"description\": \"[replace(variables('scopeDescription'),'{0}', subscription().subscriptionId)]\",\r\n                                      \"scopePath\": \"[subscription().id]\"\r\n                                    }\r\n                                  ],\r\n                                  \"sources\": [\r\n                                    {\r\n                                      \"eventSource\": \"Assessments\",\r\n                                      \"copy\": [\r\n                                        {\r\n                                          \"name\": \"ruleSets\",\r\n                                          \"count\": \"[mul(variables('recommendationNamesLengthIfEmpty'), mul(variables('recommendationSeveritiesLengthIfEmpty'),variables('recommendationStatesLengthIfEmpty')))]\",\r\n                                          \"input\": {\r\n                                            \"rules\": [\r\n                                              {\r\n                                                \"propertyJPath\": \"[if(equals(variables('recommendationNamesLength'), 0), 'type', 'name')]\",\r\n                                                \"propertyType\": \"string\",\r\n                                                \"expectedValue\": \"[if(equals(variables('recommendationNamesLength'), 0), 'Microsoft.Security/assessments', parameters('recommendationNames')[mod(div(copyIndex('ruleSets'), variables('totalRuleCombinationsForOneRecommendationName')), variables('recommendationNamesLength'))])]\",\r\n                                                \"operator\": \"Contains\"\r\n                                              },\r\n                                              {\r\n                                                \"propertyJPath\": \"properties.metadata.severity\",\r\n                                                \"propertyType\": \"string\",\r\n                                                \"expectedValue\": \"[parameters('recommendationSeverities')[mod(div(copyIndex('ruleSets'), variables('totalRuleCombinationsForOneRecommendationSeverity')), variables('recommendationSeveritiesLength'))]]\",\r\n                                                \"operator\": \"Equals\"\r\n                                              },\r\n                                              {\r\n                                                \"propertyJPath\": \"properties.status.code\",\r\n                                                \"propertyType\": \"string\",\r\n                                                \"expectedValue\": \"[variables('stateMap')[parameters('recommendationStates')[mod(div(copyIndex('ruleSets'), variables('totalRuleCombinationsForOneRecommendationState')), variables('recommendationStatesLength'))]]]\",\r\n                                                \"operator\": \"Contains\"\r\n                                              }\r\n                                            ]\r\n                                          }\r\n                                        }\r\n                                      ]\r\n                                    }\r\n                                  ],\r\n                                  \"actions\": [\r\n                                    {\r\n                                      \"actionType\": \"LogicApp\",\r\n                                      \"logicAppResourceId\": \"[parameters('logicAppResourceId')]\",\r\n                                      \"uri\": \"[listCallbackUrl(concat(parameters('logicAppResourceId'), '/triggers/', variables('triggerMap')[parameters('logicAppTrigger')]),'2016-06-01').value]\"\r\n                                    }\r\n                                  ]\r\n                                }\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"automationName\": {\r\n                      \"value\": \"[parameters('automationName')]\"\r\n                    },\r\n                    \"resourceGroupName\": {\r\n                      \"value\": \"[parameters('resourceGroupName')]\"\r\n                    },\r\n                    \"resourceGroupLocation\": {\r\n                      \"value\": \"[parameters('resourceGroupLocation')]\"\r\n                    },\r\n                    \"recommendationNames\": {\r\n                      \"value\": \"[parameters('recommendationNames')]\"\r\n                    },\r\n                    \"recommendationSeverities\": {\r\n                      \"value\": \"[parameters('recommendationSeverities')]\"\r\n                    },\r\n                    \"recommendationStates\": {\r\n                      \"value\": \"[parameters('recommendationStates')]\"\r\n                    },\r\n                    \"logicAppResourceId\": {\r\n                      \"value\": \"[parameters('logicAppResourceId')]\"\r\n                    },\r\n                    \"logicAppTrigger\": {\r\n                      \"value\": \"[parameters('logicAppTrigger')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/73d6ab6c-2475-4850-afd6-43795f3492ef\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"73d6ab6c-2475-4850-afd6-43795f3492ef\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Linux machines should only have local accounts that are allowed\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Managing user accounts using Azure Active Directory is a best practice for management of identities. Reducing local machine accounts helps prevent the proliferation of identities managed outside a central system. Machines are non-compliant if local user accounts exist that are enabled and not listed in the policy parameter.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"LocalUsers_Linux\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"Allowed\": \"[LocalUser]Accounts;Exclude\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"Allowed\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed local accounts\",\r\n              \"description\": \"List the name of accounts that should be excluded, seperated by a semicolon (';'). If these accounts exist and are enabled, they will be identified as Compliant.\"\r\n            },\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"microsoft-aks\",\r\n                          \"qubole-inc\",\r\n                          \"datastax\",\r\n                          \"couchbase\",\r\n                          \"scalegrid\",\r\n                          \"checkpoint\",\r\n                          \"paloaltonetworks\",\r\n                          \"debian\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"OpenLogic\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"CentOS*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Oracle\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Oracle-Linux\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"RHEL\",\r\n                              \"RHEL-HA\",\r\n                              \"RHEL-SAP\",\r\n                              \"RHEL-SAP-APPS\",\r\n                              \"RHEL-SAP-HA\",\r\n                              \"RHEL-SAP-HANA\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"osa\",\r\n                              \"rhel-byos\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"cis-centos-7-l1\",\r\n                              \"cis-centos-7-v2-1-1-l1\",\r\n                              \"cis-centos-8-l1\",\r\n                              \"cis-debian-linux-8-l1\",\r\n                              \"cis-debian-linux-9-l1\",\r\n                              \"cis-nginx-centos-7-v1-1-0-l1\",\r\n                              \"cis-oracle-linux-7-v2-0-0-l1\",\r\n                              \"cis-oracle-linux-8-l1\",\r\n                              \"cis-postgresql-11-centos-linux-7-level-1\",\r\n                              \"cis-rhel-7-l2\",\r\n                              \"cis-rhel-7-v2-2-0-l1\",\r\n                              \"cis-rhel-8-l1\",\r\n                              \"cis-suse-linux-12-v2-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1604-v1-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1804-l1\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"credativ\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Debian\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"7*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Suse\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"SLES*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"11*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Canonical\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"UbuntuServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"12*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"linux-data-science-vm-ubuntu\",\r\n                              \"azureml\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-centos-os\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-altus-centos-os\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"linux*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.linuxConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Linux*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"notIn\": [\r\n                                  \"OpenLogic\",\r\n                                  \"RedHat\",\r\n                                  \"credativ\",\r\n                                  \"Suse\",\r\n                                  \"Canonical\",\r\n                                  \"microsoft-dsvm\",\r\n                                  \"cloudera\",\r\n                                  \"microsoft-ads\",\r\n                                  \"center-for-internet-security-inc\",\r\n                                  \"Oracle\"\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"linux*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"LocalUsers_Linux\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('[LocalUser]Accounts;Exclude', '=', parameters('Allowed')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/73db37c4-f180-4b0f-ab2c-8ee96467686b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"73db37c4-f180-4b0f-ab2c-8ee96467686b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"API Management service should use a SKU that supports virtual networks\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"With supported SKUs of API Management, deploying service into a virtual network unlocks advanced API Management networking and security features which provides you greater control over your network security configuration. Learn more at: https://aka.ms/apimvnet.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"API Management\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          },\r\n          \"listOfAllowedSKUs\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"description\": \"The list of SKUs that can be specified for Azure API Management service.\",\r\n              \"displayName\": \"Allowed SKUs\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Developer\",\r\n              \"Basic\",\r\n              \"Standard\",\r\n              \"Premium\",\r\n              \"Isolated\",\r\n              \"Consumption\"\r\n            ],\r\n            \"defaultValue\": [\r\n              \"Developer\",\r\n              \"Premium\",\r\n              \"Isolated\"\r\n            ]\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ApiManagement/service\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.ApiManagement/service/sku.name\",\r\n                  \"in\": \"[parameters('listOfAllowedSKUs')]\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/73ef9241-5d81-4cd4-b483-8443d1730fe5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"73ef9241-5d81-4cd4-b483-8443d1730fe5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Storage accounts should be limited by allowed SKUs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Restrict the set of storage account SKUs that your organization can deploy.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.0\",\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the audit policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Deny\"\r\n          },\r\n          \"listOfAllowedSKUs\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"description\": \"The list of SKUs that can be specified for storage accounts.\",\r\n              \"displayName\": \"Allowed SKUs\",\r\n              \"strongType\": \"StorageSKUs\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Storage/storageAccounts/sku.name\",\r\n                  \"in\": \"[parameters('listOfAllowedSKUs')]\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7433c107-6db4-4ad1-b57a-a76dce0154a1\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7433c107-6db4-4ad1-b57a-a76dce0154a1\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Ensure that 'Python version' is the latest, if used as a part of the API app\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Periodically, newer versions are released for Python software either due to security flaws or to include additional functionality. Using the latest Python version for API apps is recommended in order to take advantage of security fixes, if any, and/or new functionalities of the latest version. Currently, this policy only applies to Linux web apps.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"WindowsPythonLatestVersion\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"[Deprecated]: Latest Windows Python version\",\r\n              \"description\": \"Latest supported Python version for App Services\",\r\n              \"deprecated\": true\r\n            },\r\n            \"defaultValue\": \"3.6\"\r\n          },\r\n          \"LinuxPythonLatestVersion\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Linux Latest Python version\",\r\n              \"description\": \"Latest supported Python version for App Services\"\r\n            },\r\n            \"defaultValue\": \"3.9\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"*api\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"contains\": \"linux\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/web.linuxFxVersion\",\r\n                    \"notContains\": \"PYTHON\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/web.linuxFxVersion\",\r\n                    \"equals\": \"[concat('PYTHON|', parameters('LinuxPythonLatestVersion'))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/74c3584d-afae-46f7-a20a-6f8adba71a16\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"74c3584d-afae-46f7-a20a-6f8adba71a16\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Public network access should be disabled for Batch accounts\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disabling public network access on a Batch account improves security by ensuring your Batch account can only be accessed from a private endpoint. Learn more about disabling public network access at https://docs.microsoft.com/azure/batch/private-connectivity.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Batch\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The desired effect of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Batch/batchAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Batch/batchAccounts/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/74c5a0ae-5e48-4738-b093-65e23a060488\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"74c5a0ae-5e48-4738-b093-65e23a060488\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Public IP addresses should have resource logs enabled for Azure DDoS Protection Standard\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enable resource logs for public IP addressess in diagnostic settings to stream to a Log Analytics workspace. Get detailed visibility into attack traffic and actions taken to mitigate DDoS attacks via notifications, reports and flow logs.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"profileName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Diagnostic setting name\",\r\n              \"description\": \"Profile name for the Azure diagnostic settings resource\"\r\n            }\r\n          },\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"The target Log Analytics workspace for the diagnostic settings\",\r\n              \"strongType\": \"omsWorkspace\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"logsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable Logs\",\r\n              \"description\": \"Enable Logs - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          },\r\n          \"metricsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable Metrics\",\r\n              \"description\": \"Enable Metrics - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"False\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Network/publicIPAddresses\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                    \"equals\": \"[parameters('LogsEnabled')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\r\n                    \"equals\": \"[parameters('MetricsEnabled')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/workspaceId\",\r\n                    \"equals\": \"[parameters('logAnalytics')]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"name\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"metricsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"profileName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Network/publicIPAddresses/providers/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('name'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\r\n                        \"dependsOn\": [],\r\n                        \"properties\": {\r\n                          \"workspaceId\": \"[parameters('logAnalytics')]\",\r\n                          \"metrics\": [\r\n                            {\r\n                              \"category\": \"AllMetrics\",\r\n                              \"enabled\": \"[parameters('metricsEnabled')]\",\r\n                              \"retentionPolicy\": {\r\n                                \"enabled\": false,\r\n                                \"days\": 0\r\n                              }\r\n                            }\r\n                          ],\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"DDoSProtectionNotifications\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"DDoSMitigationFlowLogs\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"DDoSMitigationReports\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat(parameters('logAnalytics'), 'configured for resource logs for ', ': ', parameters('name'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    },\r\n                    \"name\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"metricsEnabled\": {\r\n                      \"value\": \"[parameters('metricsEnabled')]\"\r\n                    },\r\n                    \"logsEnabled\": {\r\n                      \"value\": \"[parameters('logsEnabled')]\"\r\n                    },\r\n                    \"profileName\": {\r\n                      \"value\": \"[parameters('profileName')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/752154a7-1e0f-45c6-a880-ac75a7e4f648\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"752154a7-1e0f-45c6-a880-ac75a7e4f648\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Audit enabling of diagnostic logs in App Services\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Audit enabling of diagnostic logs on the app. This enables you to recreate activity trails for investigation purposes if a security incident occurs or your network is compromised\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"App Service\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites/config\"\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"equals\": \"web\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/detailedErrorLoggingEnabled\",\r\n                    \"notEquals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/httpLoggingEnabled\",\r\n                    \"notEquals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/requestTracingEnabled\",\r\n                    \"notEquals\": \"true\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/752c6934-9bcc-4749-b004-655e676ae2ac\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"752c6934-9bcc-4749-b004-655e676ae2ac\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Azure Migrate resources to use private DNS zones\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use private DNS zones to override the DNS resolution for a private endpoint. A private DNS zone links to your virtual network to resolve to your Azure Migrate project. Learn more at: https://aka.ms/privatednszone.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Migrate\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateDnsZoneId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private DNS Zone ID\",\r\n              \"description\": \"Specifies the private DNS zone to use to configure private endpoint\",\r\n              \"strongType\": \"Microsoft.Network/privateDnsZones\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/privateEndpoints\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*]\",\r\n                  \"where\": {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*].groupIds[*]\",\r\n                        \"equals\": \"Default\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*].privateLinkServiceId\",\r\n                            \"contains\": \"Microsoft.Migrate/assessmentProjects\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*].privateLinkServiceId\",\r\n                            \"contains\": \"Microsoft.Migrate/migrateProjects\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*].privateLinkServiceId\",\r\n                            \"contains\": \"Microsoft.OffAzure/masterSites\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                \"greaterOrEquals\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Network/privateEndpoints/privateDnsZoneGroups\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"privateDnsZoneId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('privateEndpointName'), '/deployedByPolicy')]\",\r\n                        \"type\": \"Microsoft.Network/privateEndpoints/privateDnsZoneGroups\",\r\n                        \"apiVersion\": \"2020-03-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"privateDnsZoneConfigs\": [\r\n                            {\r\n                              \"name\": \"default-privateDnsZone\",\r\n                              \"properties\": {\r\n                                \"privateDnsZoneId\": \"[parameters('privateDnsZoneId')]\"\r\n                              }\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"privateDnsZoneId\": {\r\n                      \"value\": \"[parameters('privateDnsZoneId')]\"\r\n                    },\r\n                    \"privateEndpointName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7590a335-57cf-4c95-babd-ecbc8fafeb1f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7590a335-57cf-4c95-babd-ecbc8fafeb1f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Private endpoint should be enabled for MySQL servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoint connections enforce secure communication by enabling private connectivity to Azure Database for MySQL. Configure a private endpoint connection to enable access to traffic coming only from known networks and prevent access from all other IP addresses, including within Azure.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.2\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.DBforMySQL/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.DBforMySQL/servers/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.DBforMySQL/servers/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7595c971-233d-4bcf-bd18-596129188c49\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7595c971-233d-4bcf-bd18-596129188c49\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Vulnerabilities should be remediated by a Vulnerability Assessment solution\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Monitors vulnerabilities detected by Vulnerability Assessment solution and VMs without a Vulnerability Assessment solution in Azure Security Center as recommendations.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Disabled\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.ClassicCompute/virtualMachines\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"71992a2a-d168-42e0-b10e-6b45fa2ecddb\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/760a85ff-6162-42b3-8d70-698e268f648c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"760a85ff-6162-42b3-8d70-698e268f648c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Dependency agent for Linux virtual machine scale sets\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Dependency agent for Linux virtual machine scale sets if the VM Image (OS) is in the list defined and the agent is not installed. Note: if your scale set upgradePolicy is set to Manual, you need to apply the extension to the all virtual machines in the set by calling upgrade on them. In CLI this would be az vmss update-instances.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.3.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfImageIdToInclude\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Linux OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageId\",\r\n                    \"in\": \"[parameters('listOfImageIdToInclude')]\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"14.04.0-LTS\",\r\n                              \"14.04.1-LTS\",\r\n                              \"14.04.5-LTS\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"16.04-LTS\",\r\n                              \"16.04.0-LTS\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"18.04-LTS\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-SAP-HANA\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"SLES\",\r\n                          \"SLES-HPC\",\r\n                          \"SLES-HPC-Priority\",\r\n                          \"SLES-SAP\",\r\n                          \"SLES-SAP-BYOS\",\r\n                          \"SLES-Priority\",\r\n                          \"SLES-BYOS\",\r\n                          \"SLES-SAPCAL\",\r\n                          \"SLES-Standard\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"12-SP2\",\r\n                              \"12-SP3\",\r\n                              \"12-SP4\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"CentOS\",\r\n                          \"Centos-LVM\",\r\n                          \"CentOS-SRIOV\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-centos-os\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"like\": \"7*\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\r\n                    \"equals\": \"DependencyAgentLinux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Monitoring.DependencyAgent\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"DependencyAgentLinux\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.Azure.Monitoring.DependencyAgent\",\r\n                      \"vmExtensionType\": \"DependencyAgentLinux\",\r\n                      \"vmExtensionTypeHandlerVersion\": \"9.7\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"typeHandlerVersion\": \"[variables('vmExtensionTypeHandlerVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for: ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/765266ab-e40e-4c61-bcb2-5a5275d0b7c0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"765266ab-e40e-4c61-bcb2-5a5275d0b7c0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Private endpoint connections on Azure SQL Database should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoint connections enforce secure communication by enabling private connectivity to Azure SQL Database.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.0\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Sql/servers/privateEndpointConnections[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.Sql/servers/privateEndpointConnections[*].privateLinkServiceConnectionState.status\",\r\n                    \"equals\": \"Approved\"\r\n                  }\r\n                },\r\n                \"less\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7698e800-9299-47a6-b3b6-5a0fee576eed\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7698e800-9299-47a6-b3b6-5a0fee576eed\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit delegation of scopes to a managing tenant\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Audit delegation of scopes to a managing tenant via Azure Lighthouse.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Lighthouse\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ManagedServices/registrationAssignments\"\r\n              },\r\n              {\r\n                \"value\": \"true\",\r\n                \"equals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/76bed37b-484f-430f-a009-fd7592dff818\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"76bed37b-484f-430f-a009-fd7592dff818\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure subscriptions should have a log profile for Activity Log\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy ensures if a log profile is enabled for exporting activity logs. It audits if there is no log profile created to export the logs either to a storage account or to an event hub.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/logProfiles\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Insights/logProfiles/categories\",\r\n                \"exists\": \"true\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7796937f-307b-4598-941c-67d3a05ebfe7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7796937f-307b-4598-941c-67d3a05ebfe7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Azure Data Factory should use a Git repository for source control\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enable source control on data factories, to gain capabilities such as change tracking, collaboration, continuous integration, and deployment.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-preview\",\r\n          \"category\": \"Data Factory\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DataFactory/factories\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/repoConfiguration.repositoryName\",\r\n                    \"exists\": \"false\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DataFactory/factories/repoConfiguration.repositoryName\",\r\n                    \"equals\": \"\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/77d40665-3120-4348-b539-3192ec808307\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"77d40665-3120-4348-b539-3192ec808307\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Virtual network firewall rule on Azure SQL Database should be enabled to allow traffic from the specified subnet\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Virtual network based firewall rules are used to enable traffic from a specific subnet to Azure SQL Database while ensuring the traffic stays within the Azure boundary.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"subnetId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Subnet ID\",\r\n              \"strongType\": \"Microsoft.Network/virtualNetworks/subnets\",\r\n              \"description\": \"The resource ID of the virtual network subnet that should have a rule enabled. Example: /subscriptions/00000000-1111-2222-3333-444444444444/resourceGroups/Default/providers/Microsoft.Network/virtualNetworks/testvnet/subnets/testsubnet\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"AuditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/virtualNetworkRules\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Sql/servers/virtualNetworkRules/virtualNetworkSubnetId\",\r\n                \"equals\": \"[parameters('subnetId')]\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/77e8b146-0078-4fb2-b002-e112381199f0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"77e8b146-0078-4fb2-b002-e112381199f0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Cache for Redis should use private link\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoints lets you connect your virtual network to Azure services without a public IP address at the source or destination. By mapping private endpoints to your Azure Cache for Redis instances, data leakage risks are reduced. Learn more at: https://docs.microsoft.com/azure/azure-cache-for-redis/cache-private-link.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Cache\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Cache/redis\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Cache/redis/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Cache/redis/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7803067c-7d34-46e3-8c79-0ca68fc4036d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7803067c-7d34-46e3-8c79-0ca68fc4036d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Azure Machine Learning workspaces with private endpoints\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoints connect your virtual network to Azure services without a public IP address at the source or destination. By mapping private endpoints to your Azure Machine Learning workspace, you can reduce data leakage risks. Learn more about private links at: https://docs.microsoft.com/azure/machine-learning/how-to-configure-private-link.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Machine Learning\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateEndpointSubnetId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private endpoint subnet id\",\r\n              \"description\": \"A subnet with private endpoint network policies disabled.\",\r\n              \"strongType\": \"Microsoft.Network/virtualNetworks/subnets\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.MachineLearningServices/workspaces\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.MachineLearningServices/workspaces/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.MachineLearningServices/workspaces/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"name\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"serviceId\": {\r\n                      \"value\": \"[field('id')]\"\r\n                    },\r\n                    \"privateEndpointSubnetId\": {\r\n                      \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"name\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"serviceId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointSubnetId\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"privateEndpointName\": \"[concat('pe-',substring(parameters('name'),0,min(length(parameters('name')),50)),'-',uniquestring(deployment().name))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('privateEndpointName')]\",\r\n                        \"apiVersion\": \"2020-06-01\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"expressionEvaluationOptions\": {\r\n                            \"scope\": \"inner\"\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"serviceId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"privateEndpointSubnetId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"subnetLocation\": {\r\n                                \"type\": \"string\"\r\n                              }\r\n                            },\r\n                            \"variables\": {\r\n                              \"privateEndpointName\": \"[deployment().name]\"\r\n                            },\r\n                            \"resources\": [\r\n                              {\r\n                                \"name\": \"[variables('privateEndpointName')]\",\r\n                                \"type\": \"Microsoft.Network/privateEndpoints\",\r\n                                \"apiVersion\": \"2020-07-01\",\r\n                                \"location\": \"[parameters('subnetLocation')]\",\r\n                                \"tags\": {},\r\n                                \"properties\": {\r\n                                  \"subnet\": {\r\n                                    \"id\": \"[parameters('privateEndpointSubnetId')]\"\r\n                                  },\r\n                                  \"privateLinkServiceConnections\": [\r\n                                    {\r\n                                      \"name\": \"[variables('privateEndpointName')]\",\r\n                                      \"properties\": {\r\n                                        \"privateLinkServiceId\": \"[parameters('serviceId')]\",\r\n                                        \"groupIds\": [\r\n                                          \"amlworkspace\"\r\n                                        ],\r\n                                        \"requestMessage\": \"autoapprove\"\r\n                                      }\r\n                                    }\r\n                                  ],\r\n                                  \"manualPrivateLinkServiceConnections\": []\r\n                                }\r\n                              }\r\n                            ]\r\n                          },\r\n                          \"parameters\": {\r\n                            \"serviceId\": {\r\n                              \"value\": \"[parameters('serviceId')]\"\r\n                            },\r\n                            \"privateEndpointSubnetId\": {\r\n                              \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                            },\r\n                            \"subnetLocation\": {\r\n                              \"value\": \"[reference(first(take(split(parameters('privateEndpointSubnetId'),'/subnets'),1)),'2020-07-01','Full').location]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7838fd83-5cbb-4b5d-888c-bfa240972597\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7838fd83-5cbb-4b5d-888c-bfa240972597\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Cosmos DB should disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disabling public network access improves security by ensuring that your CosmosDB account isn't exposed on the public internet. Creating private endpoints can limit exposure of your CosmosDB account. Learn more at: https://docs.microsoft.com/azure/cosmos-db/how-to-configure-private-endpoints#blocking-public-network-access-during-account-creation.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Cosmos DB\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DocumentDB/databaseAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DocumentDB/databaseAccounts/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/797b37f7-06b8-444c-b1ad-fc62867f335a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"797b37f7-06b8-444c-b1ad-fc62867f335a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows Server VMs on which Windows Serial Console is not enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows Server virtual machines on which Windows Serial Console is not enabled. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"EMSPortNumber\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"EMS Port Number\",\r\n              \"description\": \"An integer indicating the COM port to be used for the Emergency Management Services (EMS) console redirection. For more information on EMS settings, please visit https://aka.ms/gcpolwsc\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"1\",\r\n              \"2\",\r\n              \"3\",\r\n              \"4\"\r\n            ],\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"EMSBaudRate\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"EMS Baud Rate\",\r\n              \"description\": \"An integer indicating the baud rate to be used for the Emergency Management Services (EMS) console redirection. For more information on EMS settings, please visit https://aka.ms/gcpolwsc\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"9600\",\r\n              \"19200\",\r\n              \"38400\",\r\n              \"57600\",\r\n              \"115200\"\r\n            ],\r\n            \"defaultValue\": \"115200\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsSerialConsole\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('[WindowsSerialConsole]WindowsSerialConsole;EMSPortNumber', '=', parameters('EMSPortNumber'), ',', '[WindowsSerialConsole]WindowsSerialConsole;EMSBaudRate', '=', parameters('EMSBaudRate')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"WindowsSerialConsole\"\r\n                    },\r\n                    \"EMSPortNumber\": {\r\n                      \"value\": \"[parameters('EMSPortNumber')]\"\r\n                    },\r\n                    \"EMSBaudRate\": {\r\n                      \"value\": \"[parameters('EMSBaudRate')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"EMSPortNumber\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"EMSBaudRate\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[WindowsSerialConsole]WindowsSerialConsole;EMSPortNumber\",\r\n                                \"value\": \"[parameters('EMSPortNumber')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"[WindowsSerialConsole]WindowsSerialConsole;EMSBaudRate\",\r\n                                \"value\": \"[parameters('EMSBaudRate')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[WindowsSerialConsole]WindowsSerialConsole;EMSPortNumber\",\r\n                                \"value\": \"[parameters('EMSPortNumber')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"[WindowsSerialConsole]WindowsSerialConsole;EMSBaudRate\",\r\n                                \"value\": \"[parameters('EMSBaudRate')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7a031c68-d6ab-406e-a506-697a19c634b0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7a031c68-d6ab-406e-a506-697a19c634b0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure private DNS zones for private endpoints connected to App Configuration\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use private DNS zones to override the DNS resolution for a private endpoint. A private DNS zone can be linked to your virtual network to resolve app configuration instances. Learn more at: https://aka.ms/appconfig/private-endpoint.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Configuration\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateDnsZoneId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private DNS zone\",\r\n              \"description\": \"Specifies the private DNS zone to use to configure private endpoint\",\r\n              \"strongType\": \"Microsoft.Network/privateDnsZones\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/privateEndpoints\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*].groupIds[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*].groupIds[*]\",\r\n                    \"equals\": \"configurationStores\"\r\n                  }\r\n                },\r\n                \"greaterOrEquals\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Network/privateEndpoints/privateDnsZoneGroups\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"privateDnsZoneId\": {\r\n                      \"value\": \"[parameters('privateDnsZoneId')]\"\r\n                    },\r\n                    \"privateEndpointName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"privateDnsZoneId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('privateEndpointName'), '/deployedByPolicy')]\",\r\n                        \"type\": \"Microsoft.Network/privateEndpoints/privateDnsZoneGroups\",\r\n                        \"apiVersion\": \"2020-03-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"privateDnsZoneConfigs\": [\r\n                            {\r\n                              \"name\": \"privatelink-azconfig-io\",\r\n                              \"properties\": {\r\n                                \"privateDnsZoneId\": \"[parameters('privateDnsZoneId')]\"\r\n                              }\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7a860e27-9ca2-4fc6-822d-c2d248c300df\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7a860e27-9ca2-4fc6-822d-c2d248c300df\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Allow managing tenant ids to onboard through Azure Lighthouse\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Restricting Azure Lighthouse delegations to specific managing tenants increases security by limiting those who can manage your Azure resources.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"Lighthouse\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfAllowedTenants\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed tenants\",\r\n              \"description\": \"List of the tenants IDs that can be onboarded through Azure Lighthouse\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ManagedServices/registrationDefinitions\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.ManagedServices/registrationDefinitions/managedByTenantId\",\r\n                  \"in\": \"[parameters('listOfAllowedTenants')]\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7a8a51a3-ad87-4def-96f3-65a1839242b6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7a8a51a3-ad87-4def-96f3-65a1839242b6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Attestation providers should use private endpoints\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoints provide a way to connect Azure Attestation providers to your Azure resources without sending traffic over the public internet. By preventing public access, private endpoints help protect against undesired anonymous access.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Attestation\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Attestation/attestationProviders\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Attestation/attestationProviders/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Attestation/attestationProviders/privateEndpointConnections/privateEndpoint\",\r\n                    \"exists\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Attestation/attestationProviders/privateEndpointConnections/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Attestation/attestationProviders/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                    \"equals\": \"Approved\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7b256a2d-058b-41f8-bed9-3f870541c40a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7b256a2d-058b-41f8-bed9-3f870541c40a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Resource logs in Virtual Machine Scale Sets should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"It is recommended to enable Logs so that activity trail can be recreated when investigations are required in the event of an incident or a compromise.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.1\",\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"includeAKSClusters\": {\r\n            \"type\": \"Boolean\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include AKS Clusters\",\r\n              \"description\": \"Whether to include AKS Clusters to resource logs extension - True or False\"\r\n            },\r\n            \"defaultValue\": false\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[parameters('includeAKSClusters')]\",\r\n                    \"equals\": true\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[parameters('includeAKSClusters')]\",\r\n                    \"equals\": false\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                    \"notEquals\": \"microsoft-aks\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                    \"notEquals\": \"aks\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                    \"notLike\": \"aks*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n              \"existenceCondition\": {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\r\n                        \"equals\": \"IaaSDiagnostics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                        \"equals\": \"Microsoft.Azure.Diagnostics\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\r\n                        \"equals\": \"LinuxDiagnostic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                        \"in\": [\r\n                          \"Microsoft.OSTCExtensions\",\r\n                          \"Microsoft.Azure.Diagnostics\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7c1b1214-f927-48bf-8882-84f0af6588b1\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7c1b1214-f927-48bf-8882-84f0af6588b1\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Require blob encryption for storage accounts\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy ensures blob encryption for storage accounts is turned on. It only applies to Microsoft.Storage resource types, not other storage providers. This policy is deprecated because storage blob encryption is now enabled by default, and can no longer be disabled.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Storage\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Storage/storageAccounts/enableBlobEncryption\",\r\n                \"equals\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7c5a74bf-ae94-4a74-8fcf-644d1e0e6e6f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7c5a74bf-ae94-4a74-8fcf-644d1e0e6e6f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Cache for Redis should reside within a virtual network\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Virtual Network deployment provides enhanced security and isolation for your Azure Cache for Redis, as well as subnets, access control policies, and other features to further restrict access.When an Azure Cache for Redis instance is configured with a virtual network, it is not publicly addressable and can only be accessed from virtual machines and applications within the virtual network.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.3\",\r\n          \"category\": \"Cache\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Cache/redis\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Cache/Redis/subnetId\",\r\n                \"exists\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7d092e0a-7acd-40d2-a975-dca21cae48c4\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7d092e0a-7acd-40d2-a975-dca21cae48c4\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Both operating systems and data disks in Azure Kubernetes Service clusters should be encrypted by customer-managed keys\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Encrypting OS and data disks using customer-managed keys provides more control and greater flexibility in key management. This is a common requirement in many regulatory and industry compliance standards.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Kubernetes\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"'Audit' allows a non-compliant resource to be created or updated, but flags it as non-compliant. 'Deny' blocks the non-compliant resource creation or update. 'Disabled' turns off the policy.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ContainerService/managedClusters\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.ContainerService/managedClusters/diskEncryptionSetID\",\r\n                    \"exists\": \"False\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.ContainerService/managedClusters/diskEncryptionSetID\",\r\n                    \"equals\": \"\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7d7be79c-23ba-4033-84dd-45e2a5ccdd67\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7d7be79c-23ba-4033-84dd-45e2a5ccdd67\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Service Bus namespaces with private endpoints\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoints connect your virtual network to Azure services without a public IP address at the source or destination. By mapping private endpoints to Service Bus namespaces, you can reduce data leakage risks. Learn more at: https://docs.microsoft.com/azure/service-bus-messaging/private-link-service.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Service Bus\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateEndpointSubnetId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private endpoint subnet id\",\r\n              \"description\": \"Specifies the subnet to use to configure private endpoint\",\r\n              \"strongType\": \"Microsoft.Network/virtualNetworks/subnets\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ServiceBus/namespaces\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.ServiceBus/namespaces/sku.tier\",\r\n                \"equals\": \"Premium\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.ServiceBus/namespaces/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.ServiceBus/namespaces/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7\",\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/090c5cfd-751d-490a-894a-3ce6f1109419\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"name\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"serviceId\": {\r\n                      \"value\": \"[field('id')]\"\r\n                    },\r\n                    \"privateEndpointSubnetId\": {\r\n                      \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"name\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"serviceId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointSubnetId\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"privateEndpointName\": \"[concat('pe-',substring(parameters('name'),0,min(length(parameters('name')),50)),'-',uniquestring(deployment().name))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('privateEndpointName')]\",\r\n                        \"apiVersion\": \"2020-06-01\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"expressionEvaluationOptions\": {\r\n                            \"scope\": \"inner\"\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"serviceId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"privateEndpointSubnetId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"subnetLocation\": {\r\n                                \"type\": \"string\"\r\n                              }\r\n                            },\r\n                            \"variables\": {\r\n                              \"privateEndpointName\": \"[deployment().name]\"\r\n                            },\r\n                            \"resources\": [\r\n                              {\r\n                                \"name\": \"[variables('privateEndpointName')]\",\r\n                                \"type\": \"Microsoft.Network/privateEndpoints\",\r\n                                \"apiVersion\": \"2020-07-01\",\r\n                                \"location\": \"[parameters('subnetLocation')]\",\r\n                                \"tags\": {},\r\n                                \"properties\": {\r\n                                  \"subnet\": {\r\n                                    \"id\": \"[parameters('privateEndpointSubnetId')]\"\r\n                                  },\r\n                                  \"privateLinkServiceConnections\": [\r\n                                    {\r\n                                      \"name\": \"[variables('privateEndpointName')]\",\r\n                                      \"properties\": {\r\n                                        \"privateLinkServiceId\": \"[parameters('serviceId')]\",\r\n                                        \"groupIds\": [\r\n                                          \"namespace\"\r\n                                        ],\r\n                                        \"requestMessage\": \"autoapprove\"\r\n                                      }\r\n                                    }\r\n                                  ],\r\n                                  \"manualPrivateLinkServiceConnections\": []\r\n                                }\r\n                              }\r\n                            ]\r\n                          },\r\n                          \"parameters\": {\r\n                            \"serviceId\": {\r\n                              \"value\": \"[parameters('serviceId')]\"\r\n                            },\r\n                            \"privateEndpointSubnetId\": {\r\n                              \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                            },\r\n                            \"subnetLocation\": {\r\n                              \"value\": \"[reference(first(take(split(parameters('privateEndpointSubnetId'),'/subnets'),1)),'2020-07-01','Full').location]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7d890f7f-100c-473d-baa1-2777e2266535\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7d890f7f-100c-473d-baa1-2777e2266535\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs that have the specified applications installed\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that have the specified applications installed. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"NotInstalledApplication\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7e56b49b-5990-4159-a734-511ea19b731c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7e56b49b-5990-4159-a734-511ea19b731c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs that have not restarted within the specified number of days\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that have not restarted within the specified number of days. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"MachineLastBootUpTime\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7e84ba44-6d03-46fd-950e-5efa5a1112fa\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7e84ba44-6d03-46fd-950e-5efa5a1112fa\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Azure SQL database servers diagnostic settings to Log Analytics workspace\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enables auditing logs for Azure SQL Database server and stream the logs to a Log Analytics workspace when any SQL Server which is missing this auditing is created or updated\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.2\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"logAnalyticsWorkspaceId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Specify the Log Analytics workspace the server should be connected to.\",\r\n              \"strongType\": \"omsWorkspace\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/auditingSettings\",\r\n              \"name\": \"Default\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Sql/auditingSettings.state\",\r\n                \"equals\": \"Enabled\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/056cd41c-7e88-42e1-933e-88ba6a50c9c3\",\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"serverName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalyticsWorkspaceId\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"diagnosticSettingsName\": \"SQLSecurityAuditEvents_3d229c42-c7e7-4c97-9a99-ec0d0d8b86c1\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Sql/servers/databases/providers/diagnosticSettings\",\r\n                        \"name\": \"[concat(parameters('serverName'),'/master/microsoft.insights/',variables('diagnosticSettingsName'))]\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"properties\": {\r\n                          \"name\": \"[variables('diagnosticSettingsName')]\",\r\n                          \"workspaceId\": \"[parameters('logAnalyticsWorkspaceId')]\",\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"SQLSecurityAuditEvents\",\r\n                              \"enabled\": true,\r\n                              \"retentionPolicy\": {\r\n                                \"days\": 0,\r\n                                \"enabled\": false\r\n                              }\r\n                            }\r\n                          ]\r\n                        }\r\n                      },\r\n                      {\r\n                        \"name\": \"[concat(parameters('serverName'), '/Default')]\",\r\n                        \"type\": \"Microsoft.Sql/servers/auditingSettings\",\r\n                        \"apiVersion\": \"2017-03-01-preview\",\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Sql/servers/', parameters('serverName'),'/databases/master/providers/microsoft.insights/diagnosticSettings/', variables('diagnosticSettingsName'))]\"\r\n                        ],\r\n                        \"properties\": {\r\n                          \"state\": \"Enabled\",\r\n                          \"isAzureMonitorTargetEnabled\": true\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"serverName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"logAnalyticsWorkspaceId\": {\r\n                      \"value\": \"[parameters('logAnalyticsWorkspaceId')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7ea8a143-05e3-4553-abfe-f56bef8b0b70\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7ea8a143-05e3-4553-abfe-f56bef8b0b70\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs that do not have the password complexity setting enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines that do not have the password complexity setting enabled. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"2.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"PasswordMustMeetComplexityRequirements\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"PasswordMustMeetComplexityRequirements\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7ed40801-8a0f-4ceb-85c0-9fd25c1d61a8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7ed40801-8a0f-4ceb-85c0-9fd25c1d61a8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs configurations in 'System Audit Policies - Privilege Use'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Privilege Use'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SystemAuditPoliciesPrivilegeUse\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7f4e96d1-e4f3-4dbb-b767-33ca4df8df7c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7f4e96d1-e4f3-4dbb-b767-33ca4df8df7c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit diagnostic setting\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Audit diagnostic setting for selected resource types\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfResourceTypes\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Resource Types\",\r\n              \"strongType\": \"resourceTypes\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": \"[parameters('listOfResourceTypes')]\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"AuditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\r\n                    \"equals\": \"true\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7f89b1eb-583c-429a-8828-af049802c1d9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7f89b1eb-583c-429a-8828-af049802c1d9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Defender for Azure SQL Database servers should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Azure Defender for SQL provides functionality for surfacing and mitigating potential database vulnerabilities, detecting anomalous activities that could indicate threats to SQL databases, and discovering and classifying sensitive data.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.2\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/pricings\",\r\n              \"name\": \"SqlServers\",\r\n              \"existenceScope\": \"subscription\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/pricings/pricingTier\",\r\n                \"equals\": \"Standard\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7fe3b40f-802b-4cdd-8bd4-fd799c948cc2\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7fe3b40f-802b-4cdd-8bd4-fd799c948cc2\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"SQL Auditing settings should have Action-Groups configured to capture critical activities\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"The AuditActionsAndGroups property should contain at least SUCCESSFUL_DATABASE_AUTHENTICATION_GROUP, FAILED_DATABASE_AUTHENTICATION_GROUP, BATCH_COMPLETED_GROUP to ensure a thorough audit logging\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/auditingSettings\",\r\n              \"name\": \"default\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Sql/servers/auditingSettings/auditActionsAndGroups[*]\",\r\n                      \"notEquals\": \"SUCCESSFUL_DATABASE_AUTHENTICATION_GROUP\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Sql/servers/auditingSettings/auditActionsAndGroups[*]\",\r\n                      \"notEquals\": \"FAILED_DATABASE_AUTHENTICATION_GROUP\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Sql/servers/auditingSettings/auditActionsAndGroups[*]\",\r\n                      \"notEquals\": \"BATCH_COMPLETED_GROUP\"\r\n                    }\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7ff426e2-515f-405a-91c8-4f2333442eb5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7ff426e2-515f-405a-91c8-4f2333442eb5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy - Configure suppression rules for Azure Security Center alerts\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Suppress Azure Security Center alerts to reduce alerts fatigue by deploying suppression rules on your management group or subscription.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"version\": \"1.0.0\"\r\n        },\r\n        \"parameters\": {\r\n          \"alertType\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Alert Type\",\r\n              \"description\": \"Enter the alert type field of the alert you would like to suppress. Alert type could be queried via alerts api or PowerShell, learn more at https://aka.ms/asc-alertsPwoershell\"\r\n            }\r\n          },\r\n          \"suppressionRuleName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Rule name\",\r\n              \"description\": \"Rule names must begin with a letter or a number, be between 2 and 50 characters, and contain no symbols other than dashes ( - ) or underscores ( _ )\"\r\n            }\r\n          },\r\n          \"state\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"State\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Enabled\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Enabled\"\r\n          },\r\n          \"reason\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Reason\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"The severity of the alert should be lower\",\r\n              \"The alert detecting too many normal activities\",\r\n              \"The alert is too noisy - hitting on the same resources too many times\",\r\n              \"The resource isn't relevant for me to monitor\",\r\n              \"The alert detecting normal activity on specific entity\",\r\n              \"The alert isn't actionable - not clear how to investigate the threat\",\r\n              \"Other\"\r\n            ]\r\n          },\r\n          \"comment\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Comment\"\r\n            },\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"expirationDate\": {\r\n            \"type\": \"DateTime\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Expiration date\"\r\n            }\r\n          },\r\n          \"entityOneType\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"First entity type\",\r\n              \"description\": \"To refine the suppression rules to suppress alerts only for specific entities, enter the type of the entity you would like to suppress. Only alerts containing all of the entities defined in the rule will be suppressed (alerts without entities will be suppressed entirely).\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"User account - name\",\r\n              \"User account - AAD user ID\",\r\n              \"User account - UPN suffix\",\r\n              \"Azure resource ID\",\r\n              \"File - name\",\r\n              \"File - directory\",\r\n              \"File hash\",\r\n              \"Host - name\",\r\n              \"Host - Azure ID\",\r\n              \"Host - DNS Domain\",\r\n              \"Host - OMS agent ID\",\r\n              \"IP address\",\r\n              \"Malware - name\",\r\n              \"Malware - category\",\r\n              \"Process - command line\",\r\n              \"\"\r\n            ],\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"entityOneOp\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"First entity operation\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Equals\",\r\n              \"Contains\",\r\n              \"\"\r\n            ],\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"entityOneValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"First entity value\",\r\n              \"description\": \"The value of the entity. Only alerts containing all of the entities defined in the rule will be suppressed (alerts without entities will be suppressed entirely).\"\r\n            },\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"entitySecondType\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Second entity type\",\r\n              \"description\": \"To refine the suppression rules to suppress alerts only for specific entities, enter the type of the entity you would like to suppress. Only alerts containing all of the entities defined in the rule will be suppressed (alerts without entities will be suppressed entirely).\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"User account - name\",\r\n              \"User account - AAD user ID\",\r\n              \"User account - UPN suffix\",\r\n              \"Azure resource ID\",\r\n              \"File - name\",\r\n              \"File - directory\",\r\n              \"File hash\",\r\n              \"Host - name\",\r\n              \"Host - Azure ID\",\r\n              \"Host - DNS Domain\",\r\n              \"Host - OMS agent ID\",\r\n              \"IP address\",\r\n              \"Malware - name\",\r\n              \"Malware - category\",\r\n              \"Process - command line\",\r\n              \"\"\r\n            ],\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"entitySecondOp\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Second entity operation\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Equals\",\r\n              \"Contains\",\r\n              \"\"\r\n            ],\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"entitySecondValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Second entity value\",\r\n              \"description\": \"The value of the entity. Only alerts containing all of the entities defined in the rule will be suppressed (alerts without entities will be suppressed entirely).\"\r\n            },\r\n            \"defaultValue\": \"\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/alertsSuppressionRules\",\r\n              \"name\": \"[parameters('suppressionRuleName')]\",\r\n              \"existenceScope\": \"subscription\",\r\n              \"deploymentScope\": \"subscription\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/fb1c8493-542b-48eb-b624-b4c8fea62acd\"\r\n              ],\r\n              \"deployment\": {\r\n                \"location\": \"centralus\",\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"alertType\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"suppressionRuleName\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"state\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"reason\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"comment\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"expirationDate\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"entityOneType\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"entityOneOp\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"entityOneValue\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"entitySecondType\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"entitySecondOp\": {\r\n                        \"type\": \"String\"\r\n                      },\r\n                      \"entitySecondValue\": {\r\n                        \"type\": \"String\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"reasonToEnum\": {\r\n                        \"The severity of the alert should be lower\": \"AlertSeverityTooHigh\",\r\n                        \"The alert detecting too many normal activities\": \"FalsePositive\",\r\n                        \"The alert is too noisy - hitting on the same resources too many times\": \"Noise\",\r\n                        \"The resource isn't relevant for me to monitor\": \"NotRelevant\",\r\n                        \"The alert detecting normal activity on specific entity\": \"SpecificEntityFalsePositive\",\r\n                        \"The alert isn't actionable - not clear how to investigate the threat\": \"Unclear\",\r\n                        \"Other\": \"Other\"\r\n                      },\r\n                      \"entityNameToType\": {\r\n                        \"User account - name\": \"entities.account.name\",\r\n                        \"User account - AAD user ID\": \"entities.account.aaduserid\",\r\n                        \"User account - UPN suffix\": \"entities.account.upnsuffix\",\r\n                        \"Azure resource ID\": \"entities.azureresource.resourceid\",\r\n                        \"File - name\": \"entities.file.name\",\r\n                        \"File - directory\": \"entities.file.directory\",\r\n                        \"File hash\": \"entities.filehash.value\",\r\n                        \"Host - name\": \"entities.host.hostname\",\r\n                        \"Host - Azure ID\": \"entities.host.azureid\",\r\n                        \"Host - DNS Domain\": \"entities.host.dnsdomain\",\r\n                        \"Host - OMS agent ID\": \"entities.host.omsagentid\",\r\n                        \"IP address\": \"entities.ip.address\",\r\n                        \"Malware - name\": \"entities.malware.name\",\r\n                        \"Malware - category\": \"entities.malware.category\",\r\n                        \"Process - command line: \": \"entities.process.commandline\"\r\n                      },\r\n                      \"entityOperationNameToOperation\": {\r\n                        \"Equals\": \"in\",\r\n                        \"Contains\": \"contains\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Security/alertsSuppressionRules\",\r\n                        \"apiVersion\": \"2019-01-01-preview\",\r\n                        \"name\": \"[parameters('suppressionRuleName')]\",\r\n                        \"location\": \"centralus\",\r\n                        \"properties\": {\r\n                          \"alertType\": \"[parameters('alertType')]\",\r\n                          \"state\": \"[parameters('state')]\",\r\n                          \"reason\": \"[variables('reasonToEnum')[parameters('reason')]]\",\r\n                          \"comment\": \"[parameters('comment')]\",\r\n                          \"expirationDateUtc\": \"[parameters('expirationDate')]\",\r\n                          \"suppressionAlertsScope\": \"[if(and(or(empty(parameters('entityOneType')), empty(parameters('entityOneOp')), empty(parameters('entityOneValue'))), or(empty(parameters('entitySecondType')), empty(parameters('entitySecondOp')), empty(parameters('entitySecondValue')))), null(), json(concat('{ \\\"allOf\\\": [', if(or(empty(parameters('entityOneType')), empty(parameters('entityOneOp')), empty(parameters('entityOneValue'))), '', concat(' { \\\"field\\\": \\\"', variables('entityNameToType')[parameters('entityOneType')], '\\\", \\\"', variables('entityOperationNameToOperation')[parameters('entityOneOp')], '\\\":', if(equals(parameters('entityOneOp'), 'Equals'), '[', ''), ' \\\"', parameters('entityOneValue'), '\\\"', if(equals(parameters('entityOneOp'), 'Equals'), ']', ''), ' }', if(or(empty(parameters('entitySecondType')), empty(parameters('entitySecondOp')), empty(parameters('entitySecondValue'))), '', ', '))), if(or(empty(parameters('entitySecondType')), empty(parameters('entitySecondOp')), empty(parameters('entitySecondValue'))), '', concat(' { \\\"field\\\": \\\"', variables('entityNameToType')[parameters('entitySecondType')], '\\\", \\\"', variables('entityOperationNameToOperation')[parameters('entitySecondOp')], '\\\":', if(equals(parameters('entitySecondOp'), 'Equals'), '[', ''), ' \\\"', parameters('entitySecondValue'), '\\\"', if(equals(parameters('entitySecondOp'), 'Equals'), ']', ''), ' } ')), '] }')))]\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"alertType\": {\r\n                      \"value\": \"[parameters('alertType')]\"\r\n                    },\r\n                    \"suppressionRuleName\": {\r\n                      \"value\": \"[parameters('suppressionRuleName')]\"\r\n                    },\r\n                    \"state\": {\r\n                      \"value\": \"[parameters('state')]\"\r\n                    },\r\n                    \"reason\": {\r\n                      \"value\": \"[parameters('reason')]\"\r\n                    },\r\n                    \"comment\": {\r\n                      \"value\": \"[parameters('comment')]\"\r\n                    },\r\n                    \"expirationDate\": {\r\n                      \"value\": \"[parameters('expirationDate')]\"\r\n                    },\r\n                    \"entityOneType\": {\r\n                      \"value\": \"[parameters('entityOneType')]\"\r\n                    },\r\n                    \"entityOneOp\": {\r\n                      \"value\": \"[parameters('entityOneOp')]\"\r\n                    },\r\n                    \"entityOneValue\": {\r\n                      \"value\": \"[parameters('entityOneValue')]\"\r\n                    },\r\n                    \"entitySecondType\": {\r\n                      \"value\": \"[parameters('entitySecondType')]\"\r\n                    },\r\n                    \"entitySecondOp\": {\r\n                      \"value\": \"[parameters('entitySecondOp')]\"\r\n                    },\r\n                    \"entitySecondValue\": {\r\n                      \"value\": \"[parameters('entitySecondValue')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/80e94a21-c6cd-4c95-a2c7-beb5704e61c0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"80e94a21-c6cd-4c95-a2c7-beb5704e61c0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Advanced Threat Protection to be enabled on Azure database for MySQL servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enable Advanced Threat Protection on your non-Basic tier Azure database for MySQL servers to detect anomalous activities indicating unusual and potentially harmful attempts to access or exploit databases.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DBforMySQL/servers\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DBforMySQL/servers/sku.tier\",\r\n                \"notContains\": \"basic\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.DBforMySQL/servers/securityAlertPolicies\",\r\n              \"name\": \"Default\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.DBforMySQL/servers/securityAlertPolicies/Default.state\",\r\n                \"equals\": \"Enabled\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"serverName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('serverName'), '/Default')]\",\r\n                        \"type\": \"Microsoft.DBforMySQL/servers/securityAlertPolicies\",\r\n                        \"apiVersion\": \"2017-12-01\",\r\n                        \"properties\": {\r\n                          \"state\": \"Enabled\",\r\n                          \"emailAccountAdmins\": false\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"serverName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/80ed5239-4122-41ed-b54a-6f1fa7552816\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"80ed5239-4122-41ed-b54a-6f1fa7552816\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs configurations in 'User Rights Assignment'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'User Rights Assignment'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"UsersOrGroupsThatMayAccessThisComputerFromTheNetwork\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Users or groups that may access this computer from the network\",\r\n              \"description\": \"Specifies which remote users on the network are permitted to connect to the computer. This does not include Remote Desktop Connection.\"\r\n            },\r\n            \"defaultValue\": \"Administrators, Authenticated Users\"\r\n          },\r\n          \"UsersOrGroupsThatMayLogOnLocally\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Users or groups that may log on locally\",\r\n              \"description\": \"Specifies which users or groups can interactively log on to the computer. Users who attempt to log on via Remote Desktop Connection or IIS also require this user right.\"\r\n            },\r\n            \"defaultValue\": \"Administrators\"\r\n          },\r\n          \"UsersOrGroupsThatMayLogOnThroughRemoteDesktopServices\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Users or groups that may log on through Remote Desktop Services\",\r\n              \"description\": \"Specifies which users or groups are permitted to log on as a Terminal Services client, Remote Desktop, or for Remote Assistance.\"\r\n            },\r\n            \"defaultValue\": \"Administrators, Remote Desktop Users\"\r\n          },\r\n          \"UsersAndGroupsThatAreDeniedAccessToThisComputerFromTheNetwork\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Users and groups that are denied access to this computer from the network\",\r\n              \"description\": \"Specifies which users or groups are explicitly prohibited from connecting to the computer across the network.\"\r\n            },\r\n            \"defaultValue\": \"Guests\"\r\n          },\r\n          \"UsersOrGroupsThatMayManageAuditingAndSecurityLog\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Users or groups that may manage auditing and security log\",\r\n              \"description\": \"Specifies users and groups permitted to change the auditing options for files and directories and clear the Security log.\"\r\n            },\r\n            \"defaultValue\": \"Administrators\"\r\n          },\r\n          \"UsersOrGroupsThatMayBackUpFilesAndDirectories\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Users or groups that may back up files and directories\",\r\n              \"description\": \"Specifies users and groups allowed to circumvent file and directory permissions to back up the system.\"\r\n            },\r\n            \"defaultValue\": \"Administrators, Backup Operators\"\r\n          },\r\n          \"UsersOrGroupsThatMayChangeTheSystemTime\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Users or groups that may change the system time\",\r\n              \"description\": \"Specifies which users and groups are permitted to change the time and date on the internal clock of the computer.\"\r\n            },\r\n            \"defaultValue\": \"Administrators, LOCAL SERVICE\"\r\n          },\r\n          \"UsersOrGroupsThatMayChangeTheTimeZone\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Users or groups that may change the time zone\",\r\n              \"description\": \"Specifies which users and groups are permitted to change the time zone of the computer.\"\r\n            },\r\n            \"defaultValue\": \"Administrators, LOCAL SERVICE\"\r\n          },\r\n          \"UsersOrGroupsThatMayCreateATokenObject\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Users or groups that may create a token object\",\r\n              \"description\": \"Specifies which users and groups are permitted to create an access token, which may provide elevated rights to access sensitive data.\"\r\n            },\r\n            \"defaultValue\": \"No One\"\r\n          },\r\n          \"UsersAndGroupsThatAreDeniedLoggingOnAsABatchJob\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Users and groups that are denied logging on as a batch job\",\r\n              \"description\": \"Specifies which users and groups are explicitly not permitted to log on to the computer as a batch job (i.e. scheduled task).\"\r\n            },\r\n            \"defaultValue\": \"Guests\"\r\n          },\r\n          \"UsersAndGroupsThatAreDeniedLoggingOnAsAService\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Users and groups that are denied logging on as a service\",\r\n              \"description\": \"Specifies which service accounts are explicitly not permitted to register a process as a service.\"\r\n            },\r\n            \"defaultValue\": \"Guests\"\r\n          },\r\n          \"UsersAndGroupsThatAreDeniedLocalLogon\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Users and groups that are denied local logon\",\r\n              \"description\": \"Specifies which users and groups are explicitly not permitted to log on to the computer.\"\r\n            },\r\n            \"defaultValue\": \"Guests\"\r\n          },\r\n          \"UsersAndGroupsThatAreDeniedLogOnThroughRemoteDesktopServices\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Users and groups that are denied log on through Remote Desktop Services\",\r\n              \"description\": \"Specifies which users and groups are explicitly not permitted to log on to the computer via Terminal Services/Remote Desktop Client.\"\r\n            },\r\n            \"defaultValue\": \"Guests\"\r\n          },\r\n          \"UserAndGroupsThatMayForceShutdownFromARemoteSystem\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"User and groups that may force shutdown from a remote system\",\r\n              \"description\": \"Specifies which users and groups are permitted to shut down the computer from a remote location on the network.\"\r\n            },\r\n            \"defaultValue\": \"Administrators\"\r\n          },\r\n          \"UsersAndGroupsThatMayRestoreFilesAndDirectories\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Users and groups that may restore files and directories\",\r\n              \"description\": \"Specifies which users and groups are permitted to bypass file, directory, registry, and other persistent object permissions when restoring backed up files and directories.\"\r\n            },\r\n            \"defaultValue\": \"Administrators, Backup Operators\"\r\n          },\r\n          \"UsersAndGroupsThatMayShutDownTheSystem\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Users and groups that may shut down the system\",\r\n              \"description\": \"Specifies which users and groups who are logged on locally to the computers in your environment are permitted to shut down the operating system with the Shut Down command.\"\r\n            },\r\n            \"defaultValue\": \"Administrators\"\r\n          },\r\n          \"UsersOrGroupsThatMayTakeOwnershipOfFilesOrOtherObjects\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Users or groups that may take ownership of files or other objects\",\r\n              \"description\": \"Specifies which users and groups are permitted to take ownership of files, folders, registry keys, processes, or threads. This user right bypasses any permissions that are in place to protect objects to give ownership to the specified user.\"\r\n            },\r\n            \"defaultValue\": \"Administrators\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_UserRightsAssignment\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('Access this computer from the network;ExpectedValue', '=', parameters('UsersOrGroupsThatMayAccessThisComputerFromTheNetwork'), ',', 'Allow log on locally;ExpectedValue', '=', parameters('UsersOrGroupsThatMayLogOnLocally'), ',', 'Allow log on through Remote Desktop Services;ExpectedValue', '=', parameters('UsersOrGroupsThatMayLogOnThroughRemoteDesktopServices'), ',', 'Deny access to this computer from the network;ExpectedValue', '=', parameters('UsersAndGroupsThatAreDeniedAccessToThisComputerFromTheNetwork'), ',', 'Manage auditing and security log;ExpectedValue', '=', parameters('UsersOrGroupsThatMayManageAuditingAndSecurityLog'), ',', 'Back up files and directories;ExpectedValue', '=', parameters('UsersOrGroupsThatMayBackUpFilesAndDirectories'), ',', 'Change the system time;ExpectedValue', '=', parameters('UsersOrGroupsThatMayChangeTheSystemTime'), ',', 'Change the time zone;ExpectedValue', '=', parameters('UsersOrGroupsThatMayChangeTheTimeZone'), ',', 'Create a token object;ExpectedValue', '=', parameters('UsersOrGroupsThatMayCreateATokenObject'), ',', 'Deny log on as a batch job;ExpectedValue', '=', parameters('UsersAndGroupsThatAreDeniedLoggingOnAsABatchJob'), ',', 'Deny log on as a service;ExpectedValue', '=', parameters('UsersAndGroupsThatAreDeniedLoggingOnAsAService'), ',', 'Deny log on locally;ExpectedValue', '=', parameters('UsersAndGroupsThatAreDeniedLocalLogon'), ',', 'Deny log on through Remote Desktop Services;ExpectedValue', '=', parameters('UsersAndGroupsThatAreDeniedLogOnThroughRemoteDesktopServices'), ',', 'Force shutdown from a remote system;ExpectedValue', '=', parameters('UserAndGroupsThatMayForceShutdownFromARemoteSystem'), ',', 'Restore files and directories;ExpectedValue', '=', parameters('UsersAndGroupsThatMayRestoreFilesAndDirectories'), ',', 'Shut down the system;ExpectedValue', '=', parameters('UsersAndGroupsThatMayShutDownTheSystem'), ',', 'Take ownership of files or other objects;ExpectedValue', '=', parameters('UsersOrGroupsThatMayTakeOwnershipOfFilesOrOtherObjects')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AzureBaseline_UserRightsAssignment\"\r\n                    },\r\n                    \"UsersOrGroupsThatMayAccessThisComputerFromTheNetwork\": {\r\n                      \"value\": \"[parameters('UsersOrGroupsThatMayAccessThisComputerFromTheNetwork')]\"\r\n                    },\r\n                    \"UsersOrGroupsThatMayLogOnLocally\": {\r\n                      \"value\": \"[parameters('UsersOrGroupsThatMayLogOnLocally')]\"\r\n                    },\r\n                    \"UsersOrGroupsThatMayLogOnThroughRemoteDesktopServices\": {\r\n                      \"value\": \"[parameters('UsersOrGroupsThatMayLogOnThroughRemoteDesktopServices')]\"\r\n                    },\r\n                    \"UsersAndGroupsThatAreDeniedAccessToThisComputerFromTheNetwork\": {\r\n                      \"value\": \"[parameters('UsersAndGroupsThatAreDeniedAccessToThisComputerFromTheNetwork')]\"\r\n                    },\r\n                    \"UsersOrGroupsThatMayManageAuditingAndSecurityLog\": {\r\n                      \"value\": \"[parameters('UsersOrGroupsThatMayManageAuditingAndSecurityLog')]\"\r\n                    },\r\n                    \"UsersOrGroupsThatMayBackUpFilesAndDirectories\": {\r\n                      \"value\": \"[parameters('UsersOrGroupsThatMayBackUpFilesAndDirectories')]\"\r\n                    },\r\n                    \"UsersOrGroupsThatMayChangeTheSystemTime\": {\r\n                      \"value\": \"[parameters('UsersOrGroupsThatMayChangeTheSystemTime')]\"\r\n                    },\r\n                    \"UsersOrGroupsThatMayChangeTheTimeZone\": {\r\n                      \"value\": \"[parameters('UsersOrGroupsThatMayChangeTheTimeZone')]\"\r\n                    },\r\n                    \"UsersOrGroupsThatMayCreateATokenObject\": {\r\n                      \"value\": \"[parameters('UsersOrGroupsThatMayCreateATokenObject')]\"\r\n                    },\r\n                    \"UsersAndGroupsThatAreDeniedLoggingOnAsABatchJob\": {\r\n                      \"value\": \"[parameters('UsersAndGroupsThatAreDeniedLoggingOnAsABatchJob')]\"\r\n                    },\r\n                    \"UsersAndGroupsThatAreDeniedLoggingOnAsAService\": {\r\n                      \"value\": \"[parameters('UsersAndGroupsThatAreDeniedLoggingOnAsAService')]\"\r\n                    },\r\n                    \"UsersAndGroupsThatAreDeniedLocalLogon\": {\r\n                      \"value\": \"[parameters('UsersAndGroupsThatAreDeniedLocalLogon')]\"\r\n                    },\r\n                    \"UsersAndGroupsThatAreDeniedLogOnThroughRemoteDesktopServices\": {\r\n                      \"value\": \"[parameters('UsersAndGroupsThatAreDeniedLogOnThroughRemoteDesktopServices')]\"\r\n                    },\r\n                    \"UserAndGroupsThatMayForceShutdownFromARemoteSystem\": {\r\n                      \"value\": \"[parameters('UserAndGroupsThatMayForceShutdownFromARemoteSystem')]\"\r\n                    },\r\n                    \"UsersAndGroupsThatMayRestoreFilesAndDirectories\": {\r\n                      \"value\": \"[parameters('UsersAndGroupsThatMayRestoreFilesAndDirectories')]\"\r\n                    },\r\n                    \"UsersAndGroupsThatMayShutDownTheSystem\": {\r\n                      \"value\": \"[parameters('UsersAndGroupsThatMayShutDownTheSystem')]\"\r\n                    },\r\n                    \"UsersOrGroupsThatMayTakeOwnershipOfFilesOrOtherObjects\": {\r\n                      \"value\": \"[parameters('UsersOrGroupsThatMayTakeOwnershipOfFilesOrOtherObjects')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"UsersOrGroupsThatMayAccessThisComputerFromTheNetwork\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"UsersOrGroupsThatMayLogOnLocally\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"UsersOrGroupsThatMayLogOnThroughRemoteDesktopServices\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"UsersAndGroupsThatAreDeniedAccessToThisComputerFromTheNetwork\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"UsersOrGroupsThatMayManageAuditingAndSecurityLog\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"UsersOrGroupsThatMayBackUpFilesAndDirectories\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"UsersOrGroupsThatMayChangeTheSystemTime\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"UsersOrGroupsThatMayChangeTheTimeZone\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"UsersOrGroupsThatMayCreateATokenObject\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"UsersAndGroupsThatAreDeniedLoggingOnAsABatchJob\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"UsersAndGroupsThatAreDeniedLoggingOnAsAService\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"UsersAndGroupsThatAreDeniedLocalLogon\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"UsersAndGroupsThatAreDeniedLogOnThroughRemoteDesktopServices\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"UserAndGroupsThatMayForceShutdownFromARemoteSystem\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"UsersAndGroupsThatMayRestoreFilesAndDirectories\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"UsersAndGroupsThatMayShutDownTheSystem\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"UsersOrGroupsThatMayTakeOwnershipOfFilesOrOtherObjects\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Access this computer from the network;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayAccessThisComputerFromTheNetwork')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Allow log on locally;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayLogOnLocally')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Allow log on through Remote Desktop Services;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayLogOnThroughRemoteDesktopServices')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Deny access to this computer from the network;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersAndGroupsThatAreDeniedAccessToThisComputerFromTheNetwork')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Manage auditing and security log;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayManageAuditingAndSecurityLog')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Back up files and directories;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayBackUpFilesAndDirectories')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Change the system time;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayChangeTheSystemTime')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Change the time zone;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayChangeTheTimeZone')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Create a token object;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayCreateATokenObject')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Deny log on as a batch job;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersAndGroupsThatAreDeniedLoggingOnAsABatchJob')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Deny log on as a service;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersAndGroupsThatAreDeniedLoggingOnAsAService')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Deny log on locally;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersAndGroupsThatAreDeniedLocalLogon')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Deny log on through Remote Desktop Services;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersAndGroupsThatAreDeniedLogOnThroughRemoteDesktopServices')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Force shutdown from a remote system;ExpectedValue\",\r\n                                \"value\": \"[parameters('UserAndGroupsThatMayForceShutdownFromARemoteSystem')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Restore files and directories;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersAndGroupsThatMayRestoreFilesAndDirectories')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Shut down the system;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersAndGroupsThatMayShutDownTheSystem')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Take ownership of files or other objects;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayTakeOwnershipOfFilesOrOtherObjects')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Access this computer from the network;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayAccessThisComputerFromTheNetwork')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Allow log on locally;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayLogOnLocally')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Allow log on through Remote Desktop Services;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayLogOnThroughRemoteDesktopServices')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Deny access to this computer from the network;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersAndGroupsThatAreDeniedAccessToThisComputerFromTheNetwork')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Manage auditing and security log;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayManageAuditingAndSecurityLog')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Back up files and directories;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayBackUpFilesAndDirectories')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Change the system time;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayChangeTheSystemTime')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Change the time zone;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayChangeTheTimeZone')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Create a token object;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayCreateATokenObject')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Deny log on as a batch job;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersAndGroupsThatAreDeniedLoggingOnAsABatchJob')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Deny log on as a service;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersAndGroupsThatAreDeniedLoggingOnAsAService')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Deny log on locally;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersAndGroupsThatAreDeniedLocalLogon')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Deny log on through Remote Desktop Services;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersAndGroupsThatAreDeniedLogOnThroughRemoteDesktopServices')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Force shutdown from a remote system;ExpectedValue\",\r\n                                \"value\": \"[parameters('UserAndGroupsThatMayForceShutdownFromARemoteSystem')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Restore files and directories;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersAndGroupsThatMayRestoreFilesAndDirectories')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Shut down the system;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersAndGroupsThatMayShutDownTheSystem')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Take ownership of files or other objects;ExpectedValue\",\r\n                                \"value\": \"[parameters('UsersOrGroupsThatMayTakeOwnershipOfFilesOrOtherObjects')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/815dcc9f-6662-43f2-9a03-1b83e9876f24\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"815dcc9f-6662-43f2-9a03-1b83e9876f24\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Data Explorer encryption at rest should use a customer-managed key\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enabling encryption at rest using a customer-managed key on your Azure Data Explorer cluster provides additional control over the key being used by the encryption at rest. This feature is oftentimes applicable to customers with special compliance requirements and requires a Key Vault to managing the keys.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Azure Data Explorer\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Kusto/Clusters\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Kusto/clusters/keyVaultProperties\",\r\n                    \"exists\": false\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Kusto/clusters/keyVaultProperties.keyName\",\r\n                    \"exists\": false\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Kusto/clusters/keyVaultProperties.keyVersion\",\r\n                    \"exists\": false\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Kusto/clusters/keyVaultProperties.keyVaultUri\",\r\n                    \"exists\": false\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/81e74cea-30fd-40d5-802f-d72103c2aaaa\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"81e74cea-30fd-40d5-802f-d72103c2aaaa\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Geo-redundant backup should be enabled for Azure Database for MySQL\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Database for MySQL allows you to choose the redundancy option for your database server. It can be set to a geo-redundant backup storage in which the data is not only stored within the region in which your server is hosted, but is also replicated to a paired region to provide recovery option in case of a region failure. Configuring geo-redundant storage for backup is only allowed during server create.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DBforMySQL/servers\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DBforMySQL/servers/storageProfile.geoRedundantBackup\",\r\n                \"notEquals\": \"Enabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/82339799-d096-41ae-8538-b108becf0970\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"82339799-d096-41ae-8538-b108becf0970\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'System Audit Policies - System'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'System Audit Policies - System' for auditing IPsec driver, system integrity, system extension, state change, and other system events. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_SystemAuditPoliciesSystem\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"AuditOtherSystemEvents\": \"Audit Other System Events;ExpectedValue\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"AuditOtherSystemEvents\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit Other System Events\",\r\n              \"description\": \"Specifies whether audit events are generated for Windows Firewall Service and Windows Firewall driver start and stop events, failure events for these services and Windows Firewall Service policy processing failures.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"No Auditing\",\r\n              \"Success\",\r\n              \"Failure\",\r\n              \"Success and Failure\"\r\n            ],\r\n            \"defaultValue\": \"No Auditing\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SystemAuditPoliciesSystem\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('Audit Other System Events;ExpectedValue', '=', parameters('AuditOtherSystemEvents')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8316fa92-d69c-4810-8124-62414f560dcf\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8316fa92-d69c-4810-8124-62414f560dcf\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Configure backup on virtual machines with a given tag to a new recovery services vault with a default policy\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enforce backup for all virtual machines by deploying a recovery services vault in the same location and resource group as the virtual machine. Doing this is useful when different application teams in your organization are allocated separate resource groups and need to manage their own backups and restores. You can optionally include virtual machines containing a specified tag to control the scope of assignment. See https://aka.ms/AzureVMAppCentricBackupIncludeTag.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0-preview\",\r\n          \"preview\": true,\r\n          \"category\": \"Backup\"\r\n        },\r\n        \"parameters\": {\r\n          \"inclusionTagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Inclusion Tag Name\",\r\n              \"description\": \"Name of the tag to use for including VMs in the scope of this policy. This should be used along with the Inclusion Tag Value parameter. Learn more at https://aka.ms/AppCentricVMBackupPolicy.\"\r\n            },\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"inclusionTagValue\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Inclusion Tag Values\",\r\n              \"description\": \"Value of the tag to use for including VMs in the scope of this policy (in case of multiple values, use a comma-separated list). This should be used along with the Inclusion Tag Name parameter. Learn more at https://aka.ms/AppCentricVMBackupPolicy.\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"deployIfNotExists\",\r\n              \"auditIfNotExists\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"deployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"id\",\r\n                \"notContains\": \"/resourceGroups/databricks-rg-\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"[concat('tags[', parameters('inclusionTagName'), ']')]\",\r\n                    \"in\": \"[parameters('inclusionTagValue')]\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[empty(parameters('inclusionTagValue'))]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"value\": \"[empty(parameters('inclusionTagName'))]\",\r\n                    \"equals\": \"true\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2008-R2-SP1\",\r\n                          \"2008-R2-SP1-smalldisk\",\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\",\r\n                          \"2019-Datacenter\",\r\n                          \"2019-Datacenter-Core\",\r\n                          \"2019-Datacenter-Core-smalldisk\",\r\n                          \"2019-Datacenter-Core-with-Containers\",\r\n                          \"2019-Datacenter-Core-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-smalldisk\",\r\n                          \"2019-Datacenter-with-Containers\",\r\n                          \"2019-Datacenter-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-zhcn\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerSemiAnnual\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"Datacenter-Core-1709-smalldisk\",\r\n                          \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                          \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerHPCPack\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2019\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016-BYOL\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2-BYOL\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftRServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"MLServer-WS2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftVisualStudio\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"VisualStudio\",\r\n                          \"Windows\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"windows-data-science-vm\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsDesktop\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Windows-10\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-SAP-HANA\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"SLES\",\r\n                          \"SLES-HPC\",\r\n                          \"SLES-HPC-Priority\",\r\n                          \"SLES-SAP\",\r\n                          \"SLES-SAP-BYOS\",\r\n                          \"SLES-Priority\",\r\n                          \"SLES-BYOS\",\r\n                          \"SLES-SAPCAL\",\r\n                          \"SLES-Standard\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"12*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"contains\": \"ubuntu\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"14.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"16.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"18.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"*20_04-lts\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"20_04-lts*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Oracle\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Oracle-Linux\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7.*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"CentOS\",\r\n                          \"Centos-LVM\",\r\n                          \"CentOS-SRIOV\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-centos-os\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"like\": \"7*\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.RecoveryServices/backupprotecteditems\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\",\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/5e467623-bb1f-42f4-a55d-6e525e11384b\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Name of Azure Virtual Machines\"\r\n                        }\r\n                      },\r\n                      \"vmRgName\": {\r\n                        \"type\": \"string\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Resource group containing the virtual machines.\"\r\n                        }\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Location for VM and Backup vault\"\r\n                        }\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"backupFabric\": \"Azure\",\r\n                      \"backupPolicy\": \"DefaultPolicy\",\r\n                      \"v2VmType\": \"Microsoft.Compute/virtualMachines\",\r\n                      \"v2VmContainer\": \"iaasvmcontainer;iaasvmcontainerv2;\",\r\n                      \"v2Vm\": \"vm;iaasvmcontainerv2;\",\r\n                      \"vaultName\": \"[take(concat('RSVault-', parameters('location'), '-', guid(resourceGroup().id)),50)]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[variables('vaultName')]\",\r\n                        \"type\": \"Microsoft.RecoveryServices/vaults\",\r\n                        \"apiVersion\": \"2016-06-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {},\r\n                        \"sku\": {\r\n                          \"name\": \"Standard\"\r\n                        }\r\n                      },\r\n                      {\r\n                        \"name\": \"[concat(variables('vaultName'), '/', variables('backupFabric'), '/', variables('v2VmContainer'), concat(parameters('vmRgName'),';',parameters('vmName')), '/', variables('v2Vm'), concat(parameters('vmRgName'),';',parameters('vmName')))]\",\r\n                        \"apiVersion\": \"2016-12-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"type\": \"Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems\",\r\n                        \"dependsOn\": [\r\n                          \"[resourceId('Microsoft.RecoveryServices/vaults/', variables('vaultName'))]\"\r\n                        ],\r\n                        \"properties\": {\r\n                          \"protectedItemType\": \"[variables('v2VmType')]\",\r\n                          \"policyId\": \"[resourceId('Microsoft.RecoveryServices/vaults/backupPolicies', variables('vaultName'),variables('backupPolicy'))]\",\r\n                          \"sourceResourceId\": \"[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', parameters('vmRgName'), '/providers/Microsoft.Compute/virtualMachines/', parameters('vmName'))]\"\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"status\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Backup enabled successfully for VM:', ' ', parameters('vmName'), 'Backup Vault: ', variables('vaultName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"vmRgName\": {\r\n                      \"value\": \"[resourceGroup().name]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/83644c87-93dd-49fe-bf9f-6aff8fd0834e\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"83644c87-93dd-49fe-bf9f-6aff8fd0834e\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Resource logs in Event Hub should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit enabling of resource logs. This enables you to recreate activity trails to use for investigation purposes; when a security incident occurs or when your network is compromised\",\r\n        \"metadata\": {\r\n          \"version\": \"4.0.1\",\r\n          \"category\": \"Event Hub\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"requiredRetentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Required retention (days)\",\r\n              \"description\": \"The required resource logs retention in days\"\r\n            },\r\n            \"defaultValue\": \"365\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.EventHub/namespaces\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*]\",\r\n                  \"where\": {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                            \"equals\": \"true\"\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                                \"equals\": \"0\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                                \"greaterOrEquals\": \"[parameters('requiredRetentionDays')]\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                            \"equals\": \"true\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                            \"equals\": \"true\"\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                                \"notEquals\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/storageAccountId\",\r\n                                \"exists\": false\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                \"greaterOrEquals\": 1\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/83a214f7-d01a-484b-91a9-ed54470c9a6a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"83a214f7-d01a-484b-91a9-ed54470c9a6a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Network interfaces should not have public IPs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy denies the network interfaces which are configured with any public IP. Public IP addresses allow internet resources to communicate inbound to Azure resources, and Azure resources to communicate outbound to the internet. This should be reviewed by the network security team.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/networkInterfaces\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Network/networkInterfaces/ipconfigurations[*].publicIpAddress.id\",\r\n                  \"notLike\": \"*\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/83a86a26-fd1f-447c-b59d-e51f44264114\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"83a86a26-fd1f-447c-b59d-e51f44264114\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Bring your own key data protection should be enabled for MySQL servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use customer-managed keys to manage the encryption at rest of your MySQL servers. By default, the data is encrypted at rest with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.3\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.DBforMySQL/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.DBforMySQL/servers/keys\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.DBforMySQL/servers/keys/serverKeyType\",\r\n                    \"equals\": \"AzureKeyVault\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DBforMySQL/servers/keys/uri\",\r\n                    \"notEquals\": \"\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DBforMySQL/servers/keys/uri\",\r\n                    \"exists\": \"true\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/83cef61d-dbd1-4b20-a4fc-5fbc7da10833\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"83cef61d-dbd1-4b20-a4fc-5fbc7da10833\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Managed disks should disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disabling public network access improves security by ensuring that a managed disk isn't exposed on the public internet. Creating private endpoints can limit exposure of managed disks. Learn more at: https://aka.ms/disksprivatelinksdoc.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The effect determines what happens when the policy rule is evaluated to match\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/disks\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/disks/networkAccessPolicy\",\r\n                \"notIn\": [\r\n                  \"DenyAll\",\r\n                  \"AllowPrivate\"\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8405fdab-1faf-48aa-b702-999c9c172094\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8405fdab-1faf-48aa-b702-999c9c172094\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure managed disks to disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disable public network access for your managed disk resource so that it's not accessible over the public internet. This can reduce data leakage risks. Learn more at: https://aka.ms/disksprivatelinksdoc.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Modify\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Modify\"\r\n          },\r\n          \"location\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Location\",\r\n              \"strongType\": \"location\",\r\n              \"description\": \"All disks in this region are validated and disk access resource would be associated with them.\"\r\n            }\r\n          },\r\n          \"diskAccessId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Resource Id for the DiskAccess in the given location to which the disk resource needs to be linked\",\r\n              \"strongType\": \"Microsoft.Compute/diskAccesses\",\r\n              \"description\": \"Disk access resources enable exporting managed disks securely via private endpoints. Learn more at: https://aka.ms/disksprivatelinksdoc\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/disks\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"equals\": \"[parameters('location')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/disks/networkAccessPolicy\",\r\n                \"notIn\": [\r\n                  \"AllowPrivate\",\r\n                  \"DenyAll\"\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"conflictEffect\": \"audit\",\r\n              \"operations\": [\r\n                {\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.Compute/disks/diskAccessId\",\r\n                  \"value\": \"[parameters('diskAccessId')]\"\r\n                },\r\n                {\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.Compute/disks/networkAccessPolicy\",\r\n                  \"value\": \"AllowPrivate\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8426280e-b5be-43d9-979e-653d12a08638\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8426280e-b5be-43d9-979e-653d12a08638\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Log Analytics agent should be installed on your Linux Azure Arc machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy audits Linux Azure Arc machines if the Log Analytics agent is not installed.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-preview\",\r\n          \"category\": \"Monitoring\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.HybridCompute/machines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                \"like\": \"linux*\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.HybridCompute/machines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/machines/extensions/type\",\r\n                    \"equals\": \"OmsAgentForLinux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/machines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/machines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/842c54e8-c2f9-4d79-ae8d-38d8b8019373\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"842c54e8-c2f9-4d79-ae8d-38d8b8019373\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Ensure that '.NET Framework' version is the latest, if used as a part of the Web app\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy is not required since Azure App Service automatically updates and maintains the .NET Framework versions installed on the platform.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"App Service\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"app*\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/config/web.netFrameworkVersion\",\r\n                \"in\": [\r\n                  \"v3.0\",\r\n                  \"v4.0\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/843664e0-7563-41ee-a9cb-7522c382d2c4\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"843664e0-7563-41ee-a9cb-7522c382d2c4\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit Windows machines that are not joined to the specified domain\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if the value of the Domain property in WMI class win32_computersystem does not match the value in the policy parameter.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"WindowsDomainMembership\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"DomainName\": \"[DomainMembership]WindowsDomainMembership;DomainName\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"DomainName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Domain Name (FQDN)\",\r\n              \"description\": \"The fully qualified domain name (FQDN) that the Windows machines should be joined to\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsDomainMembership\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('[DomainMembership]WindowsDomainMembership;DomainName', '=', parameters('DomainName')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/84662df4-0e37-44a6-9ce1-c9d2150db18c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"84662df4-0e37-44a6-9ce1-c9d2150db18c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'Windows Components'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'Windows Components' for basic authentication, unencrypted traffic, Microsoft accounts, telemetry, Cortana, and other Windows behaviors. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_WindowsComponents\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"SendFileSamplesWhenFurtherAnalysisIsRequired\": \"Send file samples when further analysis is required;ExpectedValue\",\r\n              \"AllowIndexingOfEncryptedFiles\": \"Allow indexing of encrypted files;ExpectedValue\",\r\n              \"AllowTelemetry\": \"Allow Telemetry;ExpectedValue\",\r\n              \"AllowUnencryptedTraffic\": \"Allow unencrypted traffic;ExpectedValue\",\r\n              \"AlwaysInstallWithElevatedPrivileges\": \"Always install with elevated privileges;ExpectedValue\",\r\n              \"AlwaysPromptForPasswordUponConnection\": \"Always prompt for password upon connection;ExpectedValue\",\r\n              \"ApplicationSpecifyTheMaximumLogFileSizeKB\": \"Application: Specify the maximum log file size (KB);ExpectedValue\",\r\n              \"AutomaticallySendMemoryDumpsForOSgeneratedErrorReports\": \"Automatically send memory dumps for OS-generated error reports;ExpectedValue\",\r\n              \"ConfigureDefaultConsent\": \"Configure Default consent;ExpectedValue\",\r\n              \"ConfigureWindowsSmartScreen\": \"Configure Windows SmartScreen;ExpectedValue\",\r\n              \"DisallowDigestAuthentication\": \"Disallow Digest authentication;ExpectedValue\",\r\n              \"DisallowWinRMFromStoringRunAsCredentials\": \"Disallow WinRM from storing RunAs credentials;ExpectedValue\",\r\n              \"DoNotAllowPasswordsToBeSaved\": \"Do not allow passwords to be saved;ExpectedValue\",\r\n              \"SecuritySpecifyTheMaximumLogFileSizeKB\": \"Security: Specify the maximum log file size (KB);ExpectedValue\",\r\n              \"SetClientConnectionEncryptionLevel\": \"Set client connection encryption level;ExpectedValue\",\r\n              \"SetTheDefaultBehaviorForAutoRun\": \"Set the default behavior for AutoRun;ExpectedValue\",\r\n              \"SetupSpecifyTheMaximumLogFileSizeKB\": \"Setup: Specify the maximum log file size (KB);ExpectedValue\",\r\n              \"SystemSpecifyTheMaximumLogFileSizeKB\": \"System: Specify the maximum log file size (KB);ExpectedValue\",\r\n              \"TurnOffDataExecutionPreventionForExplorer\": \"Turn off Data Execution Prevention for Explorer;ExpectedValue\",\r\n              \"SpecifyTheIntervalToCheckForDefinitionUpdates\": \"Specify the interval to check for definition updates;ExpectedValue\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"SendFileSamplesWhenFurtherAnalysisIsRequired\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Send file samples when further analysis is required\",\r\n              \"description\": \"Specifies whether and how Windows Defender will submit samples of suspected malware  to Microsoft for further analysis when opt-in for MAPS telemetry is set.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"AllowIndexingOfEncryptedFiles\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allow indexing of encrypted files\",\r\n              \"description\": \"Specifies whether encrypted items are allowed to be indexed.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"AllowTelemetry\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allow Telemetry\",\r\n              \"description\": \"Specifies configuration of the amount of diagnostic and usage data reported to Microsoft. The data is transmitted securely and sensitive data is not sent.\"\r\n            },\r\n            \"defaultValue\": \"2\"\r\n          },\r\n          \"AllowUnencryptedTraffic\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allow unencrypted traffic\",\r\n              \"description\": \"Specifies whether the Windows Remote Management (WinRM) service sends and receives unencrypted messages over the network.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"AlwaysInstallWithElevatedPrivileges\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Always install with elevated privileges\",\r\n              \"description\": \"Specifies whether Windows Installer should use system permissions when it installs any program on the system.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"AlwaysPromptForPasswordUponConnection\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Always prompt for password upon connection\",\r\n              \"description\": \"Specifies whether Terminal Services/Remote Desktop Connection always prompts the client computer for a password upon connection.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"ApplicationSpecifyTheMaximumLogFileSizeKB\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Application: Specify the maximum log file size (KB)\",\r\n              \"description\": \"Specifies the maximum size for the Application event log in kilobytes.\"\r\n            },\r\n            \"defaultValue\": \"32768\"\r\n          },\r\n          \"AutomaticallySendMemoryDumpsForOSgeneratedErrorReports\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Automatically send memory dumps for OS-generated error reports\",\r\n              \"description\": \"Specifies if memory dumps in support of OS-generated error reports can be sent to Microsoft automatically.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"ConfigureDefaultConsent\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Configure Default consent\",\r\n              \"description\": \"Specifies setting of the default consent handling for error reports sent to Microsoft.\"\r\n            },\r\n            \"defaultValue\": \"4\"\r\n          },\r\n          \"ConfigureWindowsSmartScreen\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Configure Windows SmartScreen\",\r\n              \"description\": \"Specifies how to manage the behavior of Windows SmartScreen. Windows SmartScreen helps keep PCs safer by warning users before running unrecognized programs downloaded from the Internet. Some information is sent to Microsoft about files and programs run on PCs with this feature enabled.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"DisallowDigestAuthentication\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Disallow Digest authentication\",\r\n              \"description\": \"Specifies whether the Windows Remote Management (WinRM) client will not use Digest authentication.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"DisallowWinRMFromStoringRunAsCredentials\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Disallow WinRM from storing RunAs credentials\",\r\n              \"description\": \"Specifies whether the Windows Remote Management (WinRM) service will not allow RunAs credentials to be stored for any plug-ins.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"DoNotAllowPasswordsToBeSaved\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Do not allow passwords to be saved\",\r\n              \"description\": \"Specifies whether to prevent Remote Desktop Services - Terminal Services clients from saving passwords on a computer.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"SecuritySpecifyTheMaximumLogFileSizeKB\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Security: Specify the maximum log file size (KB)\",\r\n              \"description\": \"Specifies the maximum size for the Security event log in kilobytes.\"\r\n            },\r\n            \"defaultValue\": \"196608\"\r\n          },\r\n          \"SetClientConnectionEncryptionLevel\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Set client connection encryption level\",\r\n              \"description\": \"Specifies whether to require the use of a specific encryption level to secure communications between client computers and RD Session Host servers during Remote Desktop Protocol (RDP) connections. This policy only applies when you are using native RDP encryption.\"\r\n            },\r\n            \"defaultValue\": \"3\"\r\n          },\r\n          \"SetTheDefaultBehaviorForAutoRun\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Set the default behavior for AutoRun\",\r\n              \"description\": \"Specifies the default behavior for Autorun commands. Autorun commands are generally stored in autorun.inf files. They often launch the installation program or other routines.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"SetupSpecifyTheMaximumLogFileSizeKB\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Setup: Specify the maximum log file size (KB)\",\r\n              \"description\": \"Specifies the maximum size for the Setup event log in kilobytes.\"\r\n            },\r\n            \"defaultValue\": \"32768\"\r\n          },\r\n          \"SystemSpecifyTheMaximumLogFileSizeKB\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"System: Specify the maximum log file size (KB)\",\r\n              \"description\": \"Specifies the maximum size for the System event log in kilobytes.\"\r\n            },\r\n            \"defaultValue\": \"32768\"\r\n          },\r\n          \"TurnOffDataExecutionPreventionForExplorer\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Turn off Data Execution Prevention for Explorer\",\r\n              \"description\": \"Specifies whether to turn off Data Execution Prevention for Windows File Explorer. Disabling data execution prevention can allow certain legacy plug-in applications to function without terminating Explorer.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"SpecifyTheIntervalToCheckForDefinitionUpdates\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Specify the interval to check for definition updates\",\r\n              \"description\": \"Specifies an interval at which to check for Windows Defender definition updates. The time value is represented as the number of hours between update checks.\"\r\n            },\r\n            \"defaultValue\": \"8\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_WindowsComponents\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('Send file samples when further analysis is required;ExpectedValue', '=', parameters('SendFileSamplesWhenFurtherAnalysisIsRequired'), ',', 'Allow indexing of encrypted files;ExpectedValue', '=', parameters('AllowIndexingOfEncryptedFiles'), ',', 'Allow Telemetry;ExpectedValue', '=', parameters('AllowTelemetry'), ',', 'Allow unencrypted traffic;ExpectedValue', '=', parameters('AllowUnencryptedTraffic'), ',', 'Always install with elevated privileges;ExpectedValue', '=', parameters('AlwaysInstallWithElevatedPrivileges'), ',', 'Always prompt for password upon connection;ExpectedValue', '=', parameters('AlwaysPromptForPasswordUponConnection'), ',', 'Application: Specify the maximum log file size (KB);ExpectedValue', '=', parameters('ApplicationSpecifyTheMaximumLogFileSizeKB'), ',', 'Automatically send memory dumps for OS-generated error reports;ExpectedValue', '=', parameters('AutomaticallySendMemoryDumpsForOSgeneratedErrorReports'), ',', 'Configure Default consent;ExpectedValue', '=', parameters('ConfigureDefaultConsent'), ',', 'Configure Windows SmartScreen;ExpectedValue', '=', parameters('ConfigureWindowsSmartScreen'), ',', 'Disallow Digest authentication;ExpectedValue', '=', parameters('DisallowDigestAuthentication'), ',', 'Disallow WinRM from storing RunAs credentials;ExpectedValue', '=', parameters('DisallowWinRMFromStoringRunAsCredentials'), ',', 'Do not allow passwords to be saved;ExpectedValue', '=', parameters('DoNotAllowPasswordsToBeSaved'), ',', 'Security: Specify the maximum log file size (KB);ExpectedValue', '=', parameters('SecuritySpecifyTheMaximumLogFileSizeKB'), ',', 'Set client connection encryption level;ExpectedValue', '=', parameters('SetClientConnectionEncryptionLevel'), ',', 'Set the default behavior for AutoRun;ExpectedValue', '=', parameters('SetTheDefaultBehaviorForAutoRun'), ',', 'Setup: Specify the maximum log file size (KB);ExpectedValue', '=', parameters('SetupSpecifyTheMaximumLogFileSizeKB'), ',', 'System: Specify the maximum log file size (KB);ExpectedValue', '=', parameters('SystemSpecifyTheMaximumLogFileSizeKB'), ',', 'Turn off Data Execution Prevention for Explorer;ExpectedValue', '=', parameters('TurnOffDataExecutionPreventionForExplorer'), ',', 'Specify the interval to check for definition updates;ExpectedValue', '=', parameters('SpecifyTheIntervalToCheckForDefinitionUpdates')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8537fe96-8cbe-43de-b0ef-131bc72bc22a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8537fe96-8cbe-43de-b0ef-131bc72bc22a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure IoT Hub device provisioning service instances to disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disable public network access for your IoT Hub device provisioning instance so that it's not accessible over the public internet. This can reduce data leakage risks. Learn more at: https://aka.ms/iotdpsvnet.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Internet of Things\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Modify\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Modify\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Devices/provisioningServices\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Devices/provisioningServices/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"conflictEffect\": \"audit\",\r\n              \"operations\": [\r\n                {\r\n                  \"condition\": \"[greaterOrEquals(requestContext().apiVersion, '2020-03-01')]\",\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.Devices/provisioningServices/publicNetworkAccess\",\r\n                  \"value\": \"Disabled\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/859dfc91-ea35-43a6-8256-31271c363794\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"859dfc91-ea35-43a6-8256-31271c363794\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Azure Data Factory integration runtime should have a limit for number of cores\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"To manage your resources and costs, limit the number of cores for an integration runtime.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-preview\",\r\n          \"category\": \"Data Factory\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          },\r\n          \"maxCores\": {\r\n            \"type\": \"Integer\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed max number of cores\",\r\n              \"description\": \"The max number of cores allowed for dataflow.\"\r\n            },\r\n            \"defaultValue\": 32\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DataFactory/factories/integrationRuntimes\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DataFactory/factories/integrationruntimes/type\",\r\n                \"equals\": \"Managed\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DataFactory/factories/integrationRuntimes/Managed.typeProperties.computeProperties.dataFlowProperties.coreCount\",\r\n                \"exists\": \"true\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DataFactory/factories/integrationRuntimes/Managed.typeProperties.computeProperties.dataFlowProperties.coreCount\",\r\n                \"greater\": \"[parameters('maxCores')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/85bb39b5-2f66-49f8-9306-77da3ac5130f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"85bb39b5-2f66-49f8-9306-77da3ac5130f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Cosmos DB accounts should have firewall rules\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Firewall rules should be defined on your Azure Cosmos DB accounts to prevent traffic from unauthorized sources. Accounts that have at least one IP rule defined with the virtual network filter enabled are deemed compliant. Accounts disabling public access are also deemed compliant.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"Cosmos DB\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Policy Effect\",\r\n              \"description\": \"The desired effect of the policy.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Deny\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DocumentDB/databaseAccounts\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/publicNetworkAccess\",\r\n                    \"exists\": \"false\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/publicNetworkAccess\",\r\n                    \"equals\": \"Enabled\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/isVirtualNetworkFilterEnabled\",\r\n                    \"exists\": \"false\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/isVirtualNetworkFilterEnabled\",\r\n                    \"equals\": \"false\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.DocumentDB/databaseAccounts/ipRules\",\r\n                            \"exists\": \"false\"\r\n                          },\r\n                          {\r\n                            \"count\": {\r\n                              \"field\": \"Microsoft.DocumentDB/databaseAccounts/ipRules[*]\"\r\n                            },\r\n                            \"equals\": 0\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.DocumentDB/databaseAccounts/ipRangeFilter\",\r\n                            \"exists\": \"false\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.DocumentDB/databaseAccounts/ipRangeFilter\",\r\n                            \"equals\": \"\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/862e97cf-49fc-4a5c-9de4-40d4e2e7c8eb\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"862e97cf-49fc-4a5c-9de4-40d4e2e7c8eb\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs configurations in 'Security Options - Microsoft Network Server'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - Microsoft Network Server'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsMicrosoftNetworkServer\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AzureBaseline_SecurityOptionsMicrosoftNetworkServer\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/86880e5c-df35-43c5-95ad-7e120635775e\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"86880e5c-df35-43c5-95ad-7e120635775e\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy SQL DB transparent data encryption\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enables transparent data encryption on SQL databases\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers/databases\"\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"notEquals\": \"master\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"DeployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/databases/transparentDataEncryption\",\r\n              \"name\": \"current\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Sql/transparentDataEncryption.status\",\r\n                \"equals\": \"Enabled\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/9b7fa17d-e63e-47b0-bb0a-15c516ac86ec\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"fullDbName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('fullDbName'), '/current')]\",\r\n                        \"type\": \"Microsoft.Sql/servers/databases/transparentDataEncryption\",\r\n                        \"apiVersion\": \"2014-04-01\",\r\n                        \"properties\": {\r\n                          \"status\": \"Enabled\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"fullDbName\": {\r\n                      \"value\": \"[field('fullName')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/86a912f6-9a06-4e26-b447-11b16ba8659f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"86a912f6-9a06-4e26-b447-11b16ba8659f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"System updates should be installed on your machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Missing security system updates on your servers will be monitored by Azure Security Center as recommendations\",\r\n        \"metadata\": {\r\n          \"version\": \"4.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.ClassicCompute/virtualMachines\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"4ab6e3c5-74dd-8b35-9ab9-f61b30875b27\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/86b3d65f-7626-441e-b690-81a8b71cff60\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"86b3d65f-7626-441e-b690-81a8b71cff60\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure private DNS zones for private endpoints that connect to Azure Data Factory\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private DNS records allow private connections to private endpoints. Private endpoint connections allow secure communication by enabling private connectivity to your Azure Data Factory without a need for public IP addresses at the source or destination. For more information on private endpoints and DNS zones in Azure Data Factory, see https://docs.microsoft.com/azure/data-factory/data-factory-private-link.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Data Factory\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateDnsZoneId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private DNS Zone\",\r\n              \"strongType\": \"Microsoft.Network/privateDnsZones\",\r\n              \"description\": \"The private DNS zone to deploy in a new private DNS zone group and link to the private endpoint\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          },\r\n          \"listOfGroupIds\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"description\": \"The list of Group Ids that can be specified for Private Endpoints.\",\r\n              \"displayName\": \"Allowed Group Ids\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"dataFactory\",\r\n              \"portal\"\r\n            ],\r\n            \"defaultValue\": [\r\n              \"dataFactory\",\r\n              \"portal\"\r\n            ]\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/privateEndpoints\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*].groupIds[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.Network/privateEndpoints/privateLinkServiceConnections[*].groupIds[*]\",\r\n                    \"in\": \"[parameters('listOfGroupIds')]\"\r\n                  }\r\n                },\r\n                \"greaterOrEquals\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Network/privateEndpoints/privateDnsZoneGroups\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"privateDnsZoneId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('privateEndpointName'), '/deployedByPolicy')]\",\r\n                        \"type\": \"Microsoft.Network/privateEndpoints/privateDnsZoneGroups\",\r\n                        \"apiVersion\": \"2020-03-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"privateDnsZoneConfigs\": [\r\n                            {\r\n                              \"name\": \"dataFactory-privateDnsZone\",\r\n                              \"properties\": {\r\n                                \"privateDnsZoneId\": \"[parameters('privateDnsZoneId')]\"\r\n                              }\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"privateDnsZoneId\": {\r\n                      \"value\": \"[parameters('privateDnsZoneId')]\"\r\n                    },\r\n                    \"privateEndpointName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/86cd96e1-1745-420d-94d4-d3f2fe415aa4\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"86cd96e1-1745-420d-94d4-d3f2fe415aa4\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Ensure that Register with Azure Active Directory is enabled on API app\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy is a duplicate of the respective Managed Identity policies. Please use /providers/Microsoft.Authorization/policyDefinitions/c4d441f8-f9d9-4a9e-9cef-e82117cb3ee instead.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"App Service\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"*api\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/config/web.managedServiceIdentityId\",\r\n                \"exists\": \"true\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/86d97760-d216-4d81-a3ad-163087b2b6c3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"86d97760-d216-4d81-a3ad-163087b2b6c3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Data Box jobs should use a customer-managed key to encrypt the device unlock password\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use a customer-managed key to control the encryption of the device unlock password for Azure Data Box. Customer-managed keys also help manage access to the device unlock password by the Data Box service in order to prepare the device and copy data in an automated manner. The data on the device itself is already encrypted at rest with Advanced Encryption Standard 256-bit encryption, and the device unlock password is encrypted by default with a Microsoft managed key.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Data Box\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The desired effect of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          },\r\n          \"supportedSKUs\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Supported SKUs\",\r\n              \"description\": \"The list of SKUs that support customer-managed key encryption key\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DataBox\",\r\n              \"DataBoxHeavy\"\r\n            ],\r\n            \"defaultValue\": [\r\n              \"DataBox\",\r\n              \"DataBoxHeavy\"\r\n            ]\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DataBox/jobs\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Databox/jobs/sku.name\",\r\n                \"in\": \"[parameters('supportedSKUs')]\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DataBox/jobs/details.keyEncryptionKey.kekType\",\r\n                \"notEquals\": \"CustomerManaged\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/86efb160-8de7-451d-bc08-5d475b0aadae\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"86efb160-8de7-451d-bc08-5d475b0aadae\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Require a tag on resources\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enforces existence of a tag. Does not apply to resource groups.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"Tags\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n            \"exists\": \"false\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/871b6d14-10aa-478d-b590-94f262ecfa99\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"871b6d14-10aa-478d-b590-94f262ecfa99\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'System Audit Policies - Privilege Use'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'System Audit Policies - Privilege Use' for auditing nonsensitive and other privilege use. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_SystemAuditPoliciesPrivilegeUse\",\r\n            \"version\": \"1.*\"\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SystemAuditPoliciesPrivilegeUse\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/87845465-c458-45f3-af66-dcd62176f397\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"87845465-c458-45f3-af66-dcd62176f397\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'Security Options - Devices'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'Security Options - Devices' for undocking without logging on, installing print drivers, and formatting/ejecting media. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_SecurityOptionsDevices\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"DevicesAllowedToFormatAndEjectRemovableMedia\": \"Devices: Allowed to format and eject removable media;ExpectedValue\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"DevicesAllowedToFormatAndEjectRemovableMedia\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Devices: Allowed to format and eject removable media\",\r\n              \"description\": \"Specifies who is allowed to format and eject removable NTFS media. You can use this policy setting to prevent unauthorized users from removing data on one computer to access it on another computer on which they have local administrator privileges.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsDevices\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('Devices: Allowed to format and eject removable media;ExpectedValue', '=', parameters('DevicesAllowedToFormatAndEjectRemovableMedia')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8794ff4f-1a35-4e18-938f-0b22055067cd\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8794ff4f-1a35-4e18-938f-0b22055067cd\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs configurations in 'Administrative Templates - Control Panel'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Administrative Templates - Control Panel'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_AdministrativeTemplatesControlPanel\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/87b590fe-4a1d-4697-ae74-d4fe72ab786c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"87b590fe-4a1d-4697-ae74-d4fe72ab786c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Stream Analytics jobs should use customer-managed keys to encrypt data\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use customer-managed keys when you want to securely store any metadata and private data assets of your Stream Analytics jobs in your storage account. This gives you total control over how your Stream Analytics data is encrypted.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Stream Analytics\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The desired effect of the policy.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"audit\",\r\n              \"deny\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.StreamAnalytics/streamingJobs/contentStoragePolicy\",\r\n                \"equals\": \"SystemAccount\"\r\n              },\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.StreamAnalytics/streamingJobs\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/87ba29ef-1ab3-4d82-b763-87fcd4f531f7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"87ba29ef-1ab3-4d82-b763-87fcd4f531f7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Linux VMs that have the specified applications installed\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Linux virtual machines that have the specified applications installed. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"ApplicationName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Application names\",\r\n              \"description\": \"A semicolon-separated list of the names of the applications that should not be installed. e.g. 'python; powershell'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"microsoft-aks\",\r\n                          \"qubole-inc\",\r\n                          \"datastax\",\r\n                          \"couchbase\",\r\n                          \"scalegrid\",\r\n                          \"checkpoint\",\r\n                          \"paloaltonetworks\",\r\n                          \"debian\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"OpenLogic\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"CentOS*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Oracle\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Oracle-Linux\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"RHEL\",\r\n                              \"RHEL-HA\",\r\n                              \"RHEL-SAP\",\r\n                              \"RHEL-SAP-APPS\",\r\n                              \"RHEL-SAP-HA\",\r\n                              \"RHEL-SAP-HANA\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"RedHat\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"osa\",\r\n                              \"rhel-byos\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"cis-centos-7-l1\",\r\n                              \"cis-centos-7-v2-1-1-l1\",\r\n                              \"cis-centos-8-l1\",\r\n                              \"cis-debian-linux-8-l1\",\r\n                              \"cis-debian-linux-9-l1\",\r\n                              \"cis-nginx-centos-7-v1-1-0-l1\",\r\n                              \"cis-oracle-linux-7-v2-0-0-l1\",\r\n                              \"cis-oracle-linux-8-l1\",\r\n                              \"cis-postgresql-11-centos-linux-7-level-1\",\r\n                              \"cis-rhel-7-l2\",\r\n                              \"cis-rhel-7-v2-2-0-l1\",\r\n                              \"cis-rhel-8-l1\",\r\n                              \"cis-suse-linux-12-v2-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1604-v1-0-0-l1\",\r\n                              \"cis-ubuntu-linux-1804-l1\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"credativ\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"Debian\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"7*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Suse\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"SLES*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"11*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"Canonical\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"UbuntuServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"12*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"linux-data-science-vm-ubuntu\",\r\n                              \"azureml\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-centos-os\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"6*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloudera\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"cloudera-altus-centos-os\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"linux*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.linuxConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Linux*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                                \"notIn\": [\r\n                                  \"OpenLogic\",\r\n                                  \"RedHat\",\r\n                                  \"credativ\",\r\n                                  \"Suse\",\r\n                                  \"Canonical\",\r\n                                  \"microsoft-dsvm\",\r\n                                  \"cloudera\",\r\n                                  \"microsoft-ads\",\r\n                                  \"center-for-internet-security-inc\",\r\n                                  \"Oracle\"\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"linux*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"not_installed_application_linux\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('[ChefInSpec]NotInstalledApplicationLinuxResource1;AttributesYmlContent', '=', concat('packages: [', replace(parameters('ApplicationName'), ';', ','), ']')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"not_installed_application_linux\"\r\n                    },\r\n                    \"ApplicationName\": {\r\n                      \"value\": \"[parameters('ApplicationName')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ApplicationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[ChefInSpec]NotInstalledApplicationLinuxResource1;AttributesYmlContent\",\r\n                                \"value\": \"[concat('packages: [', replace(parameters('ApplicationName'), ';', ','), ']')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[ChefInSpec]NotInstalledApplicationLinuxResource1;AttributesYmlContent\",\r\n                                \"value\": \"[concat('packages: [', replace(parameters('ApplicationName'), ';', ','), ']')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforLinux')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforLinux\",\r\n                          \"typeHandlerVersion\": \"1.0\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/884b209a-963b-4520-8006-d20cb3c213e0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"884b209a-963b-4520-8006-d20cb3c213e0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Ensure that 'Java version' is the latest, if used as a part of the API app\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Periodically, newer versions are released for Java either due to security flaws or to include additional functionality. Using the latest Python version for API apps is recommended in order to take advantage of security fixes, if any, and/or new functionalities of the latest version. Currently, this policy only applies to Linux web apps.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"JavaLatestVersion\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Latest Java version\",\r\n              \"description\": \"Latest supported Java version for App Services\"\r\n            },\r\n            \"defaultValue\": \"11\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"*api\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"contains\": \"linux\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/web.linuxFxVersion\",\r\n                    \"notContains\": \"JAVA\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/web.linuxFxVersion\",\r\n                    \"like\": \"[concat('*', parameters('JavaLatestVersion'))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/88999f4c-376a-45c8-bcb3-4058f713cf39\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"88999f4c-376a-45c8-bcb3-4058f713cf39\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Network interfaces should disable IP forwarding\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy denies the network interfaces which enabled IP forwarding. The setting of IP forwarding disables Azure's check of the source and destination for a network interface. This should be reviewed by the network security team.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/networkInterfaces\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Network/networkInterfaces/enableIpForwarding\",\r\n                \"equals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/88c0b9da-ce96-4b03-9635-f29a937e2900\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"88c0b9da-ce96-4b03-9635-f29a937e2900\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"SQL servers with auditing to storage account destination should be configured with 90 days retention or higher\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"For incident investigation purposes, we recommend setting the data retention for your SQL Server' auditing to storage account destination to at least 90 days. Confirm that you are meeting the necessary retention rules for the regions in which you are operating. This is sometimes required for compliance with regulatory standards.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"notContains\": \"analytics\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/auditingSettings\",\r\n              \"name\": \"default\",\r\n              \"existenceCondition\": {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Sql/servers/auditingSettings/isAzureMonitorTargetEnabled\",\r\n                        \"equals\": true\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Sql/servers/auditingSettings/storageEndpoint\",\r\n                        \"equals\": \"\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/servers/auditingSettings/retentionDays\",\r\n                    \"equals\": 0\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/servers/auditingSettings/retentionDays\",\r\n                    \"greaterOrEquals\": 90\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/89099bee-89e0-4b26-a5f4-165451757743\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"89099bee-89e0-4b26-a5f4-165451757743\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Modify - Configure Azure Event Grid domains to disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disable public network access for Azure Event Grid resource so that it isn't accessible over the public internet. This will help protect them against data leakage risks. You can limit exposure of the your resources by creating private endpoints instead. Learn more at: https://aka.ms/privateendpoints.\",\r\n        \"metadata\": {\r\n          \"category\": \"Event Grid\",\r\n          \"version\": \"1.0.0\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Modify\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Modify\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.EventGrid/domains\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.EventGrid/domains/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/1e241071-0855-49ea-94dc-649edcd759de\"\r\n              ],\r\n              \"conflictEffect\": \"audit\",\r\n              \"operations\": [\r\n                {\r\n                  \"condition\": \"[greaterOrEquals(requestContext().apiVersion, '2020-04-01-preview')]\",\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.EventGrid/domains/publicNetworkAccess\",\r\n                  \"value\": \"Disabled\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/898e9824-104c-4965-8e0e-5197588fa5d4\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"898e9824-104c-4965-8e0e-5197588fa5d4\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"App Configuration should use a SKU that supports private link\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"When using a supported SKU, Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The private link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your app configuration instances instead of the entire service, you'll also be protected against data leakage risks. Learn more at: https://aka.ms/appconfig/private-endpoint.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Configuration\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.AppConfiguration/configurationStores\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.AppConfiguration/configurationStores/sku.name\",\r\n                \"equals\": \"Free\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/89c8a434-18f0-402c-8147-630a8dea54e0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"89c8a434-18f0-402c-8147-630a8dea54e0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs configurations in 'Security Options - System settings'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Security Options - System settings'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SecurityOptionsSystemsettings\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8a39d1f1-5513-4628-b261-f469a5a3341b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8a39d1f1-5513-4628-b261-f469a5a3341b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Container Instance container group should deploy into a virtual network\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Secure communication between your containers with Azure Virtual Networks. When you specify a virtual network, resources within the virtual network can securely and privately communicate with each other.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Container Instance\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\",\r\n              \"Deny\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ContainerInstance/containerGroups\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.ContainerInstance/containerGroups/networkProfile.id\",\r\n                \"exists\": false\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8af8f826-edcb-4178-b35f-851ea6fea615\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8af8f826-edcb-4178-b35f-851ea6fea615\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Data Factory should use private link\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to Azure Data Factory, data leakage risks are reduced. Learn more about private links at: https://docs.microsoft.com/azure/data-factory/data-factory-private-link.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Data Factory\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.DataFactory/factories\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.DataFactory/factories/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.DataFactory/factories/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8b0323be-cc25-4b61-935d-002c3798c6ea\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8b0323be-cc25-4b61-935d-002c3798c6ea\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs with a pending reboot\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with a pending reboot. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsPendingReboot\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8b0de57a-f511-4d45-a277-17cb79cb163b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8b0de57a-f511-4d45-a277-17cb79cb163b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs configurations in 'Windows Firewall Properties'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Windows Firewall Properties'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_WindowsFirewallProperties\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8bbd627e-4d25-4906-9a6e-3789780af3ec\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8bbd627e-4d25-4906-9a6e-3789780af3ec\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Ensure that 'HTTP Version' is the latest, if used to run the Web app\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Periodically, newer versions are released for HTTP either due to security flaws or to include additional functionality. Using the latest HTTP version for web apps to take advantage of security fixes, if any, and/or new functionalities of the newer version. Currently, this policy only applies to Linux web apps.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"app*\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"contains\": \"linux\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/config/web.http20Enabled\",\r\n                \"Equals\": \"true\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8c122334-9d20-4eb8-89ea-ac9a705b74ae\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8c122334-9d20-4eb8-89ea-ac9a705b74ae\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Latest TLS version should be used in your API App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Upgrade to the latest TLS version\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"*api\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/config/minTlsVersion\",\r\n                \"equals\": \"1.2\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8cb6aa8b-9e41-4f4e-aa25-089a7ac2581e\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8cb6aa8b-9e41-4f4e-aa25-089a7ac2581e\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Require a tag and its value on resource groups\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Enforces a required tag and its value on resource groups.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Tags\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            }\r\n          },\r\n          \"tagValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Value\",\r\n              \"description\": \"Value of the tag, such as 'production'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Resources/subscriptions/resourceGroups\"\r\n              },\r\n              {\r\n                \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                \"notEquals\": \"[parameters('tagValue')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8ce3da23-7156-49e4-b145-24f95f9dcb46\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8ce3da23-7156-49e4-b145-24f95f9dcb46\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Azure Arc enabled Kubernetes clusters should have Azure Defender's extension installed\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Defender's extension for Azure Arc provides threat protection for your Arc enabled Kubernetes clusters. The extension collects data from all control plane (master) nodes in the cluster and sends it to the Azure Defender for Kubernetes backend in the cloud for further analysis. Learn more in https://docs.microsoft.com/azure/security-center/defender-for-kubernetes-azure-arc.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-preview\",\r\n          \"category\": \"Kubernetes\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Kubernetes/connectedClusters\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Kubernetes/connectedClusters/distribution\",\r\n                \"in\": [\r\n                  \"generic\",\r\n                  \"openshift\"\r\n                ]\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Kubernetes/connectedClusters/connectivityStatus\",\r\n                \"equals\": \"connected\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.KubernetesConfiguration/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.KubernetesConfiguration/extensions/extensionType\",\r\n                    \"equals\": \"microsoft.azuredefender.kubernetes\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.KubernetesConfiguration/extensions/installState\",\r\n                    \"equals\": \"Installed\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8dfab9c4-fe7b-49ad-85e4-1e9be085358f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8dfab9c4-fe7b-49ad-85e4-1e9be085358f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs configurations in 'System Audit Policies - Object Access'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Object Access'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"AuditDetailedFileShare\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit Detailed File Share\",\r\n              \"description\": \"If this policy setting is enabled, access to all shared files and folders on the system is audited. Auditing for Success can lead to very high volumes of events.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"No Auditing\",\r\n              \"Success\",\r\n              \"Failure\",\r\n              \"Success and Failure\"\r\n            ],\r\n            \"defaultValue\": \"No Auditing\"\r\n          },\r\n          \"AuditFileShare\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit File Share\",\r\n              \"description\": \"Specifies whether to audit events related to file shares: creation, deletion, modification, and access attempts. Also, it shows failed SMB SPN checks. Event volumes can be high on DCs and File Servers.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"No Auditing\",\r\n              \"Success\",\r\n              \"Failure\",\r\n              \"Success and Failure\"\r\n            ],\r\n            \"defaultValue\": \"No Auditing\"\r\n          },\r\n          \"AuditFileSystem\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit File System\",\r\n              \"description\": \"Specifies whether audit events are generated when users attempt to access file system objects. Audit events are generated only for objects that have configured system access control lists (SACLs).\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"No Auditing\",\r\n              \"Success\",\r\n              \"Failure\",\r\n              \"Success and Failure\"\r\n            ],\r\n            \"defaultValue\": \"No Auditing\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SystemAuditPoliciesObjectAccess\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('Audit Detailed File Share;ExpectedValue', '=', parameters('AuditDetailedFileShare'), ',', 'Audit File Share;ExpectedValue', '=', parameters('AuditFileShare'), ',', 'Audit File System;ExpectedValue', '=', parameters('AuditFileSystem')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AzureBaseline_SystemAuditPoliciesObjectAccess\"\r\n                    },\r\n                    \"AuditDetailedFileShare\": {\r\n                      \"value\": \"[parameters('AuditDetailedFileShare')]\"\r\n                    },\r\n                    \"AuditFileShare\": {\r\n                      \"value\": \"[parameters('AuditFileShare')]\"\r\n                    },\r\n                    \"AuditFileSystem\": {\r\n                      \"value\": \"[parameters('AuditFileSystem')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AuditDetailedFileShare\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AuditFileShare\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AuditFileSystem\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Audit Detailed File Share;ExpectedValue\",\r\n                                \"value\": \"[parameters('AuditDetailedFileShare')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Audit File Share;ExpectedValue\",\r\n                                \"value\": \"[parameters('AuditFileShare')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Audit File System;ExpectedValue\",\r\n                                \"value\": \"[parameters('AuditFileSystem')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Audit Detailed File Share;ExpectedValue\",\r\n                                \"value\": \"[parameters('AuditDetailedFileShare')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Audit File Share;ExpectedValue\",\r\n                                \"value\": \"[parameters('AuditFileShare')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Audit File System;ExpectedValue\",\r\n                                \"value\": \"[parameters('AuditFileSystem')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8e170edb-e0f5-497a-bb36-48b3280cec6a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8e170edb-e0f5-497a-bb36-48b3280cec6a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Enable Security Center's auto provisioning of the Log Analytics agent on your subscriptions with custom workspace.\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Allow Security Center to auto provision the Log Analytics agent on your subscriptions to monitor and collect security data using a custom workspace.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          },\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Auto provision the Log Analytics agent on your subscriptions to monitor and collect security data using a custom workspace.\",\r\n              \"strongType\": \"omsWorkspace\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/autoProvisioningSettings\",\r\n              \"deploymentScope\": \"Subscription\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/autoProvisioningSettings/autoProvision\",\r\n                \"equals\": \"On\"\r\n              },\r\n              \"deployment\": {\r\n                \"location\": \"westus\",\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Security/autoProvisioningSettings\",\r\n                        \"name\": \"default\",\r\n                        \"apiVersion\": \"2017-08-01-preview\",\r\n                        \"properties\": {\r\n                          \"autoProvision\": \"On\"\r\n                        }\r\n                      },\r\n                      {\r\n                        \"type\": \"Microsoft.Security/workspaceSettings\",\r\n                        \"apiVersion\": \"2017-08-01-preview\",\r\n                        \"name\": \"default\",\r\n                        \"properties\": {\r\n                          \"workspaceId\": \"[parameters('logAnalytics')]\",\r\n                          \"scope\": \"[subscription().id]\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8e7da0a5-0a0e-4bbc-bfc0-7773c018b616\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8e7da0a5-0a0e-4bbc-bfc0-7773c018b616\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Azure SQL Server to enable private endpoint connections\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"A private endpoint connection enables private connectivity to your Azure SQL Database via a private IP address inside a virtual network. This configuration improves your security posture and supports Azure networking tools and scenarios.\",\r\n        \"metadata\": {\r\n          \"category\": \"SQL\",\r\n          \"version\": \"1.0.0\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateEndpointSubnetId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Subnet to use for Private Endpoints\",\r\n              \"description\": \"The name of the subnet within the virtual network that you would like to use for your Private Endpoint Connection deployment\",\r\n              \"strongType\": \"Microsoft.Network/virtualNetworks/subnets\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Sql/servers/privateEndpointConnections[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.Sql/servers/privateEndpointConnections[*].id\",\r\n                    \"exists\": \"false\"\r\n                  }\r\n                },\r\n                \"equals\": 0\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/privateEndpointConnections\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7\",\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/6d8ee4ec-f05a-4a1d-8b00-a9b17e38b437\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"name\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"serviceId\": {\r\n                      \"value\": \"[field('id')]\"\r\n                    },\r\n                    \"privateEndpointSubnetId\": {\r\n                      \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"name\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"serviceId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointSubnetId\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"privateEndpointName\": \"[concat('pe-',substring(parameters('name'),0,min(length(parameters('name')),50)),'-',uniquestring(deployment().name))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('privateEndpointName')]\",\r\n                        \"apiVersion\": \"2020-06-01\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"expressionEvaluationOptions\": {\r\n                            \"scope\": \"inner\"\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"name\": {\r\n                                \"type\": \"String\"\r\n                              },\r\n                              \"serviceId\": {\r\n                                \"type\": \"String\"\r\n                              },\r\n                              \"privateEndpointSubnetId\": {\r\n                                \"type\": \"String\"\r\n                              },\r\n                              \"subnetlocation\": {\r\n                                \"type\": \"String\"\r\n                              }\r\n                            },\r\n                            \"variables\": {\r\n                              \"privateEndpointName\": \"[deployment().name]\"\r\n                            },\r\n                            \"resources\": [\r\n                              {\r\n                                \"type\": \"Microsoft.Network/privateEndpoints\",\r\n                                \"apiVersion\": \"2020-07-01\",\r\n                                \"name\": \"[variables('privateEndpointName')]\",\r\n                                \"location\": \"[parameters('subnetlocation')]\",\r\n                                \"properties\": {\r\n                                  \"privateLinkServiceConnections\": [\r\n                                    {\r\n                                      \"name\": \"[parameters('name')]\",\r\n                                      \"properties\": {\r\n                                        \"privateLinkServiceId\": \"[parameters('serviceId')]\",\r\n                                        \"groupIds\": [\r\n                                          \"sqlServer\"\r\n                                        ],\r\n                                        \"privateLinkServiceConnectionState\": {\r\n                                          \"status\": \"Approved\",\r\n                                          \"description\": \"Auto-approved\",\r\n                                          \"actionsRequired\": \"None\"\r\n                                        }\r\n                                      }\r\n                                    }\r\n                                  ],\r\n                                  \"manualPrivateLinkServiceConnections\": [],\r\n                                  \"subnet\": {\r\n                                    \"id\": \"[parameters('privateEndpointSubnetId')]\"\r\n                                  },\r\n                                  \"customDnsConfigs\": []\r\n                                }\r\n                              }\r\n                            ]\r\n                          },\r\n                          \"parameters\": {\r\n                            \"name\": {\r\n                              \"value\": \"[parameters('name')]\"\r\n                            },\r\n                            \"privateEndpointSubnetId\": {\r\n                              \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                            },\r\n                            \"serviceId\": {\r\n                              \"value\": \"[parameters('serviceId')]\"\r\n                            },\r\n                            \"subnetlocation\": {\r\n                              \"value\": \"[reference(first(take(split(parameters('privateEndpointSubnetId'),'/subnets'),1)),'2020-07-01','Full').location]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8e8ca470-d980-4831-99e6-dc70d9f6af87\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8e8ca470-d980-4831-99e6-dc70d9f6af87\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs that do not store passwords using reversible encryption\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines that do not store passwords using reversible encryption. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"2.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"StorePasswordsUsingReversibleEncryption\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"StorePasswordsUsingReversibleEncryption\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8ff0b18b-262e-4512-857a-48ad0aeb9a78\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8ff0b18b-262e-4512-857a-48ad0aeb9a78\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs configurations in 'Windows Firewall Properties'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Windows Firewall Properties'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"WindowsFirewallDomainUseProfileSettings\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Domain): Use profile settings\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security uses the settings for the Domain profile to filter network traffic. If you select Off, Windows Firewall with Advanced Security will not use any of the firewall rules or connection security rules for this profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallDomainBehaviorForOutboundConnections\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Domain): Behavior for outbound connections\",\r\n              \"description\": \"Specifies the behavior for outbound connections for the Domain profile that do not match an outbound firewall rule. The default value of 0 means to allow connections, and a value of 1 means to block connections.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"WindowsFirewallDomainApplyLocalConnectionSecurityRules\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Domain): Apply local connection security rules\",\r\n              \"description\": \"Specifies whether local administrators are allowed to create connection security rules that apply together with connection security rules configured by Group Policy for the Domain profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallDomainApplyLocalFirewallRules\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Domain): Apply local firewall rules\",\r\n              \"description\": \"Specifies whether local administrators are allowed to create local firewall rules that apply together with firewall rules configured by Group Policy for the Domain profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallDomainDisplayNotifications\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Domain): Display notifications\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security displays notifications to the user when a program is blocked from receiving inbound connections, for the Domain profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallPrivateUseProfileSettings\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Private): Use profile settings\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security uses the settings for the Private profile to filter network traffic. If you select Off, Windows Firewall with Advanced Security will not use any of the firewall rules or connection security rules for this profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallPrivateBehaviorForOutboundConnections\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Private): Behavior for outbound connections\",\r\n              \"description\": \"Specifies the behavior for outbound connections for the Private profile that do not match an outbound firewall rule. The default value of 0 means to allow connections, and a value of 1 means to block connections.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"WindowsFirewallPrivateApplyLocalConnectionSecurityRules\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Private): Apply local connection security rules\",\r\n              \"description\": \"Specifies whether local administrators are allowed to create connection security rules that apply together with connection security rules configured by Group Policy for the Private profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallPrivateApplyLocalFirewallRules\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Private): Apply local firewall rules\",\r\n              \"description\": \"Specifies whether local administrators are allowed to create local firewall rules that apply together with firewall rules configured by Group Policy for the Private profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallPrivateDisplayNotifications\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Private): Display notifications\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security displays notifications to the user when a program is blocked from receiving inbound connections, for the Private profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallPublicUseProfileSettings\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Public): Use profile settings\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security uses the settings for the Public profile to filter network traffic. If you select Off, Windows Firewall with Advanced Security will not use any of the firewall rules or connection security rules for this profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallPublicBehaviorForOutboundConnections\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Public): Behavior for outbound connections\",\r\n              \"description\": \"Specifies the behavior for outbound connections for the Public profile that do not match an outbound firewall rule. The default value of 0 means to allow connections, and a value of 1 means to block connections.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"WindowsFirewallPublicApplyLocalConnectionSecurityRules\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Public): Apply local connection security rules\",\r\n              \"description\": \"Specifies whether local administrators are allowed to create connection security rules that apply together with connection security rules configured by Group Policy for the Public profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallPublicApplyLocalFirewallRules\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Public): Apply local firewall rules\",\r\n              \"description\": \"Specifies whether local administrators are allowed to create local firewall rules that apply together with firewall rules configured by Group Policy for the Public profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallPublicDisplayNotifications\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall (Public): Display notifications\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security displays notifications to the user when a program is blocked from receiving inbound connections, for the Public profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"WindowsFirewallDomainAllowUnicastResponse\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall: Domain: Allow unicast response\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security permits the local computer to receive unicast responses to its outgoing multicast or broadcast messages; for the Domain profile.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"WindowsFirewallPrivateAllowUnicastResponse\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall: Private: Allow unicast response\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security permits the local computer to receive unicast responses to its outgoing multicast or broadcast messages; for the Private profile.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"WindowsFirewallPublicAllowUnicastResponse\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Windows Firewall: Public: Allow unicast response\",\r\n              \"description\": \"Specifies whether Windows Firewall with Advanced Security permits the local computer to receive unicast responses to its outgoing multicast or broadcast messages; for the Public profile.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_WindowsFirewallProperties\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('Windows Firewall: Domain: Firewall state;ExpectedValue', '=', parameters('WindowsFirewallDomainUseProfileSettings'), ',', 'Windows Firewall: Domain: Outbound connections;ExpectedValue', '=', parameters('WindowsFirewallDomainBehaviorForOutboundConnections'), ',', 'Windows Firewall: Domain: Settings: Apply local connection security rules;ExpectedValue', '=', parameters('WindowsFirewallDomainApplyLocalConnectionSecurityRules'), ',', 'Windows Firewall: Domain: Settings: Apply local firewall rules;ExpectedValue', '=', parameters('WindowsFirewallDomainApplyLocalFirewallRules'), ',', 'Windows Firewall: Domain: Settings: Display a notification;ExpectedValue', '=', parameters('WindowsFirewallDomainDisplayNotifications'), ',', 'Windows Firewall: Private: Firewall state;ExpectedValue', '=', parameters('WindowsFirewallPrivateUseProfileSettings'), ',', 'Windows Firewall: Private: Outbound connections;ExpectedValue', '=', parameters('WindowsFirewallPrivateBehaviorForOutboundConnections'), ',', 'Windows Firewall: Private: Settings: Apply local connection security rules;ExpectedValue', '=', parameters('WindowsFirewallPrivateApplyLocalConnectionSecurityRules'), ',', 'Windows Firewall: Private: Settings: Apply local firewall rules;ExpectedValue', '=', parameters('WindowsFirewallPrivateApplyLocalFirewallRules'), ',', 'Windows Firewall: Private: Settings: Display a notification;ExpectedValue', '=', parameters('WindowsFirewallPrivateDisplayNotifications'), ',', 'Windows Firewall: Public: Firewall state;ExpectedValue', '=', parameters('WindowsFirewallPublicUseProfileSettings'), ',', 'Windows Firewall: Public: Outbound connections;ExpectedValue', '=', parameters('WindowsFirewallPublicBehaviorForOutboundConnections'), ',', 'Windows Firewall: Public: Settings: Apply local connection security rules;ExpectedValue', '=', parameters('WindowsFirewallPublicApplyLocalConnectionSecurityRules'), ',', 'Windows Firewall: Public: Settings: Apply local firewall rules;ExpectedValue', '=', parameters('WindowsFirewallPublicApplyLocalFirewallRules'), ',', 'Windows Firewall: Public: Settings: Display a notification;ExpectedValue', '=', parameters('WindowsFirewallPublicDisplayNotifications'), ',', 'Windows Firewall: Domain: Allow unicast response;ExpectedValue', '=', parameters('WindowsFirewallDomainAllowUnicastResponse'), ',', 'Windows Firewall: Private: Allow unicast response;ExpectedValue', '=', parameters('WindowsFirewallPrivateAllowUnicastResponse'), ',', 'Windows Firewall: Public: Allow unicast response;ExpectedValue', '=', parameters('WindowsFirewallPublicAllowUnicastResponse')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AzureBaseline_WindowsFirewallProperties\"\r\n                    },\r\n                    \"WindowsFirewallDomainUseProfileSettings\": {\r\n                      \"value\": \"[parameters('WindowsFirewallDomainUseProfileSettings')]\"\r\n                    },\r\n                    \"WindowsFirewallDomainBehaviorForOutboundConnections\": {\r\n                      \"value\": \"[parameters('WindowsFirewallDomainBehaviorForOutboundConnections')]\"\r\n                    },\r\n                    \"WindowsFirewallDomainApplyLocalConnectionSecurityRules\": {\r\n                      \"value\": \"[parameters('WindowsFirewallDomainApplyLocalConnectionSecurityRules')]\"\r\n                    },\r\n                    \"WindowsFirewallDomainApplyLocalFirewallRules\": {\r\n                      \"value\": \"[parameters('WindowsFirewallDomainApplyLocalFirewallRules')]\"\r\n                    },\r\n                    \"WindowsFirewallDomainDisplayNotifications\": {\r\n                      \"value\": \"[parameters('WindowsFirewallDomainDisplayNotifications')]\"\r\n                    },\r\n                    \"WindowsFirewallPrivateUseProfileSettings\": {\r\n                      \"value\": \"[parameters('WindowsFirewallPrivateUseProfileSettings')]\"\r\n                    },\r\n                    \"WindowsFirewallPrivateBehaviorForOutboundConnections\": {\r\n                      \"value\": \"[parameters('WindowsFirewallPrivateBehaviorForOutboundConnections')]\"\r\n                    },\r\n                    \"WindowsFirewallPrivateApplyLocalConnectionSecurityRules\": {\r\n                      \"value\": \"[parameters('WindowsFirewallPrivateApplyLocalConnectionSecurityRules')]\"\r\n                    },\r\n                    \"WindowsFirewallPrivateApplyLocalFirewallRules\": {\r\n                      \"value\": \"[parameters('WindowsFirewallPrivateApplyLocalFirewallRules')]\"\r\n                    },\r\n                    \"WindowsFirewallPrivateDisplayNotifications\": {\r\n                      \"value\": \"[parameters('WindowsFirewallPrivateDisplayNotifications')]\"\r\n                    },\r\n                    \"WindowsFirewallPublicUseProfileSettings\": {\r\n                      \"value\": \"[parameters('WindowsFirewallPublicUseProfileSettings')]\"\r\n                    },\r\n                    \"WindowsFirewallPublicBehaviorForOutboundConnections\": {\r\n                      \"value\": \"[parameters('WindowsFirewallPublicBehaviorForOutboundConnections')]\"\r\n                    },\r\n                    \"WindowsFirewallPublicApplyLocalConnectionSecurityRules\": {\r\n                      \"value\": \"[parameters('WindowsFirewallPublicApplyLocalConnectionSecurityRules')]\"\r\n                    },\r\n                    \"WindowsFirewallPublicApplyLocalFirewallRules\": {\r\n                      \"value\": \"[parameters('WindowsFirewallPublicApplyLocalFirewallRules')]\"\r\n                    },\r\n                    \"WindowsFirewallPublicDisplayNotifications\": {\r\n                      \"value\": \"[parameters('WindowsFirewallPublicDisplayNotifications')]\"\r\n                    },\r\n                    \"WindowsFirewallDomainAllowUnicastResponse\": {\r\n                      \"value\": \"[parameters('WindowsFirewallDomainAllowUnicastResponse')]\"\r\n                    },\r\n                    \"WindowsFirewallPrivateAllowUnicastResponse\": {\r\n                      \"value\": \"[parameters('WindowsFirewallPrivateAllowUnicastResponse')]\"\r\n                    },\r\n                    \"WindowsFirewallPublicAllowUnicastResponse\": {\r\n                      \"value\": \"[parameters('WindowsFirewallPublicAllowUnicastResponse')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallDomainUseProfileSettings\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallDomainBehaviorForOutboundConnections\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallDomainApplyLocalConnectionSecurityRules\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallDomainApplyLocalFirewallRules\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallDomainDisplayNotifications\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallPrivateUseProfileSettings\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallPrivateBehaviorForOutboundConnections\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallPrivateApplyLocalConnectionSecurityRules\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallPrivateApplyLocalFirewallRules\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallPrivateDisplayNotifications\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallPublicUseProfileSettings\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallPublicBehaviorForOutboundConnections\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallPublicApplyLocalConnectionSecurityRules\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallPublicApplyLocalFirewallRules\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallPublicDisplayNotifications\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallDomainAllowUnicastResponse\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallPrivateAllowUnicastResponse\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"WindowsFirewallPublicAllowUnicastResponse\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Windows Firewall: Domain: Firewall state;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallDomainUseProfileSettings')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Domain: Outbound connections;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallDomainBehaviorForOutboundConnections')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Domain: Settings: Apply local connection security rules;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallDomainApplyLocalConnectionSecurityRules')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Domain: Settings: Apply local firewall rules;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallDomainApplyLocalFirewallRules')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Domain: Settings: Display a notification;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallDomainDisplayNotifications')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Private: Firewall state;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPrivateUseProfileSettings')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Private: Outbound connections;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPrivateBehaviorForOutboundConnections')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Private: Settings: Apply local connection security rules;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPrivateApplyLocalConnectionSecurityRules')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Private: Settings: Apply local firewall rules;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPrivateApplyLocalFirewallRules')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Private: Settings: Display a notification;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPrivateDisplayNotifications')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Public: Firewall state;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPublicUseProfileSettings')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Public: Outbound connections;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPublicBehaviorForOutboundConnections')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Public: Settings: Apply local connection security rules;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPublicApplyLocalConnectionSecurityRules')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Public: Settings: Apply local firewall rules;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPublicApplyLocalFirewallRules')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Public: Settings: Display a notification;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPublicDisplayNotifications')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Domain: Allow unicast response;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallDomainAllowUnicastResponse')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Private: Allow unicast response;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPrivateAllowUnicastResponse')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Public: Allow unicast response;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPublicAllowUnicastResponse')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Windows Firewall: Domain: Firewall state;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallDomainUseProfileSettings')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Domain: Outbound connections;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallDomainBehaviorForOutboundConnections')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Domain: Settings: Apply local connection security rules;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallDomainApplyLocalConnectionSecurityRules')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Domain: Settings: Apply local firewall rules;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallDomainApplyLocalFirewallRules')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Domain: Settings: Display a notification;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallDomainDisplayNotifications')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Private: Firewall state;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPrivateUseProfileSettings')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Private: Outbound connections;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPrivateBehaviorForOutboundConnections')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Private: Settings: Apply local connection security rules;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPrivateApplyLocalConnectionSecurityRules')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Private: Settings: Apply local firewall rules;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPrivateApplyLocalFirewallRules')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Private: Settings: Display a notification;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPrivateDisplayNotifications')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Public: Firewall state;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPublicUseProfileSettings')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Public: Outbound connections;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPublicBehaviorForOutboundConnections')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Public: Settings: Apply local connection security rules;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPublicApplyLocalConnectionSecurityRules')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Public: Settings: Apply local firewall rules;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPublicApplyLocalFirewallRules')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Public: Settings: Display a notification;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPublicDisplayNotifications')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Domain: Allow unicast response;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallDomainAllowUnicastResponse')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Private: Allow unicast response;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPrivateAllowUnicastResponse')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Windows Firewall: Public: Allow unicast response;ExpectedValue\",\r\n                                \"value\": \"[parameters('WindowsFirewallPublicAllowUnicastResponse')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/909c958d-1b99-4c74-b88f-46a5c5bc34f9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"909c958d-1b99-4c74-b88f-46a5c5bc34f9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs that do not have the specified Windows PowerShell modules installed\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines that do not have the specified Windows PowerShell modules installed. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"Modules\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"PowerShell Modules\",\r\n              \"description\": \"A semicolon-separated list of the names of the PowerShell modules that should be installed. You may also specify a specific version of a module that should be installed by including a comma after the module name, followed by the desired version. e.g. PSDscResources; SqlServerDsc, 12.0.0.0; ComputerManagementDsc, 6.1.0.0\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsPowerShellModules\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('[PowerShellModules]PowerShellModules1;Modules', '=', parameters('Modules')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"WindowsPowerShellModules\"\r\n                    },\r\n                    \"Modules\": {\r\n                      \"value\": \"[parameters('Modules')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"Modules\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[PowerShellModules]PowerShellModules1;Modules\",\r\n                                \"value\": \"[parameters('Modules')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[PowerShellModules]PowerShellModules1;Modules\",\r\n                                \"value\": \"[parameters('Modules')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/90ba2ee7-4ca8-4673-84d1-c851c50d3baf\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"90ba2ee7-4ca8-4673-84d1-c851c50d3baf\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Event Hub namespaces with private endpoints\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoints connect your virtual network to Azure services without a public IP address at the source or destination. By mapping private endpoints to Event Hub namespaces, you can reduce data leakage risks. Learn more at: https://docs.microsoft.com/azure/event-hubs/private-link-service.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Event Hub\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateEndpointSubnetId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private endpoint subnet id\",\r\n              \"description\": \"Specifies the subnet to use to configure private endpoint\",\r\n              \"strongType\": \"Microsoft.Network/virtualNetworks/subnets\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.EventHub/namespaces\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.EventHub/namespaces/privateEndpointConnections\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.EventHub/namespaces/privateEndpointConnections/privateLinkServiceConnectionState.status\",\r\n                \"equals\": \"Approved\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7\",\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/f526a384-b230-433a-b45c-95f59c4a2dec\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"name\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"serviceId\": {\r\n                      \"value\": \"[field('id')]\"\r\n                    },\r\n                    \"privateEndpointSubnetId\": {\r\n                      \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"name\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"serviceId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointSubnetId\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"privateEndpointName\": \"[concat('pe-',substring(parameters('name'),0,min(length(parameters('name')),50)),'-',uniquestring(deployment().name))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('privateEndpointName')]\",\r\n                        \"apiVersion\": \"2020-06-01\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"expressionEvaluationOptions\": {\r\n                            \"scope\": \"inner\"\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"serviceId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"privateEndpointSubnetId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"subnetLocation\": {\r\n                                \"type\": \"string\"\r\n                              }\r\n                            },\r\n                            \"variables\": {\r\n                              \"privateEndpointName\": \"[deployment().name]\"\r\n                            },\r\n                            \"resources\": [\r\n                              {\r\n                                \"name\": \"[variables('privateEndpointName')]\",\r\n                                \"type\": \"Microsoft.Network/privateEndpoints\",\r\n                                \"apiVersion\": \"2020-07-01\",\r\n                                \"location\": \"[parameters('subnetLocation')]\",\r\n                                \"tags\": {},\r\n                                \"properties\": {\r\n                                  \"subnet\": {\r\n                                    \"id\": \"[parameters('privateEndpointSubnetId')]\"\r\n                                  },\r\n                                  \"privateLinkServiceConnections\": [\r\n                                    {\r\n                                      \"name\": \"[variables('privateEndpointName')]\",\r\n                                      \"properties\": {\r\n                                        \"privateLinkServiceId\": \"[parameters('serviceId')]\",\r\n                                        \"groupIds\": [\r\n                                          \"namespace\"\r\n                                        ],\r\n                                        \"requestMessage\": \"autoapprove\"\r\n                                      }\r\n                                    }\r\n                                  ],\r\n                                  \"manualPrivateLinkServiceConnections\": []\r\n                                }\r\n                              }\r\n                            ]\r\n                          },\r\n                          \"parameters\": {\r\n                            \"serviceId\": {\r\n                              \"value\": \"[parameters('serviceId')]\"\r\n                            },\r\n                            \"privateEndpointSubnetId\": {\r\n                              \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                            },\r\n                            \"subnetLocation\": {\r\n                              \"value\": \"[reference(first(take(split(parameters('privateEndpointSubnetId'),'/subnets'),1)),'2020-07-01','Full').location]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/91678b7c-d721-4fc5-b179-3cdf74e96b1c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"91678b7c-d721-4fc5-b179-3cdf74e96b1c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs configurations in 'Windows Components'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Windows Components'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_WindowsComponents\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/9178b430-2295-406e-bb28-f6a7a2a2f897\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9178b430-2295-406e-bb28-f6a7a2a2f897\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Resource logs in App Services should be enabled\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit enabling of resource logs on the app. This enables you to recreate activity trails for investigation purposes if a security incident occurs or your network is compromised.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"requiredRetentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Required retention (days)\",\r\n              \"description\": \"The required resource logs retention in days\"\r\n            },\r\n            \"defaultValue\": \"365\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"notContains\": \"functionapp\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*]\",\r\n                  \"where\": {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                            \"equals\": \"true\"\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                                \"equals\": \"0\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                                \"greaterOrEquals\": \"[parameters('requiredRetentionDays')]\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                            \"equals\": \"true\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                            \"equals\": \"true\"\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                                \"notEquals\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Insights/diagnosticSettings/storageAccountId\",\r\n                                \"exists\": false\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                },\r\n                \"greaterOrEquals\": 1\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/91a78b24-f231-4a8a-8da9-02c35b2b6510\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"91a78b24-f231-4a8a-8da9-02c35b2b6510\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Dependency agent on Azure Arc enabled Windows servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enable VM insights on servers and machines connected to Azure through Arc enabled servers by installing the Dependency agent virtual machine extension. VM insights uses the Dependency agent to collect network metrics and discovered data about processes running on the machine and external process dependencies. See more - https://aka.ms/vminsightsdocs.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.1\",\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.HybridCompute/machines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                \"like\": \"windows*\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.HybridCompute/machines/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/machines/extensions/type\",\r\n                    \"equals\": \"DependencyAgentWindows\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/machines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Monitoring.DependencyAgent\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/machines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"DaExtensionName\": \"DependencyAgentWindows\",\r\n                      \"DaExtensionType\": \"DependencyAgentWindows\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.HybridCompute/machines/extensions\",\r\n                        \"apiVersion\": \"2020-03-11-preview\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('DaExtensionName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.Azure.Monitoring.DependencyAgent\",\r\n                          \"type\": \"[variables('DaExtensionType')]\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {}\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled DA extension for VM', ': ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/91cb9edd-cd92-4d2f-b2f2-bdd8d065a3d4\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"91cb9edd-cd92-4d2f-b2f2-bdd8d065a3d4\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"MFA should be enabled accounts with write permissions on your subscription\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Multi-Factor Authentication (MFA) should be enabled for all subscription accounts with write privileges to prevent a breach of accounts or resources.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0\",\r\n          \"category\": \"Security Center\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/assessments\",\r\n              \"name\": \"57e98606-6b1e-6193-0e3d-fe621387c16b\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/assessments/status.code\",\r\n                \"in\": [\r\n                  \"NotApplicable\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/9297c21d-2ed6-4474-b48f-163f75654ce3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9297c21d-2ed6-4474-b48f-163f75654ce3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs that contain certificates expiring within the specified number of days\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines that contain certificates expiring within the specified number of days. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"CertificateExpiration\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/9328f27e-611e-44a7-a244-39109d7d35ab\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9328f27e-611e-44a7-a244-39109d7d35ab\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit Windows machines that do not contain the specified certificates in Trusted Root\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Requires that prerequisites are deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol. Machines are non-compliant if the machine Trusted Root certificate store (Cert:\\\\LocalMachine\\\\Root) does not contain one or more of the certificates listed by the policy parameter.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"1.0.1\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"WindowsCertificateInTrustedRoot\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"CertificateThumbprints\": \"[CertificateStore]CertificateStore1;CertificateThumbprintsToInclude\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"CertificateThumbprints\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Certificate thumbprints\",\r\n              \"description\": \"A semicolon-separated list of certificate thumbprints that should exist under the Trusted Root certificate store (Cert:\\\\LocalMachine\\\\Root). e.g. THUMBPRINT1;THUMBPRINT2;THUMBPRINT3\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WindowsCertificateInTrustedRoot\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('[CertificateStore]CertificateStore1;CertificateThumbprintsToInclude', '=', parameters('CertificateThumbprints')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/934345e1-4dfb-4c70-90d7-41990dc9608b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"934345e1-4dfb-4c70-90d7-41990dc9608b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs if the Administrators group doesn't contain all the specified members\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines in which the Administrators group does not contain all of the specified members. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"MembersToInclude\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Members to include\",\r\n              \"description\": \"A semicolon-separated list of members that should be included in the Administrators local group. Ex: Administrator; myUser1; myUser2\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AdministratorsGroupMembersToInclude\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('[LocalGroup]AdministratorsGroup;MembersToInclude', '=', parameters('MembersToInclude')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AdministratorsGroupMembersToInclude\"\r\n                    },\r\n                    \"MembersToInclude\": {\r\n                      \"value\": \"[parameters('MembersToInclude')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"MembersToInclude\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[LocalGroup]AdministratorsGroup;MembersToInclude\",\r\n                                \"value\": \"[parameters('MembersToInclude')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[LocalGroup]AdministratorsGroup;MembersToInclude\",\r\n                                \"value\": \"[parameters('MembersToInclude')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/93507a81-10a4-4af0-9ee2-34cf25a96e98\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"93507a81-10a4-4af0-9ee2-34cf25a96e98\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Allow resource creation only in European data centers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Allows resource creation in the following locations only: North Europe, West Europe\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"General\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": [\r\n                \"northeurope\",\r\n                \"westeurope\"\r\n              ]\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/94c19f19-8192-48cd-a11b-e37099d3e36b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"94c19f19-8192-48cd-a11b-e37099d3e36b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'System Audit Policies - Account Management'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'System Audit Policies - Account Management' for auditing application, security, and user group management, and other management events. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_SystemAuditPoliciesAccountManagement\",\r\n            \"version\": \"1.*\"\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SystemAuditPoliciesAccountManagement\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/94d9aca8-3757-46df-aa51-f218c5f11954\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"94d9aca8-3757-46df-aa51-f218c5f11954\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Virtual networks should be protected by Azure DDoS Protection Standard\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Protect your virtual networks against volumetric and protocol attacks with Azure DDoS Protection Standard. For more information, visit https://aka.ms/ddosprotectiondocs.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Modify\",\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Modify\"\r\n          },\r\n          \"ddosPlan\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"DDoS Protection Plan\",\r\n              \"description\": \"DDoS Protection Plan resource to be associated to the virtual networks\",\r\n              \"strongType\": \"Microsoft.Network/ddosProtectionPlans\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/virtualNetworks\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Network/virtualNetworks/enableDdosProtection\",\r\n                    \"notEquals\": true\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/virtualNetworks/ddosProtectionPlan\",\r\n                    \"equals\": \"\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"conflictEffect\": \"audit\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7\"\r\n              ],\r\n              \"operations\": [\r\n                {\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.Network/virtualNetworks/enableDdosProtection\",\r\n                  \"value\": true\r\n                },\r\n                {\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.Network/virtualNetworks/ddosProtectionPlan.id\",\r\n                  \"value\": \"[parameters('ddosPlan')]\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/94de2ad3-e0c1-4caf-ad78-5d47bbc83d3d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"94de2ad3-e0c1-4caf-ad78-5d47bbc83d3d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy - Configure diagnostic settings for Azure Key Vault to Log Analytics workspace\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploys the diagnostic settings for Azure Key Vault to stream resource logs to a Log Analytics workspace when any Key Vault which is missing this diagnostic settings is created or updated.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Key Vault\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          },\r\n          \"diagnosticsSettingNameToUse\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Setting name\",\r\n              \"description\": \"Name of the diagnostic settings.\"\r\n            },\r\n            \"defaultValue\": \"AzureKeyVaultDiagnosticsLogsToWorkspace\"\r\n          },\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Specify the Log Analytics workspace the Key Vault should be connected to.\",\r\n              \"strongType\": \"omsWorkspace\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"AuditEventEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"AuditEvent - Enabled\",\r\n              \"description\": \"Whether to stream AuditEvent logs to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          },\r\n          \"AllMetricsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"AllMetrics - Enabled\",\r\n              \"description\": \"Whether to stream AllMetrics logs to the Log Analytics workspace - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.KeyVault/vaults\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"anyof\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\r\n                        \"equals\": \"True\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                        \"equals\": \"True\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/workspaceId\",\r\n                    \"equals\": \"[parameters('logAnalytics')]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"diagnosticsSettingNameToUse\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"resourceName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AuditEventEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AllMetricsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.KeyVault/vaults/providers/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('resourceName'), '/', 'Microsoft.Insights/', parameters('diagnosticsSettingNameToUse'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"dependsOn\": [],\r\n                        \"properties\": {\r\n                          \"workspaceId\": \"[parameters('logAnalytics')]\",\r\n                          \"metrics\": [\r\n                            {\r\n                              \"category\": \"AllMetrics\",\r\n                              \"enabled\": \"[parameters('AllMetricsEnabled')]\",\r\n                              \"retentionPolicy\": {\r\n                                \"days\": 0,\r\n                                \"enabled\": false\r\n                              },\r\n                              \"timeGrain\": null\r\n                            }\r\n                          ],\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"AuditEvent\",\r\n                              \"enabled\": \"[parameters('AuditEventEnabled')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {}\r\n                  },\r\n                  \"parameters\": {\r\n                    \"diagnosticsSettingNameToUse\": {\r\n                      \"value\": \"[parameters('diagnosticsSettingNameToUse')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"resourceName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"AuditEventEnabled\": {\r\n                      \"value\": \"[parameters('AllMetricsEnabled')]\"\r\n                    },\r\n                    \"AllMetricsEnabled\": {\r\n                      \"value\": \"[parameters('AuditEventEnabled')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/951af2fa-529b-416e-ab6e-066fd85ac459\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"951af2fa-529b-416e-ab6e-066fd85ac459\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Automation accounts should disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disabling public network access improves security by ensuring that the resource isn't exposed on the public internet. You can limit exposure of your Automation account resources by creating private endpoints instead. Learn more at: https://docs.microsoft.com/azure/automation/how-to/private-link-security.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Automation\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Automation/automationAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Automation/automationAccounts/publicNetworkAccess\",\r\n                \"notEquals\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/955a914f-bf86-4f0e-acd5-e0766b0efcb6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"955a914f-bf86-4f0e-acd5-e0766b0efcb6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Authentication should be enabled on your web app\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure App Service Authentication is a feature that can prevent anonymous HTTP requests from reaching the web app, or authenticate those that have tokens before they reach the web app\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"app*\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/config/siteAuthEnabled\",\r\n                \"equals\": \"true\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/95bccee9-a7f8-4bec-9ee9-62c3473701fc\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"95bccee9-a7f8-4bec-9ee9-62c3473701fc\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Require a tag on resource groups\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Enforces existence of a tag on resource groups.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Tags\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Resources/subscriptions/resourceGroups\"\r\n              },\r\n              {\r\n                \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                \"exists\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/96670d01-0a4d-4649-9c89-2d3abc0a5025\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"96670d01-0a4d-4649-9c89-2d3abc0a5025\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Advanced data security settings for SQL server should contain an email address to receive security alerts\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Ensure that an email address is provided for the 'Send alerts to' field in the Advanced Data Security server settings. This email address receives alert notifications when anomalous activities are detected on SQL servers.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"SQL\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Disabled\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/securityAlertPolicies\",\r\n              \"name\": \"default\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Sql/servers/securityAlertPolicies/emailAddresses[*]\",\r\n                \"notEquals\": \"\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/9677b740-f641-4f3c-b9c5-466005c85278\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9677b740-f641-4f3c-b9c5-466005c85278\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"App Configuration should use a customer-managed key\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Customer-managed keys provide enhanced data protection by allowing you to manage your encryption keys. This is often required to meet compliance requirements.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.0\",\r\n          \"category\": \"App Configuration\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.AppConfiguration/configurationStores\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.AppConfiguration/configurationStores/encryption.keyVaultProperties.keyIdentifier\",\r\n                \"exists\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/967a4b4b-2da9-43c1-b7d0-f98d0d74d0b1\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"967a4b4b-2da9-43c1-b7d0-f98d0d74d0b1\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Windows machines should meet requirements for 'Administrative Templates - System'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Windows machines should have the specified Group Policy settings in the category 'Administrative Templates - System' for settings that control the administrative experience and Remote Assistance. This policy requires that the Guest Configuration prerequisites have been deployed to the policy assignment scope. For details, visit https://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"version\": \"2.0.0\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"guestConfiguration\": {\r\n            \"name\": \"AzureBaseline_AdministrativeTemplatesSystem\",\r\n            \"version\": \"1.*\",\r\n            \"configurationParameter\": {\r\n              \"AlwaysUseClassicLogon\": \"Always use classic logon;ExpectedValue\",\r\n              \"BootStartDriverInitializationPolicy\": \"Boot-Start Driver Initialization Policy;ExpectedValue\",\r\n              \"EnableWindowsNTPClient\": \"Enable Windows NTP Client;ExpectedValue\",\r\n              \"TurnOnConveniencePINSignin\": \"Turn on convenience PIN sign-in;ExpectedValue\"\r\n            }\r\n          }\r\n        },\r\n        \"parameters\": {\r\n          \"IncludeArcMachines\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Include Arc connected servers\",\r\n              \"description\": \"By selecting this option, you agree to be charged monthly per Arc connected machine.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"AlwaysUseClassicLogon\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Always use classic logon\",\r\n              \"description\": \"Specifies whether to force the user to log on to the computer using the classic logon screen. This setting only works when the computer is not on a domain.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"BootStartDriverInitializationPolicy\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Boot-Start Driver Initialization Policy\",\r\n              \"description\": \"Specifies which boot-start drivers are initialized based on a classification determined by an Early Launch Antimalware boot-start driver.\"\r\n            },\r\n            \"defaultValue\": \"3\"\r\n          },\r\n          \"EnableWindowsNTPClient\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable Windows NTP Client\",\r\n              \"description\": \"Specifies whether the Windows NTP Client is enabled. Enabling the Windows NTP Client allows your computer to synchronize its computer clock with other NTP servers.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"TurnOnConveniencePINSignin\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Turn on convenience PIN sign-in\",\r\n              \"description\": \"Specifies whether a domain user can sign in using a convenience PIN.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of this policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"value\": \"[parameters('IncludeArcMachines')]\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_AdministrativeTemplatesSystem\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                    \"equals\": \"Compliant\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                    \"equals\": \"[base64(concat('Always use classic logon;ExpectedValue', '=', parameters('AlwaysUseClassicLogon'), ',', 'Boot-Start Driver Initialization Policy;ExpectedValue', '=', parameters('BootStartDriverInitializationPolicy'), ',', 'Enable Windows NTP Client;ExpectedValue', '=', parameters('EnableWindowsNTPClient'), ',', 'Turn on convenience PIN sign-in;ExpectedValue', '=', parameters('TurnOnConveniencePINSignin')))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/968410dc-5ca0-4518-8a5b-7b55f0530ea9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"968410dc-5ca0-4518-8a5b-7b55f0530ea9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Add a tag to subscriptions\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Adds the specified tag and value to subscriptions via a remediation task. If the tag exists with a different value it will not be changed. See https://aka.ms/azurepolicyremediation for more information on policy remediation.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Tags\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            }\r\n          },\r\n          \"tagValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Value\",\r\n              \"description\": \"Value of the tag, such as 'production'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Resources/subscriptions\"\r\n              },\r\n              {\r\n                \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                \"exists\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"modify\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/4a9ae827-6dc8-4573-8ac7-8239d42aa03f\"\r\n              ],\r\n              \"operations\": [\r\n                {\r\n                  \"operation\": \"add\",\r\n                  \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                  \"value\": \"[parameters('tagValue')]\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/96d9a89c-0d67-41fc-899d-2b9599f76a24\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"96d9a89c-0d67-41fc-899d-2b9599f76a24\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"HPC Cache accounts should use customer-managed key for encryption\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Manage encryption at rest of Azure HPC Cache with customer-managed keys. By default, customer data is encrypted with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\",\r\n              \"Deny\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.StorageCache/caches\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"identity.type\",\r\n                    \"exists\": false\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.StorageCache/caches/encryptionSettings.keyEncryptionKey.keyUrl\",\r\n                    \"exists\": false\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.StorageCache/caches/encryptionSettings.keyEncryptionKey.sourceVault.Id\",\r\n                    \"exists\": false\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/970f84d8-71b6-4091-9979-ace7e3fb6dbb\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"970f84d8-71b6-4091-9979-ace7e3fb6dbb\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Secure Boot should be enabled on supported Windows virtual machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enable Secure Boot on supported Windows virtual machines to mitigate against malicious and unauthorized changes to the boot chain. Once enabled, only trusted bootloaders, kernel and kernel drivers will be allowed to run. This assessment only applies to trusted launch enabled Windows virtual machines.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"version\": \"1.0.0-preview\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.imageReference.offer\",\r\n                \"like\": \"windows*\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings\",\r\n                \"exists\": \"true\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings.secureBootEnabled\",\r\n                \"notequals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/97566dd7-78ae-4997-8b36-1c7bfe0d8121\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"97566dd7-78ae-4997-8b36-1c7bfe0d8121\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Show audit results from Windows VMs configurations in 'Administrative Templates - MSS (Legacy)'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy should only be used along with its corresponding deploy policy in an initiative. This definition allows Azure Policy to process the results of auditing Windows virtual machines with non-compliant settings in Group Policy category: 'Administrative Templates - MSS (Legacy)'. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"deprecated\": true\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_AdminstrativeTemplatesMSSLegacy\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/97646672-5efa-4622-9b54-740270ad60bf\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"97646672-5efa-4622-9b54-740270ad60bf\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs configurations in 'System Audit Policies - Policy Change'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'System Audit Policies - Policy Change'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"AuditAuthenticationPolicyChange\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit Authentication Policy Change\",\r\n              \"description\": \"Specifies whether audit events are generated when changes are made to authentication policy. This setting is useful for tracking changes in domain-level and forest-level trust and privileges that are granted to user accounts or groups.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"No Auditing\",\r\n              \"Success\",\r\n              \"Failure\",\r\n              \"Success and Failure\"\r\n            ],\r\n            \"defaultValue\": \"Success\"\r\n          },\r\n          \"AuditAuthorizationPolicyChange\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit Authorization Policy Change\",\r\n              \"description\": \"Specifies whether audit events are generated for assignment and removal of user rights in user right policies, changes in security token object permission, resource attributes changes and Central Access Policy changes for file system objects.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"No Auditing\",\r\n              \"Success\",\r\n              \"Failure\",\r\n              \"Success and Failure\"\r\n            ],\r\n            \"defaultValue\": \"No Auditing\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_SystemAuditPoliciesPolicyChange\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('Audit Authentication Policy Change;ExpectedValue', '=', parameters('AuditAuthenticationPolicyChange'), ',', 'Audit Authorization Policy Change;ExpectedValue', '=', parameters('AuditAuthorizationPolicyChange')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AzureBaseline_SystemAuditPoliciesPolicyChange\"\r\n                    },\r\n                    \"AuditAuthenticationPolicyChange\": {\r\n                      \"value\": \"[parameters('AuditAuthenticationPolicyChange')]\"\r\n                    },\r\n                    \"AuditAuthorizationPolicyChange\": {\r\n                      \"value\": \"[parameters('AuditAuthorizationPolicyChange')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AuditAuthenticationPolicyChange\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AuditAuthorizationPolicyChange\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Audit Authentication Policy Change;ExpectedValue\",\r\n                                \"value\": \"[parameters('AuditAuthenticationPolicyChange')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Audit Authorization Policy Change;ExpectedValue\",\r\n                                \"value\": \"[parameters('AuditAuthorizationPolicyChange')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Audit Authentication Policy Change;ExpectedValue\",\r\n                                \"value\": \"[parameters('AuditAuthenticationPolicyChange')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Audit Authorization Policy Change;ExpectedValue\",\r\n                                \"value\": \"[parameters('AuditAuthorizationPolicyChange')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/97b595c8-fd10-400e-8543-28e2b9138b13\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"97b595c8-fd10-400e-8543-28e2b9138b13\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Event Grid domains should use private link\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Azure Private Link lets you connect your virtual network to Azure services without a public IP address at the source or destination. The Private Link platform handles the connectivity between the consumer and services over the Azure backbone network. By mapping private endpoints to your Event Grid domain instead of the entire service, you'll also be protected against data leakage risks. Learn more at: https://aka.ms/privateendpoints.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.2\",\r\n          \"category\": \"Event Grid\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.EventGrid/domains\"\r\n              },\r\n              {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.EventGrid/domains/privateEndpointConnections[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.EventGrid/domains/privateEndpointConnections[*].privateLinkServiceConnectionState.status\",\r\n                    \"equals\": \"Approved\"\r\n                  }\r\n                },\r\n                \"less\": 1\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/9830b652-8523-49cc-b1b3-e17dce1127ca\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9830b652-8523-49cc-b1b3-e17dce1127ca\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Allow resource creation only in United States data centers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Allows resource creation in the following locations only: Central US, East US, East US2, North Central US, South Central US, West US\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"General\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": [\r\n                \"centralus\",\r\n                \"eastus\",\r\n                \"eastus2\",\r\n                \"northcentralus\",\r\n                \"southcentralus\",\r\n                \"westus\"\r\n              ]\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/983211ba-f348-4758-983b-21fa29294869\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"983211ba-f348-4758-983b-21fa29294869\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Deploy prerequisites to audit Windows VMs configurations in 'Administrative Templates - Network'\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a Guest Configuration assignment to audit Windows virtual machines with non-compliant settings in Group Policy category: 'Administrative Templates - Network'. It also creates a system-assigned managed identity and deploys the VM extension for Guest Configuration. This policy should only be used along with its corresponding audit policy in an initiative. For more information on Guest Configuration policies, please visit https://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"version\": \"1.1.0-deprecated\",\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ],\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"EnableInsecureGuestLogons\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable insecure guest logons\",\r\n              \"description\": \"Specifies whether the SMB client will allow insecure guest logons to an SMB server.\"\r\n            },\r\n            \"defaultValue\": \"0\"\r\n          },\r\n          \"AllowSimultaneousConnectionsToTheInternetOrAWindowsDomain\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allow simultaneous connections to the Internet or a Windows Domain\",\r\n              \"description\": \"Specify whether to prevent computers from connecting to both a domain based network and a non-domain based network at the same time. A value of 0 allows simultaneous connections, and a value of 1 blocks them.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          },\r\n          \"TurnOffMulticastNameResolution\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Turn off multicast name resolution\",\r\n              \"description\": \"Specifies whether LLMNR, a secondary name resolution protocol that transmits using multicast over a local subnet link on a single subnet, is enabled.\"\r\n            },\r\n            \"defaultValue\": \"1\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"in\": [\r\n                          \"esri\",\r\n                          \"incredibuild\",\r\n                          \"MicrosoftDynamicsAX\",\r\n                          \"MicrosoftSharepoint\",\r\n                          \"MicrosoftVisualStudio\",\r\n                          \"MicrosoftWindowsDesktop\",\r\n                          \"MicrosoftWindowsServerHPCPack\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftWindowsServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"notLike\": \"2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"MicrosoftSQLServer\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"notLike\": \"SQL2008*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-dsvm\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"dsvm-windows\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"microsoft-ads\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"in\": [\r\n                              \"standard-data-science-vm\",\r\n                              \"windows-data-science-vm\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"batch\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"equals\": \"rendering-windows2016\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"center-for-internet-security-inc\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"cis-windows-server-201*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"pivotal\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"bosh-windows-server*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                            \"equals\": \"cloud-infrastructure-services\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"ad*\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/osProfile.windowsConfiguration\",\r\n                                \"exists\": \"true\"\r\n                              },\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.osDisk.osType\",\r\n                                \"like\": \"Windows*\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"anyOf\": [\r\n                              {\r\n                                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                \"exists\": \"false\"\r\n                              },\r\n                              {\r\n                                \"allOf\": [\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                                    \"notLike\": \"2008*\"\r\n                                  },\r\n                                  {\r\n                                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                    \"notLike\": \"SQL2008*\"\r\n                                  }\r\n                                ]\r\n                              }\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.HybridCompute/machines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.HybridCompute/imageOffer\",\r\n                    \"like\": \"windows*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AzureBaseline_AdministrativeTemplatesNetwork\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/parameterHash\",\r\n                \"equals\": \"[base64(concat('Enable insecure guest logons;ExpectedValue', '=', parameters('EnableInsecureGuestLogons'), ',', 'Minimize the number of simultaneous connections to the Internet or a Windows Domain;ExpectedValue', '=', parameters('AllowSimultaneousConnectionsToTheInternetOrAWindowsDomain'), ',', 'Turn off multicast name resolution;ExpectedValue', '=', parameters('TurnOffMulticastNameResolution')))]\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"type\": {\r\n                      \"value\": \"[field('type')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AzureBaseline_AdministrativeTemplatesNetwork\"\r\n                    },\r\n                    \"EnableInsecureGuestLogons\": {\r\n                      \"value\": \"[parameters('EnableInsecureGuestLogons')]\"\r\n                    },\r\n                    \"AllowSimultaneousConnectionsToTheInternetOrAWindowsDomain\": {\r\n                      \"value\": \"[parameters('AllowSimultaneousConnectionsToTheInternetOrAWindowsDomain')]\"\r\n                    },\r\n                    \"TurnOffMulticastNameResolution\": {\r\n                      \"value\": \"[parameters('TurnOffMulticastNameResolution')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"type\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"EnableInsecureGuestLogons\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"AllowSimultaneousConnectionsToTheInternetOrAWindowsDomain\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"TurnOffMulticastNameResolution\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('microsoft.hybridcompute/machines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.HybridCompute/machines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Enable insecure guest logons;ExpectedValue\",\r\n                                \"value\": \"[parameters('EnableInsecureGuestLogons')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Minimize the number of simultaneous connections to the Internet or a Windows Domain;ExpectedValue\",\r\n                                \"value\": \"[parameters('AllowSimultaneousConnectionsToTheInternetOrAWindowsDomain')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Turn off multicast name resolution;ExpectedValue\",\r\n                                \"value\": \"[parameters('TurnOffMulticastNameResolution')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2018-11-20\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"Enable insecure guest logons;ExpectedValue\",\r\n                                \"value\": \"[parameters('EnableInsecureGuestLogons')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Minimize the number of simultaneous connections to the Internet or a Windows Domain;ExpectedValue\",\r\n                                \"value\": \"[parameters('AllowSimultaneousConnectionsToTheInternetOrAWindowsDomain')]\"\r\n                              },\r\n                              {\r\n                                \"name\": \"Turn off multicast name resolution;ExpectedValue\",\r\n                                \"value\": \"[parameters('TurnOffMulticastNameResolution')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"condition\": \"[equals(toLower(parameters('type')), toLower('Microsoft.Compute/virtualMachines'))]\",\r\n                        \"apiVersion\": \"2019-07-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/985285b7-b97a-419c-8d48-c88cc934c8d8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"985285b7-b97a-419c-8d48-c88cc934c8d8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Configure backup on virtual machines without a given tag to a new recovery services vault with a default policy\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enforce backup for all virtual machines by deploying a recovery services vault in the same location and resource group as the virtual machine. Doing this is useful when different application teams in your organization are allocated separate resource groups and need to manage their own backups and restores. You can optionally exclude virtual machines containing a specified tag to control the scope of assignment. See https://aka.ms/AzureVMAppCentricBackupExcludeTag.\",\r\n        \"metadata\": {\r\n          \"version\": \"3.0.0-preview\",\r\n          \"preview\": true,\r\n          \"category\": \"Backup\"\r\n        },\r\n        \"parameters\": {\r\n          \"exclusionTagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Exclusion Tag Name\",\r\n              \"description\": \"Name of the tag to use for excluding VMs from the scope of this policy. This should be used along with the Exclusion Tag Value parameter. Learn more at https://aka.ms/AppCentricVMBackupPolicy.\"\r\n            },\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"exclusionTagValue\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Exclusion Tag Values\",\r\n              \"description\": \"Value of the tag to use for excluding VMs from the scope of this policy (in case of multiple values, use a comma-separated list). This should be used along with the Exclusion Tag Name parameter. Learn more at https://aka.ms/AppCentricVMBackupPolicy.\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"deployIfNotExists\",\r\n              \"auditIfNotExists\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"deployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"[concat('tags[', parameters('exclusionTagName'), ']')]\",\r\n                  \"in\": \"[parameters('exclusionTagValue')]\"\r\n                }\r\n              },\r\n              {\r\n                \"field\": \"id\",\r\n                \"notContains\": \"/resourceGroups/databricks-rg-\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2008-R2-SP1\",\r\n                          \"2008-R2-SP1-smalldisk\",\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\",\r\n                          \"2019-Datacenter\",\r\n                          \"2019-Datacenter-Core\",\r\n                          \"2019-Datacenter-Core-smalldisk\",\r\n                          \"2019-Datacenter-Core-with-Containers\",\r\n                          \"2019-Datacenter-Core-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-smalldisk\",\r\n                          \"2019-Datacenter-with-Containers\",\r\n                          \"2019-Datacenter-with-Containers-smalldisk\",\r\n                          \"2019-Datacenter-zhcn\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerSemiAnnual\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"Datacenter-Core-1709-smalldisk\",\r\n                          \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                          \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerHPCPack\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2019\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016-BYOL\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2-BYOL\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftRServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"MLServer-WS2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftVisualStudio\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"VisualStudio\",\r\n                          \"Windows\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"windows-data-science-vm\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsDesktop\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Windows-10\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-SAP-HANA\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"SLES\",\r\n                          \"SLES-HPC\",\r\n                          \"SLES-HPC-Priority\",\r\n                          \"SLES-SAP\",\r\n                          \"SLES-SAP-BYOS\",\r\n                          \"SLES-Priority\",\r\n                          \"SLES-BYOS\",\r\n                          \"SLES-SAPCAL\",\r\n                          \"SLES-Standard\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"12*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"contains\": \"ubuntu\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"14.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"16.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"18.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"*20_04-lts\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"20_04-lts*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Oracle\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Oracle-Linux\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7.*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"CentOS\",\r\n                          \"Centos-LVM\",\r\n                          \"CentOS-SRIOV\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-centos-os\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"like\": \"7*\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.RecoveryServices/backupprotecteditems\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\",\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/5e467623-bb1f-42f4-a55d-6e525e11384b\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Name of Azure Virtual Machines\"\r\n                        }\r\n                      },\r\n                      \"vmRgName\": {\r\n                        \"type\": \"string\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Resource group containing the virtual machines.\"\r\n                        }\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Location for VM and Backup vault\"\r\n                        }\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"backupFabric\": \"Azure\",\r\n                      \"backupPolicy\": \"DefaultPolicy\",\r\n                      \"v2VmType\": \"Microsoft.Compute/virtualMachines\",\r\n                      \"v2VmContainer\": \"iaasvmcontainer;iaasvmcontainerv2;\",\r\n                      \"v2Vm\": \"vm;iaasvmcontainerv2;\",\r\n                      \"vaultName\": \"[take(concat('RSVault-', parameters('location'), '-', guid(resourceGroup().id)),50)]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[variables('vaultName')]\",\r\n                        \"type\": \"Microsoft.RecoveryServices/vaults\",\r\n                        \"apiVersion\": \"2016-06-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {},\r\n                        \"sku\": {\r\n                          \"name\": \"Standard\"\r\n                        }\r\n                      },\r\n                      {\r\n                        \"name\": \"[concat(variables('vaultName'), '/', variables('backupFabric'), '/', variables('v2VmContainer'), concat(parameters('vmRgName'),';',parameters('vmName')), '/', variables('v2Vm'), concat(parameters('vmRgName'),';',parameters('vmName')))]\",\r\n                        \"apiVersion\": \"2016-12-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"type\": \"Microsoft.RecoveryServices/vaults/backupFabrics/protectionContainers/protectedItems\",\r\n                        \"dependsOn\": [\r\n                          \"[resourceId('Microsoft.RecoveryServices/vaults/', variables('vaultName'))]\"\r\n                        ],\r\n                        \"properties\": {\r\n                          \"protectedItemType\": \"[variables('v2VmType')]\",\r\n                          \"policyId\": \"[resourceId('Microsoft.RecoveryServices/vaults/backupPolicies', variables('vaultName'),variables('backupPolicy'))]\",\r\n                          \"sourceResourceId\": \"[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', parameters('vmRgName'), '/providers/Microsoft.Compute/virtualMachines/', parameters('vmName'))]\"\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"status\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Backup enabled successfully for VM:', ' ', parameters('vmName'), 'Backup Vault: ', variables('vaultName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"vmRgName\": {\r\n                      \"value\": \"[resourceGroup().name]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/98d0b9f8-fd90-49c9-88e2-d3baf3b0dd86\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"98d0b9f8-fd90-49c9-88e2-d3baf3b0dd86\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Configure supported Windows virtual machines to automatically install the Guest Attestation extension\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Configure supported Windows virtual machines to automatically install the Guest Attestation extension to allow Azure Security Center to proactively attest and monitor the boot integrity. Boot integrity is attested via Remote Attestation.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"version\": \"1.0.0-preview\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/storageProfile.imageReference.offer\",\r\n                \"like\": \"windows*\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings\",\r\n                \"exists\": \"true\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings.vTpmEnabled\",\r\n                \"equals\": \"true\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/securityProfile.uefiSettings.secureBootEnabled\",\r\n                \"equals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Security.WindowsAttestation\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"GuestAttestation\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"in\": [\r\n                      \"Succeeded\",\r\n                      \"Provisioning succeeded\"\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"extensionName\": \"GuestAttestation\",\r\n                      \"extensionPublisher\": \"Microsoft.Azure.Security.WindowsAttestation\",\r\n                      \"extensionVersion\": \"1.0\",\r\n                      \"maaTenantName\": \"GuestAttestation\",\r\n                      \"ascReportingEndpoint\": \"https://eus2.service.attest.azure.net/\",\r\n                      \"maaEndpoint\": \"https://sharedeus2.eus2.attest.azure.net/\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"apiVersion\": \"2018-10-01\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('extensionName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('extensionPublisher')]\",\r\n                          \"type\": \"[variables('extensionName')]\",\r\n                          \"typeHandlerVersion\": \"[variables('extensionVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"AttestationConfig\": {\r\n                              \"MaaSettings\": {\r\n                                \"maaEndpoint\": \"[variables('maaEndpoint')]\",\r\n                                \"maaTenantName\": \"[variables('maaTenantName')]\"\r\n                              },\r\n                              \"AscSettings\": {\r\n                                \"ascReportingEndpoint\": \"[variables('ascReportingEndpoint')]\",\r\n                                \"ascReportingFrequency\": \"\"\r\n                              },\r\n                              \"useCustomToken\": \"false\",\r\n                              \"disableAlerts\": \"false\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/98ea2fc7-6fc6-4fd1-9d8d-6331154da071\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"98ea2fc7-6fc6-4fd1-9d8d-6331154da071\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Ensure that 'HTTP Version' is the latest, if used to run the API app\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Periodically, newer versions are released for HTTP either due to security flaws or to include additional functionality. Using the latest HTTP version for web apps to take advantage of security fixes, if any, and/or new functionalities of the newer version. Currently, this policy only applies to Linux web apps.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"*api\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"contains\": \"linux\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/config/web.http20Enabled\",\r\n                \"equals\": \"true\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/991310cd-e9f3-47bc-b7b6-f57b557d07db\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"991310cd-e9f3-47bc-b7b6-f57b557d07db\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Batch account should use customer-managed keys to encrypt data\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Use customer-managed keys to manage the encryption at rest of your Batch account's data. By default, customer data is encrypted with service-managed keys, but customer-managed keys are commonly required to meet regulatory compliance standards. Customer-managed keys enable the data to be encrypted with an Azure Key Vault key created and owned by you. You have full control and responsibility for the key lifecycle, including rotation and management. Learn more at https://aka.ms/Batch-CMK.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.1\",\r\n          \"category\": \"Batch\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The desired effect of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Batch/batchAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Batch/batchAccounts/encryption.keySource\",\r\n                \"notEquals\": \"Microsoft.KeyVault\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/99e9ccd8-3db9-4592-b0d1-14b1715a4d8a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"99e9ccd8-3db9-4592-b0d1-14b1715a4d8a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"FTPS only should be required in your API App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enable FTPS enforcement for enhanced security\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"*api\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Web/sites/config/ftpsState\",\r\n                \"in\": [\r\n                  \"FtpsOnly\",\r\n                  \"Disabled\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/9a1b8c48-453a-4044-86c3-d8bfd823e4f5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9a1b8c48-453a-4044-86c3-d8bfd823e4f5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Diagnostic Settings for Azure SQL Database to Event Hub\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploys the diagnostic settings for Azure SQL Database to stream to a regional Event Hub on any Azure SQL Database which is missing this diagnostic settings is created or updated.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.2.0\",\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"profileName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Profile name\",\r\n              \"description\": \"The diagnostic settings profile name\"\r\n            },\r\n            \"defaultValue\": \"setbypolicy\"\r\n          },\r\n          \"eventHubRuleId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Event Hub Authorization Rule Id\",\r\n              \"description\": \"The Event Hub authorization rule Id for Azure Diagnostics. The authorization rule needs to be at Event Hub namespace level. e.g. /subscriptions/{subscription Id}/resourceGroups/{resource group}/providers/Microsoft.EventHub/namespaces/{Event Hub namespace}/authorizationrules/{authorization rule}\",\r\n              \"strongType\": \"Microsoft.EventHub/Namespaces/AuthorizationRules\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"metricsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable metrics\",\r\n              \"description\": \"Whether to enable metrics stream to the Event Hub - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"False\"\r\n          },\r\n          \"logsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable logs\",\r\n              \"description\": \"Whether to enable logs stream to the Event Hub  - True or False\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"True\",\r\n              \"False\"\r\n            ],\r\n            \"defaultValue\": \"True\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers/databases\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"DeployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"name\": \"[parameters('profileName')]\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].enabled\",\r\n                    \"equals\": \"[parameters('logsEnabled')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/metrics[*].enabled\",\r\n                    \"equals\": \"[parameters('metricsEnabled')]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"fullName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"eventHubRuleId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"metricsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"profileName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Sql/servers/databases/providers/diagnosticSettings\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('fullName'), '/', 'Microsoft.Insights/', parameters('profileName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"dependsOn\": [],\r\n                        \"properties\": {\r\n                          \"eventHubAuthorizationRuleId\": \"[parameters('eventHubRuleId')]\",\r\n                          \"metrics\": [\r\n                            {\r\n                              \"category\": \"AllMetrics\",\r\n                              \"enabled\": \"[parameters('metricsEnabled')]\",\r\n                              \"retentionPolicy\": {\r\n                                \"enabled\": false,\r\n                                \"days\": 0\r\n                              }\r\n                            }\r\n                          ],\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"QueryStoreRuntimeStatistics\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"QueryStoreWaitStatistics\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"Errors\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"DatabaseWaitStatistics\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"Blocks\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"SQLInsights\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"SQLSecurityAuditEvents\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"Timeouts\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"AutomaticTuning\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"Deadlocks\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            },\r\n                            {\r\n                              \"category\": \"DevOpsOperationsAudit\",\r\n                              \"enabled\": \"[parameters('logsEnabled')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled diagnostic settings for ', parameters('fullName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"fullName\": {\r\n                      \"value\": \"[field('fullName')]\"\r\n                    },\r\n                    \"eventHubRuleId\": {\r\n                      \"value\": \"[parameters('eventHubRuleId')]\"\r\n                    },\r\n                    \"metricsEnabled\": {\r\n                      \"value\": \"[parameters('metricsEnabled')]\"\r\n                    },\r\n                    \"logsEnabled\": {\r\n                      \"value\": \"[parameters('logsEnabled')]\"\r\n                    },\r\n                    \"profileName\": {\r\n                      \"value\": \"[parameters('profileName')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/9a7c7a7d-49e5-4213-bea8-6a502b6272e0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9a7c7a7d-49e5-4213-bea8-6a502b6272e0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Virtual network injection should be enabled for Azure Data Explorer\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Secure your network perimeter with virtual network injection which allows you to enforce network security group rules, connect on-premises and secure your data connection sources with service endpoints.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Azure Data Explorer\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Deny\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Kusto/Clusters\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Kusto/clusters/virtualNetworkConfiguration\",\r\n                    \"exists\": false\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Kusto/clusters/virtualNetworkConfiguration.subnetId\",\r\n                    \"exists\": false\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Kusto/clusters/virtualNetworkConfiguration.enginePublicIpId\",\r\n                    \"exists\": false\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Kusto/clusters/virtualNetworkConfiguration.dataManagementPublicIpId\",\r\n                    \"exists\": false\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/9ad2fd1f-b25f-47a2-aa01-1a5a779e6413\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9ad2fd1f-b25f-47a2-aa01-1a5a779e6413\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Microsoft IaaSAntimalware extension should be deployed on Windows servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy audits any Windows server VM without Microsoft IaaSAntimalware extension deployed.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                \"equals\": \"MicrosoftWindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                \"equals\": \"WindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                \"in\": [\r\n                  \"2008-R2-SP1\",\r\n                  \"2008-R2-SP1-smalldisk\",\r\n                  \"2012-Datacenter\",\r\n                  \"2012-Datacenter-smalldisk\",\r\n                  \"2012-R2-Datacenter\",\r\n                  \"2012-R2-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter\",\r\n                  \"2016-Datacenter-Server-Core\",\r\n                  \"2016-Datacenter-Server-Core-smalldisk\",\r\n                  \"2016-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter-with-Containers\",\r\n                  \"2016-Datacenter-with-RDSH\",\r\n                  \"2019-Datacenter\",\r\n                  \"2019-Datacenter-Core\",\r\n                  \"2019-Datacenter-Core-smalldisk\",\r\n                  \"2019-Datacenter-Core-with-Containers\",\r\n                  \"2019-Datacenter-Core-with-Containers-smalldisk\",\r\n                  \"2019-Datacenter-smalldisk\",\r\n                  \"2019-Datacenter-with-Containers\",\r\n                  \"2019-Datacenter-with-Containers-smalldisk\"\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"IaaSAntimalware\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Security\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/9b597639-28e4-48eb-b506-56b05d366257\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9b597639-28e4-48eb-b506-56b05d366257\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure IoT Hub device provisioning service instances with private endpoints\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Private endpoints connect your virtual network to Azure services without a public IP address at the source or destination. By mapping private endpoints to IoT Hub device provisioning service, you can reduce data leakage risks. Learn more about private links at: https://aka.ms/iotdpsvnet.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0\",\r\n          \"category\": \"Internet of Things\"\r\n        },\r\n        \"parameters\": {\r\n          \"privateEndpointSubnetId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Private endpoint subnet id\",\r\n              \"description\": \"A subnet with private endpoint network policies disabled.\",\r\n              \"strongType\": \"Microsoft.Network/virtualNetworks/subnets\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"DeployIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"DeployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Devices/provisioningServices\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Devices/provisioningServices\",\r\n              \"existenceCondition\": {\r\n                \"count\": {\r\n                  \"field\": \"Microsoft.Devices/provisioningServices/privateEndpointConnections[*]\",\r\n                  \"where\": {\r\n                    \"field\": \"Microsoft.Devices/provisioningServices/privateEndpointConnections[*].privateLinkServiceConnectionState.status\",\r\n                    \"equals\": \"Approved\"\r\n                  }\r\n                },\r\n                \"greaterOrEquals\": 1\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"name\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"serviceId\": {\r\n                      \"value\": \"[field('id')]\"\r\n                    },\r\n                    \"privateEndpointSubnetId\": {\r\n                      \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"name\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"serviceId\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"privateEndpointSubnetId\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"privateEndpointName\": \"[concat('pe-',substring(parameters('name'),0,min(length(parameters('name')),50)),'-',uniquestring(deployment().name))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('privateEndpointName')]\",\r\n                        \"apiVersion\": \"2020-06-01\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"expressionEvaluationOptions\": {\r\n                            \"scope\": \"inner\"\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"serviceId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"privateEndpointSubnetId\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"subnetLocation\": {\r\n                                \"type\": \"string\"\r\n                              }\r\n                            },\r\n                            \"variables\": {\r\n                              \"privateEndpointName\": \"[deployment().name]\"\r\n                            },\r\n                            \"resources\": [\r\n                              {\r\n                                \"name\": \"[variables('privateEndpointName')]\",\r\n                                \"type\": \"Microsoft.Network/privateEndpoints\",\r\n                                \"apiVersion\": \"2020-07-01\",\r\n                                \"location\": \"[parameters('subnetLocation')]\",\r\n                                \"tags\": {},\r\n                                \"properties\": {\r\n                                  \"subnet\": {\r\n                                    \"id\": \"[parameters('privateEndpointSubnetId')]\"\r\n                                  },\r\n                                  \"privateLinkServiceConnections\": [\r\n                                    {\r\n                                      \"name\": \"[variables('privateEndpointName')]\",\r\n                                      \"properties\": {\r\n                                        \"privateLinkServiceId\": \"[parameters('serviceId')]\",\r\n                                        \"groupIds\": [\r\n                                          \"iotDps\"\r\n                                        ],\r\n                                        \"requestMessage\": \"autoapprove\"\r\n                                      }\r\n                                    }\r\n                                  ],\r\n                                  \"manualPrivateLinkServiceConnections\": []\r\n                                }\r\n                              }\r\n                            ]\r\n                          },\r\n                          \"parameters\": {\r\n                            \"serviceId\": {\r\n                              \"value\": \"[parameters('serviceId')]\"\r\n                            },\r\n                            \"privateEndpointSubnetId\": {\r\n                              \"value\": \"[parameters('privateEndpointSubnetId')]\"\r\n                            },\r\n                            \"subnetLocation\": {\r\n                              \"value\": \"[reference(first(take(split(parameters('privateEndpointSubnetId'),'/subnets'),1)),'2020-07-01','Full').location]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/9b75ea5b-c796-4c99-aaaf-21c204daac43\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9b75ea5b-c796-4c99-aaaf-21c204daac43\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Deprecated]: Audit API Applications that are not using latest supported Java Framework\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use the latest supported Java version for the latest security classes. Using older classes and types can make your application vulnerable.\",\r\n        \"metadata\": {\r\n          \"version\": \"1.0.0-deprecated\",\r\n          \"category\": \"Security Center\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyof\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"api\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"apiApp\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UseLatestJava\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"in\": [\r\n                  \"OffByPolicy\",\r\n                  \"Healthy\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/9bfe3727-0a17-471f-a2fe-eddd6b668745\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9bfe3727-0a17-471f-a2fe-eddd6b668745\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Configure Azure Cognitive Search services to disable public network access\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Disable public network access for your Azure Cognitive Search service so that it is not accessible over the public internet. This can reduce data leakage risks. Learn more at: https://aka.ms/azure-cognitive-search/inbound-private-endpoints.\",\r\n        \"metadata\": {\r\n          \"category\": \"Search\",\r\n          \"version\": \"1.0.0\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Modify\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Modify\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Search/searchServices\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Search/searchServices/publicNetworkAccess\",\r\n                \"notEquals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"conflictEffect\": \"audit\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7\",\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/7ca78c08-252a-4471-8644-bb5ff32d4ba0\"\r\n              ],\r\n              \"operations\": [\r\n                {\r\n                  \"operation\": \"addOrReplace\",\r\n                  \"field\": \"Microsoft.Search/searchServices/publicNetworkAccess\",\r\n                  \"value\": \"Disabled\"\r\n                }\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/9cee519f-d9c1-4fd9-9f79-24ec3449ed30\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9cee519f-d9c1-4fd9-9f79-24ec3449ed30\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Ensure that 'Java version' is the latest, if used as a part of the Function app\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Periodically, newer versions are released for Java software either due to security flaws or to include additional functionality. Using the latest Java version for Function apps is recommended in order to take advantage of security fixes, if any, and/or new functionalities of the latest version. Currently, this policy only applies to Linux web apps.\",\r\n        \"metadata\": {\r\n          \"version\": \"2.0.0\",\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"JavaLatestVersion\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Latest Java version\",\r\n              \"description\": \"Latest supported Java version for App Services\"\r\n            },\r\n            \"defaultValue\": \"11\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"like\": \"functionapp*\"\r\n              },\r\n              {\r\n                \"field\": \"kind\",\r\n                \"contains\": \"linux\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"web\",\r\n              \"existenceCondition\": {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/web.linuxFxVersion\",\r\n                    \"notContains\": \"JAVA\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/web.linuxFxVersion\",\r\n                    \"like\": \"[concat('*', parameters('JavaLatestVersion'))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/9d0b6ea4-93e2-4578-bf2f-6bb17d22b4bc\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9d0b6ea4-93e2-4578-bf2f-6bb17d22b4bc\"\r\n    }\r\n  ],\r\n  \"nextLink\": \"https://management.azure.com/subscriptions/f67cc918-f64f-4c3f-aa24-a855465f9d41/providers/Microsoft.Authorization/policydefinitions?$filter=PolicyType%20eq%20%27Builtin%27&api-version=2020-09-01&$skiptoken=eyJuZXh0UG9saWN5U3RvcmUiOiJDb250cm9sUGxhbmVCdWlsdEluRGVmaW5pdGlvbiIsIm5leHRQYXJ0aXRpb25LZXkiOiIxITghTXpJd056VS0iLCJuZXh0Um93S2V5IjoiMSExMDQhUmpoRFJFVkdNekZCTXpGRk5FSTBRVGt6UlRRMVJqVTNNVVU1TVRJMU5VRmZMVGxFTVVRNU56RkZPakpFTkRZM1JUb3lSRFF5TnpnNk1rUTVOak16T2pKRVF6YzBRek5FTkVaRlEwTTAifQ%3D%3D\"\r\n}",
      "StatusCode": 200
    },
    {
      "RequestUri": "/subscriptions/f67cc918-f64f-4c3f-aa24-a855465f9d41/providers/Microsoft.Authorization/policydefinitions/someName?api-version=2020-09-01",
      "EncodedRequestUri": "L3N1YnNjcmlwdGlvbnMvZjY3Y2M5MTgtZjY0Zi00YzNmLWFhMjQtYTg1NTQ2NWY5ZDQxL3Byb3ZpZGVycy9NaWNyb3NvZnQuQXV0aG9yaXphdGlvbi9wb2xpY3lkZWZpbml0aW9ucy9zb21lTmFtZT9hcGktdmVyc2lvbj0yMDIwLTA5LTAx",
      "RequestMethod": "DELETE",
      "RequestBody": "",
      "RequestHeaders": {
        "User-Agent": [
          "AzurePowershell/v5.4.0",
          "PSVersion/v6.2.4"
        ],
        "ParameterSetName": [
          "NameParameterSet"
        ],
        "CommandName": [
          "Remove-AzPolicyDefinition"
        ]
      },
      "ResponseHeaders": {
        "Cache-Control": [
          "no-cache"
        ],
        "Pragma": [
          "no-cache"
        ],
        "Strict-Transport-Security": [
          "max-age=31536000; includeSubDomains"
        ],
        "Server": [
          "Kestrel"
        ],
        "x-ms-ratelimit-remaining-subscription-deletes": [
          "14999"
        ],
        "x-ms-request-id": [
          "dbfcfb63-7aca-40d3-8235-8d862d863f37"
        ],
        "x-ms-correlation-request-id": [
          "dbfcfb63-7aca-40d3-8235-8d862d863f37"
        ],
        "x-ms-routing-request-id": [
          "WESTUS2:20210517T223656Z:dbfcfb63-7aca-40d3-8235-8d862d863f37"
        ],
        "X-Content-Type-Options": [
          "nosniff"
        ],
        "Date": [
          "Mon, 17 May 2021 22:36:55 GMT"
        ],
        "Expires": [
          "-1"
        ],
        "Retry-After": [
          "0"
        ]
      },
      "ResponseBody": "",
      "StatusCode": 204
    },
    {
      "RequestUri": "/subscriptions/f67cc918-f64f-4c3f-aa24-a855465f9d41/providers/Microsoft.Authorization/policydefinitions/someName?api-version=2020-09-01",
      "EncodedRequestUri": "L3N1YnNjcmlwdGlvbnMvZjY3Y2M5MTgtZjY0Zi00YzNmLWFhMjQtYTg1NTQ2NWY5ZDQxL3Byb3ZpZGVycy9NaWNyb3NvZnQuQXV0aG9yaXphdGlvbi9wb2xpY3lkZWZpbml0aW9ucy9zb21lTmFtZT9hcGktdmVyc2lvbj0yMDIwLTA5LTAx",
      "RequestMethod": "DELETE",
      "RequestBody": "",
      "RequestHeaders": {
        "User-Agent": [
          "AzurePowershell/v5.4.0",
          "PSVersion/v6.2.4"
        ],
        "ParameterSetName": [
          "SubscriptionIdParameterSet"
        ],
        "CommandName": [
          "Remove-AzPolicyDefinition"
        ]
      },
      "ResponseHeaders": {
        "Cache-Control": [
          "no-cache"
        ],
        "Pragma": [
          "no-cache"
        ],
        "Strict-Transport-Security": [
          "max-age=31536000; includeSubDomains"
        ],
        "Server": [
          "Kestrel"
        ],
        "x-ms-ratelimit-remaining-subscription-deletes": [
          "14999"
        ],
        "x-ms-request-id": [
          "5d7cb81d-055a-4125-8d49-7e2d2f06afc5"
        ],
        "x-ms-correlation-request-id": [
          "5d7cb81d-055a-4125-8d49-7e2d2f06afc5"
        ],
        "x-ms-routing-request-id": [
          "WESTUS2:20210517T223656Z:5d7cb81d-055a-4125-8d49-7e2d2f06afc5"
        ],
        "X-Content-Type-Options": [
          "nosniff"
        ],
        "Date": [
          "Mon, 17 May 2021 22:36:55 GMT"
        ],
        "Expires": [
          "-1"
        ],
        "Retry-After": [
          "0"
        ]
      },
      "ResponseBody": "",
      "StatusCode": 204
    },
    {
      "RequestUri": "/providers/Microsoft.Management/managementGroups/AzGovPerfTest/providers/Microsoft.Authorization/policydefinitions/someName?api-version=2020-09-01",
      "EncodedRequestUri": "L3Byb3ZpZGVycy9NaWNyb3NvZnQuTWFuYWdlbWVudC9tYW5hZ2VtZW50R3JvdXBzL0F6R292UGVyZlRlc3QvcHJvdmlkZXJzL01pY3Jvc29mdC5BdXRob3JpemF0aW9uL3BvbGljeWRlZmluaXRpb25zL3NvbWVOYW1lP2FwaS12ZXJzaW9uPTIwMjAtMDktMDE=",
      "RequestMethod": "DELETE",
      "RequestBody": "",
      "RequestHeaders": {
        "User-Agent": [
          "AzurePowershell/v5.4.0",
          "PSVersion/v6.2.4"
        ],
        "ParameterSetName": [
          "ManagementGroupNameParameterSet"
        ],
        "CommandName": [
          "Remove-AzPolicyDefinition"
        ]
      },
      "ResponseHeaders": {
        "Cache-Control": [
          "no-cache"
        ],
        "Pragma": [
          "no-cache"
        ],
        "Strict-Transport-Security": [
          "max-age=31536000; includeSubDomains"
        ],
        "Server": [
          "Kestrel"
        ],
        "x-ms-ratelimit-remaining-tenant-deletes": [
          "14999"
        ],
        "x-ms-request-id": [
          "539ca552-9692-42e4-a2ff-6c7c3381dc2c"
        ],
        "x-ms-correlation-request-id": [
          "539ca552-9692-42e4-a2ff-6c7c3381dc2c"
        ],
        "x-ms-routing-request-id": [
          "WESTUS2:20210517T223656Z:539ca552-9692-42e4-a2ff-6c7c3381dc2c"
        ],
        "X-Content-Type-Options": [
          "nosniff"
        ],
        "Date": [
          "Mon, 17 May 2021 22:36:56 GMT"
        ],
        "Expires": [
          "-1"
        ],
        "Retry-After": [
          "0"
        ]
      },
      "ResponseBody": "",
      "StatusCode": 204
    },
    {
      "RequestUri": "/subscriptions/f67cc918-f64f-4c3f-aa24-a855465f9d41/providers/Microsoft.Authorization/policyDefinitions/someName?api-version=2020-09-01",
      "EncodedRequestUri": "L3N1YnNjcmlwdGlvbnMvZjY3Y2M5MTgtZjY0Zi00YzNmLWFhMjQtYTg1NTQ2NWY5ZDQxL3Byb3ZpZGVycy9NaWNyb3NvZnQuQXV0aG9yaXphdGlvbi9wb2xpY3lEZWZpbml0aW9ucy9zb21lTmFtZT9hcGktdmVyc2lvbj0yMDIwLTA5LTAx",
      "RequestMethod": "DELETE",
      "RequestBody": "",
      "RequestHeaders": {
        "User-Agent": [
          "AzurePowershell/v5.4.0",
          "PSVersion/v6.2.4"
        ],
        "ParameterSetName": [
          "IdParameterSet"
        ],
        "CommandName": [
          "Remove-AzPolicyDefinition"
        ]
      },
      "ResponseHeaders": {
        "Cache-Control": [
          "no-cache"
        ],
        "Pragma": [
          "no-cache"
        ],
        "Strict-Transport-Security": [
          "max-age=31536000; includeSubDomains"
        ],
        "Server": [
          "Kestrel"
        ],
        "x-ms-ratelimit-remaining-subscription-deletes": [
          "14999"
        ],
        "x-ms-request-id": [
          "381b2ed2-c4b2-46f7-bc15-269b1173791b"
        ],
        "x-ms-correlation-request-id": [
          "381b2ed2-c4b2-46f7-bc15-269b1173791b"
        ],
        "x-ms-routing-request-id": [
          "WESTUS2:20210517T223656Z:381b2ed2-c4b2-46f7-bc15-269b1173791b"
        ],
        "X-Content-Type-Options": [
          "nosniff"
        ],
        "Date": [
          "Mon, 17 May 2021 22:36:56 GMT"
        ],
        "Expires": [
          "-1"
        ],
        "Retry-After": [
          "0"
        ]
      },
      "ResponseBody": "",
      "StatusCode": 204
    }
  ],
  "Names": {},
  "Variables": {
    "SubscriptionId": "f67cc918-f64f-4c3f-aa24-a855465f9d41"
  }
}