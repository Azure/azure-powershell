{
  "Entries": [
    {
      "RequestUri": "/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policydefinitions?api-version=2018-05-01",
      "EncodedRequestUri": "L3N1YnNjcmlwdGlvbnMvZDA2MTBiMjctOTY2My00YzA1LTg5ZjgtNWI0YmUwMWU4NmE1L3Byb3ZpZGVycy9NaWNyb3NvZnQuQXV0aG9yaXphdGlvbi9wb2xpY3lkZWZpbml0aW9ucz9hcGktdmVyc2lvbj0yMDE4LTA1LTAx",
      "RequestMethod": "GET",
      "RequestBody": "",
      "RequestHeaders": {
        "User-Agent": [
          "AzurePowershell/v1.0.0",
          "PSVersion/v6.1.0"
        ],
        "ParameterSetName": [
          "BuiltinFilterParameterSet"
        ],
        "CommandName": [
          "Get-AzPolicyDefinition"
        ]
      },
      "ResponseHeaders": {
        "Cache-Control": [
          "no-cache"
        ],
        "Pragma": [
          "no-cache"
        ],
        "Vary": [
          "Accept-Encoding"
        ],
        "x-ms-ratelimit-remaining-subscription-reads": [
          "11994"
        ],
        "x-ms-request-id": [
          "westus2:8a58406a-ee79-427b-a9e5-d88291ed8e31"
        ],
        "x-ms-correlation-request-id": [
          "e1ff05b3-8f14-4445-90d2-49bb8af9c621"
        ],
        "x-ms-routing-request-id": [
          "WESTUS2:20181220T213758Z:e1ff05b3-8f14-4445-90d2-49bb8af9c621"
        ],
        "Strict-Transport-Security": [
          "max-age=31536000; includeSubDomains"
        ],
        "X-Content-Type-Options": [
          "nosniff"
        ],
        "Date": [
          "Thu, 20 Dec 2018 21:37:57 GMT"
        ],
        "Content-Length": [
          "439489"
        ],
        "Content-Type": [
          "application/json; charset=utf-8"
        ],
        "Expires": [
          "-1"
        ],
        "Retry-After": [
          "0"
        ]
      },
      "ResponseBody": "{\r\n  \"value\": [\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit virtual machines without disaster recovery configured\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Audit virtual machines which do not have disaster recovery configured. To learn more about disaster recovery, visit https://aka.ms/asr-doc.\",\r\n        \"metadata\": {\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.ClassicCompute/virtualMachines\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Resources/links\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"name\",\r\n                \"like\": \"ASR-Protect-*\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0015ea4d-51ff-4ce3-8d8c-f3f8f0179a56\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0015ea4d-51ff-4ce3-8d8c-f3f8f0179a56\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Web Sockets state for a Function App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"The Web Sockets protocol is vulnerable to different types of security threats. Use of Web Sockets within an Function app must be carefully reviewed.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"DisableWebSockets\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/001802d1-4969-4c82-a700-c29c6c6f9bbd\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"001802d1-4969-4c82-a700-c29c6c6f9bbd\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy Log Analytics Agent for Linux VMs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Log Analytics Agent for Linux VMs if the VM Image (OS) is in the list defined and the agent is not installed.\",\r\n        \"metadata\": {\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\"\r\n            }\r\n          },\r\n          \"listOfImageIdToInclude\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Linux OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageId\",\r\n                    \"in\": \"[parameters('listOfImageIdToInclude')]\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-SAP-HANA\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"SLES\",\r\n                          \"SLES-HPC\",\r\n                          \"SLES-HPC-Priority\",\r\n                          \"SLES-SAP\",\r\n                          \"SLES-SAP-BYOS\",\r\n                          \"SLES-Priority\",\r\n                          \"SLES-BYOS\",\r\n                          \"SLES-SAPCAL\",\r\n                          \"SLES-Standard\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"12*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"14.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"16.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"18.04*LTS\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Oracle\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Oracle-Linux\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7.*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"CentOS\",\r\n                          \"Centos-LVM\",\r\n                          \"CentOS-SRIOV\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-centos-os\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"like\": \"7*\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"OmsAgentForLinux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"MMAExtension\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.EnterpriseCloud.Monitoring\",\r\n                      \"vmExtensionType\": \"OmsAgentForLinux\",\r\n                      \"vmExtensionTypeHandlerVersion\": \"1.7\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"typeHandlerVersion\": \"[variables('vmExtensionTypeHandlerVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"workspaceId\": \"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\",\r\n                            \"stopOnMultipleConnections\": \"true\"\r\n                          },\r\n                          \"protectedSettings\": {\r\n                            \"workspaceKey\": \"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"\r\n                          }\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for VM', ': ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/053d3325-282c-4e5c-b944-24faffd30d77\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"053d3325-282c-4e5c-b944-24faffd30d77\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit enabling of diagnostic logs in Azure Data Lake Store\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit enabling of logs and retain them up to a year. This enables you to recreate activity trails for investigation purposes when a security incident occurs or your network is compromised\",\r\n        \"metadata\": {\r\n          \"category\": \"Data Lake\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"requiredRetentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Required retention (days)\",\r\n              \"description\": \"The required diagnostic logs retention in days\"\r\n            },\r\n            \"defaultValue\": \"365\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.DataLakeStore/accounts\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                    \"equals\": \"[parameters('requiredRetentionDays')]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/057ef27e-665e-4328-8ea3-04b3122bd9fb\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"057ef27e-665e-4328-8ea3-04b3122bd9fb\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit SQL DB Level Audit Setting\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Audit DB level audit setting for SQL databases\",\r\n        \"metadata\": {\r\n          \"category\": \"SQL\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"setting\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audit Setting\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"enabled\",\r\n              \"disabled\"\r\n            ]\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers/databases\"\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"notEquals\": \"master\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"AuditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/databases/auditingSettings\",\r\n              \"name\": \"default\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/auditingSettings.state\",\r\n                    \"equals\": \"[parameters('setting')]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a12\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"06a78e20-9358-41c9-923c-fb736d382a12\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit VMs that do not use managed disks\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy audits VMs that do not use managed disks\",\r\n        \"metadata\": {\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/osDisk.uri\",\r\n                    \"exists\": \"True\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/VirtualMachineScaleSets\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/VirtualMachineScaleSets/osDisk.vhdContainers\",\r\n                        \"exists\": \"True\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/VirtualMachineScaleSets/osdisk.imageUrl\",\r\n                        \"exists\": \"True\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/06a78e20-9358-41c9-923c-fb736d382a4d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"06a78e20-9358-41c9-923c-fb736d382a4d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]:  Audit CORS resource access restrictions for a Function App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Cross origin Resource Sharing (CORS) should not allow all domains to access your Function app. Allow only required domains to interact with your Function app.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"RestrictCORSAccess\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0820b7b9-23aa-4725-a1ce-ae4558f718e5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0820b7b9-23aa-4725-a1ce-ae4558f718e5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy Log Analytics Agent for Windows VMs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Log Analytics Agent for Windows VMs if the VM Image (OS) is in the list defined and the agent is not installed.\",\r\n        \"metadata\": {\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\"\r\n            }\r\n          },\r\n          \"listOfImageIdToInclude\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Windows OS to add to scope\",\r\n              \"description\": \"Example values: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageId\",\r\n                    \"in\": \"[parameters('listOfImageIdToInclude')]\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2008-R2-SP1\",\r\n                          \"2008-R2-SP1-smalldisk\",\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerSemiAnnual\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"Datacenter-Core-1709-smalldisk\",\r\n                          \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                          \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerHPCPack\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016-BYOL\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2-BYOL\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftRServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"MLServer-WS2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftVisualStudio\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"VisualStudio\",\r\n                          \"Windows\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"windows-data-science-vm\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsDesktop\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Windows-10\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"MicrosoftMonitoringAgent\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"MMAExtension\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.EnterpriseCloud.Monitoring\",\r\n                      \"vmExtensionType\": \"MicrosoftMonitoringAgent\",\r\n                      \"vmExtensionTypeHandlerVersion\": \"1.0\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"typeHandlerVersion\": \"[variables('vmExtensionTypeHandlerVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"workspaceId\": \"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\",\r\n                            \"stopOnMultipleConnections\": \"true\"\r\n                          },\r\n                          \"protectedSettings\": {\r\n                            \"workspaceKey\": \"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"\r\n                          }\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for VM', ': ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0868462e-646c-4fe3-9ced-a733534b6a2c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0868462e-646c-4fe3-9ced-a733534b6a2c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Web Applications that are not using latest supported PHP Framework\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use the latest supported PHP version for the latest security classes. Using older classes and types can make your application vulnerable.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"WebApp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UseLatestPHP\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/08b17839-76c6-4015-90e0-33d9d54d219c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"08b17839-76c6-4015-90e0-33d9d54d219c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit minimum number of owners for subscription\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"It is recommended to designate more than one subscription owner in order to have administrator access redundancy.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"DesignateMoreThanOneOwner\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/09024ccc-0c5f-475e-9457-b7c0d9ed487b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"09024ccc-0c5f-475e-9457-b7c0d9ed487b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Monitor unencrypted VM Disks in Azure Security Center\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"VMs without an enabled disk encryption will be monitored by Azure Security Center as recommendations\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"encryption\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0961003e-5a0a-4549-abde-af6a37f2724d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0961003e-5a0a-4549-abde-af6a37f2724d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit resource location matches resource group location\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit that the resource location matches its resource group location\",\r\n        \"metadata\": {\r\n          \"category\": \"General\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"location\",\r\n            \"notIn\": [\r\n              \"[resourcegroup().location]\",\r\n              \"global\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0a914e76-4921-4c19-b460-a2d36003525a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0a914e76-4921-4c19-b460-a2d36003525a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit remote debugging state for a Function App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Remote debugging requires inbound ports to be opened on an function app.  Remote debugging should be turned off.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"DisableRemoteDebugging\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/0e60b895-3786-45da-8377-9c6b4b6ac5f9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0e60b895-3786-45da-8377-9c6b4b6ac5f9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Dependency Agent Deployment - VM Image (OS) unlisted\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Reports VMs as non-compliant if the VM Image (OS) is not in the list defined and the agent is not installed.\",\r\n        \"metadata\": {\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfImageIdToInclude_windows\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Windows OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"listOfImageIdToInclude_linux\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Linux OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"anyOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageId\",\r\n                      \"in\": \"[parameters('listOfImageIdToInclude_windows')]\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageId\",\r\n                      \"in\": \"[parameters('listOfImageIdToInclude_linux')]\"\r\n                    },\r\n                    {\r\n                      \"anyOf\": [\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"2008-R2-SP1\",\r\n                                \"2008-R2-SP1-smalldisk\",\r\n                                \"2012-Datacenter\",\r\n                                \"2012-Datacenter-smalldisk\",\r\n                                \"2012-R2-Datacenter\",\r\n                                \"2012-R2-Datacenter-smalldisk\",\r\n                                \"2016-Datacenter\",\r\n                                \"2016-Datacenter-Server-Core\",\r\n                                \"2016-Datacenter-Server-Core-smalldisk\",\r\n                                \"2016-Datacenter-smalldisk\",\r\n                                \"2016-Datacenter-with-Containers\",\r\n                                \"2016-Datacenter-with-RDSH\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServerSemiAnnual\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"Datacenter-Core-1709-smalldisk\",\r\n                                \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                                \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServerHPCPack\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftSQLServer\"\r\n                            },\r\n                            {\r\n                              \"anyOf\": [\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2016\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2016-BYOL\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2012R2\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2012R2-BYOL\"\r\n                                }\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftRServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"MLServer-WS2016\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftVisualStudio\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"in\": [\r\n                                \"VisualStudio\",\r\n                                \"Windows\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftDynamicsAX\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"Dynamics\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"microsoft-ads\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"windows-data-science-vm\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsDesktop\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"Windows-10\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"RedHat\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"RHEL\",\r\n                            \"RHEL-SAP-HANA\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"SUSE\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"SLES\",\r\n                            \"SLES-HPC\",\r\n                            \"SLES-HPC-Priority\",\r\n                            \"SLES-SAP\",\r\n                            \"SLES-SAP-BYOS\",\r\n                            \"SLES-Priority\",\r\n                            \"SLES-BYOS\",\r\n                            \"SLES-SAPCAL\",\r\n                            \"SLES-Standard\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"12-SP2\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"Canonical\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"UbuntuServer\"\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"14.04.0-LTS\",\r\n                                \"14.04.1-LTS\",\r\n                                \"14.04.5-LTS\"\r\n                              ]\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"16.04-LTS\",\r\n                                \"16.04.0-LTS\"\r\n                              ]\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"18.04-LTS\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"OpenLogic\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"Centos\",\r\n                            \"Centos-LVM\",\r\n                            \"CentOS-SRIOV\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"cloudera\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"cloudera-centos-os\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSKU\",\r\n                          \"like\": \"7*\"\r\n                        }\r\n                      ]\r\n                    }\r\n                  ]\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                \"equals\": \"Microsoft.Azure.Monitoring.DependencyAgent\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/11ac78e3-31bc-4f0c-8434-37ab963cea07\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"11ac78e3-31bc-4f0c-8434-37ab963cea07\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy VM extension to audit that an application is installed inside Windows VMs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Include this rule to deploy the VM extension for Microsoft Guest Configuration, the VM extension for Microsoft Azure Managed Service Identity, and the required content to audit that an application is installed inside Windows virtual machines. This policy should only be used along with its corresponding audit policy in an initiative/policy set. For more information on guest configuration policies, please visit http://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ]\r\n        },\r\n        \"parameters\": {\r\n          \"installedApplication\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Application name (supports wildcard)\",\r\n              \"description\": \"Application name. Example: 'Microsoft SQL Server 2014 (64-bit)' or 'Microsoft SQL Server 2014*' to match any application starting with 'Microsoft SQL Server 2014'.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                    \"equals\": \"MicrosoftSQLServer\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                    \"equals\": \"SQL2017-WS2016\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                    \"equals\": \"Enterprise\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"name\": \"WhitelistedApplication\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"WhitelistedApplication\"\r\n                    },\r\n                    \"installedApplication\": {\r\n                      \"value\": \"[parameters('installedApplication')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"installedApplication\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-06-30-preview\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[InstalledApplication]bwhitelistedapp;Name\",\r\n                                \"value\": \"[Parameters('installedApplication')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2017-03-30\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2015-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/12f7e5d0-42a7-4630-80d8-54fb7cff9bd6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"12f7e5d0-42a7-4630-80d8-54fb7cff9bd6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy VM extension to audit Windows VM minimum password age 1 day\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Include this rule to deploy the VM extensions for Microsoft Guest Configuration, Microsoft Azure Managed Service Identity, and required content to check settings inside the virtual machine. This security setting determines the period of time (in days) that a password must be used before the user can change it.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ]\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                    \"equals\": \"MicrosoftWindowsServer\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                    \"equals\": \"WindowsServer\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                    \"in\": [\r\n                      \"2012-Datacenter\",\r\n                      \"2012-Datacenter-smalldisk\",\r\n                      \"2012-R2-Datacenter\",\r\n                      \"2012-R2-Datacenter-smalldisk\",\r\n                      \"2016-Datacenter\",\r\n                      \"2016-Datacenter-Server-Core\",\r\n                      \"2016-Datacenter-Server-Core-smalldisk\",\r\n                      \"2016-Datacenter-smalldisk\",\r\n                      \"2016-Datacenter-with-Containers\",\r\n                      \"2016-Datacenter-with-RDSH\"\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"name\": \"MinimumPasswordAge\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"MinimumPasswordAge\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-06-30-preview\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2017-03-30\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2015-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/16390df4-2f73-4b42-af13-c801066763df\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"16390df4-2f73-4b42-af13-c801066763df\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit transparent data encryption status\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit transparent data encryption status for SQL databases\",\r\n        \"metadata\": {\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers/databases\"\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"notEquals\": \"master\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/databases/transparentDataEncryption\",\r\n              \"name\": \"current\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/transparentDataEncryption.status\",\r\n                    \"equals\": \"enabled\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/17k78e20-9358-41c9-923c-fb736d382a12\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"17k78e20-9358-41c9-923c-fb736d382a12\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy Dependency Agent for Windows VMs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Dependency Agent for Windows VMs if the VM Image (OS) is in the list defined and the agent is not installed.\",\r\n        \"metadata\": {\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfImageIdToInclude\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Windows OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageId\",\r\n                    \"in\": \"[parameters('listOfImageIdToInclude')]\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2008-R2-SP1\",\r\n                          \"2008-R2-SP1-smalldisk\",\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerSemiAnnual\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"Datacenter-Core-1709-smalldisk\",\r\n                          \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                          \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerHPCPack\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016-BYOL\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2-BYOL\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftRServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"MLServer-WS2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftVisualStudio\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"VisualStudio\",\r\n                          \"Windows\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"windows-data-science-vm\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsDesktop\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Windows-10\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"DependencyAgentWindows\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Monitoring.DependencyAgent\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"DependencyAgent\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.Azure.Monitoring.DependencyAgent\",\r\n                      \"vmExtensionType\": \"DependencyAgentWindows\",\r\n                      \"vmExtensionTypeHandlerVersion\": \"9.6\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"typeHandlerVersion\": \"[variables('vmExtensionTypeHandlerVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for VM', ': ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1c210e94-a481-4beb-95fa-1571b434fb04\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1c210e94-a481-4beb-95fa-1571b434fb04\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit use of classic virtual machines\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use new Azure Resource Manager v2 for your virtual machines to provide security enhancements such as: stronger access control (RBAC), better auditing, ARM-based deployment and governance, access to managed identities, access to key vault for secrets, Azure AD-based authentication and support for tags and resource groups for easier security management\",\r\n        \"metadata\": {\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.classicCompute/virtualMachines\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1d84d5fb-01f6-4d12-ba4f-4a26081d403d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1d84d5fb-01f6-4d12-ba4f-4a26081d403d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit API Applications that are not using latest supported .NET Framework\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use the latest supported .NET Framework version for the latest security classes. Using older classes and types can make your application vulnerable.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"api\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"apiApp\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UseLatestDotNet\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1de7b11d-1870-41a5-8181-507e7c663cfb\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1de7b11d-1870-41a5-8181-507e7c663cfb\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Enforce tag and its value\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"description\": \"Enforces a required tag and its value. Does not apply to resource groups.\",\r\n        \"metadata\": {\r\n          \"category\": \"General\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            }\r\n          },\r\n          \"tagValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Value\",\r\n              \"description\": \"Value of the tag, such as 'production'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n              \"equals\": \"[parameters('tagValue')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1e30110a-5ceb-460c-a204-c1c3969c6d62\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1e30110a-5ceb-460c-a204-c1c3969c6d62\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit provisioning of an Azure Active Directory administrator for SQL server\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit provisioning of an Azure Active Directory administrator for your SQL server to enable Azure AD authentication. Azure AD authentication enables simplified permission management and centralized identity management of database users and other Microsoft services\",\r\n        \"metadata\": {\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/administrators\"\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/1f314764-cb73-4fc9-b863-8eca98ac36e9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1f314764-cb73-4fc9-b863-8eca98ac36e9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Monitor unprotected web application in Azure Security Center\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Web applications without a Web Application Firewall protection will be monitored by Azure Security Center as recommendations\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Network/publicIPAddresses\",\r\n              \"Microsoft.ClassicCompute/domainNames\",\r\n              \"Microsoft.Web/hostingEnvironments\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"unprotectedWebApplication\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/201ea587-7c90-41c3-910f-c280ae01cfd6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"201ea587-7c90-41c3-910f-c280ae01cfd6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit API Apps that are not using custom domains\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use of custom domains protects a API app from common attacks such as phishing and other DNS-related attacks.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"api\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"apiApp\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UsedCustomDomains\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/224da9fe-0d38-4e79-adb3-0a6e2af942ac\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"224da9fe-0d38-4e79-adb3-0a6e2af942ac\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit enabling of only secure connections to your Redis Cache\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Audit enabling of only connections via SSL to Redis Cache. Use of secure connections ensures authentication between the server and the service and protects data in transit from network layer attacks such as man-in-the-middle, eavesdropping, and session-hijacking\",\r\n        \"metadata\": {\r\n          \"category\": \"Cache\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Cache/redis\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Cache/Redis/enableNonSslPort\",\r\n                \"equals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/22bee202-a82f-4305-9a2a-6d7f44d4dedb\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"22bee202-a82f-4305-9a2a-6d7f44d4dedb\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy VM extension to audit Windows VM passwords must be at least 14 characters\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Include this rule to deploy the VM extensions for Microsoft Guest Configuration, Microsoft Azure Managed Service Identity, and required content to check settings inside the virtual machine. This security setting determines the least number of characters that a password for a user account may contain.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ]\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                    \"equals\": \"MicrosoftWindowsServer\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                    \"equals\": \"WindowsServer\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                    \"in\": [\r\n                      \"2012-Datacenter\",\r\n                      \"2012-Datacenter-smalldisk\",\r\n                      \"2012-R2-Datacenter\",\r\n                      \"2012-R2-Datacenter-smalldisk\",\r\n                      \"2016-Datacenter\",\r\n                      \"2016-Datacenter-Server-Core\",\r\n                      \"2016-Datacenter-Server-Core-smalldisk\",\r\n                      \"2016-Datacenter-smalldisk\",\r\n                      \"2016-Datacenter-with-Containers\",\r\n                      \"2016-Datacenter-with-RDSH\"\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"name\": \"MinimumPasswordLength\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"MinimumPasswordLength\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-06-30-preview\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2017-03-30\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2015-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/23020aa6-1135-4be2-bae2-149982b06eca\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"23020aa6-1135-4be2-bae2-149982b06eca\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Windows VM maximum password age 70 days\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This security setting determines the period of time (in days) that a password can be used before the system requires the user to change it.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                \"equals\": \"MicrosoftWindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                \"equals\": \"WindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                \"in\": [\r\n                  \"2012-Datacenter\",\r\n                  \"2012-Datacenter-smalldisk\",\r\n                  \"2012-R2-Datacenter\",\r\n                  \"2012-R2-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter\",\r\n                  \"2016-Datacenter-Server-Core\",\r\n                  \"2016-Datacenter-Server-Core-smalldisk\",\r\n                  \"2016-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter-with-Containers\",\r\n                  \"2016-Datacenter-with-RDSH\"\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"MaximumPasswordAge\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/24dde96d-f0b1-425e-884f-4a1421e2dcdc\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"24dde96d-f0b1-425e-884f-4a1421e2dcdc\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit configuration of metric alert rules on Batch accounts\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit configuration of metric alert rules on Batch account to enable the required metric\",\r\n        \"metadata\": {\r\n          \"category\": \"Batch\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"metricName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Metric name\",\r\n              \"description\": \"The metric name that an alert rule must be enabled on\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Batch/batchAccounts\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/alertRules\",\r\n              \"existenceScope\": \"Subscription\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/alertRules/isEnabled\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/alertRules/condition.dataSource.metricName\",\r\n                    \"equals\": \"[parameters('metricName')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/alertRules/condition.dataSource.resourceUri\",\r\n                    \"equals\": \"[concat('/subscriptions/', subscription().subscriptionId, '/resourcegroups/', resourceGroup().name, '/providers/Microsoft.Batch/batchAccounts/', field('name'))]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/26ee67a2-f81a-4ba8-b9ce-8550bd5ee1a7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"26ee67a2-f81a-4ba8-b9ce-8550bd5ee1a7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy default Microsoft IaaSAntimalware extension for Windows Server\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy deploys a Microsoft IaaSAntimalware extension with a default configuraion when a VM is not configured with the antimalware extension.\",\r\n        \"metadata\": {\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                \"equals\": \"MicrosoftWindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                \"equals\": \"WindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                \"in\": [\r\n                  \"2008-R2-SP1\",\r\n                  \"2008-R2-SP1-smalldisk\",\r\n                  \"2012-Datacenter\",\r\n                  \"2012-Datacenter-smalldisk\",\r\n                  \"2012-R2-Datacenter\",\r\n                  \"2012-R2-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter\",\r\n                  \"2016-Datacenter-Server-Core\",\r\n                  \"2016-Datacenter-Server-Core-smalldisk\",\r\n                  \"2016-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter-with-Containers\",\r\n                  \"2016-Datacenter-with-RDSH\"\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"IaaSAntimalware\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Security\"\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ExclusionsPaths\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Semicolon delimited list of file paths or locations to exclude from scanning\"\r\n                        }\r\n                      },\r\n                      \"ExclusionsExtensions\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Semicolon delimited list of file extensions to exclude from scanning\"\r\n                        }\r\n                      },\r\n                      \"ExclusionsProcesses\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Semicolon delimited list of process names to exclude from scanning\"\r\n                        }\r\n                      },\r\n                      \"RealtimeProtectionEnabled\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"true\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Indicates whether or not real time protection is enabled (default is true)\"\r\n                        }\r\n                      },\r\n                      \"ScheduledScanSettingsIsEnabled\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"false\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Indicates whether or not custom scheduled scan settings are enabled (default is false)\"\r\n                        }\r\n                      },\r\n                      \"ScheduledScanSettingsScanType\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"Quick\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Indicates whether scheduled scan setting type is set to Quick or Full (default is Quick)\"\r\n                        }\r\n                      },\r\n                      \"ScheduledScanSettingsDay\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"7\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Day of the week for scheduled scan (1-Sunday, 2-Monday, ..., 7-Saturday)\"\r\n                        }\r\n                      },\r\n                      \"ScheduledScanSettingsTime\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"120\",\r\n                        \"metadata\": {\r\n                          \"description\": \"When to perform the scheduled scan, measured in minutes from midnight (0-1440). For example: 0 = 12AM, 60 = 1AM, 120 = 2AM.\"\r\n                        }\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('vmName'),'/IaaSAntimalware')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"apiVersion\": \"2017-12-01\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.Azure.Security\",\r\n                          \"type\": \"IaaSAntimalware\",\r\n                          \"typeHandlerVersion\": \"1.3\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"AntimalwareEnabled\": true,\r\n                            \"RealtimeProtectionEnabled\": \"[parameters('RealtimeProtectionEnabled')]\",\r\n                            \"ScheduledScanSettings\": {\r\n                              \"isEnabled\": \"[parameters('ScheduledScanSettingsIsEnabled')]\",\r\n                              \"day\": \"[parameters('ScheduledScanSettingsDay')]\",\r\n                              \"time\": \"[parameters('ScheduledScanSettingsTime')]\",\r\n                              \"scanType\": \"[parameters('ScheduledScanSettingsScanType')]\"\r\n                            },\r\n                            \"Exclusions\": {\r\n                              \"Extensions\": \"[parameters('ExclusionsExtensions')]\",\r\n                              \"Paths\": \"[parameters('ExclusionsPaths')]\",\r\n                              \"Processes\": \"[parameters('ExclusionsProcesses')]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"RealtimeProtectionEnabled\": {\r\n                      \"value\": \"true\"\r\n                    },\r\n                    \"ScheduledScanSettingsIsEnabled\": {\r\n                      \"value\": \"true\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2835b622-407b-4114-9198-6f7064cbe0dc\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2835b622-407b-4114-9198-6f7064cbe0dc\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Apply tag and its default value\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"description\": \"Applies a required tag and its default value if it is not specified by the user. Does not apply to resource groups.\",\r\n        \"metadata\": {\r\n          \"category\": \"General\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            }\r\n          },\r\n          \"tagValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Value\",\r\n              \"description\": \"Value of the tag, such as 'production'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n            \"exists\": \"false\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                \"value\": \"[parameters('tagValue')]\"\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2a0e14a6-b0a6-4fab-991a-187a4f81c498\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2a0e14a6-b0a6-4fab-991a-187a4f81c498\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Windows VM should not store passwords using reversible encryption\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This security setting determines whether the operating system stores passwords using reversible encryption.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                \"equals\": \"MicrosoftWindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                \"equals\": \"WindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                \"in\": [\r\n                  \"2012-Datacenter\",\r\n                  \"2012-Datacenter-smalldisk\",\r\n                  \"2012-R2-Datacenter\",\r\n                  \"2012-R2-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter\",\r\n                  \"2016-Datacenter-Server-Core\",\r\n                  \"2016-Datacenter-Server-Core-smalldisk\",\r\n                  \"2016-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter-with-Containers\",\r\n                  \"2016-Datacenter-with-RDSH\"\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"StorePasswordsUsingReversibleEncryption\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2d60d3b7-aa10-454c-88a8-de39d99d17c6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2d60d3b7-aa10-454c-88a8-de39d99d17c6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Linux VM allowing remote connections from accounts with no passwords\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This security setting verifies remote connections from accounts with empty passwords is disabled.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"14.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"16.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"equals\": \"16.04-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"18.04-LTS\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Suse\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"SLES\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"12-SP3\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"RHEL\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7-RAW\",\r\n                          \"7.4\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"credativ\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Debian\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"9\",\r\n                          \"8\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"CentOS\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7.5\",\r\n                          \"7.4\",\r\n                          \"7.3\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"PasswordPolicy_msid110\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2d67222d-05fd-4526-a171-2ee132ad9e83\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2d67222d-05fd-4526-a171-2ee132ad9e83\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit HTTPS only access for a Web Application\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"WebApp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"EnforceHttps\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/2fde8a98-6892-426a-83ba-050e640c0ce0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2fde8a98-6892-426a-83ba-050e640c0ce0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Log Analytics Agent Deployment - VM Image (OS) unlisted\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Reports VMs as non-compliant if the VM Image (OS) is not in the list defined and the agent is not installed.\",\r\n        \"metadata\": {\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfImageIdToInclude_windows\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Windows OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"listOfImageIdToInclude_linux\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Linux OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"anyOf\": [\r\n                    {\r\n                      \"anyOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageId\",\r\n                          \"in\": \"[parameters('listOfImageIdToInclude_windows')]\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageId\",\r\n                          \"in\": \"[parameters('listOfImageIdToInclude_linux')]\"\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"2008-R2-SP1\",\r\n                                \"2008-R2-SP1-smalldisk\",\r\n                                \"2012-Datacenter\",\r\n                                \"2012-Datacenter-smalldisk\",\r\n                                \"2012-R2-Datacenter\",\r\n                                \"2012-R2-Datacenter-smalldisk\",\r\n                                \"2016-Datacenter\",\r\n                                \"2016-Datacenter-Server-Core\",\r\n                                \"2016-Datacenter-Server-Core-smalldisk\",\r\n                                \"2016-Datacenter-smalldisk\",\r\n                                \"2016-Datacenter-with-Containers\",\r\n                                \"2016-Datacenter-with-RDSH\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServerSemiAnnual\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"Datacenter-Core-1709-smalldisk\",\r\n                                \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                                \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServerHPCPack\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftSQLServer\"\r\n                            },\r\n                            {\r\n                              \"anyOf\": [\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2016\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2016-BYOL\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2012R2\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2012R2-BYOL\"\r\n                                }\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftRServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"MLServer-WS2016\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftVisualStudio\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"in\": [\r\n                                \"VisualStudio\",\r\n                                \"Windows\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftDynamicsAX\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"Dynamics\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"microsoft-ads\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"windows-data-science-vm\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsDesktop\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"Windows-10\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"RedHat\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"RHEL\",\r\n                            \"RHEL-SAP-HANA\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"SUSE\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"SLES\",\r\n                            \"SLES-HPC\",\r\n                            \"SLES-HPC-Priority\",\r\n                            \"SLES-SAP\",\r\n                            \"SLES-SAP-BYOS\",\r\n                            \"SLES-Priority\",\r\n                            \"SLES-BYOS\",\r\n                            \"SLES-SAPCAL\",\r\n                            \"SLES-Standard\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"12*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"Canonical\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"UbuntuServer\"\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"14.04*LTS\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"16.04*LTS\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"18.04*LTS\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"Oracle\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"Oracle-Linux\"\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7.*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"OpenLogic\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"CentOS\",\r\n                            \"Centos-LVM\",\r\n                            \"CentOS-SRIOV\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"cloudera\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"cloudera-centos-os\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSKU\",\r\n                          \"like\": \"7*\"\r\n                        }\r\n                      ]\r\n                    }\r\n                  ]\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/32133ab0-ee4b-4b44-98d6-042180979d50\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"32133ab0-ee4b-4b44-98d6-042180979d50\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy VM extension to audit Linux VM accounts with no passwords\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Include this rule to deploy the VM extensions for Microsoft Guest Configuration, Microsoft Azure Managed Service Identity, and required content to check settings inside the virtual machine. For Linux servers this includes Chef Inspec, Ruby, and Python. This security setting verifies there are no accounts without passwords.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ]\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"14.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"16.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"equals\": \"16.04-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"18.04-LTS\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Suse\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"SLES\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"12-SP3\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"RHEL\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7-RAW\",\r\n                          \"7.4\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"credativ\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Debian\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"9\",\r\n                          \"8\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"CentOS\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7.5\",\r\n                          \"7.4\",\r\n                          \"7.3\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"name\": \"PasswordPolicy_msid232\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"PasswordPolicy_msid232\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-06-30-preview\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2017-03-30\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2015-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforLinux')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforLinux\",\r\n                          \"typeHandlerVersion\": \"1.0\",\r\n                          \"autoUpgradeMinorVersion\": true\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3470477a-b35a-49db-aca5-1073d04524fe\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3470477a-b35a-49db-aca5-1073d04524fe\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit unrestricted network access to storage accounts\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit unrestricted network access in your storage account firewall settings. Instead, configure network rules so only applications from allowed networks can access the storage account. To allow connections from specific internet or on-premise clients, access can be granted to traffic from specific Azure virtual networks or to public internet IP address ranges\",\r\n        \"metadata\": {\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Storage/storageAccounts/networkAcls.defaultAction\",\r\n                \"equals\": \"Allow\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/34c877ad-507e-4c82-993e-3452a6e0ad3c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"34c877ad-507e-4c82-993e-3452a6e0ad3c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit enabling of diagnostic logs in Logic Apps\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit enabling of logs and retain them up to a year. This enables you to recreate activity trails for investigation purposes when a security incident occurs or your network is compromised\",\r\n        \"metadata\": {\r\n          \"category\": \"Logic Apps\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"requiredRetentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Required retention (days)\",\r\n              \"description\": \"The required diagnostic logs retention in days\"\r\n            },\r\n            \"defaultValue\": \"365\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Logic/workflows\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                    \"equals\": \"[parameters('requiredRetentionDays')]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/34f95f76-5386-4de7-b824-0d8478470c9d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"34f95f76-5386-4de7-b824-0d8478470c9d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy VM extension to audit Windows VM maximum password age 70 days\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Include this rule to deploy the VM extensions for Microsoft Guest Configuration, Microsoft Azure Managed Service Identity, and required content to check settings inside the virtual machine. This security setting determines the period of time (in days) that a password can be used before the system requires the user to change it.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ]\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                    \"equals\": \"MicrosoftWindowsServer\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                    \"equals\": \"WindowsServer\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                    \"in\": [\r\n                      \"2012-Datacenter\",\r\n                      \"2012-Datacenter-smalldisk\",\r\n                      \"2012-R2-Datacenter\",\r\n                      \"2012-R2-Datacenter-smalldisk\",\r\n                      \"2016-Datacenter\",\r\n                      \"2016-Datacenter-Server-Core\",\r\n                      \"2016-Datacenter-Server-Core-smalldisk\",\r\n                      \"2016-Datacenter-smalldisk\",\r\n                      \"2016-Datacenter-with-Containers\",\r\n                      \"2016-Datacenter-with-RDSH\"\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"name\": \"MaximumPasswordAge\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"MaximumPasswordAge\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-06-30-preview\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2017-03-30\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2015-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/356a906e-05e5-4625-8729-90771e0ee934\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"356a906e-05e5-4625-8729-90771e0ee934\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]:  Audit CORS resource access restrictions for an API App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Cross origin Resource Sharing (CORS) should not allow all domains to access your API app. Allow only required domains to interact with your API app.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"api\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"apiApp\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"RestrictCORSAccess\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/358c20a6-3f9e-4f0e-97ff-c6ce485e2aac\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"358c20a6-3f9e-4f0e-97ff-c6ce485e2aac\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit enablement of encryption of Automation account variables\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"It is important to enable encryption of Automation account variable assets when storing sensitive data\",\r\n        \"metadata\": {\r\n          \"category\": \"Automation\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Automation/automationAccounts/variables\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Automation/automationAccounts/variables/isEncrypted\",\r\n                \"notEquals\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3657f5a0-770e-44a3-b44e-9431ba1e9735\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3657f5a0-770e-44a3-b44e-9431ba1e9735\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Threat Detection on SQL servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy ensures that Threat Detection is enabled on SQL Servers.\",\r\n        \"metadata\": {\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"DeployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/securityAlertPolicies\",\r\n              \"name\": \"Default\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Sql/securityAlertPolicies.state\",\r\n                \"equals\": \"Enabled\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/056cd41c-7e88-42e1-933e-88ba6a50c9c3\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"serverName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('serverName'), '/Default')]\",\r\n                        \"type\": \"Microsoft.Sql/servers/securityAlertPolicies\",\r\n                        \"apiVersion\": \"2017-03-01-preview\",\r\n                        \"properties\": {\r\n                          \"state\": \"Enabled\",\r\n                          \"emailAccountAdmins\": true\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"serverName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/36d49e87-48c4-4f2e-beed-ba4ed02b71f5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"36d49e87-48c4-4f2e-beed-ba4ed02b71f5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit use of classic storage accounts\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use new Azure Resource Manager v2 for your storage accounts to provide security enhancements such as: stronger access control (RBAC), better auditing, Azure Resource Manager based deployment and governance, access to managed identities, access to key vault for secrets, Azure AD-based authentication and support for tags and resource groups for easier security management\",\r\n        \"metadata\": {\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.classicStorage/storageAccounts\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/37e0d2fe-28a5-43d6-a273-67d37d1f5606\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"37e0d2fe-28a5-43d6-a273-67d37d1f5606\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy Dependency Agent for Windows VM Scale Sets (VMSS)\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Dependency Agent for Windows VM Scale Sets if the VM Image (OS) is in the list defined and the agent is not installed. Note: if your scale set upgradePolicy is set to Manual, you need to apply the extension to the all VMs in the set by calling upgrade on them. In CLI this would be az vmss update-instances.\",\r\n        \"metadata\": {\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfImageIdToInclude\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Windows OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageId\",\r\n                    \"in\": \"[parameters('listOfImageIdToInclude')]\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2008-R2-SP1\",\r\n                          \"2008-R2-SP1-smalldisk\",\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerSemiAnnual\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"Datacenter-Core-1709-smalldisk\",\r\n                          \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                          \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerHPCPack\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016-BYOL\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2-BYOL\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftRServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"MLServer-WS2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftVisualStudio\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"VisualStudio\",\r\n                          \"Windows\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"windows-data-science-vm\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsDesktop\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Windows-10\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\r\n                    \"equals\": \"DependencyAgentWindows\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Monitoring.DependencyAgent\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"DependencyAgent\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.Azure.Monitoring.DependencyAgent\",\r\n                      \"vmExtensionType\": \"DependencyAgentWindows\",\r\n                      \"vmExtensionTypeHandlerVersion\": \"9.7\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"typeHandlerVersion\": \"[variables('vmExtensionTypeHandlerVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for: ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3be22e3b-d919-47aa-805e-8985dbeb0ad9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3be22e3b-d919-47aa-805e-8985dbeb0ad9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy Log Analytics Agent for Windows VM Scale Sets (VMSS)\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Log Analytics Agent for Windows VM Scale Sets if the VM Image (OS) is in the list defined and the agent is not installed. Note: if your scale set upgradePolicy is set to Manual, you need to apply the extension to the all VMs in the set by calling upgrade on them. In CLI this would be az vmss update-instances.\",\r\n        \"metadata\": {\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\"\r\n            }\r\n          },\r\n          \"listOfImageIdToInclude\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Windows OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageId\",\r\n                    \"in\": \"[parameters('listOfImageIdToInclude')]\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2008-R2-SP1\",\r\n                          \"2008-R2-SP1-smalldisk\",\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerSemiAnnual\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"Datacenter-Core-1709-smalldisk\",\r\n                          \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                          \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerHPCPack\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016-BYOL\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2-BYOL\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftRServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"MLServer-WS2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftVisualStudio\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"VisualStudio\",\r\n                          \"Windows\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"windows-data-science-vm\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsDesktop\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Windows-10\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\r\n                    \"equals\": \"MicrosoftMonitoringAgent\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"MMAExtension\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.EnterpriseCloud.Monitoring\",\r\n                      \"vmExtensionType\": \"MicrosoftMonitoringAgent\",\r\n                      \"vmExtensionTypeHandlerVersion\": \"1.0\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"typeHandlerVersion\": \"[variables('vmExtensionTypeHandlerVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"workspaceId\": \"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\",\r\n                            \"stopOnMultipleConnections\": \"true\"\r\n                          },\r\n                          \"protectedSettings\": {\r\n                            \"workspaceKey\": \"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"\r\n                          }\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for: ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3c1b3629-c8f8-4bf6-862c-037cb9094038\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3c1b3629-c8f8-4bf6-862c-037cb9094038\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy default Log Analytics Agent for Ubuntu VMs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy deploys the Log Analytics Agent on Ubuntu VMs, and connects to the selected Log Analytics workspace\",\r\n        \"metadata\": {\r\n          \"category\": \"Compute\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                \"equals\": \"Canonical\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                \"equals\": \"UbuntuServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                \"in\": [\r\n                  \"18.04-LTS\",\r\n                  \"16.04-LTS\",\r\n                  \"16.04.0-LTS\",\r\n                  \"14.04.2-LTS\",\r\n                  \"12.04.5-LTS\"\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"OmsAgentForLinux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('vmName'),'/omsPolicy')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"apiVersion\": \"2017-12-01\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.EnterpriseCloud.Monitoring\",\r\n                          \"type\": \"OmsAgentForLinux\",\r\n                          \"typeHandlerVersion\": \"1.4\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"workspaceId\": \"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\"\r\n                          },\r\n                          \"protectedSettings\": {\r\n                            \"workspaceKey\": \"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"\r\n                          }\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled monitoring for Linux VM', ': ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3d8640fc-63f6-4734-8dcb-cfd3d8c78f38\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3d8640fc-63f6-4734-8dcb-cfd3d8c78f38\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit API Applications that are not using latest supported PHP Framework\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use the latest supported PHP version for the latest security classes. Using older classes and types can make your application vulnerable.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"api\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"apiApp\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UseLatestPHP\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/3fe37002-5d00-4b37-a301-da09e3a0ca66\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3fe37002-5d00-4b37-a301-da09e3a0ca66\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit secure transfer to storage accounts\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit requirment of Secure transfer in your storage account. Secure transfer is an option that forces your storage account to accept requests only from secure connections (HTTPS). Use of HTTPS ensures authentication between the server and the service and protects data in transit from network layer attacks such as man-in-the-middle, eavesdropping, and session-hijacking\",\r\n        \"metadata\": {\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Storage/storageAccounts/supportsHttpsTrafficOnly\",\r\n                  \"equals\": \"True\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/404c3081-a854-4457-ae30-26a93ef643f9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"404c3081-a854-4457-ae30-26a93ef643f9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit enabling of diagnostic logs in Batch accounts\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit enabling of logs and retain them up to a year. This enables you to recreate activity trails for investigation purposes when a security incident occurs or your network is compromised\",\r\n        \"metadata\": {\r\n          \"category\": \"Batch\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"requiredRetentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Required retention (days)\",\r\n              \"description\": \"The required diagnostic logs retention in days\"\r\n            },\r\n            \"defaultValue\": \"365\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Batch/batchAccounts\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                    \"equals\": \"[parameters('requiredRetentionDays')]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/428256e6-1fac-4f48-a757-df34c2b3336d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"428256e6-1fac-4f48-a757-df34c2b3336d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Monitor permissive network access in Azure Security Center\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Network Security Groups with too permissive rules will be monitored by Azure Security Center as recommendations\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.ClassicCompute/virtualMachines\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"permissiveNetworkAccess\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/44452482-524f-4bf4-b852-0bff7cc4a3ed\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"44452482-524f-4bf4-b852-0bff7cc4a3ed\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Require SQL Server version 12.0\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"description\": \"This policy ensures all SQL servers use version 12.0\",\r\n        \"metadata\": {\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Sql/servers/version\",\r\n                  \"equals\": \"12.0\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/464dbb85-3d5f-4a1d-bb09-95a9b5dd19cf\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"464dbb85-3d5f-4a1d-bb09-95a9b5dd19cf\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Web Applications that are not using latest supported Python Framework\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use the latest supported Python version for the latest security classes. Using older classes and types can make your application vulnerable.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"WebApp\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UseLatestPython\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/46544d7b-1f0d-46f5-81da-5c1351de1b06\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"46544d7b-1f0d-46f5-81da-5c1351de1b06\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Enforce automatic OS upgrade with app health checks on VMSS\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy enforces usage of automatic OS upgrade with application health checks through health probes, which enables safer rollout by evaluating application health after each OS upgrade batch.\",\r\n        \"metadata\": {\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Compute/VirtualMachineScaleSets/upgradePolicy.automaticOSUpgrade\",\r\n                      \"equals\": \"True\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/VirtualMachineScaleSets/networkProfile.healthProbe.id\",\r\n                    \"exists\": \"False\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/465f0161-0087-490a-9ad9-ad6217f4f43a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"465f0161-0087-490a-9ad9-ad6217f4f43a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Monitor possible app Whitelisting in Azure Security Center\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Possible Application Whitelist configuration will be monitored by Azure Security Center\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.ClassicCompute/virtualMachines\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"applicationWhitelisting\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/47a6b606-51aa-4496-8bb7-64b11cf66adc\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"47a6b606-51aa-4496-8bb7-64b11cf66adc\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit IP restrictions configuration for an API App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"IP Restrictions allow you to define a list of IP addresses that are allowed to access your app. Use of IP Restrictions protects an API app from common attacks.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"api\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"apiApp\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"ConfigureIPRestrictions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/48893b84-a2c8-4d9a-badf-835d5d1b7d53\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"48893b84-a2c8-4d9a-badf-835d5d1b7d53\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Apply tag and its default value to resource groups\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Applies a required tag and its default value to resource groups if it is not specified by the user.\",\r\n        \"metadata\": {\r\n          \"category\": \"General\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            }\r\n          },\r\n          \"tagValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Value\",\r\n              \"description\": \"Value of the tag, such as 'production'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                \"exists\": \"false\"\r\n              },\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Resources/subscriptions/resourceGroups\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                \"value\": \"[parameters('tagValue')]\"\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/49c88fc8-6fd1-46fd-a676-f12d1d3a4c71\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"49c88fc8-6fd1-46fd-a676-f12d1d3a4c71\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy VM extension to audit that an application is installed inside Linux VMs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Include this rule to deploy the VM extension for Microsoft Guest Configuration, the VM extension for Microsoft Azure Managed Service Identity, and the content required to audit that an application is installed inside Linux virtual machines. This policy should only be used along with its corresponding audit policy in an initiative/policy set. For more information on guest configuration policies, please visit http://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ]\r\n        },\r\n        \"parameters\": {\r\n          \"ApplicationName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Application name\",\r\n              \"description\": \"Application name. Example: 'python' or 'powershell'.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"14.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"16.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"equals\": \"16.04-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"18.04-LTS\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Suse\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"SLES\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"12-SP3\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"RHEL\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7-RAW\",\r\n                          \"7.4\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"credativ\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Debian\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"9\",\r\n                          \"8\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"CentOS\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7.5\",\r\n                          \"7.4\",\r\n                          \"7.3\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"name\": \"installed_application_linux\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"installed_application_linux\"\r\n                    },\r\n                    \"ApplicationName\": {\r\n                      \"value\": \"[parameters('ApplicationName')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ApplicationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-06-30-preview\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[ChefInSpec]InstalledApplicationLinuxResource1;AttributesYmlContent\",\r\n                                \"value\": \"[concat('packages: [', parameters('ApplicationName'), ']')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2017-03-30\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2015-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforLinux')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforLinux\",\r\n                          \"typeHandlerVersion\": \"1.0\",\r\n                          \"autoUpgradeMinorVersion\": true\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4d1c04de-2172-403f-901b-90608c35c721\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4d1c04de-2172-403f-901b-90608c35c721\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy Dependency Agent for Linux VMs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Dependency Agent for Linux VMs if the VM Image (OS) is in the list defined and the agent is not installed.\",\r\n        \"metadata\": {\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfImageIdToInclude\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Linux OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageId\",\r\n                    \"in\": \"[parameters('listOfImageIdToInclude')]\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"14.04.0-LTS\",\r\n                              \"14.04.1-LTS\",\r\n                              \"14.04.5-LTS\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"16.04-LTS\",\r\n                              \"16.04.0-LTS\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"18.04-LTS\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-SAP-HANA\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"SLES\",\r\n                          \"SLES-HPC\",\r\n                          \"SLES-HPC-Priority\",\r\n                          \"SLES-SAP\",\r\n                          \"SLES-SAP-BYOS\",\r\n                          \"SLES-Priority\",\r\n                          \"SLES-BYOS\",\r\n                          \"SLES-SAPCAL\",\r\n                          \"SLES-Standard\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"12-SP2\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"CentOS\",\r\n                          \"Centos-LVM\",\r\n                          \"CentOS-SRIOV\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-centos-os\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"like\": \"7*\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"DependencyAgentLinux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Monitoring.DependencyAgent\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"DependencyAgent\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.Azure.Monitoring.DependencyAgent\",\r\n                      \"vmExtensionType\": \"DependencyAgentLinux\",\r\n                      \"vmExtensionTypeHandlerVersion\": \"9.6\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"typeHandlerVersion\": \"[variables('vmExtensionTypeHandlerVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for VM', ': ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4da21710-ce6f-4e06-8cdb-5cc4c93ffbee\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4da21710-ce6f-4e06-8cdb-5cc4c93ffbee\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit maximum number of owners for a subscription\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"It is recommended to designate up to 3 subscription owners in order to reduce the potential for breach by a compromised owner.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"DesignateLessThanXOwners\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/4f11b553-d42e-4e3a-89be-32ca364cad4c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4f11b553-d42e-4e3a-89be-32ca364cad4c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit CORS resource access restrictions for a Web Application\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Cross origin Resource Sharing (CORS) should not allow all domains to access your web application. Allow only required domains to interact with your web app.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"WebApp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"RestrictCORSAccess\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5744710e-cc2f-4ee8-8809-3b11e89f4bc9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5744710e-cc2f-4ee8-8809-3b11e89f4bc9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Windows VM minimum password age 1 day\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This security setting determines the period of time (in days) that a password must be used before the user can change it.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                \"equals\": \"MicrosoftWindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                \"equals\": \"WindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                \"in\": [\r\n                  \"2012-Datacenter\",\r\n                  \"2012-Datacenter-smalldisk\",\r\n                  \"2012-R2-Datacenter\",\r\n                  \"2012-R2-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter\",\r\n                  \"2016-Datacenter-Server-Core\",\r\n                  \"2016-Datacenter-Server-Core-smalldisk\",\r\n                  \"2016-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter-with-Containers\",\r\n                  \"2016-Datacenter-with-RDSH\"\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"MinimumPasswordAge\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5aa11bbc-5c76-4302-80e5-aba46a4282e7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5aa11bbc-5c76-4302-80e5-aba46a4282e7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Windows VM passwords must be at least 14 characters\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This security setting determines the least number of characters that a password for a user account may contain.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                \"equals\": \"MicrosoftWindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                \"equals\": \"WindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                \"in\": [\r\n                  \"2012-Datacenter\",\r\n                  \"2012-Datacenter-smalldisk\",\r\n                  \"2012-R2-Datacenter\",\r\n                  \"2012-R2-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter\",\r\n                  \"2016-Datacenter-Server-Core\",\r\n                  \"2016-Datacenter-Server-Core-smalldisk\",\r\n                  \"2016-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter-with-Containers\",\r\n                  \"2016-Datacenter-with-RDSH\"\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"MinimumPasswordLength\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5aebc8d1-020d-4037-89a0-02043a7524ec\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5aebc8d1-020d-4037-89a0-02043a7524ec\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit that an application is not installed inside Linux VMs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy will audit that the specified application is not installed inside Linux virtual machines. This policy should only be used along with its corresponding deploy policy in an initiative/policy set. For more information on guest configuration policies, please visit http://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"14.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"16.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"equals\": \"16.04-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"18.04-LTS\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Suse\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"SLES\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"12-SP3\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"RHEL\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7-RAW\",\r\n                          \"7.4\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"credativ\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Debian\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"9\",\r\n                          \"8\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"CentOS\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7.5\",\r\n                          \"7.4\",\r\n                          \"7.3\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"not_installed_application_linux\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5b842acb-0fe7-41b0-9f40-880ec4ad84d8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5b842acb-0fe7-41b0-9f40-880ec4ad84d8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Log Analytics Agent Deployment in VMSS - VM Image (OS) unlisted\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Reports VMSS as non-compliant if the VM Image (OS) is not in the list defined and the agent is not installed.\",\r\n        \"metadata\": {\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfImageIdToInclude_windows\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Windows OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"listOfImageIdToInclude_linux\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Linux OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"anyOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageId\",\r\n                      \"in\": \"[parameters('listOfImageIdToInclude_windows')]\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageId\",\r\n                      \"in\": \"[parameters('listOfImageIdToInclude_linux')]\"\r\n                    },\r\n                    {\r\n                      \"anyOf\": [\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"2008-R2-SP1\",\r\n                                \"2008-R2-SP1-smalldisk\",\r\n                                \"2012-Datacenter\",\r\n                                \"2012-Datacenter-smalldisk\",\r\n                                \"2012-R2-Datacenter\",\r\n                                \"2012-R2-Datacenter-smalldisk\",\r\n                                \"2016-Datacenter\",\r\n                                \"2016-Datacenter-Server-Core\",\r\n                                \"2016-Datacenter-Server-Core-smalldisk\",\r\n                                \"2016-Datacenter-smalldisk\",\r\n                                \"2016-Datacenter-with-Containers\",\r\n                                \"2016-Datacenter-with-RDSH\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServerSemiAnnual\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"Datacenter-Core-1709-smalldisk\",\r\n                                \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                                \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServerHPCPack\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftSQLServer\"\r\n                            },\r\n                            {\r\n                              \"anyOf\": [\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2016\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2016-BYOL\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2012R2\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2012R2-BYOL\"\r\n                                }\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftRServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"MLServer-WS2016\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftVisualStudio\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"in\": [\r\n                                \"VisualStudio\",\r\n                                \"Windows\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftDynamicsAX\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"Dynamics\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"microsoft-ads\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"windows-data-science-vm\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsDesktop\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"Windows-10\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"RedHat\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"RHEL\",\r\n                            \"RHEL-SAP-HANA\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"SUSE\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"SLES\",\r\n                            \"SLES-HPC\",\r\n                            \"SLES-HPC-Priority\",\r\n                            \"SLES-SAP\",\r\n                            \"SLES-SAP-BYOS\",\r\n                            \"SLES-Priority\",\r\n                            \"SLES-BYOS\",\r\n                            \"SLES-SAPCAL\",\r\n                            \"SLES-Standard\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"12*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"Canonical\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"UbuntuServer\"\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"14.04*LTS\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"16.04*LTS\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"18.04*LTS\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"Oracle\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"Oracle-Linux\"\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7.*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"OpenLogic\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"CentOS\",\r\n                            \"Centos-LVM\",\r\n                            \"CentOS-SRIOV\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"cloudera\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"cloudera-centos-os\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSKU\",\r\n                          \"like\": \"7*\"\r\n                        }\r\n                      ]\r\n                    }\r\n                  ]\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5c3bc7b8-a64c-4e08-a9cd-7ff0f31e1138\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5c3bc7b8-a64c-4e08-a9cd-7ff0f31e1138\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit external accounts with write permissions on a subscription\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"External accounts with write privileges should be removed from your subscription in order to prevent unmonitored access.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"RemoveExternalAccountsWritePermissions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5c607a2e-c700-4744-8254-d77e7c9eb5e4\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5c607a2e-c700-4744-8254-d77e7c9eb5e4\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit HTTPS only access for a Function App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"EnforceHttps\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5df82f4f-773a-4a2d-97a2-422a806f1a55\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5df82f4f-773a-4a2d-97a2-422a806f1a55\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Web Applications that are not using latest supported .NET Framework\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use the latest supported .NET Framework version for the latest security classes. Using older classes and types can make your application vulnerable.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"WebApp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UseLatestDotNet\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5e3315e0-a414-4efb-a4d2-c7bd2b0443d2\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5e3315e0-a414-4efb-a4d2-c7bd2b0443d2\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit that an application is installed inside Windows VMs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy will audit that the specified application is installed inside Windows virtual machines. This policy should only be used along with its corresponding deploy policy in an initiative/policy set. For more information on guest configuration policies, please visit http://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"SQL2017-WS2016\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Enterprise\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"WhitelistedApplication\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5e393799-e3ca-4e43-a9a5-0ec4648a57d9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5e393799-e3ca-4e43-a9a5-0ec4648a57d9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Allow resource creation only in India data centers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"description\": \"Allows resource creation in the following locations only: West India, South India, Central India\",\r\n        \"metadata\": {\r\n          \"category\": \"General\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": [\r\n                \"westindia\",\r\n                \"southindia\",\r\n                \"centralindia\"\r\n              ]\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5ee85ce5-e7eb-44d6-b4a2-32a24be1ca54\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5ee85ce5-e7eb-44d6-b4a2-32a24be1ca54\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy Log Analytics Agent for Linux VM Scale Sets (VMSS)\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Log Analytics Agent for Linux VM Scale Sets if the VM Image (OS) is in the list defined and the agent is not installed. Note: if your scale set upgradePolicy is set to Manual, you need to apply the extension to the all VMs in the set by calling upgrade on them. In CLI this would be az vmss update-instances.\",\r\n        \"metadata\": {\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\"\r\n            }\r\n          },\r\n          \"listOfImageIdToInclude\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Linux OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageId\",\r\n                    \"in\": \"[parameters('listOfImageIdToInclude')]\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-SAP-HANA\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"SLES\",\r\n                          \"SLES-HPC\",\r\n                          \"SLES-HPC-Priority\",\r\n                          \"SLES-SAP\",\r\n                          \"SLES-SAP-BYOS\",\r\n                          \"SLES-Priority\",\r\n                          \"SLES-BYOS\",\r\n                          \"SLES-SAPCAL\",\r\n                          \"SLES-Standard\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"12*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"14.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"16.04*LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"18.04*LTS\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Oracle\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Oracle-Linux\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7.*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"CentOS\",\r\n                          \"Centos-LVM\",\r\n                          \"CentOS-SRIOV\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-centos-os\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"like\": \"7*\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\r\n                    \"equals\": \"OmsAgentForLinux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"MMAExtension\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.EnterpriseCloud.Monitoring\",\r\n                      \"vmExtensionType\": \"OmsAgentForLinux\",\r\n                      \"vmExtensionTypeHandlerVersion\": \"1.7\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"typeHandlerVersion\": \"[variables('vmExtensionTypeHandlerVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"workspaceId\": \"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\",\r\n                            \"stopOnMultipleConnections\": \"true\"\r\n                          },\r\n                          \"protectedSettings\": {\r\n                            \"workspaceKey\": \"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"\r\n                          }\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for: ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5ee9e9ed-0b42-41b7-8c9c-3cfb2fbe2069\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5ee9e9ed-0b42-41b7-8c9c-3cfb2fbe2069\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit external accounts with read permissions on a subscription\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"External accounts with read privileges should be removed from your subscription in order to prevent unmonitored access.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"RemoveExternalAccountsReadPermissions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/5f76cf89-fbf2-47fd-a3f4-b891fa780b60\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5f76cf89-fbf2-47fd-a3f4-b891fa780b60\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit web servers inside Windows VMs must use TLS minimum version 1.1 encryption\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy will audit instances of Internet Information Services (IIS) running inside Windows virtual machines, to verify that TLS minimum version 1.1 is used for encryption.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                \"equals\": \"MicrosoftWindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                \"equals\": \"WindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                \"in\": [\r\n                  \"2012-Datacenter\",\r\n                  \"2012-Datacenter-smalldisk\",\r\n                  \"2012-R2-Datacenter\",\r\n                  \"2012-R2-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter\",\r\n                  \"2016-Datacenter-Server-Core\",\r\n                  \"2016-Datacenter-Server-Core-smalldisk\",\r\n                  \"2016-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter-with-Containers\",\r\n                  \"2016-Datacenter-with-RDSH\"\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"AuditSecureProtocol\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/60ffe3e2-4604-4460-8f22-0f1da058266c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"60ffe3e2-4604-4460-8f22-0f1da058266c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit the setting of ClusterProtectionLevel property to EncryptAndSign in Service Fabric\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Service Fabric provides three levels of protection (None, Sign and EncryptAndSign) for node-to-node communication using a primary cluster certificate. Set the protection level to ensure that all node-to-node messages are encrypted and digitally signed\",\r\n        \"metadata\": {\r\n          \"category\": \"Service Fabric\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ServiceFabric/clusters\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.ServiceFabric/clusters/fabricSettings[*].name\",\r\n                    \"notEquals\": \"Security\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.ServiceFabric/clusters/fabricSettings[*].parameters[*].name\",\r\n                    \"notEquals\": \"ClusterProtectionLevel\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.ServiceFabric/clusters/fabricSettings[*].parameters[*].value\",\r\n                    \"notEquals\": \"EncryptAndSign\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/617c02be-7f02-4efd-8836-3180d47b6c68\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"617c02be-7f02-4efd-8836-3180d47b6c68\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit missing blob encryption for storage accounts\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy audits storage accounts without blob encryption. It only applies to Microsoft.Storage resource types, not other storage providers. Possible network Just In Time access will be monitored by Azure Security Center as recommendations.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Storage/storageAccounts/enableBlobEncryption\",\r\n                  \"equals\": \"True\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/655cb504-bcee-4362-bd4c-402e6aa38759\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"655cb504-bcee-4362-bd4c-402e6aa38759\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit IP restrictions configuration for a Function App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"IP Restrictions allow you to define a list of IP addresses that are allowed to access your app. Use of IP Restrictions protects a Function app from common attacks.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"ConfigureIPRestrictions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/664346d9-be92-43fb-a219-d595eeb76a90\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"664346d9-be92-43fb-a219-d595eeb76a90\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit IP restrictions configuration for a Web Application\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"IP Restrictions allow you to define a list of IP addresses that are allowed to access your app. Use of IP Restrictions protects a web application from common attacks.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"WebApp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"ConfigureIPRestrictions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6a8450e2-6c61-43b4-be65-62e3a197bffe\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6a8450e2-6c61-43b4-be65-62e3a197bffe\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit deprecated accounts on a subscription\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Deprecated accounts should be removed from your subscriptions.  Deprecated accounts are accounts that have been blocked from signing in.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"RemoveDeprecatedAccounts\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6b1cbf55-e8b6-442f-ba4c-7246b6381474\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6b1cbf55-e8b6-442f-ba4c-7246b6381474\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Not allowed resource types\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"description\": \"This policy enables you to specify the resource types that your organization cannot deploy.\",\r\n        \"metadata\": {\r\n          \"category\": \"General\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfResourceTypesNotAllowed\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"description\": \"The list of resource types that cannot be deployed.\",\r\n              \"displayName\": \"Not allowed resource types\",\r\n              \"strongType\": \"resourceTypes\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": \"[parameters('listOfResourceTypesNotAllowed')]\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6c112d4e-5bc7-47ae-a041-ea2d9dccd749\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6c112d4e-5bc7-47ae-a041-ea2d9dccd749\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Allow resource creation only in Japan data centers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"description\": \"Allows resource creation in the following locations only: Japan East, Japan West\",\r\n        \"metadata\": {\r\n          \"category\": \"General\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": [\r\n                \"japaneast\",\r\n                \"japanwest\"\r\n              ]\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/6fdb9205-3462-4cfc-87d8-16c7860b53f4\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6fdb9205-3462-4cfc-87d8-16c7860b53f4\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy VM extension to audit Windows VM should not allow previous 24 passwords\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Include this rule to deploy the VM extensions for Microsoft Guest Configuration, Microsoft Azure Managed Service Identity, and required content to check settings inside the virtual machine. This security setting determines the number of unique new passwords that have to be associated with a user account before an old password can be reused.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ]\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                    \"equals\": \"MicrosoftWindowsServer\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                    \"equals\": \"WindowsServer\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                    \"in\": [\r\n                      \"2012-Datacenter\",\r\n                      \"2012-Datacenter-smalldisk\",\r\n                      \"2012-R2-Datacenter\",\r\n                      \"2012-R2-Datacenter-smalldisk\",\r\n                      \"2016-Datacenter\",\r\n                      \"2016-Datacenter-Server-Core\",\r\n                      \"2016-Datacenter-Server-Core-smalldisk\",\r\n                      \"2016-Datacenter-smalldisk\",\r\n                      \"2016-Datacenter-with-Containers\",\r\n                      \"2016-Datacenter-with-RDSH\"\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"name\": \"EnforcePasswordHistory\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"EnforcePasswordHistory\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-06-30-preview\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2017-03-30\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2015-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/726671ac-c4de-4908-8c7d-6043ae62e3b6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"726671ac-c4de-4908-8c7d-6043ae62e3b6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Allowed storage account SKUs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"description\": \"This policy enables you to specify a set of storage account SKUs that your organization can deploy.\",\r\n        \"metadata\": {\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfAllowedSKUs\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"description\": \"The list of SKUs that can be specified for storage accounts.\",\r\n              \"displayName\": \"Allowed SKUs\",\r\n              \"strongType\": \"StorageSKUs\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Storage/storageAccounts/sku.name\",\r\n                  \"in\": \"[parameters('listOfAllowedSKUs')]\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7433c107-6db4-4ad1-b57a-a76dce0154a1\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7433c107-6db4-4ad1-b57a-a76dce0154a1\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit enabling of diagnostic logs in App Services\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Audit enabling of diagnostic logs on the app. This enables you to recreate activity trails for investigation purposes if a security incident occurs or your network is compromised\",\r\n        \"metadata\": {\r\n          \"category\": \"App Service\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites/config\"\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"equals\": \"web\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/detailedErrorLoggingEnabled\",\r\n                    \"notEquals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/httpLoggingEnabled\",\r\n                    \"notEquals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/config/requestTracingEnabled\",\r\n                    \"notEquals\": \"true\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/752c6934-9bcc-4749-b004-655e676ae2ac\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"752c6934-9bcc-4749-b004-655e676ae2ac\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Monitor VM Vulnerabilities in Azure Security Center\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Monitors vulnerabilities detected by Vulnerability Assessment solution and VMs without a Vulnerability Assessment solution in Azure Security Center as recommendations.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.ClassicCompute/virtualMachines\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"vulnerabilityAssessment\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/760a85ff-6162-42b3-8d70-698e268f648c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"760a85ff-6162-42b3-8d70-698e268f648c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy Dependency Agent for Linux VM Scale Sets (VMSS)\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Deploy Dependency Agent for Linux VM Scale Sets if the VM Image (OS) is in the list defined and the agent is not installed. Note: if your scale set upgradePolicy is set to Manual, you need to apply the extension to the all VMs in the set by calling upgrade on them. In CLI this would be az vmss update-instances.\",\r\n        \"metadata\": {\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfImageIdToInclude\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Linux OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageId\",\r\n                    \"in\": \"[parameters('listOfImageIdToInclude')]\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"14.04.0-LTS\",\r\n                              \"14.04.1-LTS\",\r\n                              \"14.04.5-LTS\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"16.04-LTS\",\r\n                              \"16.04.0-LTS\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"18.04-LTS\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"RHEL\",\r\n                          \"RHEL-SAP-HANA\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"SUSE\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"SLES\",\r\n                          \"SLES-HPC\",\r\n                          \"SLES-HPC-Priority\",\r\n                          \"SLES-SAP\",\r\n                          \"SLES-SAP-BYOS\",\r\n                          \"SLES-Priority\",\r\n                          \"SLES-BYOS\",\r\n                          \"SLES-SAPCAL\",\r\n                          \"SLES-Standard\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"in\": [\r\n                              \"12-SP2\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"CentOS\",\r\n                          \"Centos-LVM\",\r\n                          \"CentOS-SRIOV\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"6.*\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"like\": \"7*\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"cloudera\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"cloudera-centos-os\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"like\": \"7*\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\r\n                    \"equals\": \"DependencyAgentLinux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Monitoring.DependencyAgent\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"DependencyAgent\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.Azure.Monitoring.DependencyAgent\",\r\n                      \"vmExtensionType\": \"DependencyAgentLinux\",\r\n                      \"vmExtensionTypeHandlerVersion\": \"9.7\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"typeHandlerVersion\": \"[variables('vmExtensionTypeHandlerVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for: ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/765266ab-e40e-4c61-bcb2-5a5275d0b7c0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"765266ab-e40e-4c61-bcb2-5a5275d0b7c0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit enabling of diagnostics logs in Service Fabric and Virtual Machine Scale Sets\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"It is recommended to enable Logs so that activity trail can be recreated when investigations are required in the event of an incident or a compromise.\",\r\n        \"metadata\": {\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n              \"existenceCondition\": {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\r\n                        \"equals\": \"IaaSDiagnostics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                        \"equals\": \"Microsoft.Azure.Diagnostics\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\r\n                        \"equals\": \"LinuxDiagnostic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                        \"equals\": \"Microsoft.OSTCExtensions\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7c1b1214-f927-48bf-8882-84f0af6588b1\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7c1b1214-f927-48bf-8882-84f0af6588b1\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Require blob encryption for storage accounts\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"description\": \"This policy ensures blob encryption for storage accounts is turned on. It only applies to Microsoft.Storage resource types, not other storage providers.\",\r\n        \"metadata\": {\r\n          \"category\": \"Storage\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Storage/storageAccounts/enableBlobEncryption\",\r\n                \"equals\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7c5a74bf-ae94-4a74-8fcf-644d1e0e6e6f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7c5a74bf-ae94-4a74-8fcf-644d1e0e6e6f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit that an application is not installed inside Windows VMs.\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy will audit that the specified application is not installed inside Windows virtual machines. This policy should only be used along with its corresponding deploy policy in an initiative/policy set. For more information on guest configuration policies, please visit http://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"SQL2017-WS2016\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Enterprise\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"NotInstalledApplication\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7e56b49b-5990-4159-a734-511ea19b731c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7e56b49b-5990-4159-a734-511ea19b731c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy VM extension to audit Windows VM enforces password complexity requirements\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Include this rule to deploy the VM extensions for Microsoft Guest Configuration, Microsoft Azure Managed Service Identity, and required content to check settings inside the virtual machine. If this policy is enabled, passwords must meet minimum requirements.  See documentation for full details at URL http://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ]\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                    \"equals\": \"MicrosoftWindowsServer\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                    \"equals\": \"WindowsServer\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                    \"in\": [\r\n                      \"2012-Datacenter\",\r\n                      \"2012-Datacenter-smalldisk\",\r\n                      \"2012-R2-Datacenter\",\r\n                      \"2012-R2-Datacenter-smalldisk\",\r\n                      \"2016-Datacenter\",\r\n                      \"2016-Datacenter-Server-Core\",\r\n                      \"2016-Datacenter-Server-Core-smalldisk\",\r\n                      \"2016-Datacenter-smalldisk\",\r\n                      \"2016-Datacenter-with-Containers\",\r\n                      \"2016-Datacenter-with-RDSH\"\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"name\": \"PasswordMustMeetComplexityRequirements\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"PasswordMustMeetComplexityRequirements\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-06-30-preview\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2017-03-30\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2015-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7ed40801-8a0f-4ceb-85c0-9fd25c1d61a8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7ed40801-8a0f-4ceb-85c0-9fd25c1d61a8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit diagnostic setting\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Audit diagnostic setting for selected resource types\",\r\n        \"metadata\": {\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfResourceTypes\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Resource Types\",\r\n              \"strongType\": \"resourceTypes\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": \"[parameters('listOfResourceTypes')]\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"AuditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/metrics.enabled\",\r\n                    \"equals\": \"true\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/7f89b1eb-583c-429a-8828-af049802c1d9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7f89b1eb-583c-429a-8828-af049802c1d9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit enabling of diagnostic logs in Event Hub\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit enabling of logs and retain them up to a year. This enables recreation of activity trails for investigation purposes when a security incident occurs or your network is compromised\",\r\n        \"metadata\": {\r\n          \"category\": \"Event Hub\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"requiredRetentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Required retention (days)\",\r\n              \"description\": \"The required diagnostic logs retention in days\"\r\n            },\r\n            \"defaultValue\": \"365\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.EventHub/namespaces\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                    \"equals\": \"[parameters('requiredRetentionDays')]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/83a214f7-d01a-484b-91a9-ed54470c9a6a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"83a214f7-d01a-484b-91a9-ed54470c9a6a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy SQL DB transparent data encryption\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Enables transparent data encryption on SQL databases\",\r\n        \"metadata\": {\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers/databases\"\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"notEquals\": \"master\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"DeployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/databases/transparentDataEncryption\",\r\n              \"name\": \"current\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Sql/transparentDataEncryption.status\",\r\n                \"equals\": \"Enabled\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/9b7fa17d-e63e-47b0-bb0a-15c516ac86ec\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"fullDbName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('fullDbName'), '/current')]\",\r\n                        \"type\": \"Microsoft.Sql/servers/databases/transparentDataEncryption\",\r\n                        \"apiVersion\": \"2014-04-01\",\r\n                        \"properties\": {\r\n                          \"status\": \"Enabled\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"fullDbName\": {\r\n                      \"value\": \"[field('fullName')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/86a912f6-9a06-4e26-b447-11b16ba8659f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"86a912f6-9a06-4e26-b447-11b16ba8659f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Monitor missing system updates in Azure Security Center\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Missing security system updates on your servers will be monitored by Azure Security Center as recommendations\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.ClassicCompute/virtualMachines\",\r\n              \"Microsoft.OperationalInsights/workspaces\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"systemUpdates\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/86b3d65f-7626-441e-b690-81a8b71cff60\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"86b3d65f-7626-441e-b690-81a8b71cff60\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy VM extension to audit that an application is not installed inside Linux VMs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Include this rule to deploy the VM extension for Microsoft Guest Configuration, the VM extension for Microsoft Azure Managed Service Identity, and the content required to audit that an application is not installed inside Linux virtual machines. This policy should only be used along with its corresponding audit policy in an initiative/policy set. For more information on guest configuration policies, please visit http://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ]\r\n        },\r\n        \"parameters\": {\r\n          \"ApplicationName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Application name\",\r\n              \"description\": \"Application name. Example: 'python' or 'powershell'.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"14.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"16.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"equals\": \"16.04-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"18.04-LTS\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Suse\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"SLES\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"12-SP3\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"RHEL\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7-RAW\",\r\n                          \"7.4\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"credativ\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Debian\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"9\",\r\n                          \"8\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"CentOS\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7.5\",\r\n                          \"7.4\",\r\n                          \"7.3\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"name\": \"not_installed_application_linux\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"not_installed_application_linux\"\r\n                    },\r\n                    \"ApplicationName\": {\r\n                      \"value\": \"[parameters('ApplicationName')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ApplicationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-06-30-preview\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[ChefInSpec]NotInstalledApplicationLinuxResource1;AttributesYmlContent\",\r\n                                \"value\": \"[concat('packages: [', parameters('ApplicationName'), ']')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2017-03-30\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2015-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforLinux')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforLinux\",\r\n                          \"typeHandlerVersion\": \"1.0\",\r\n                          \"autoUpgradeMinorVersion\": true\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/884b209a-963b-4520-8006-d20cb3c213e0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"884b209a-963b-4520-8006-d20cb3c213e0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Enforce tag and its value on resource groups\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Enforces a required tag and its value on resource groups.\",\r\n        \"metadata\": {\r\n          \"category\": \"General\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            }\r\n          },\r\n          \"tagValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Value\",\r\n              \"description\": \"Value of the tag, such as 'production'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                \"notEquals\": \"[parameters('tagValue')]\"\r\n              },\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Resources/subscriptions/resourceGroups\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8ce3da23-7156-49e4-b145-24f95f9dcb46\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8ce3da23-7156-49e4-b145-24f95f9dcb46\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy VM extension to audit Windows VM should not store passwords using reversible encryption\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Include this rule to deploy the VM extensions for Microsoft Guest Configuration, Microsoft Azure Managed Service Identity, and required content to check settings inside the virtual machine. This security setting determines whether the operating system stores passwords using reversible encryption.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ]\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                    \"equals\": \"MicrosoftWindowsServer\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                    \"equals\": \"WindowsServer\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                    \"in\": [\r\n                      \"2012-Datacenter\",\r\n                      \"2012-Datacenter-smalldisk\",\r\n                      \"2012-R2-Datacenter\",\r\n                      \"2012-R2-Datacenter-smalldisk\",\r\n                      \"2016-Datacenter\",\r\n                      \"2016-Datacenter-Server-Core\",\r\n                      \"2016-Datacenter-Server-Core-smalldisk\",\r\n                      \"2016-Datacenter-smalldisk\",\r\n                      \"2016-Datacenter-with-Containers\",\r\n                      \"2016-Datacenter-with-RDSH\"\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"name\": \"StorePasswordsUsingReversibleEncryption\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"StorePasswordsUsingReversibleEncryption\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-06-30-preview\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2017-03-30\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2015-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/8ff0b18b-262e-4512-857a-48ad0aeb9a78\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8ff0b18b-262e-4512-857a-48ad0aeb9a78\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit accounts with write permissions who are not MFA enabled on a subscription\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Multi-Factor Authentication (MFA) should be enabled for all subscription accounts with write privileges to prevent a breach of accounts or resources.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"EnableMFAForWritePermissions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/9297c21d-2ed6-4474-b48f-163f75654ce3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9297c21d-2ed6-4474-b48f-163f75654ce3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Allow resource creation only in European data centers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"description\": \"Allows resource creation in the following locations only: North Europe, West Europe\",\r\n        \"metadata\": {\r\n          \"category\": \"General\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": [\r\n                \"northeurope\",\r\n                \"westeurope\"\r\n              ]\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/94c19f19-8192-48cd-a11b-e37099d3e36b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"94c19f19-8192-48cd-a11b-e37099d3e36b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Allow resource creation only in United States data centers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"description\": \"Allows resource creation in the following locations only: Central US, East US, East US2, North Central US, South Central US, West US\",\r\n        \"metadata\": {\r\n          \"category\": \"General\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": [\r\n                \"centralus\",\r\n                \"eastus\",\r\n                \"eastus2\",\r\n                \"northcentralus\",\r\n                \"southcentralus\",\r\n                \"westus\"\r\n              ]\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/983211ba-f348-4758-983b-21fa29294869\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"983211ba-f348-4758-983b-21fa29294869\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit API Applications that are not using latest supported Java Framework\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use the latest supported Java version for the latest security classes. Using older classes and types can make your application vulnerable.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"api\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"apiApp\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UseLatestJava\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/9bfe3727-0a17-471f-a2fe-eddd6b668745\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9bfe3727-0a17-471f-a2fe-eddd6b668745\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Monitor unprotected network endpoints in Azure Security Center\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Network endpoints without a Next Generation Firewall's protection will be monitored by Azure Security Center as recommendations\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Network/publicIPAddresses\",\r\n              \"Microsoft.ClassicCompute/domainNames\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"unprotectedNetworkEndpoint\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/9daedab3-fb2d-461e-b861-71790eead4f6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9daedab3-fb2d-461e-b861-71790eead4f6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Allowed resource types\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"description\": \"This policy enables you to specify the resource types that your organization can deploy.\",\r\n        \"metadata\": {\r\n          \"category\": \"General\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfResourceTypesAllowed\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"description\": \"The list of resource types that can be deployed.\",\r\n              \"displayName\": \"Allowed resource types\",\r\n              \"strongType\": \"resourceTypes\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"type\",\r\n              \"in\": \"[parameters('listOfResourceTypesAllowed')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/a08ec900-254a-4555-9bf5-e42af04b5c5c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"a08ec900-254a-4555-9bf5-e42af04b5c5c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit authorization rules on Service Bus namespaces\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Service Bus clients should not use a namespace level access policy that provides access to all queues and topics in a namespace. To align with the least privilege security model, you shoud create access policies at the entity level for queues and topics to provide access to only the specific entity\",\r\n        \"metadata\": {\r\n          \"category\": \"Service Bus\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ServiceBus/namespaces/authorizationRules\"\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"notEquals\": \"RootManageSharedAccessKey\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/a1817ec0-a368-432a-8057-8371e17ac6ee\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"a1817ec0-a368-432a-8057-8371e17ac6ee\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit usage of custom RBAC rules\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Audit built-in roles such as 'Owner, Contributer, Reader' instead of custom RBAC roles, which are error prone. Using custom roles is treated as an exception and requires a rigorous review and threat modeling\",\r\n        \"metadata\": {\r\n          \"category\": \"General\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Authorization/roleDefinitions\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Authorization/roleDefinitions/type\",\r\n                \"equals\": \"CustomRole\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/a451c1ef-c6ca-483d-87ed-f49761e3ffb5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"a451c1ef-c6ca-483d-87ed-f49761e3ffb5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit SQL server level Auditing settings\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audits the existence of SQL Auditing at the server level\",\r\n        \"metadata\": {\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"setting\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Desired Auditing setting\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"enabled\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"enabled\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/auditingSettings\",\r\n              \"name\": \"default\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Sql/auditingSettings.state\",\r\n                \"equals\": \"[parameters('setting')]\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/a6fb4358-5bf4-4ad7-ba82-2cd2f41ce5e9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"a6fb4358-5bf4-4ad7-ba82-2cd2f41ce5e9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit standard tier of DDoS protection is enabled for a virtual network\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"DDoS protection standard should be enabled for all virtual networks with a subnet that is part of an application gateway with a public IP.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"microsoft.network/virtualNetworks\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"EnableDDoSProtection\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/a7aca53f-2ed4-4466-a25e-0b45ade68efd\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"a7aca53f-2ed4-4466-a25e-0b45ade68efd\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Enforce encryption on Data Lake Store accounts\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy ensures encryption is enabled on all Data Lake Store accounts\",\r\n        \"metadata\": {\r\n          \"category\": \"Data Lake\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DataLakeStore/accounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DataLakeStore/accounts/encryptionState\",\r\n                \"equals\": \"Disabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/a7ff3161-0087-490a-9ad9-ad6217f4f43a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"a7ff3161-0087-490a-9ad9-ad6217f4f43a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Monitor unencrypted SQL database in Azure Security Center\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Unencrypted SQL servers or databases will be monitored by Azure Security Center as recommendations\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.SQL/servers\",\r\n              \"Microsoft.SQL/servers/databases\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"encryption\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/a8bef009-a5c9-4d0f-90d7-6018734e8a16\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"a8bef009-a5c9-4d0f-90d7-6018734e8a16\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy network watcher when virtual networks are created\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy creates a network watcher resource in regions with virtual networks. You need to ensure existence of a resource group named networkWatcherRG, which will be used to deploy network watcher instances.\",\r\n        \"metadata\": {\r\n          \"category\": \"Network\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Network/virtualNetworks\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"DeployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Network/networkWatchers\",\r\n              \"resourceGroupName\": \"networkWatcherRG\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"location\",\r\n                \"equals\": \"[field('location')]\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/4d97b98b-1d4f-4787-a291-c67834d212e7\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2016-09-01\",\r\n                        \"type\": \"Microsoft.Network/networkWatchers\",\r\n                        \"name\": \"[concat('networkWacher_', parameters('location'))]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/a9b99dd8-06c5-4317-8629-9d86a3c6e7d9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"a9b99dd8-06c5-4317-8629-9d86a3c6e7d9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit accounts with owner permissions who are not MFA enabled on a subscription\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Multi-Factor Authentication (MFA) should be enabled for all subscription accounts with owner permissions to prevent a breach of accounts or resources.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"EnableMFAForOwnerPermissions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/aa633080-8b72-40c4-a2d7-d00c03e80bed\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"aa633080-8b72-40c4-a2d7-d00c03e80bed\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Automatic provisioning of security monitoring agent\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Installs security agent on VMs for advanced security alerts and preventions in Azure Security Center. Applies only for subscriptions that use Azure Security Center.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true,\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.ClassicCompute/virtualMachines\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"AuditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"securityAgent\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/abcc6037-1fc4-47f6-aac5-89706589be24\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"abcc6037-1fc4-47f6-aac5-89706589be24\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Allow resource creation if 'environment' tag value in allowed values\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"description\": \"Allows resource creation if the 'environment' tag is set to one of the following values: production, dev, test, staging\",\r\n        \"metadata\": {\r\n          \"category\": \"General\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"tags.environment\",\r\n              \"in\": [\r\n                \"production\",\r\n                \"dev\",\r\n                \"test\",\r\n                \"staging\"\r\n              ]\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/ac7e5fc0-c029-4b12-91d4-a8500ce697f9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"ac7e5fc0-c029-4b12-91d4-a8500ce697f9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Monitor missing Endpoint Protection in Azure Security Center\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Servers without an installed Endpoint Protection agent will be monitored by Azure Security Center as recommendations\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.ClassicCompute/virtualMachines\",\r\n              \"Microsoft.OperationalInsights/workspaces\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"endpointProtection\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/af6cd1bd-1635-48cb-bde7-5b15693900b9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"af6cd1bd-1635-48cb-bde7-5b15693900b9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Monitor unaudited SQL database in Azure Security Center\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"SQL servers and databases which doesn't have SQL auditing turned on will be monitored by Azure Security Center as recommendations\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.SQL/servers\",\r\n              \"Microsoft.SQL/servers/databases\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"auditing\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/af8051bf-258b-44e2-a2bf-165330459f9d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"af8051bf-258b-44e2-a2bf-165330459f9d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Monitor possible network Just In Time (JIT) access in Azure Security Center\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Possible network Just In Time (JIT) access will be monitored by Azure Security Center as recommendations\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"jitNetworkAccess\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/b0f33259-77d7-4c9e-aac6-3aabcfae693c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"b0f33259-77d7-4c9e-aac6-3aabcfae693c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Linux VM /etc/passwd file permissions are set to 0644\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This security setting verifies /etc/passwd file permissions are set to 0644 to prevent unauthorized changes that could allow access to the server.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"14.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"16.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"equals\": \"16.04-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"18.04-LTS\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Suse\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"SLES\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"12-SP3\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"RHEL\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7-RAW\",\r\n                          \"7.4\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"credativ\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Debian\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"9\",\r\n                          \"8\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"CentOS\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7.5\",\r\n                          \"7.4\",\r\n                          \"7.3\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"PasswordPolicy_msid121\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/b18175dd-c599-4c64-83ba-bb018a06d35b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"b18175dd-c599-4c64-83ba-bb018a06d35b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit authorization rules on Event Hub namespaces\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Event Hub clients should not use a namespace level access policy that provides access to all queues and topics in a namespace. To align with the least privilege security model, you shoud create access policies at the entity level for queues and topics to provide access to only the specific entity\",\r\n        \"metadata\": {\r\n          \"category\": \"Event Hub\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.EventHub/namespaces/authorizationRules\"\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"notEquals\": \"RootManageSharedAccessKey\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/b278e460-7cfc-4451-8294-cccc40a940d7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"b278e460-7cfc-4451-8294-cccc40a940d7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy VM extension to audit web servers inside Windows VMs must use TLS minimum version 1.1 encryption\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Include this rule to deploy the VM extensions for Microsoft Guest Configuration, Microsoft Azure Managed Service Identity, and required content to audit instances of Internet Information Services (IIS) running inside Windows virtual machines, to verify that TLS minimum version 1.1 is used for encryption.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ]\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                    \"equals\": \"MicrosoftWindowsServer\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageOffer\",\r\n                    \"equals\": \"WindowsServer\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageSKU\",\r\n                    \"in\": [\r\n                      \"2012-Datacenter\",\r\n                      \"2012-Datacenter-smalldisk\",\r\n                      \"2012-R2-Datacenter\",\r\n                      \"2012-R2-Datacenter-smalldisk\",\r\n                      \"2016-Datacenter\",\r\n                      \"2016-Datacenter-Server-Core\",\r\n                      \"2016-Datacenter-Server-Core-smalldisk\",\r\n                      \"2016-Datacenter-smalldisk\",\r\n                      \"2016-Datacenter-with-Containers\",\r\n                      \"2016-Datacenter-with-RDSH\"\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"name\": \"AuditSecureProtocol\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"AuditSecureProtocol\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-06-30-preview\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2017-03-30\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2015-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/b2fc8f91-866d-4434-9089-5ebfe38d6fd8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"b2fc8f91-866d-4434-9089-5ebfe38d6fd8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit enabling of diagnostic logs for Search service\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit enabling of logs and retain them up to a year. This enables you to recreate activity trails for investigation purposes when a security incident occurs or your network is compromised\",\r\n        \"metadata\": {\r\n          \"category\": \"Search\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"requiredRetentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Required retention (days)\",\r\n              \"description\": \"The required diagnostic logs retention in days\"\r\n            },\r\n            \"defaultValue\": \"365\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Search/searchServices\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                    \"equals\": \"[parameters('requiredRetentionDays')]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/b4330a05-a843-4bc8-bf9a-cacce50c67f4\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"b4330a05-a843-4bc8-bf9a-cacce50c67f4\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Web Sockets state for an API App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"The Web Sockets protocol is vulnerable to different types of security threats. Use of Web Sockets within an API app must be carefully reviewed.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"api\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"apiApp\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"DisableWebSockets\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/b48334a4-911b-4084-b1ab-3e6a4e50b951\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"b48334a4-911b-4084-b1ab-3e6a4e50b951\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit usage of Azure Active Directory for client authentication in Service Fabric\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit usage of client authentication only via Azure Active Directory in Service Fabric\",\r\n        \"metadata\": {\r\n          \"category\": \"Service Fabric\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.ServiceFabric/clusters\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.ServiceFabric/clusters/azureActiveDirectory.tenantId\",\r\n                    \"exists\": \"false\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.ServiceFabric/clusters/azureActiveDirectory.tenantId\",\r\n                    \"equals\": \"\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/b54ed75b-3e1a-44ac-a333-05ba39b99ff0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"b54ed75b-3e1a-44ac-a333-05ba39b99ff0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit API Applications that are not using latest supported Python Framework\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use the latest supported Python version for the latest security classes. Using older classes and types can make your application vulnerable.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"api\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"apiApp\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UseLatestPython\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/bc0378bb-d7ab-4614-a0f6-5a6e3f02d644\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"bc0378bb-d7ab-4614-a0f6-5a6e3f02d644\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Web Applications that are not using latest supported Java Framework\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use the latest supported Java version for the latest security classes. Using older classes and types can make your application vulnerable.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"WebApp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UseLatestJava\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/be0a7681-bed4-48dc-9ff3-f0171ee170b6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"be0a7681-bed4-48dc-9ff3-f0171ee170b6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Allow resource creation only in Asia data centers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"description\": \"Allows resource creation in the following locations only: East Asia, Southeast Asia, West India, South India, Central India, Japan East, Japan West\",\r\n        \"metadata\": {\r\n          \"category\": \"General\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": [\r\n                \"eastasia\",\r\n                \"southeastasia\",\r\n                \"westindia\",\r\n                \"southindia\",\r\n                \"centralindia\",\r\n                \"japaneast\",\r\n                \"japanwest\"\r\n              ]\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/c1b9cbed-08e3-427d-b9ce-7c535b1e9b94\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"c1b9cbed-08e3-427d-b9ce-7c535b1e9b94\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Linux VM accounts with no passwords\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This security setting verifies there are no accounts without passwords.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"14.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"16.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"equals\": \"16.04-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"18.04-LTS\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Suse\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"SLES\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"12-SP3\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"RHEL\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7-RAW\",\r\n                          \"7.4\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"credativ\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Debian\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"9\",\r\n                          \"8\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"CentOS\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7.5\",\r\n                          \"7.4\",\r\n                          \"7.3\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"PasswordPolicy_msid232\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/c40c9087-1981-4e73-9f53-39743eda9d05\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"c40c9087-1981-4e73-9f53-39743eda9d05\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit HTTPS only access for an API App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use of HTTPS ensures server/service authentication and protects data in transit from network layer eavesdropping attacks.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"api\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"apiApp\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"EnforceHttps\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/c85538c1-b527-4ce4-bdb4-1dabcb3fd90d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"c85538c1-b527-4ce4-bdb4-1dabcb3fd90d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit enabling of diagnostic logs in Data Lake Analytics\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit enabling of logs and retain them up to a year. This enables you to recreate activity trails for investigation purposes when a security incident occurs or your network is compromised\",\r\n        \"metadata\": {\r\n          \"category\": \"Data Lake\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"requiredRetentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Required retention (days)\",\r\n              \"description\": \"The required diagnostic logs retention in days\"\r\n            },\r\n            \"defaultValue\": \"365\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.DataLakeAnalytics/accounts\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                    \"equals\": \"[parameters('requiredRetentionDays')]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/c95c74d9-38fe-4f0d-af86-0c7d626a315c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"c95c74d9-38fe-4f0d-af86-0c7d626a315c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Apply Diagnostic Settings for Network Security Groups\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy automatically deploys diagnostic settings to network security groups.\",\r\n        \"metadata\": {\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"storagePrefix\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Storage Account Prefix for Regional Storage Account\"\r\n            }\r\n          },\r\n          \"rgName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Resource Group Name for Storage Account (must exist)\",\r\n              \"description\": \"This resource group must already exist\",\r\n              \"strongType\": \"ExistingResourceGroups\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Network/networkSecurityGroups\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"DeployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"name\": \"setbypolicy\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/17d1049b-9a84-46fb-8f53-869881c3d3ab\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"storagePrefix\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"nsgName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"rgName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"storageDeployName\": \"[concat('policyStorage_', uniqueString(parameters('location'), parameters('nsgName')))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Network/networkSecurityGroups/providers/diagnosticSettings\",\r\n                        \"name\": \"[concat(parameters('nsgName'),'/Microsoft.Insights/setbypolicy')]\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"dependsOn\": [\r\n                          \"[variables('storageDeployName')]\"\r\n                        ],\r\n                        \"properties\": {\r\n                          \"storageAccountId\": \"[reference(variables('storageDeployName')).outputs.storageAccountId.value]\",\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"NetworkSecurityGroupEvent\",\r\n                              \"enabled\": true,\r\n                              \"retentionPolicy\": {\r\n                                \"enabled\": false,\r\n                                \"days\": 0\r\n                              }\r\n                            },\r\n                            {\r\n                              \"category\": \"NetworkSecurityGroupRuleCounter\",\r\n                              \"enabled\": true,\r\n                              \"retentionPolicy\": {\r\n                                \"enabled\": false,\r\n                                \"days\": 0\r\n                              }\r\n                            }\r\n                          ]\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2017-05-10\",\r\n                        \"name\": \"[variables('storageDeployName')]\",\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"resourceGroup\": \"[parameters('rgName')]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"incremental\",\r\n                          \"parameters\": {\r\n                            \"location\": {\r\n                              \"value\": \"[parameters('location')]\"\r\n                            },\r\n                            \"storagePrefix\": {\r\n                              \"value\": \"[parameters('storagePrefix')]\"\r\n                            }\r\n                          },\r\n                          \"template\": {\r\n                            \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"parameters\": {\r\n                              \"location\": {\r\n                                \"type\": \"string\"\r\n                              },\r\n                              \"storagePrefix\": {\r\n                                \"type\": \"string\"\r\n                              }\r\n                            },\r\n                            \"resources\": [\r\n                              {\r\n                                \"apiVersion\": \"2017-06-01\",\r\n                                \"type\": \"Microsoft.Storage/storageAccounts\",\r\n                                \"name\": \"[concat(parameters('storageprefix'), parameters('location'))]\",\r\n                                \"sku\": {\r\n                                  \"name\": \"Standard_LRS\",\r\n                                  \"tier\": \"Standard\"\r\n                                },\r\n                                \"kind\": \"Storage\",\r\n                                \"location\": \"[parameters('location')]\",\r\n                                \"tags\": {\r\n                                  \"created-by\": \"policy\"\r\n                                },\r\n                                \"scale\": null,\r\n                                \"properties\": {\r\n                                  \"networkAcls\": {\r\n                                    \"bypass\": \"AzureServices\",\r\n                                    \"defaultAction\": \"Allow\",\r\n                                    \"ipRules\": [],\r\n                                    \"virtualNetworkRules\": []\r\n                                  },\r\n                                  \"supportsHttpsTrafficOnly\": true\r\n                                }\r\n                              }\r\n                            ],\r\n                            \"outputs\": {\r\n                              \"storageAccountId\": {\r\n                                \"type\": \"string\",\r\n                                \"value\": \"[resourceId(parameters('rgName'), 'Microsoft.Storage/storageAccounts',concat(parameters('storagePrefix'), parameters('location')))]\"\r\n                              }\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"storagePrefix\": {\r\n                      \"value\": \"[parameters('storagePrefix')]\"\r\n                    },\r\n                    \"rgName\": {\r\n                      \"value\": \"[parameters('rgName')]\"\r\n                    },\r\n                    \"nsgName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/c9c29499-c1d1-4195-99bd-2ec9e3a9dc89\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"c9c29499-c1d1-4195-99bd-2ec9e3a9dc89\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit remote debugging state for a Web Application\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Remote debugging requires inbound ports to be opened on a web application.  Remote debugging should be turned off.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"WebApp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"DisableRemoteDebugging\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/cb510bfd-1cba-4d9f-a230-cb0976f4bb71\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"cb510bfd-1cba-4d9f-a230-cb0976f4bb71\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Allowed virtual machine SKUs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"description\": \"This policy enables you to specify a set of virtual machine SKUs that your organization can deploy.\",\r\n        \"metadata\": {\r\n          \"category\": \"Compute\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfAllowedSKUs\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"description\": \"The list of SKUs that can be specified for virtual machines.\",\r\n              \"displayName\": \"Allowed SKUs\",\r\n              \"strongType\": \"VMSKUs\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Compute/virtualMachines/sku.name\",\r\n                  \"in\": \"[parameters('listOfAllowedSKUs')]\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/cccc23c7-8427-4f53-ad12-b6a63eb452b3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"cccc23c7-8427-4f53-ad12-b6a63eb452b3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Allow resource creation if 'department' tag set\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"description\": \"Allows resource creation only if the 'department' tag is set\",\r\n        \"metadata\": {\r\n          \"category\": \"General\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"tags\",\r\n              \"containsKey\": \"department\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/cd8dc879-a2ae-43c3-8211-1877c5755064\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"cd8dc879-a2ae-43c3-8211-1877c5755064\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Windows VM should not allow previous 24 passwords\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This security setting determines the number of unique new passwords that have to be associated with a user account before an old password can be reused.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                \"equals\": \"MicrosoftWindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                \"equals\": \"WindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                \"in\": [\r\n                  \"2012-Datacenter\",\r\n                  \"2012-Datacenter-smalldisk\",\r\n                  \"2012-R2-Datacenter\",\r\n                  \"2012-R2-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter\",\r\n                  \"2016-Datacenter-Server-Core\",\r\n                  \"2016-Datacenter-Server-Core-smalldisk\",\r\n                  \"2016-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter-with-Containers\",\r\n                  \"2016-Datacenter-with-RDSH\"\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"EnforcePasswordHistory\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/cdbf72d9-ac9c-4026-8a3a-491a5ac59293\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"cdbf72d9-ac9c-4026-8a3a-491a5ac59293\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit enabling of diagnostic logs in Key Vault\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit enabling of logs and retain them up to a year. This enables you to recreate activity trails for investigation purposes when a security incident occurs or your network is compromised\",\r\n        \"metadata\": {\r\n          \"category\": \"Key Vault\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"requiredRetentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Required retention (days)\",\r\n              \"description\": \"The required diagnostic logs retention in days\"\r\n            },\r\n            \"defaultValue\": \"365\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.KeyVault/vaults\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                    \"equals\": \"[parameters('requiredRetentionDays')]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/cf820ca0-f99e-4f3e-84fb-66e913812d21\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"cf820ca0-f99e-4f3e-84fb-66e913812d21\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Function Apps that are not using custom domains\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use of custom domains protects a Function app from common attacks such as phishing and other DNS-related attacks.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"functionapp,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UsedCustomDomains\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/d1cb47db-b7a1-4c46-814e-aad1c0e84f3c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"d1cb47db-b7a1-4c46-814e-aad1c0e84f3c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Web Applications that are not using custom domains\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use of custom domains protects a web application from common attacks such as phishing and other DNS-related attacks.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"WebApp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UsedCustomDomains\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/dd2ea520-6b06-45c3-806e-ea297c23e06a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"dd2ea520-6b06-45c3-806e-ea297c23e06a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Allow resource creation only in Japan data centers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"description\": \"Allows resource creation in the following locations only: Japan East, Japan West\",\r\n        \"metadata\": {\r\n          \"category\": \"General\",\r\n          \"deprecated\": true\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": [\r\n                \"japaneast\",\r\n                \"japanwest\"\r\n              ]\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/e01598e8-6538-41ed-95e8-8b29746cd697\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"e01598e8-6538-41ed-95e8-8b29746cd697\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Monitor OS vulnerabilities in Azure Security Center\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Servers which do not satisfy the configured baseline will be monitored by Azure Security Center as recommendations\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Compute/virtualMachines\",\r\n              \"Microsoft.ClassicCompute/virtualMachines\",\r\n              \"Microsoft.OperationalInsights/workspaces\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"osVulnerabilities\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/e1e5fd5d-3e4c-4ce1-8661-7d1873ae6b15\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"e1e5fd5d-3e4c-4ce1-8661-7d1873ae6b15\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Dependency Agent Deployment in VMSS - VM Image (OS) unlisted\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Reports VMSS as non-compliant if the VM Image (OS) is not in the list defined and the agent is not installed.\",\r\n        \"metadata\": {\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfImageIdToInclude_windows\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Windows OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"listOfImageIdToInclude_linux\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Linux OS to add to scope\",\r\n              \"description\": \"Example value: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"anyOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageId\",\r\n                      \"in\": \"[parameters('listOfImageIdToInclude_windows')]\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageId\",\r\n                      \"in\": \"[parameters('listOfImageIdToInclude_linux')]\"\r\n                    },\r\n                    {\r\n                      \"anyOf\": [\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"2008-R2-SP1\",\r\n                                \"2008-R2-SP1-smalldisk\",\r\n                                \"2012-Datacenter\",\r\n                                \"2012-Datacenter-smalldisk\",\r\n                                \"2012-R2-Datacenter\",\r\n                                \"2012-R2-Datacenter-smalldisk\",\r\n                                \"2016-Datacenter\",\r\n                                \"2016-Datacenter-Server-Core\",\r\n                                \"2016-Datacenter-Server-Core-smalldisk\",\r\n                                \"2016-Datacenter-smalldisk\",\r\n                                \"2016-Datacenter-with-Containers\",\r\n                                \"2016-Datacenter-with-RDSH\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServerSemiAnnual\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"Datacenter-Core-1709-smalldisk\",\r\n                                \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                                \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"WindowsServerHPCPack\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftSQLServer\"\r\n                            },\r\n                            {\r\n                              \"anyOf\": [\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2016\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2016-BYOL\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2012R2\"\r\n                                },\r\n                                {\r\n                                  \"field\": \"Microsoft.Compute/imageOffer\",\r\n                                  \"like\": \"*-WS2012R2-BYOL\"\r\n                                }\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftRServer\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"MLServer-WS2016\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftVisualStudio\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"in\": [\r\n                                \"VisualStudio\",\r\n                                \"Windows\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftDynamicsAX\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"Dynamics\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"microsoft-ads\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"windows-data-science-vm\"\r\n                            }\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"allOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                              \"equals\": \"MicrosoftWindowsDesktop\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageOffer\",\r\n                              \"equals\": \"Windows-10\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"RedHat\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"RHEL\",\r\n                            \"RHEL-SAP-HANA\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"SUSE\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"SLES\",\r\n                            \"SLES-HPC\",\r\n                            \"SLES-HPC-Priority\",\r\n                            \"SLES-SAP\",\r\n                            \"SLES-SAP-BYOS\",\r\n                            \"SLES-Priority\",\r\n                            \"SLES-BYOS\",\r\n                            \"SLES-SAPCAL\",\r\n                            \"SLES-Standard\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"12-SP2\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"Canonical\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"UbuntuServer\"\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"14.04.0-LTS\",\r\n                                \"14.04.1-LTS\",\r\n                                \"14.04.5-LTS\"\r\n                              ]\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"16.04-LTS\",\r\n                                \"16.04.0-LTS\"\r\n                              ]\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"in\": [\r\n                                \"18.04-LTS\"\r\n                              ]\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"OpenLogic\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"in\": [\r\n                            \"Centos\",\r\n                            \"Centos-LVM\",\r\n                            \"CentOS-SRIOV\"\r\n                          ]\r\n                        },\r\n                        {\r\n                          \"anyOf\": [\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"6.*\"\r\n                            },\r\n                            {\r\n                              \"field\": \"Microsoft.Compute/imageSKU\",\r\n                              \"like\": \"7*\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"allOf\": [\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                          \"equals\": \"cloudera\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageOffer\",\r\n                          \"equals\": \"cloudera-centos-os\"\r\n                        },\r\n                        {\r\n                          \"field\": \"Microsoft.Compute/imageSKU\",\r\n                          \"like\": \"7*\"\r\n                        }\r\n                      ]\r\n                    }\r\n                  ]\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                \"equals\": \"Microsoft.Azure.Monitoring.DependencyAgent\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/e2dd799a-a932-4e9d-ac17-d473bc3c6c10\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"e2dd799a-a932-4e9d-ac17-d473bc3c6c10\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit accounts with read permissions who are not MFA enabled on a subscription\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Multi-Factor Authentication (MFA) should be enabled for all subscription accounts with read privileges to prevent a breach of accounts or resources.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"EnableMFAForReadPermissions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/e3576e28-8b17-4677-84c3-db2990658d64\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"e3576e28-8b17-4677-84c3-db2990658d64\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Allowed locations\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"description\": \"This policy enables you to restrict the locations your organization can specify when deploying resources. Use to enforce your geo-compliance requirements. Excludes resource groups, Microsoft.AzureActiveDirectory/b2cDirectories, and resources that use the 'global' region.\",\r\n        \"metadata\": {\r\n          \"category\": \"General\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfAllowedLocations\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"description\": \"The list of locations that can be specified when deploying resources.\",\r\n              \"strongType\": \"location\",\r\n              \"displayName\": \"Allowed locations\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"location\",\r\n                \"notIn\": \"[parameters('listOfAllowedLocations')]\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"notEquals\": \"global\"\r\n              },\r\n              {\r\n                \"field\": \"type\",\r\n                \"notEquals\": \"Microsoft.AzureActiveDirectory/b2cDirectories\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/e56962a6-4747-49cd-b67b-bf8b01975c4c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"e56962a6-4747-49cd-b67b-bf8b01975c4c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Web Applications that are not using latest supported Node.js Framework\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Use the latest supported Node.js version for the latest security classes. Using older classes and types can make your application vulnerable.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"UseLatestNodeJS\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/e67687e8-08d5-4e7f-8226-5b4753bba008\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"e67687e8-08d5-4e7f-8226-5b4753bba008\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Allowed locations for resource groups\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy enables you to restrict the locations your organization can create resource groups in. Use to enforce your geo-compliance requirements.\",\r\n        \"metadata\": {\r\n          \"category\": \"General\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfAllowedLocations\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"description\": \"The list of locations that resource groups can be created in.\",\r\n              \"strongType\": \"location\",\r\n              \"displayName\": \"Allowed locations\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"location\",\r\n                \"notIn\": \"[parameters('listOfAllowedLocations')]\"\r\n              },\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Resources/subscriptions/resourceGroups\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/e765b5de-1225-4ba3-bd56-1ac6695af988\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"e765b5de-1225-4ba3-bd56-1ac6695af988\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Web Sockets state for a Web Application\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"The Web Sockets protocol is vulnerable to different types of security threats. Use of Web Sockets within a web application must be carefully reviewed.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"WebApp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"DisableWebSockets\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/e797f851-8be7-4c40-bb56-2e3395215b0e\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"e797f851-8be7-4c40-bb56-2e3395215b0e\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit remote debugging state for an API App\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Remote debugging requires inbound ports to be opened on an API app.  Remote debugging should be turned off.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"api\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"apiApp\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"DisableRemoteDebugging\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/e9c8d085-d9cc-4b17-9cdc-059f1f01f19e\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"e9c8d085-d9cc-4b17-9cdc-059f1f01f19e\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit deprecated accounts with owner permissions on a subscription\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Deprecated accounts with owner permissions should be removed from your subscription.  Deprecated accounts are accounts that have been blocked from signing in.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"RemoveDeprecatedAccountsWithOwnerPermissions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/ebb62a0c-3560-49e1-89ed-27e074e9f8ad\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"ebb62a0c-3560-49e1-89ed-27e074e9f8ad\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy VM extension to audit Linux VM allowing remote connections from accounts with no passwords\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Include this rule to deploy the VM extensions for Microsoft Guest Configuration and Microsoft Azure Managed Service Identity, and required content to check settings inside the virtual machine. For Linux servers this includes Chef Inspec, Ruby, and Python. This security setting verifies remote connections from accounts with empty passwords is disabled.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ]\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"14.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"16.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"equals\": \"16.04-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"18.04-LTS\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Suse\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"SLES\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"12-SP3\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"RHEL\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7-RAW\",\r\n                          \"7.4\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"credativ\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Debian\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"9\",\r\n                          \"8\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"CentOS\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7.5\",\r\n                          \"7.4\",\r\n                          \"7.3\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"name\": \"PasswordPolicy_msid110\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"PasswordPolicy_msid110\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-06-30-preview\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2017-03-30\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2015-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforLinux')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforLinux\",\r\n                          \"typeHandlerVersion\": \"1.0\",\r\n                          \"autoUpgradeMinorVersion\": true\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/ec49586f-4939-402d-a29e-6ff502b20592\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"ec49586f-4939-402d-a29e-6ff502b20592\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy VM extension to audit that an application is not installed inside Windows VMs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Include this rule to deploy the VM extension for Microsoft Guest Configuration, the VM extension for Microsoft Azure Managed Service Identity, and the content required to audit that an application is not installed inside Windows virtual machines. This policy should only be used along with its corresponding audit policy in an initiative/policy set. For more information on guest configuration policies, please visit http://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ]\r\n        },\r\n        \"parameters\": {\r\n          \"ApplicationName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Application name (supports wildcard)\",\r\n              \"description\": \"Application name. Example: 'Microsoft SQL Server 2014 (64-bit)' or 'Microsoft SQL Server 2014*' to match any application starting with 'Microsoft SQL Server 2014'.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"SQL2017-WS2016\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Enterprise\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"name\": \"NotInstalledApplication\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"NotInstalledApplication\"\r\n                    },\r\n                    \"ApplicationName\": {\r\n                      \"value\": \"[parameters('ApplicationName')]\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ApplicationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-06-30-preview\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\",\r\n                            \"configurationParameter\": [\r\n                              {\r\n                                \"name\": \"[InstalledApplication]NotInstalledApplicationResource1;Name\",\r\n                                \"value\": \"[Parameters('ApplicationName')]\"\r\n                              }\r\n                            ]\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2017-03-30\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2015-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforWindows')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforWindows\",\r\n                          \"typeHandlerVersion\": \"1.1\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {},\r\n                          \"protectedSettings\": {}\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/f0633351-c7b2-41ff-9981-508fc08553c2\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"f0633351-c7b2-41ff-9981-508fc08553c2\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Deploy VM extension to audit Linux VM passwd file permissions\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Include this rule to deploy the VM extensions for Microsoft Guest Configuration, Microsoft Azure Managed Service Identity, and required content to check settings inside the virtual machine. For Linux servers this includes Chef Inspec, Ruby, and Python. This security setting verifies /etc/passwd file permissions are set to 0644 to prevent unauthorized changes that could allow access to the server.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\",\r\n          \"requiredProviders\": [\r\n            \"Microsoft.GuestConfiguration\"\r\n          ]\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"14.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"16.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"equals\": \"16.04-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"18.04-LTS\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Suse\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"SLES\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"12-SP3\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"RHEL\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7-RAW\",\r\n                          \"7.4\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"credativ\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Debian\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"9\",\r\n                          \"8\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"CentOS\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7.5\",\r\n                          \"7.4\",\r\n                          \"7.3\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"name\": \"PasswordPolicy_msid121\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"configurationName\": {\r\n                      \"value\": \"PasswordPolicy_msid121\"\r\n                    }\r\n                  },\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"configurationName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-06-30-preview\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/providers/guestConfigurationAssignments\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/Microsoft.GuestConfiguration/', parameters('configurationName'))]\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"guestConfiguration\": {\r\n                            \"name\": \"[parameters('configurationName')]\",\r\n                            \"version\": \"1.*\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2017-03-30\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines\",\r\n                        \"identity\": {\r\n                          \"type\": \"SystemAssigned\"\r\n                        },\r\n                        \"name\": \"[parameters('vmName')]\",\r\n                        \"location\": \"[parameters('location')]\"\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2015-05-01-preview\",\r\n                        \"name\": \"[concat(parameters('vmName'), '/AzurePolicyforLinux')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.GuestConfiguration\",\r\n                          \"type\": \"ConfigurationforLinux\",\r\n                          \"typeHandlerVersion\": \"1.0\",\r\n                          \"autoUpgradeMinorVersion\": true\r\n                        },\r\n                        \"dependsOn\": [\r\n                          \"[concat('Microsoft.Compute/virtualMachines/',parameters('vmName'),'/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/',parameters('configurationName'))]\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/f19aa1c1-6b91-4c27-ae6a-970279f03db9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"f19aa1c1-6b91-4c27-ae6a-970279f03db9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Log Analytics Workspace for VM - Report Mismatch\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Reports VMs as non-compliant if they not logging to the LA workspace specified in the policy/initiative assignment.\",\r\n        \"metadata\": {\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {\r\n          \"logAnalyticsWorkspaceId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics Workspace Id that VMs should be configured for\",\r\n              \"description\": \"This is the Id (GUID) of the Log Analytics Workspace that the VMs should be configured for.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines/extensions\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/extensions/settings.workspaceId\",\r\n                \"notEquals\": \"[parameters('logAnalyticsWorkspaceId')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/f47b5582-33ec-4c5c-87c0-b010a6b2e917\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"f47b5582-33ec-4c5c-87c0-b010a6b2e917\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit existence of authorization rules on Event Hub entities\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Audit existence of authorization rules on Event Hub entities to grant least-privileged access\",\r\n        \"metadata\": {\r\n          \"category\": \"Event Hub\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.EventHub/namespaces/eventhubs\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.EventHub/namespaces/eventHubs/authorizationRules\"\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/f4826e5f-6a27-407c-ae3e-9582eb39891d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"f4826e5f-6a27-407c-ae3e-9582eb39891d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit Windows VM enforces password complexity requirements\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"If this policy is enabled, passwords must meet minimum requirements.  See documentation for full details at URL http://aka.ms/gcpol.\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                \"equals\": \"MicrosoftWindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                \"equals\": \"WindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                \"in\": [\r\n                  \"2012-Datacenter\",\r\n                  \"2012-Datacenter-smalldisk\",\r\n                  \"2012-R2-Datacenter\",\r\n                  \"2012-R2-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter\",\r\n                  \"2016-Datacenter-Server-Core\",\r\n                  \"2016-Datacenter-Server-Core-smalldisk\",\r\n                  \"2016-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter-with-Containers\",\r\n                  \"2016-Datacenter-with-RDSH\"\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"PasswordMustMeetComplexityRequirements\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/f48b2913-1dc5-4834-8c72-ccc1dfd819bb\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"f48b2913-1dc5-4834-8c72-ccc1dfd819bb\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Auditing on SQL servers\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy ensures that Auditing is enabled on SQL Servers for enhanced security and compliance. It will automatically create a storage account in the same region as the SQL server to store audit records.\",\r\n        \"metadata\": {\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {\r\n          \"retentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"description\": \"The value in days of the retention period (0 indicates unlimited retention)\",\r\n              \"displayName\": \"Retention days (optional, 180 days if unspecified)\"\r\n            },\r\n            \"defaultValue\": \"180\"\r\n          },\r\n          \"storageAccountsResourceGroup\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Resource group name for storage accounts\",\r\n              \"description\": \"Auditing writes database events to an audit log in your Azure Storage account (a storage account will be created in each region where a SQL Server is created that will be shared by all servers in that region). Important - for proper operation of Auditing do not delete or rename the resource group or the storage accounts.\",\r\n              \"strongType\": \"existingResourceGroups\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"DeployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/auditingSettings\",\r\n              \"name\": \"Default\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Sql/auditingSettings.state\",\r\n                \"equals\": \"Enabled\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/056cd41c-7e88-42e1-933e-88ba6a50c9c3\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/17d1049b-9a84-46fb-8f53-869881c3d3ab\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"serverName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"auditRetentionDays\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"storageAccountsResourceGroup\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"retentionDays\": \"[int(parameters('auditRetentionDays'))]\",\r\n                      \"subscriptionId\": \"[subscription().subscriptionId]\",\r\n                      \"uniqueStorage\": \"[uniqueString(variables('subscriptionId'), parameters('location'), parameters('storageAccountsResourceGroup'))]\",\r\n                      \"locationCode\": \"[substring(parameters('location'), 0, 3)]\",\r\n                      \"storageName\": \"[tolower(concat('sqlaudit', variables('locationCode'), variables('uniqueStorage')))]\",\r\n                      \"createStorageAccountDeploymentName\": \"[concat('sqlServerAuditingStorageAccount-', uniqueString(variables('locationCode'), parameters('serverName')))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2017-05-10\",\r\n                        \"name\": \"[variables('createStorageAccountDeploymentName')]\",\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"resourceGroup\": \"[parameters('storageAccountsResourceGroup')]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"parameters\": {\r\n                            \"location\": {\r\n                              \"value\": \"[parameters('location')]\"\r\n                            },\r\n                            \"storageName\": {\r\n                              \"value\": \"[variables('storageName')]\"\r\n                            }\r\n                          },\r\n                          \"templateLink\": {\r\n                            \"uri\": \"https://raw.githubusercontent.com/Azure/azure-policy/master/samples/SQL/deploy-sql-server-auditing/createStorage.template.json\",\r\n                            \"contentVersion\": \"1.0.0.0\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"name\": \"[concat(parameters('serverName'), '/Default')]\",\r\n                        \"type\": \"Microsoft.Sql/servers/auditingSettings\",\r\n                        \"apiVersion\": \"2017-03-01-preview\",\r\n                        \"properties\": {\r\n                          \"state\": \"Enabled\",\r\n                          \"storageEndpoint\": \"[reference(variables('createStorageAccountDeploymentName')).outputs.storageAccountEndPoint.value]\",\r\n                          \"storageAccountAccessKey\": \"[reference(variables('createStorageAccountDeploymentName')).outputs.storageAccountKey.value]\",\r\n                          \"retentionDays\": \"[variables('retentionDays')]\",\r\n                          \"auditActionsAndGroups\": null,\r\n                          \"storageAccountSubscriptionId\": \"[subscription().subscriptionId]\",\r\n                          \"isStorageSecondaryKeyInUse\": false\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"serverName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"auditRetentionDays\": {\r\n                      \"value\": \"[parameters('retentionDays')]\"\r\n                    },\r\n                    \"storageAccountsResourceGroup\": {\r\n                      \"value\": \"[parameters('storageAccountsResourceGroup')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/f4c68484-132f-41f9-9b6d-3e4b1cb55036\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"f4c68484-132f-41f9-9b6d-3e4b1cb55036\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit external accounts with owner permissions on a subscription\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"External accounts with owner permissions should be removed from your subscription in order to prevent unmonitored access.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"RemoveExternalAccountsWithOwnerPermissions\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/f8456c1c-aa66-4dfb-861a-25d127b775c9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"f8456c1c-aa66-4dfb-861a-25d127b775c9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit enabling of diagnostic logs in Service Bus\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit enabling of logs and retain them up to a year. This enables you to recreate activity trails for investigation purposes when a security incident occurs or your network is compromised\",\r\n        \"metadata\": {\r\n          \"category\": \"Service Bus\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"requiredRetentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Required retention (days)\",\r\n              \"description\": \"The required diagnostic logs retention in days\"\r\n            },\r\n            \"defaultValue\": \"365\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.ServiceBus/namespaces\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                    \"equals\": \"[parameters('requiredRetentionDays')]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/f8d36e2f-389b-4ee4-898d-21aeb69a0f45\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"f8d36e2f-389b-4ee4-898d-21aeb69a0f45\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit enabling of diagnostic logs in Azure Stream Analytics\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Audit enabling of logs and retain them up to a year. This enables you to recreate activity trails for investigation purposes when a security incident occurs or your network is compromised\",\r\n        \"metadata\": {\r\n          \"category\": \"Stream Analytics\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"requiredRetentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Required retention (days)\",\r\n              \"description\": \"The required diagnostic logs retention in days\"\r\n            },\r\n            \"defaultValue\": \"365\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.StreamAnalytics/streamingJobs\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.enabled\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs[*].retentionPolicy.days\",\r\n                    \"equals\": \"[parameters('requiredRetentionDays')]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/f9be5368-9bf5-4b84-9e0a-7850da98bb46\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"f9be5368-9bf5-4b84-9e0a-7850da98bb46\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Audit that an application is installed inside Linux VMs\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"This policy audits that the specified application is installed inside Linux virtual machines. This policy should only be used along with its corresponding deploy policy in an initiative/policy set. For more information on guest configuration policies, please visit http://aka.ms/gcpol\",\r\n        \"metadata\": {\r\n          \"category\": \"Guest Configuration\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Canonical\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"UbuntuServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"14.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"16.04.#-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"equals\": \"16.04-LTS\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageSKU\",\r\n                            \"match\": \"18.04-LTS\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"Suse\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"SLES\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"12-SP3\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"RedHat\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"RHEL\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7-RAW\",\r\n                          \"7.4\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"credativ\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Debian\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"9\",\r\n                          \"8\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"OpenLogic\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"CentOS\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"7.5\",\r\n                          \"7.4\",\r\n                          \"7.3\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments\",\r\n              \"name\": \"installed_application_linux\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.GuestConfiguration/guestConfigurationAssignments/complianceStatus\",\r\n                \"equals\": \"Compliant\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/fee5cb2b-9d9b-410e-afe3-2902d90d0004\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"fee5cb2b-9d9b-410e-afe3-2902d90d0004\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[Preview]: Monitor SQL vulnerability assessment results in Azure Security Center\",\r\n        \"policyType\": \"BuiltIn\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Monitor Vulnerability Assessment scan results and recommendations for how to remediate database vulnerabilities.\",\r\n        \"metadata\": {\r\n          \"category\": \"Security Center\",\r\n          \"preview\": true\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"Microsoft.Sql/servers/databases\",\r\n              \"Microsoft.Sql/managedinstances/databases\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Security/complianceResults\",\r\n              \"name\": \"sqlVulnerabilityAssessment\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Security/complianceResults/resourceStatus\",\r\n                \"equals\": \"Monitored\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/providers/Microsoft.Authorization/policyDefinitions/feedbf84-6b99-488c-acc2-71c829aa5ffc\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"feedbf84-6b99-488c-acc2-71c829aa5ffc\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"storage_httpsTrafficOnly\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"Demo\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Storage/storageAccounts/supportsHttpsTrafficOnly\",\r\n                  \"equals\": \"True\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/023217dd-81bb-461f-93ea-8799caac50c7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"023217dd-81bb-461f-93ea-8799caac50c7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"This shouldn't work\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This customer's policy is attempting to append multiple tags at once. I expect it will just append one tag with a really long name\",\r\n        \"metadata\": {\r\n          \"category\": \"camarvin\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"tags['CostCenter','Department','ContactPerson','Environment','DataClassification']\",\r\n            \"exists\": \"false\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"tags['CostCenter','Department','ContactPerson','Environment','DataClassification']\",\r\n                \"value\": [\r\n                  \"\",\r\n                  \"\",\r\n                  \"\",\r\n                  \"\",\r\n                  \"\"\r\n                ]\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/04183864-11ae-4e7a-aadb-c600e40ed1b9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"04183864-11ae-4e7a-aadb-c600e40ed1b9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Inherit named tag from resource group\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"indexed\",\r\n        \"description\": \"Applies the tag value from the resource group if it is not specified by the user. Does not apply to resource groups.\",\r\n        \"metadata\": {\r\n          \"category\": \"General\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n            \"exists\": \"false\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                \"value\": \"[resourcegroup().tags[parameters('tagName')]]\"\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/04904947-4d10-4454-9a50-f423d590e11b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"04904947-4d10-4454-9a50-f423d590e11b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"robga-nsgtemplate-test\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/networkSecurityGroups\"\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules[*].access\",\r\n                    \"equals\": \"Allow\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules[*].direction\",\r\n                    \"equals\": \"Inbound\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules[*].destinationPortRange\",\r\n                        \"equals\": \"3389\"\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules[*].destinationPortRanges[*]\",\r\n                          \"notEquals\": \"3389\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules[*].sourceAddressPrefix\",\r\n                        \"in\": [\r\n                          \"*\",\r\n                          \"Internet\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules[*].sourceAddressPrefixes[*]\",\r\n                          \"notIn\": [\r\n                            \"*\",\r\n                            \"Internet\"\r\n                          ]\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/0ddfee46-9b63-4313-a529-cfbf968d8118\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0ddfee46-9b63-4313-a529-cfbf968d8118\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"akif incident - 85944710\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"reproing incident 85944710\\nhttps://icm.ad.msft.net/imp/v3/incidents/details/85944710/home\\n\",\r\n        \"metadata\": {\r\n          \"category\": \"akhe\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfAllowedLocations\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed locations\",\r\n              \"description\": \"The list of allowed locations for resources.\",\r\n              \"strongType\": \"location\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DocumentDB/databaseAccounts\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/readLocations[*].locationName\",\r\n                    \"notIn\": \"[parameters('listOfAllowedLocations')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/writeLocations[*].locationName\",\r\n                    \"notIn\": \"[parameters('listOfAllowedLocations')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.DocumentDB/databaseAccounts/failoverPolicies[*].locationName\",\r\n                    \"notIn\": \"[parameters('listOfAllowedLocations')]\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/0e0d567a-6089-46fc-b12c-ca5af12870bd\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0e0d567a-6089-46fc-b12c-ca5af12870bd\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"akhe-incident-86226837-v2\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"second attempt to repro this incident. \",\r\n        \"metadata\": {\r\n          \"category\": \"akhe\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/firewallRules\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/servers/firewallRules/startIpAddress\",\r\n                    \"equals\": \"0.0.0.0\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Sql/servers/firewallRules/endIpAddress\",\r\n                    \"equals\": \"0.0.0.0\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/0e0d567a-6089-46fc-b12c-ca5af1287abe\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"0e0d567a-6089-46fc-b12c-ca5af1287abe\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"testSandipsh metric alert policy\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"test\",\r\n        \"metadata\": {\r\n          \"category\": \"testSandipsh\"\r\n        },\r\n        \"parameters\": {\r\n          \"resourceType\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Resource Type\",\r\n              \"description\": \"The target resource type.\"\r\n            }\r\n          },\r\n          \"alertNamePrefix\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Alert name prefix\",\r\n              \"description\": \"A prefix to be used for the metrics alert.\"\r\n            }\r\n          },\r\n          \"alertDescription\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Alert description.\",\r\n              \"description\": \"The description of alert.\"\r\n            }\r\n          },\r\n          \"alertSeverity\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"alertSeverity\",\r\n              \"description\": \"Severity of alert {0,1,2,3,4}\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"0\",\r\n              \"1\",\r\n              \"2\",\r\n              \"3\",\r\n              \"4\"\r\n            ]\r\n          },\r\n          \"isEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"isEnabled\",\r\n              \"description\": \"Specifies whether the alert is enabled.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ]\r\n          },\r\n          \"metricName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Metric name\",\r\n              \"description\": \"The metric name.\"\r\n            }\r\n          },\r\n          \"operator\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Operator\",\r\n              \"description\": \"The operator comparing the current value with the threshold value.\"\r\n            }\r\n          },\r\n          \"threshold\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Threshold\",\r\n              \"description\": \"The threshold value at which the alert is activated.\"\r\n            }\r\n          },\r\n          \"timeAggregation\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"TimeAggregation\",\r\n              \"description\": \"How the data that is collected should be combined over time.\"\r\n            }\r\n          },\r\n          \"windowSize\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Window size\",\r\n              \"description\": \"Period of time used to monitor alert activity based on the threshold. Must be between five minutes and one day. ISO 8601 duration format.\"\r\n            }\r\n          },\r\n          \"evaluationFrequency\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Evaluation Frequency\",\r\n              \"description\": \"How often the metric alert is evaluated represented in ISO 8601 duration format\"\r\n            }\r\n          },\r\n          \"actionGroupId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"ActionGroupId\",\r\n              \"description\": \"The ID of the action group that is triggered when the alert is activated or deactivated\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"[parameters('resourceType')]\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"DeployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/metricAlerts\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"name\",\r\n                \"equals\": \"[concat(parameters('alertNamePrefix'), '-', resourcegroup().name, '-', field('name'))]\"\r\n              },\r\n              \"existenceScope\": \"subscription\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"alertNamePrefix\": {\r\n                        \"type\": \"string\",\r\n                        \"minLength\": 1,\r\n                        \"metadata\": {\r\n                          \"description\": \"A prefix to be used for the metrics alert.\"\r\n                        }\r\n                      },\r\n                      \"alertDescription\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"This is a metric alert\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Description of alert\"\r\n                        }\r\n                      },\r\n                      \"alertSeverity\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"3\",\r\n                        \"allowedValues\": [\r\n                          \"0\",\r\n                          \"1\",\r\n                          \"2\",\r\n                          \"3\",\r\n                          \"4\"\r\n                        ],\r\n                        \"metadata\": {\r\n                          \"description\": \"Severity of alert {0,1,2,3,4}\"\r\n                        }\r\n                      },\r\n                      \"isEnabled\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"true\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Specifies whether the alert is enabled\"\r\n                        }\r\n                      },\r\n                      \"metricName\": {\r\n                        \"type\": \"string\",\r\n                        \"minLength\": 1,\r\n                        \"metadata\": {\r\n                          \"description\": \"Name of the metric used in the comparison to activate the alert.\"\r\n                        }\r\n                      },\r\n                      \"operator\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"GreaterThan\",\r\n                        \"allowedValues\": [\r\n                          \"Equals\",\r\n                          \"NotEquals\",\r\n                          \"GreaterThan\",\r\n                          \"GreaterThanOrEqual\",\r\n                          \"LessThan\",\r\n                          \"LessThanOrEqual\"\r\n                        ],\r\n                        \"metadata\": {\r\n                          \"description\": \"Operator comparing the current value with the threshold value.\"\r\n                        }\r\n                      },\r\n                      \"threshold\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"0\",\r\n                        \"metadata\": {\r\n                          \"description\": \"The threshold value at which the alert is activated.\"\r\n                        }\r\n                      },\r\n                      \"timeAggregation\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"Average\",\r\n                        \"allowedValues\": [\r\n                          \"Average\",\r\n                          \"Minimum\",\r\n                          \"Maximum\",\r\n                          \"Total\"\r\n                        ],\r\n                        \"metadata\": {\r\n                          \"description\": \"How the data that is collected should be combined over time.\"\r\n                        }\r\n                      },\r\n                      \"windowSize\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"PT5M\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Period of time used to monitor alert activity based on the threshold. Must be between five minutes and one day. ISO 8601 duration format.\"\r\n                        }\r\n                      },\r\n                      \"evaluationFrequency\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"PT1M\",\r\n                        \"metadata\": {\r\n                          \"description\": \"how often the metric alert is evaluated represented in ISO 8601 duration format\"\r\n                        }\r\n                      },\r\n                      \"actionGroupId\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"\",\r\n                        \"metadata\": {\r\n                          \"description\": \"The ID of the action group that is triggered when the alert is activated or deactivated\"\r\n                        }\r\n                      },\r\n                      \"resourceType\": {\r\n                        \"type\": \"string\",\r\n                        \"metadata\": {\r\n                          \"description\": \"The resource type of target resource.\"\r\n                        }\r\n                      },\r\n                      \"targetResourceName\": {\r\n                        \"type\": \"string\",\r\n                        \"metadata\": {\r\n                          \"description\": \"The target resource name.\"\r\n                        }\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"targetResourceType\": \"[parameters('resourceType')]\",\r\n                      \"resourceIdentifier\": \"[resourceId(variables('targetResourceType'), parameters('targetResourceName'))]\",\r\n                      \"alertName\": \"[concat(parameters('alertNamePrefix'), '-', resourcegroup().name, '-',  parameters('targetResourceName'))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[variables('alertName')]\",\r\n                        \"type\": \"Microsoft.Insights/metricAlerts\",\r\n                        \"location\": \"global\",\r\n                        \"apiVersion\": \"2018-03-01\",\r\n                        \"tags\": {},\r\n                        \"properties\": {\r\n                          \"description\": \"[parameters('alertDescription')]\",\r\n                          \"severity\": \"[parameters('alertSeverity')]\",\r\n                          \"enabled\": \"[parameters('isEnabled')]\",\r\n                          \"scopes\": [\r\n                            \"[variables('resourceIdentifier')]\"\r\n                          ],\r\n                          \"evaluationFrequency\": \"[parameters('evaluationFrequency')]\",\r\n                          \"windowSize\": \"[parameters('windowSize')]\",\r\n                          \"criteria\": {\r\n                            \"odata.type\": \"Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria\",\r\n                            \"allOf\": [\r\n                              {\r\n                                \"name\": \"1st criterion\",\r\n                                \"metricName\": \"[parameters('metricName')]\",\r\n                                \"dimensions\": [],\r\n                                \"operator\": \"[parameters('operator')]\",\r\n                                \"threshold\": \"[parameters('threshold')]\",\r\n                                \"timeAggregation\": \"[parameters('timeAggregation')]\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          \"actions\": [\r\n                            {\r\n                              \"actionGroupId\": \"[parameters('actionGroupId')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"alertNamePrefix\": {\r\n                      \"value\": \"[parameters('alertNamePrefix')]\"\r\n                    },\r\n                    \"alertDescription\": {\r\n                      \"value\": \"[parameters('alertDescription')]\"\r\n                    },\r\n                    \"alertSeverity\": {\r\n                      \"value\": \"[parameters('alertSeverity')]\"\r\n                    },\r\n                    \"isEnabled\": {\r\n                      \"value\": \"[parameters('isEnabled')]\"\r\n                    },\r\n                    \"metricName\": {\r\n                      \"value\": \"[parameters('metricName')]\"\r\n                    },\r\n                    \"operator\": {\r\n                      \"value\": \"[parameters('operator')]\"\r\n                    },\r\n                    \"threshold\": {\r\n                      \"value\": \"[parameters('threshold')]\"\r\n                    },\r\n                    \"timeAggregation\": {\r\n                      \"value\": \"[parameters('timeAggregation')]\"\r\n                    },\r\n                    \"windowSize\": {\r\n                      \"value\": \"[parameters('windowSize')]\"\r\n                    },\r\n                    \"evaluationFrequency\": {\r\n                      \"value\": \"[parameters('evaluationFrequency')]\"\r\n                    },\r\n                    \"actionGroupId\": {\r\n                      \"value\": \"[parameters('actionGroupId')]\"\r\n                    },\r\n                    \"resourceType\": {\r\n                      \"value\": \"[parameters('resourceType')]\"\r\n                    },\r\n                    \"targetResourceName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/123c6354-fc96-4f54-984e-8d49d06a80a3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"123c6354-fc96-4f54-984e-8d49d06a80a3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"jilim nsg repro\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"fix\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Network/networkSecurityGroups\"\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules[*].sourceAddressPrefix\",\r\n                      \"notEquals\": \"*\"\r\n                    }\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Network/networkSecurityGroups/securityRules\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefix\",\r\n                    \"equals\": \"*\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/14ac45e9-df97-455d-b6ee-dd216f15f694\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"14ac45e9-df97-455d-b6ee-dd216f15f694\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"jilim-incident-86226837-fix\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"1 - reproing the incident: https://icm.ad.msft.net/imp/v3/incidents/details/86226837/home\",\r\n        \"metadata\": {\r\n          \"category\": \"akhe\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers/firewallRules\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Sql/servers/firewallRules/startIpAddress\",\r\n                \"equals\": \"0.0.0.0\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Sql/servers/firewallRules/endIpAddress\",\r\n                \"equals\": \"0.0.0.0\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/15358dd8-671e-4c96-be33-2b668791418f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"15358dd8-671e-4c96-be33-2b668791418f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Attempt service bus\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"camarvin\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Insights/logProfiles\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/logProfiles/serviceBusRuleId\",\r\n                    \"exists\": \"false\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/163c640e-681c-445f-92ba-cd434bd8c11c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"163c640e-681c-445f-92ba-cd434bd8c11c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"jilim exists2\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"tags.zyx\",\r\n              \"exists\": \"false\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/17d43473-870f-4bc8-93c6-3961fa1d91cc\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"17d43473-870f-4bc8-93c6-3961fa1d91cc\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"inherit all tags\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"tags\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"tags\",\r\n            \"exists\": \"false\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"tags\",\r\n                \"value\": \"[resourceGroup().tags]\"\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/1e3c9312-c011-40a3-ac40-3bf3ddc24120\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1e3c9312-c011-40a3-ac40-3bf3ddc24120\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Allowed resource group locations\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Allowed resource group locations\",\r\n        \"parameters\": {\r\n          \"allowedLocations\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed locations\",\r\n              \"description\": \"The list of allowed locations for resources.\",\r\n              \"strongType\": \"location\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Resources/subscriptions/resourceGroups\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"location\",\r\n                  \"in\": \"[parameters('allowedLocations')]\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/1f20036f-28c3-48f3-9266-05d50fe391f4\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1f20036f-28c3-48f3-9266-05d50fe391f4\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"docdb_aliases_test\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DocumentDB/databaseAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DocumentDB/databaseAccounts/isVirtualNetworkFilterEnabled\",\r\n                \"equals\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/1f5360b7-fe59-43f7-8af5-825df420d09c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"1f5360b7-fe59-43f7-8af5-825df420d09c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy security rule with restricted source IPs\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Ovewrites security rules with IP restrictions at the securityRule level\",\r\n        \"metadata\": {\r\n          \"category\": \"Port Lockdown\"\r\n        },\r\n        \"parameters\": {\r\n          \"destinationPortRanges\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Destination port ranges\",\r\n              \"description\": \"Destination port ranges requiring IP restrictions. Limit to one protocol. The most inclusive should come last. I.e. 22;22-22;22-23\"\r\n            }\r\n          },\r\n          \"sourceAddressPrefixes\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"IP restriction prefixes\",\r\n              \"description\": \"The IP ranges incoming traffic will be restricted to. I.e. 192.4.0.0/8;192.5.0.0/8\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/networkSecurityGroups/securityRules\"\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRange\",\r\n                        \"in\": \"[parameters('destinationPortRanges')]\"\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRanges[*]\",\r\n                          \"notIn\": \"[parameters('destinationPortRanges')]\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/access\",\r\n                    \"equals\": \"Allow\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/direction\",\r\n                    \"equals\": \"Inbound\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefixes[*]\",\r\n                            \"exists\": \"true\"\r\n                          },\r\n                          {\r\n                            \"not\": {\r\n                              \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefixes[*]\",\r\n                              \"notLike\": \"*\"\r\n                            }\r\n                          },\r\n                          {\r\n                            \"not\": {\r\n                              \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefixes[*]\",\r\n                              \"notIn\": [\r\n                                \"*\",\r\n                                \"Internet\"\r\n                              ]\r\n                            }\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefixes[*]\",\r\n                            \"notEquals\": \"VirtualNetwork\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefix\",\r\n                            \"exists\": \"true\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefix\",\r\n                            \"notEquals\": \"\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefix\",\r\n                            \"in\": [\r\n                              \"*\",\r\n                              \"Internet\"\r\n                            ]\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefix\",\r\n                            \"notEquals\": \"VirtualNetwork\"\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefixes[*]\",\r\n                            \"equals\": \"\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefix\",\r\n                            \"equals\": \"\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Authorization/policyAssignments\",\r\n              \"name\": \"DoesNotExist101\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"fullRuleName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"sourceAddressPrefixes\": {\r\n                        \"type\": \"array\"\r\n                      },\r\n                      \"destinationPortRanges\": {\r\n                        \"type\": \"array\"\r\n                      },\r\n                      \"priority\": {\r\n                        \"type\": \"int\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[parameters('fullRuleName')]\",\r\n                        \"type\": \"Microsoft.Network/networkSecurityGroups/securityRules\",\r\n                        \"apiVersion\": \"2018-02-01\",\r\n                        \"properties\": {\r\n                          \"protocol\": \"*\",\r\n                          \"sourceAddressPrefixes\": \"[parameters('sourceAddressPrefixes')]\",\r\n                          \"destinationAddressPrefix\": \"*\",\r\n                          \"sourcePortRange\": \"*\",\r\n                          \"destinationPortRange\": \"[last(parameters('destinationPortRanges'))]\",\r\n                          \"access\": \"Allow\",\r\n                          \"direction\": \"Inbound\",\r\n                          \"priority\": \"[parameters('priority')]\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"fullRuleName\": {\r\n                      \"value\": \"[field('fullName')]\"\r\n                    },\r\n                    \"sourceAddressPrefixes\": {\r\n                      \"value\": \"[parameters('sourceAddressPrefixes')]\"\r\n                    },\r\n                    \"destinationPortRanges\": {\r\n                      \"value\": \"[parameters('destinationPortRanges')]\"\r\n                    },\r\n                    \"priority\": {\r\n                      \"value\": \"[field('Microsoft.Network/networksecurityGroups/securityRules/priority')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/20c4afd0-8a77-4433-b8b0-4ad06e4c7111\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"20c4afd0-8a77-4433-b8b0-4ad06e4c7111\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy NSGs on Subnets\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Enforce that all subnets have a Network Security Group.  If a subnet does not have one an NSG with the default Internet Exposed Endpoint restrictions will be created and associated with it.\",\r\n        \"metadata\": {\r\n          \"category\": \"Port Lockdown\"\r\n        },\r\n        \"parameters\": {\r\n          \"nsgPrefix\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"NSG name prefix\",\r\n              \"description\": \"The prefix string to apply to all automatically created network security groups.\"\r\n            }\r\n          },\r\n          \"sourceAddressPrefixes\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"IP restriction prefixes\",\r\n              \"description\": \"The IP ranges incoming traffic will be restricted to. I.e. 192.4.0.0/8;192.5.0.0/8\"\r\n            }\r\n          },\r\n          \"destinationPortRanges\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Destination port ranges\",\r\n              \"description\": \"Destination port ranges requiring IP restrictions. Ranges must not overlap.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Network/virtualNetworks/subnets\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Network/virtualNetworks/subnets/networkSecurityGroup.id\",\r\n                        \"exists\": \"false\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Network/virtualNetworks/subnets/networkSecurityGroup.id\",\r\n                        \"equals\": \"\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Network/virtualNetworks\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Network/virtualNetworks/subnets[*].networkSecurityGroup.id\",\r\n                        \"exists\": \"false\"\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.Network/virtualNetworks/subnets[*].networkSecurityGroup.id\",\r\n                          \"notEquals\": \"null\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Authorization/policyAssignments\",\r\n              \"name\": \"DoesNotExist101\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"fullResourceName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"resourceName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"nsgPrefix\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"sourceAddressPrefixes\": {\r\n                        \"type\": \"array\"\r\n                      },\r\n                      \"destinationPortRanges\": {\r\n                        \"type\": \"array\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"nsgName\": \"[concat(parameters('nsgPrefix'), '-', parameters('location'))]\",\r\n                      \"vnetName\": \"[split(parameters('fullResourceName'), '/')[0]]\",\r\n                      \"vnetResourceId\": \"[resourceId('Microsoft.Network/virtualNetworks', variables('vnetName'))]\",\r\n                      \"getVnetDeploymentName\": \"[concat('getVnet-', variables('vnetName'))]\",\r\n                      \"collectSubnetsDeploymentName\": \"[concat('collectSubnets-', variables('vnetName'))]\",\r\n                      \"overwriteVnetDeploymentName\": \"[concat('overwriteVnet-', variables('vnetName'))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-02-01\",\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('getVnetDeploymentName')]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"template\": {\r\n                            \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"resources\": [],\r\n                            \"outputs\": {\r\n                              \"vnetProperties\": {\r\n                                \"type\": \"object\",\r\n                                \"value\": \"[reference(variables('vnetResourceId'), '2018-03-01', 'Full')]\"\r\n                              }\r\n                            }\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"name\": \"[variables('nsgName')]\",\r\n                        \"type\": \"Microsoft.Network/networkSecurityGroups\",\r\n                        \"apiVersion\": \"2018-03-01\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"securityRules\": [\r\n                            {\r\n                              \"name\": \"PortLockdown_ControlledPorts_Restrict\",\r\n                              \"properties\": {\r\n                                \"description\": \"Allow controlled port connections from specific IP ranges (either corpnet or SAW)\",\r\n                                \"protocol\": \"*\",\r\n                                \"sourcePortRange\": \"*\",\r\n                                \"destinationPortRange\": \"\",\r\n                                \"destinationPortRanges\": \"[parameters('destinationPortRanges')]\",\r\n                                \"sourceAddressPrefix\": \"\",\r\n                                \"sourceAddressPrefixes\": \"[parameters('sourceAddressPrefixes')]\",\r\n                                \"destinationAddressPrefix\": \"*\",\r\n                                \"access\": \"Allow\",\r\n                                \"priority\": 3997,\r\n                                \"direction\": \"Inbound\"\r\n                              }\r\n                            },\r\n                            {\r\n                              \"name\": \"PortLockdown_ControlledPorts_AllowVnet\",\r\n                              \"properties\": {\r\n                                \"description\": \"Allow controlled port connections from within the VNET\",\r\n                                \"protocol\": \"*\",\r\n                                \"sourcePortRange\": \"*\",\r\n                                \"destinationPortRange\": \"\",\r\n                                \"destinationPortRanges\": \"[parameters('destinationPortRanges')]\",\r\n                                \"sourceAddressPrefix\": \"VirtualNetwork\",\r\n                                \"destinationAddressPrefix\": \"*\",\r\n                                \"access\": \"Allow\",\r\n                                \"priority\": 3998,\r\n                                \"direction\": \"Inbound\"\r\n                              }\r\n                            },\r\n                            {\r\n                              \"name\": \"PortLockdown_ControlledPorts_Deny\",\r\n                              \"properties\": {\r\n                                \"description\": \"Deny any controlled port connections that aren't explicitly allowed in higher priority rules\",\r\n                                \"protocol\": \"*\",\r\n                                \"sourcePortRange\": \"*\",\r\n                                \"destinationPortRange\": \"\",\r\n                                \"destinationPortRanges\": \"[parameters('destinationPortRanges')]\",\r\n                                \"sourceAddressPrefix\": \"*\",\r\n                                \"destinationAddressPrefix\": \"*\",\r\n                                \"access\": \"Deny\",\r\n                                \"priority\": 3999,\r\n                                \"direction\": \"Inbound\"\r\n                              }\r\n                            },\r\n                            {\r\n                              \"name\": \"PortLockdown_AllowAll\",\r\n                              \"properties\": {\r\n                                \"description\": \"Allow all inbound traffic that isn't explicitly blocked by Port Lockdown restrictions\",\r\n                                \"protocol\": \"*\",\r\n                                \"sourcePortRange\": \"*\",\r\n                                \"destinationPortRange\": \"*\",\r\n                                \"sourceAddressPrefix\": \"*\",\r\n                                \"destinationAddressPrefix\": \"*\",\r\n                                \"access\": \"Allow\",\r\n                                \"priority\": 4000,\r\n                                \"direction\": \"Inbound\"\r\n                              }\r\n                            }\r\n                          ]\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2018-02-01\",\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('collectSubnetsDeploymentName')]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"templateLink\": {\r\n                            \"uri\": \"https://portlockdown.blob.core.windows.net/portlockdown-templates/Subnet_OverwriteWithNsg_collectSubnets_template.json\",\r\n                            \"contentVersion\": \"1.0.0.0\"\r\n                          },\r\n                          \"parameters\": {\r\n                            \"vnetProperties\": {\r\n                              \"value\": \"[reference(variables('getVnetDeploymentName')).outputs.vnetProperties.value]\"\r\n                            },\r\n                            \"nsgResourceId\": {\r\n                              \"value\": \"[resourceid('Microsoft.Network/networkSecurityGroups', variables('nsgName'))]\"\r\n                            },\r\n                            \"vnetName\": {\r\n                              \"value\": \"[variables('vnetName')]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"dependsOn\": [\r\n                          \"[variables('nsgName')]\"\r\n                        ],\r\n                        \"apiVersion\": \"2018-02-01\",\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('overwriteVnetDeploymentName')]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"templateLink\": {\r\n                            \"uri\": \"https://portlockdown.blob.core.windows.net/portlockdown-templates/Subnet_OverwriteWithNsg_overwriteVnet_template.json\",\r\n                            \"contentVersion\": \"1.0.0.0\"\r\n                          },\r\n                          \"parameters\": {\r\n                            \"vnetProperties\": {\r\n                              \"value\": \"[reference(variables('getVnetDeploymentName')).outputs.vnetProperties.value]\"\r\n                            },\r\n                            \"location\": {\r\n                              \"value\": \"[parameters('location')]\"\r\n                            },\r\n                            \"updatedSubnets\": {\r\n                              \"value\": \"[reference(variables('collectSubnetsDeploymentName')).outputs.updatedSubnets.value]\"\r\n                            },\r\n                            \"vnetName\": {\r\n                              \"value\": \"[variables('vnetName')]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"fullResourceName\": {\r\n                      \"value\": \"[field('fullName')]\"\r\n                    },\r\n                    \"resourceName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"nsgPrefix\": {\r\n                      \"value\": \"[parameters('nsgPrefix')]\"\r\n                    },\r\n                    \"sourceAddressPrefixes\": {\r\n                      \"value\": \"[parameters('sourceAddressPrefixes')]\"\r\n                    },\r\n                    \"destinationPortRanges\": {\r\n                      \"value\": \"[parameters('destinationPortRanges')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/210ed8bd-6b07-4d5e-a62c-c34f07293288\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"210ed8bd-6b07-4d5e-a62c-c34f07293288\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit all Microsoft.Web/sites/config/authsettings\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites/config\"\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"equals\": \"authsettings\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/211a466d-b2be-46e8-b029-8c28f566f118\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"211a466d-b2be-46e8-b029-8c28f566f118\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit existence of a tag2\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Audits that a required tag is present on resources\",\r\n        \"metadata\": {},\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": null\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"tags\",\r\n            \"notcontainsKey\": \"[parameters('tagName')]\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/24813039-7534-408a-9842-eb99f45721b1\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"24813039-7534-408a-9842-eb99f45721b1\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Append single location\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {\r\n          \"category\": \"camarvin\"\r\n        },\r\n        \"parameters\": {\r\n          \"allowedLocation\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed locations\",\r\n              \"description\": \"The list of allowed locations for resources.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"equals\": \"[parameters('allowedLocation')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"tags.locationTest\",\r\n                \"value\": \"[parameters('allowedLocation')]\"\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/25e0ce73-3c96-46fd-9f4d-b83b99ec11bf\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"25e0ce73-3c96-46fd-9f4d-b83b99ec11bf\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"camarvin oms vm linux parameterized effect\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {},\r\n        \"parameters\": {\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Select Log Analytics workspace from dropdown list\",\r\n              \"strongType\": \"omsWorkspace\"\r\n            }\r\n          },\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Select Log Analytics workspace from dropdown list\",\r\n              \"strongType\": \"omsWorkspace\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"deployIfNotExists\",\r\n              \"disabled\"\r\n            ],\r\n            \"defaultValue\": \"deployIfNotExists\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                \"equals\": \"Canonical\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"OmsAgentForLinux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('vmName'),'/omsPolicy')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"apiVersion\": \"2017-12-01\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.EnterpriseCloud.Monitoring\",\r\n                          \"type\": \"OmsAgentForLinux\",\r\n                          \"typeHandlerVersion\": \"1.4\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"workspaceId\": \"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\"\r\n                          },\r\n                          \"protectedSettings\": {\r\n                            \"workspaceKey\": \"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"\r\n                          }\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled monitoring for Linux VM', ': ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/263f13f4-6b88-4788-bead-34beedde70ce\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"263f13f4-6b88-4788-bead-34beedde70ce\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"test guest assignment\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/28e54a72-2fd7-40d3-afe2-b05423e0147a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"28e54a72-2fd7-40d3-afe2-b05423e0147a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"akhe-incident-85944710-v2\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"2nd attempt on this policy. \",\r\n        \"metadata\": {\r\n          \"category\": \"akhe\"\r\n        },\r\n        \"parameters\": {\r\n          \"allowedLocations\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed locations\",\r\n              \"description\": \"The list of allowed locations for resources.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DocumentDB/databaseAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DocumentDB/databaseAccounts/Locations[*].locationName\",\r\n                \"notIn\": \"[parameters('allowedLocations')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/290b38e4-eff9-434b-b4d3-3ddd60841400\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"290b38e4-eff9-434b-b4d3-3ddd60841400\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"akhe-incident-85944710-combined\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"the combined policy attempt for both cosmos db cases. \",\r\n        \"metadata\": {},\r\n        \"parameters\": {\r\n          \"locationNames\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed locations\",\r\n              \"description\": \"The list of allowed locations for resources.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DocumentDB/databaseAccounts\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.DocumentDB/databaseAccounts/Locations[*].locationName\",\r\n                        \"exists\": \"true\"\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.DocumentDB/databaseAccounts/Locations[*].locationName\",\r\n                          \"In\": \"[parameters('locationNames')]\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.DocumentDB/databaseAccounts/readLocations[*].locationName\",\r\n                        \"exists\": \"true\"\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.DocumentDB/databaseAccounts/readLocations[*].locationName\",\r\n                          \"In\": \"[parameters('locationNames')]\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.DocumentDB/databaseAccounts/writeLocations[*].locationName\",\r\n                        \"exists\": \"true\"\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.DocumentDB/databaseAccounts/writeLocations[*].locationName\",\r\n                          \"In\": \"[parameters('locationNames')]\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.DocumentDB/databaseAccounts/failoverPolicies[*].locationName\",\r\n                        \"exists\": \"true\"\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.DocumentDB/databaseAccounts/failoverPolicies[*].locationName\",\r\n                          \"In\": \"[parameters('locationNames')]\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/290b38e4-eff9-434b-b4d3-3ddd6084180f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"290b38e4-eff9-434b-b4d3-3ddd6084180f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"storage ip rules append 2\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"Microsoft.Storage/storageAccounts/networkAcls.ipRules\",\r\n                \"value\": [\r\n                  {\r\n                    \"value\": \"8.8.8.8\",\r\n                    \"action\": \"Allow\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/2b2317a7-ab02-47b5-8159-eb7e6227709f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"2b2317a7-ab02-47b5-8159-eb7e6227709f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[demo] Enforce KeyVault diagnostic log storage\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"Ensures that AuditEvents are collected from all Key Vaults in the subscription and stored in a specific storage account for 30 days.\",\r\n        \"metadata\": {\r\n          \"category\": \"Key Vault\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.KeyVault/vaults\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                \"equals\": \"true\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\r\n                \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/roleDefinitions/17d1049b-9a84-46fb-8f53-869881c3d3ab\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"variables\": {\r\n                      \"storageName\": \"[tolower(concat('cheggkv', parameters('location')))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.KeyVault/vaults/providers/diagnosticSettings\",\r\n                        \"name\": \"[concat(parameters('vaultName'),'/Microsoft.Insights/setbypolicy')]\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"storageAccountId\": \"[resourceid('cheggremdemo', 'Microsoft.Storage/storageAccounts', variables('storageName'))]\",\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"AuditEvent\",\r\n                              \"enabled\": true,\r\n                              \"retentionPolicy\": {\r\n                                \"enabled\": true,\r\n                                \"days\": 30\r\n                              }\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"parameters\": {\r\n                      \"vaultName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vaultName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/332ce4ac-9200-4573-8c66-92b85fc82c8d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"332ce4ac-9200-4573-8c66-92b85fc82c8d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"audit_cosmosdb_enableAutomaticFailover\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DocumentDB/databaseAccounts\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.DocumentDB/databaseAccounts/enableAutomaticFailover\",\r\n                \"equals\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/37501145-d01b-4bc8-92d0-c795a19fd0a0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"37501145-d01b-4bc8-92d0-c795a19fd0a0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"audit_cosmosdb_defaultConsistencyLevel\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DocumentDB/databaseAccounts\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.DocumentDB/databaseAccounts/consistencyPolicy.defaultConsistencyLevel\",\r\n                  \"equals\": \"lalala\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/37501145-d01b-4bc8-92d0-c795a19fd0b7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"37501145-d01b-4bc8-92d0-c795a19fd0b7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"audit_cosmosdb_readLocations\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DocumentDB/databaseAccounts\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"allof\": [\r\n                    {\r\n                      \"field\": \"Microsoft.DocumentDB/databaseAccounts/readLocations[*].locationName\",\r\n                      \"equals\": \"lalala\"\r\n                    }\r\n                  ]\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/37501145-d01b-4bc8-92d0-c795a19fd0bd\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"37501145-d01b-4bc8-92d0-c795a19fd0bd\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"audit_cosmosdb_writeLocations\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DocumentDB/databaseAccounts\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"allof\": [\r\n                    {\r\n                      \"field\": \"Microsoft.DocumentDB/databaseAccounts/writeLocations[*].locationName\",\r\n                      \"equals\": \"lalala\"\r\n                    }\r\n                  ]\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/37501145-d01b-4bc8-92d0-c795a19fd0ce\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"37501145-d01b-4bc8-92d0-c795a19fd0ce\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"audit_cosmosdb_failoverPolicies\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DocumentDB/databaseAccounts\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"allof\": [\r\n                    {\r\n                      \"field\": \"Microsoft.DocumentDB/databaseAccounts/failoverPolicies[*].locationName\",\r\n                      \"equals\": \"lalala\"\r\n                    }\r\n                  ]\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/37501145-d01b-4bc8-92d0-c795a19fd160\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"37501145-d01b-4bc8-92d0-c795a19fd160\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy Threat Detection on ManagedInstances\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"indexed\",\r\n        \"description\": \"Deploy Threat Detection on ManagedInstances\",\r\n        \"metadata\": {\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/managedInstances\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"DeployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/managedInstances/securityAlertPolicies\",\r\n              \"name\": \"Default\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Sql/securityAlertPolicies.state\",\r\n                \"equals\": \"Enabled\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/056cd41c-7e88-42e1-933e-88ba6a50c9c3\",\r\n                \"/providers/Microsoft.Authorization/roleDefinitions/b24988ac-6180-42a0-ab88-20f7382dd24c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"serverName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('serverName'), '/Default')]\",\r\n                        \"type\": \"Microsoft.Sql/managedInstances/securityAlertPolicies\",\r\n                        \"apiVersion\": \"2017-03-01-preview\",\r\n                        \"properties\": {\r\n                          \"state\": \"Enabled\",\r\n                          \"emailAccountAdmins\": true\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"serverName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/388f3717-f877-4c56-9083-d448c837c0df\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"388f3717-f877-4c56-9083-d448c837c0df\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit SQL  and Managed Instance TDE\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers/databases/transparentDataEncryption\"\r\n              },\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/managedInstances/databases/transparentDataEncryption\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Sql/transparentDataEncryption.status\",\r\n                \"notEquals\": \"enabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/388f3717-f877-4c56-9083-d448c837c144\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"388f3717-f877-4c56-9083-d448c837c144\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"jilim recovery services vaults test\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {\r\n          \"vault\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Recovery Services Vault\",\r\n              \"description\": \"The Recovery Services Vault.\",\r\n              \"strongType\": \"Microsoft.RecoveryServices/vaults\"\r\n            }\r\n          },\r\n          \"vaults\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Recovery Services Vaults\",\r\n              \"description\": \"The list of Recovery Services Vaults.\",\r\n              \"strongType\": \"Microsoft.RecoveryServices/vaults\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"location\",\r\n                \"equals\": \"[parameters('vault')]\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"in\": \"[parameters('vaults')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/3b2c1b0f-63c5-4943-8578-6d37fbe411bb\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3b2c1b0f-63c5-4943-8578-6d37fbe411bb\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Append HTTPS For Web Apps\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"CSS\",\r\n        \"metadata\": {\r\n          \"category\": \"WebApps\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Web/sites/httpsOnly\",\r\n                \"exists\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"Microsoft.Web/sites/httpsOnly\",\r\n                \"value\": \"true\"\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/3b788cf8-ff6f-4075-86a1-ab76270790e0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3b788cf8-ff6f-4075-86a1-ab76270790e0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"rohitbh : Deploy Log Analytics Agent for Windows VMs\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"indexed\",\r\n        \"description\": \"Deploy Log Analytics Agent for Windows VMs if the VM Image (OS) is in the list defined and the agent is not installed.\",\r\n        \"metadata\": {\r\n          \"category\": \"rohitbh\"\r\n        },\r\n        \"parameters\": {\r\n          \"logAnalytics\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Log Analytics workspace\",\r\n              \"description\": \"Select Log Analytics workspace from dropdown list. If this workspace is outside of the scope of the assignment you must manually grant 'Log Analytics Contributor' permissions (or similar) to the policy assignment's principal ID.\",\r\n              \"strongType\": \"omsWorkspace\",\r\n              \"assignPermissions\": true\r\n            }\r\n          },\r\n          \"listOfImageIdToInclude\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Optional: List of VM images that have supported Windows OS to add to scope\",\r\n              \"description\": \"Example values: '/subscriptions/<subscriptionId>/resourceGroups/YourResourceGroup/providers/Microsoft.Compute/images/ContosoStdImage'\"\r\n            },\r\n            \"defaultValue\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imageId\",\r\n                    \"in\": \"[parameters('listOfImageIdToInclude')]\"\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"2008-R2-SP1\",\r\n                          \"2008-R2-SP1-smalldisk\",\r\n                          \"2012-Datacenter\",\r\n                          \"2012-Datacenter-smalldisk\",\r\n                          \"2012-R2-Datacenter\",\r\n                          \"2012-R2-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter\",\r\n                          \"2016-Datacenter-Server-Core\",\r\n                          \"2016-Datacenter-Server-Core-smalldisk\",\r\n                          \"2016-Datacenter-smalldisk\",\r\n                          \"2016-Datacenter-with-Containers\",\r\n                          \"2016-Datacenter-with-RDSH\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerSemiAnnual\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"in\": [\r\n                          \"Datacenter-Core-1709-smalldisk\",\r\n                          \"Datacenter-Core-1709-with-Containers-smalldisk\",\r\n                          \"Datacenter-Core-1803-with-Containers-smalldisk\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsServerHPCPack\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"WindowsServerHPCPack\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftSQLServer\"\r\n                      },\r\n                      {\r\n                        \"anyOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2016-BYOL\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Compute/imageOffer\",\r\n                            \"like\": \"*-WS2012R2-BYOL\"\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftRServer\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"MLServer-WS2016\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftVisualStudio\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"in\": [\r\n                          \"VisualStudio\",\r\n                          \"Windows\"\r\n                        ]\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftDynamicsAX\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Dynamics\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageSKU\",\r\n                        \"equals\": \"Pre-Req-AX7-Onebox-U8\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"microsoft-ads\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"windows-data-science-vm\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"allOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                        \"equals\": \"MicrosoftWindowsDesktop\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/imageOffer\",\r\n                        \"equals\": \"Windows-10\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/92aaf0da-9dab-42b6-94a3-d43ce8d16293\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"MicrosoftMonitoringAgent\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.EnterpriseCloud.Monitoring\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/provisioningState\",\r\n                    \"equals\": \"Succeeded\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"logAnalytics\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"vmExtensionName\": \"MMAExtension\",\r\n                      \"vmExtensionPublisher\": \"Microsoft.EnterpriseCloud.Monitoring\",\r\n                      \"vmExtensionType\": \"MicrosoftMonitoringAgent\",\r\n                      \"vmExtensionTypeHandlerVersion\": \"1.0\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('vmName'), '/', variables('vmExtensionName'))]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"[variables('vmExtensionPublisher')]\",\r\n                          \"type\": \"[variables('vmExtensionType')]\",\r\n                          \"typeHandlerVersion\": \"[variables('vmExtensionTypeHandlerVersion')]\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"workspaceId\": \"[reference(parameters('logAnalytics'), '2015-03-20').customerId]\",\r\n                            \"stopOnMultipleConnections\": \"true\"\r\n                          },\r\n                          \"protectedSettings\": {\r\n                            \"workspaceKey\": \"[listKeys(parameters('logAnalytics'), '2015-03-20').primarySharedKey]\"\r\n                          }\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {\r\n                      \"policy\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[concat('Enabled extension for VM', ': ', parameters('vmName'))]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"logAnalytics\": {\r\n                      \"value\": \"[parameters('logAnalytics')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/3cc5820a-cbb8-4977-9c90-d90ced95f12c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3cc5820a-cbb8-4977-9c90-d90ced95f12c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Name should have prefix and suffix\",\r\n        \"policyType\": \"Custom\",\r\n        \"description\": \"Name should have prefix and suffix\",\r\n        \"parameters\": {\r\n          \"prefix\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"The prefix\",\r\n              \"description\": \"The name prefix\"\r\n            },\r\n            \"allowedValues\": []\r\n          },\r\n          \"suffix\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"The suffix\",\r\n              \"description\": \"The name suffix.\"\r\n            },\r\n            \"allowedValues\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"name\",\r\n              \"like\": \"[concat(parameters('prefix'), '*', parameters('suffix'))]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/3e275e2e-a157-4ade-8f91-43b3ea370007\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3e275e2e-a157-4ade-8f91-43b3ea370007\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Restrict VM skus\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Restricts allowed VM skus to a predefined regex\",\r\n        \"parameters\": {\r\n          \"allowedSkuTemplate\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed VM sku template\",\r\n              \"description\": \"The VM sku template. Supports wildcards via '*'\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/sku.name\",\r\n                \"like\": \"[parameters('allowedSkuTemplate')]\"\r\n              },\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/3e3807c1-65c9-49e0-a406-82d8ae3e34c8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3e3807c1-65c9-49e0-a406-82d8ae3e34c8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit storage account SKU\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Audits the use of storage account SKUs that don't meet organizational cost policy.\",\r\n        \"parameters\": {\r\n          \"listOfAllowedSkus\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"List of allowed SKUs\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Storage/storageAccounts/sku.name\",\r\n                  \"in\": \"[parameters('listOfAllowedSkus')]\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/3e3807c1-65c9-49e0-a406-82d8ae3e3682\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3e3807c1-65c9-49e0-a406-82d8ae3e3682\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"RobgaDataFactoryTest1\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"RobgaDataFactoryTest\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.DataFactory/factories\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Insights/diagnosticSettings/workspaceId\",\r\n                \"equals\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/resourceGroups/robgatestworkspace/providers/Microsoft.OperationalInsights/workspaces/robgatestworkspace\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/3ffb9f8c-fdaa-41b0-ad4b-b0f55e2860c9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"3ffb9f8c-fdaa-41b0-ad4b-b0f55e2860c9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Enforce autoUpgrade on VM/VMSS extensions\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Denies any VM or VMSS extensions that do not have autoUpgradeMinorVersion set to true.\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines/extensions\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/autoUpgradeMinorVersion\",\r\n                    \"notEquals\": \"true\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/autoUpgradeMinorVersion\",\r\n                    \"notEquals\": \"true\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/41f9e24d-1586-455f-811a-92a2ca39f772\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"41f9e24d-1586-455f-811a-92a2ca39f772\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Append autoUpgrade to VM extensions\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Automatically enabled autoUpgradeMinorVersion on VM extensions\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines/extensions\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/extensions/autoUpgradeMinorVersion\",\r\n                \"exists\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachines/extensions/autoUpgradeMinorVersion\",\r\n                \"value\": \"true\"\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/41f9e24d-1586-455f-811a-92a2ca39f783\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"41f9e24d-1586-455f-811a-92a2ca39f783\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Append autoUpgrade to VM scale set extensions\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Automatically appends autoUpgradeMinorVersion=true to VMSS extensions\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/autoUpgradeMinorVersion\",\r\n                \"exists\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/autoUpgradeMinorVersion\",\r\n                \"value\": \"true\"\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/41f9e24d-1586-455f-811a-92a2ca39f7a3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"41f9e24d-1586-455f-811a-92a2ca39f7a3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"MSIT - AppService must use serverFarm\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/serverFarmId\",\r\n                    \"exists\": \"false\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/serverFarmId\",\r\n                    \"equals\": \"\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/41f9e24d-1586-455f-811a-92a2ca39fc12\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"41f9e24d-1586-455f-811a-92a2ca39fc12\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"MSIT - AppService serverFarm must have capacity > 1\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/serverFarms\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Web/serverFarms/sku.capacity\",\r\n                \"in\": [\r\n                  \"0\",\r\n                  \"1\"\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/41f9e24d-1586-455f-811a-92a2ca39fc23\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"41f9e24d-1586-455f-811a-92a2ca39fc23\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"rohitbh: Definition to be deleted.\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"indexed\",\r\n        \"description\": \"This policy will deploy a key vault named KV_B if a key vault named KV_A does not exist.\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.KeyVault/vaults\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.KeyVault/vaults\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"name\",\r\n                \"equals\": \"KV_B\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2016-10-01\",\r\n                        \"name\": \"KV_A\",\r\n                        \"type\": \"Microsoft.KeyVault/vaults\",\r\n                        \"location\": \"eastus2\",\r\n                        \"properties\": {\r\n                          \"tenantId\": \"72f988bf-86f1-41af-91ab-2d7cd011db47\",\r\n                          \"sku\": {\r\n                            \"family\": \"A\",\r\n                            \"name\": \"standard\"\r\n                          },\r\n                          \"accessPolicies\": []\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/48ba81c1-0012-4796-8166-c2efb4304190\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"48ba81c1-0012-4796-8166-c2efb4304190\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Do_Not_Delete\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy is used for unit tests. Please do not delete it.\",\r\n        \"parameters\": {\r\n          \"allowedLocations\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed locations\",\r\n              \"description\": \"The list of allowed locations for resources.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": \"[parameters('allowedLocations')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/4a0425e4-97bf-4ad0-ab36-145b94083c60\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4a0425e4-97bf-4ad0-ab36-145b94083c60\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deny MySQL firewallRules starting with 0\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {\r\n          \"category\": \"camarvin\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"Microsoft.Sql/servers/firewallRules/startIpAddress\",\r\n            \"equals\": \"0.0.0.0\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/4b94c320-ce63-4fb6-ba9d-7dbe648b90de\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4b94c320-ce63-4fb6-ba9d-7dbe648b90de\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"ICM 83686598\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"deny the creation of storage if supportsHttpsTrafficOnly is false\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Storage/storageAccounts/supportsHttpsTrafficOnly\",\r\n                  \"equals\": \"True\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/4c03a3e3-e038-4a55-a6a6-abf8e7bb9175\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4c03a3e3-e038-4a55-a6a6-abf8e7bb9175\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"detect 'allow All' NSG rule\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/networkSecurityGroups/securityRules\"\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRange\",\r\n                        \"equals\": \"*\"\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRanges[*]\",\r\n                          \"notEquals\": \"*\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/access\",\r\n                    \"equals\": \"Allow\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/direction\",\r\n                    \"equals\": \"Inbound\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefix\",\r\n                        \"in\": [\r\n                          \"*\",\r\n                          \"Internet\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefixes[*]\",\r\n                          \"notIn\": [\r\n                            \"*\",\r\n                            \"Internet\"\r\n                          ]\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/4c915617-16f0-4c62-b021-e66d5409d11d\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4c915617-16f0-4c62-b021-e66d5409d11d\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"rohitbh: Deploy Auditing on SQL servers without role definitions\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"indexed\",\r\n        \"description\": \"This policy ensures that Auditing is enabled on SQL Servers for enhanced security and compliance. It will automatically create a storage account in the same region as the SQL server to store audit records.\",\r\n        \"metadata\": {\r\n          \"category\": \"rohitbh\"\r\n        },\r\n        \"parameters\": {\r\n          \"retentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Retention days (optional, 180 days if unspecified)\",\r\n              \"description\": \"The value in days of the retention period (0 indicates unlimited retention)\"\r\n            },\r\n            \"defaultValue\": \"180\"\r\n          },\r\n          \"storageAccountsResourceGroup\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Resource group name for storage accounts\",\r\n              \"description\": \"Auditing writes database events to an audit log in your Azure Storage account (a storage account will be created in each region where a SQL Server is created that will be shared by all servers in that region). Important - for proper operation of Auditing do not delete or rename the resource group or the storage accounts.\",\r\n              \"strongType\": \"existingResourceGroups\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"DeployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/auditingSettings\",\r\n              \"name\": \"Default\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Sql/auditingSettings.state\",\r\n                \"equals\": \"Enabled\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"serverName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"auditRetentionDays\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"storageAccountsResourceGroup\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"retentionDays\": \"[int(parameters('auditRetentionDays'))]\",\r\n                      \"subscriptionId\": \"[subscription().subscriptionId]\",\r\n                      \"uniqueStorage\": \"[uniqueString(variables('subscriptionId'), parameters('location'), parameters('storageAccountsResourceGroup'))]\",\r\n                      \"locationCode\": \"[substring(parameters('location'), 0, 3)]\",\r\n                      \"storageName\": \"[tolower(concat('sqlaudit', variables('locationCode'), variables('uniqueStorage')))]\",\r\n                      \"createStorageAccountDeploymentName\": \"[concat('sqlServerAuditingStorageAccount-', uniqueString(variables('locationCode'), parameters('serverName')))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2017-05-10\",\r\n                        \"name\": \"[variables('createStorageAccountDeploymentName')]\",\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"resourceGroup\": \"[parameters('storageAccountsResourceGroup')]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"parameters\": {\r\n                            \"location\": {\r\n                              \"value\": \"[parameters('location')]\"\r\n                            },\r\n                            \"storageName\": {\r\n                              \"value\": \"[variables('storageName')]\"\r\n                            }\r\n                          },\r\n                          \"templateLink\": {\r\n                            \"uri\": \"https://raw.githubusercontent.com/Azure/azure-policy/master/samples/SQL/deploy-sql-server-auditing/createStorage.template.json\",\r\n                            \"contentVersion\": \"1.0.0.0\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"name\": \"[concat(parameters('serverName'), '/Default')]\",\r\n                        \"type\": \"Microsoft.Sql/servers/auditingSettings\",\r\n                        \"apiVersion\": \"2017-03-01-preview\",\r\n                        \"properties\": {\r\n                          \"state\": \"Enabled\",\r\n                          \"storageEndpoint\": \"[reference(variables('createStorageAccountDeploymentName')).outputs.storageAccountEndPoint.value]\",\r\n                          \"storageAccountAccessKey\": \"[reference(variables('createStorageAccountDeploymentName')).outputs.storageAccountKey.value]\",\r\n                          \"retentionDays\": \"[variables('retentionDays')]\",\r\n                          \"auditActionsAndGroups\": null,\r\n                          \"storageAccountSubscriptionId\": \"[subscription().subscriptionId]\",\r\n                          \"isStorageSecondaryKeyInUse\": false\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"serverName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"auditRetentionDays\": {\r\n                      \"value\": \"[parameters('retentionDays')]\"\r\n                    },\r\n                    \"storageAccountsResourceGroup\": {\r\n                      \"value\": \"[parameters('storageAccountsResourceGroup')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/4cf9b9fd-45d3-4126-8ba7-cc9adf332195\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4cf9b9fd-45d3-4126-8ba7-cc9adf332195\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"rohitbh: Deploy Auditing on SQL servers with role definitions\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"indexed\",\r\n        \"description\": \"This policy ensures that Auditing is enabled on SQL Servers for enhanced security and compliance. It will automatically create a storage account in the same region as the SQL server to store audit records.\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {\r\n          \"retentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Retention days (optional, 180 days if unspecified)\",\r\n              \"description\": \"The value in days of the retention period (0 indicates unlimited retention)\"\r\n            },\r\n            \"defaultValue\": \"180\"\r\n          },\r\n          \"storageAccountsResourceGroup\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Resource group name for storage accounts\",\r\n              \"description\": \"Auditing writes database events to an audit log in your Azure Storage account (a storage account will be created in each region where a SQL Server is created that will be shared by all servers in that region). Important - for proper operation of Auditing do not delete or rename the resource group or the storage accounts.\",\r\n              \"strongType\": \"existingResourceGroups\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"DeployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/auditingSettings\",\r\n              \"name\": \"Default\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Sql/auditingSettings.state\",\r\n                \"equals\": \"Enabled\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/056cd41c-7e88-42e1-933e-88ba6a50c9c3\",\r\n                \"/providers/microsoft.authorization/roleDefinitions/17d1049b-9a84-46fb-8f53-869881c3d3ab\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"serverName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"auditRetentionDays\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"storageAccountsResourceGroup\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"retentionDays\": \"[int(parameters('auditRetentionDays'))]\",\r\n                      \"subscriptionId\": \"[subscription().subscriptionId]\",\r\n                      \"uniqueStorage\": \"[uniqueString(variables('subscriptionId'), parameters('location'), parameters('storageAccountsResourceGroup'))]\",\r\n                      \"locationCode\": \"[substring(parameters('location'), 0, 3)]\",\r\n                      \"storageName\": \"[tolower(concat('sqlaudit', variables('locationCode'), variables('uniqueStorage')))]\",\r\n                      \"createStorageAccountDeploymentName\": \"[concat('sqlServerAuditingStorageAccount-', uniqueString(variables('locationCode'), parameters('serverName')))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2017-05-10\",\r\n                        \"name\": \"[variables('createStorageAccountDeploymentName')]\",\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"resourceGroup\": \"[parameters('storageAccountsResourceGroup')]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"parameters\": {\r\n                            \"location\": {\r\n                              \"value\": \"[parameters('location')]\"\r\n                            },\r\n                            \"storageName\": {\r\n                              \"value\": \"[variables('storageName')]\"\r\n                            }\r\n                          },\r\n                          \"templateLink\": {\r\n                            \"uri\": \"https://raw.githubusercontent.com/Azure/azure-policy/master/samples/SQL/deploy-sql-server-auditing/createStorage.template.json\",\r\n                            \"contentVersion\": \"1.0.0.0\"\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"name\": \"[concat(parameters('serverName'), '/Default')]\",\r\n                        \"type\": \"Microsoft.Sql/servers/auditingSettings\",\r\n                        \"apiVersion\": \"2017-03-01-preview\",\r\n                        \"properties\": {\r\n                          \"state\": \"Enabled\",\r\n                          \"storageEndpoint\": \"[reference(variables('createStorageAccountDeploymentName')).outputs.storageAccountEndPoint.value]\",\r\n                          \"storageAccountAccessKey\": \"[reference(variables('createStorageAccountDeploymentName')).outputs.storageAccountKey.value]\",\r\n                          \"retentionDays\": \"[variables('retentionDays')]\",\r\n                          \"auditActionsAndGroups\": null,\r\n                          \"storageAccountSubscriptionId\": \"[subscription().subscriptionId]\",\r\n                          \"isStorageSecondaryKeyInUse\": false\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"serverName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"auditRetentionDays\": {\r\n                      \"value\": \"[parameters('retentionDays')]\"\r\n                    },\r\n                    \"storageAccountsResourceGroup\": {\r\n                      \"value\": \"[parameters('storageAccountsResourceGroup')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/4cf9b9fd-45d3-4126-8ba7-cc9adf332199\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4cf9b9fd-45d3-4126-8ba7-cc9adf332199\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"rohitbh: Audit VMs that do not use managed disks without role definitions\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"This policy audits VMs that do not use managed disks\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/osDisk.uri\",\r\n                    \"exists\": \"True\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/VirtualMachineScaleSets\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/VirtualMachineScaleSets/osDisk.vhdContainers\",\r\n                        \"exists\": \"True\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/VirtualMachineScaleSets/osdisk.imageUrl\",\r\n                        \"exists\": \"True\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/4cf9b9fd-45d3-4126-8ba7-cc9adf33219f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4cf9b9fd-45d3-4126-8ba7-cc9adf33219f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"rohitbh: Audit VMs that do not use managed disks with role definitions\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"This policy audits VMs that do not use managed disks\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/osDisk.uri\",\r\n                    \"exists\": \"True\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Compute/VirtualMachineScaleSets\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/VirtualMachineScaleSets/osDisk.vhdContainers\",\r\n                        \"exists\": \"True\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Compute/VirtualMachineScaleSets/osdisk.imageUrl\",\r\n                        \"exists\": \"True\"\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/auditingSettings\",\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/056cd41c-7e88-42e1-933e-88ba6a50c9c3\"\r\n              ]\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/4cf9b9fd-45d3-4126-8ba7-cc9adf3321a3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4cf9b9fd-45d3-4126-8ba7-cc9adf3321a3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deny storage container creation\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Storage/storageAccounts/blobServices/containers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/4d2f8837-7acb-4488-b580-95960ee3f116\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4d2f8837-7acb-4488-b580-95960ee3f116\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Ensure auto-created NSG rules exist\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Ensures that security rules created in auto-created PortLockdown NSGs are not tampered with\",\r\n        \"metadata\": {\r\n          \"category\": \"Port Lockdown\"\r\n        },\r\n        \"parameters\": {\r\n          \"nsgPrefix\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"NSG name prefix\",\r\n              \"description\": \"The prefix string applied to automatically created network security groups.\"\r\n            }\r\n          },\r\n          \"sourceAddressPrefixes\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Expected IP restriction prefixes\",\r\n              \"description\": \"The IP ranges incoming traffic will be restricted to in the expected security rule. I.e. 192.4.0.0/8;192.5.0.0/8 or *\"\r\n            }\r\n          },\r\n          \"destinationPortRanges\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Expected destination port ranges\",\r\n              \"description\": \"Destination port ranges requiring IP restrictions in the expected security rule\"\r\n            }\r\n          },\r\n          \"priority\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Expected priority\",\r\n              \"description\": \"The priority of the expected security rule.\"\r\n            }\r\n          },\r\n          \"access\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Expected access\",\r\n              \"description\": \"The access (allow/deny) of the expected security rule.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Allow\",\r\n              \"Deny\"\r\n            ]\r\n          },\r\n          \"name\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Expected name\",\r\n              \"description\": \"The name of the expected security rule.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"name\",\r\n                \"equals\": \"[concat(parameters('nsgPrefix'), '-', field('location'))]\"\r\n              },\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/networkSecurityGroups\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Network/networkSecurityGroups/securityRules\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/priority\",\r\n                    \"equals\": \"[parameters('priority')]\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefixes[*]\",\r\n                        \"in\": \"[parameters('sourceAddressPrefixes')]\"\r\n                      },\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefix\",\r\n                        \"in\": \"[parameters('sourceAddressPrefixes')]\"\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRanges[*]\",\r\n                    \"in\": \"[parameters('destinationPortRanges')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/access\",\r\n                    \"equals\": \"[parameters('access')]\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"sourceAddressPrefixes\": {\r\n                        \"type\": \"array\"\r\n                      },\r\n                      \"destinationPortRanges\": {\r\n                        \"type\": \"array\"\r\n                      },\r\n                      \"name\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"priority\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"access\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"nsgName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"isSinglePrefix\": \"[equals(count(parameters('sourceAddressPrefixes')), 1)]\",\r\n                      \"isSinglePortRange\": \"[equals(count(parameters('destinationPortRanges')), 1)]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('nsgName'), '/', parameters('name'))]\",\r\n                        \"type\": \"Microsoft.Network/networkSecurityGroups/securityRules\",\r\n                        \"apiVersion\": \"2018-03-01\",\r\n                        \"properties\": {\r\n                          \"description\": \"Rule auto-created by Internet Exposed Endpoints protection\",\r\n                          \"protocol\": \"*\",\r\n                          \"sourcePortRange\": \"*\",\r\n                          \"destinationPortRange\": \"[if(variables('isSinglePortRange'), first(parameters('destinationPortRanges')), '')]\",\r\n                          \"destinationPortRanges\": \"[if(not(variables('isSinglePortRange')), parameters('destinationPortRanges'), json('[]'))]\",\r\n                          \"sourceAddressPrefix\": \"[if(variables('isSinglePrefix'), first(parameters('sourceAddressPrefixes')), '')]\",\r\n                          \"sourceAddressPrefixes\": \"[if(not(variables('isSinglePrefix')), parameters('sourceAddressPrefixes'), json('[]'))]\",\r\n                          \"destinationAddressPrefix\": \"*\",\r\n                          \"access\": \"[parameters('access')]\",\r\n                          \"priority\": \"[int(parameters('priority'))]\",\r\n                          \"direction\": \"Inbound\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"sourceAddressPrefixes\": {\r\n                      \"value\": \"[parameters('sourceAddressPrefixes')]\"\r\n                    },\r\n                    \"destinationPortRanges\": {\r\n                      \"value\": \"[parameters('destinationPortRanges')]\"\r\n                    },\r\n                    \"name\": {\r\n                      \"value\": \"[parameters('name')]\"\r\n                    },\r\n                    \"priority\": {\r\n                      \"value\": \"[parameters('priority')]\"\r\n                    },\r\n                    \"access\": {\r\n                      \"value\": \"[parameters('access')]\"\r\n                    },\r\n                    \"nsgName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/4f283ec4-25a9-46df-bbf2-806ed5a3e115\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"4f283ec4-25a9-46df-bbf2-806ed5a3e115\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"rs defaultvalue backslash\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"camarvin\"\r\n        },\r\n        \"parameters\": {\r\n          \"ExclusionsExtensions\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Extensions to Exclude\",\r\n              \"description\": \"Semicolon delimited list of file extensions to exclude from scanning\"\r\n            },\r\n            \"defaultValue\": \".FWD;.GSC;.GSE;.MYD;.MYI;.SMD;.VAC;.BAK;.CHK;.FRM;.LDF;.LOG;.MBX;.MDF;.NDF;.TRN;.UND;.UNF;.UNH;.UNI;.UNQ;.UNS;.VHD;.VMDX;.WCI;.EDB;.SDS\"\r\n          },\r\n          \"ExclusionsPaths\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Paths to Exclude\",\r\n              \"description\": \"Semicolon delimited list of file paths or locations to exclude from scanning\"\r\n            },\r\n            \"defaultValue\": \"C:\\\\rs-pkgs;C:\\\\System Volume Information\\\\DFSR;C:\\\\Sysvol;C:\\\\ProgramData\\\\Microsoft\\\\SharePoint;C:\\\\Program Files\\\\Common Files\\\\Microsoft Shared\\\\Web Server Extensions;C:\\\\Program Files\\\\Operations Manager;C:\\\\Program Files\\\\Microsoft Monitoring Agent;C:\\\\Program Files\\\\Microsoft Office Servers;C:\\\\Program Files\\\\Microsoft System Center 2012 R2\\\\Server;C:\\\\Program Files\\\\System Center Operations Manager;C:\\\\Program Files\\\\System Center Operations Manager 2007;C:\\\\Windows\\\\Microsoft.NET\\\\Framework64\\\\v2.0.50727\\\\Temporary ASP.NET Files;C:\\\\Windows\\\\Microsoft.NET\\\\Framework64\\\\v4.0.30319\\\\Temporary ASP.NET Files;C:\\\\Windows\\\\NTDS;C:\\\\Windows\\\\System32\\\\LogFiles;C:\\\\Windows\\\\Sysvol;C:\\\\Program Files\\\\Double-Take Software;C:\\\\Program Files\\\\DoubleTake;C:\\\\Program Files\\\\Exchsrvr;C:\\\\Program Files\\\\Ipswitch;C:\\\\Program Files\\\\LogMeIn;C:\\\\Windows\\\\SoftwareDistribution\\\\Datastore;C:\\\\Windows\\\\Temp\\\\Gthrsvc\"\r\n          },\r\n          \"ExclusionsProcesses\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Processes to Exclude\",\r\n              \"description\": \"Semicolon delimited list of processes to exclude from scanning\"\r\n            },\r\n            \"defaultValue\": \"HealthService.exe;ManagementService.exe;Microsoft.Mom.Sdk.Service.exe;Microsoft.Mom.ConfigServiceHost.exe;MonitoringHost.exe;pagefile.sys\"\r\n          },\r\n          \"RealtimeProtectionEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable real time protection\",\r\n              \"description\": \"Indicates whether or not real time protection is enabled (default is true)\"\r\n            },\r\n            \"defaultValue\": \"true\"\r\n          },\r\n          \"ScheduledScanSettingsIsEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Enable Scheduled scans\",\r\n              \"description\": \"Indicates whether or not custom scheduled scan settings are enabled (default is false)\"\r\n            },\r\n            \"defaultValue\": \"false\"\r\n          },\r\n          \"ScheduledScanSettingsScanType\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Scheduled Scan Type\",\r\n              \"description\": \"Indicates whether scheduled scan setting type is set to Quick or Full (default is Quick)\"\r\n            },\r\n            \"defaultValue\": \"Quick\"\r\n          },\r\n          \"ScheduledScanSettingsDay\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Day of Scheduled Scan\",\r\n              \"description\": \"Day of the week for scheduled scan (1-Sunday, 2-Monday, ..., 7-Saturday)\"\r\n            },\r\n            \"defaultValue\": \"7\"\r\n          },\r\n          \"ScheduledScanSettingsTime\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Time of Scheduled Scan\",\r\n              \"description\": \"Semicolon delimited list of file extensions to exclude from scanning\"\r\n            },\r\n            \"defaultValue\": \"120\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                \"equals\": \"MicrosoftWindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                \"equals\": \"WindowsServer\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageSKU\",\r\n                \"in\": [\r\n                  \"2008-R2-SP1\",\r\n                  \"2008-R2-SP1-smalldisk\",\r\n                  \"2012-Datacenter\",\r\n                  \"2012-Datacenter-smalldisk\",\r\n                  \"2012-R2-Datacenter\",\r\n                  \"2012-R2-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter\",\r\n                  \"2016-Datacenter-Server-Core\",\r\n                  \"2016-Datacenter-Server-Core-smalldisk\",\r\n                  \"2016-Datacenter-smalldisk\",\r\n                  \"2016-Datacenter-with-Containers\",\r\n                  \"2016-Datacenter-with-RDSH\"\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"IaaSAntimalware\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Security\"\r\n                  }\r\n                ]\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/providers/microsoft.authorization/roleDefinitions/9980e02c-c2be-4d73-94e8-173b1dc7cf3c\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ExclusionsPaths\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ExclusionsExtensions\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ExclusionsProcesses\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"RealtimeProtectionEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ScheduledScanSettingsIsEnabled\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ScheduledScanSettingsScanType\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ScheduledScanSettingsDay\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"ScheduledScanSettingsTime\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[concat(parameters('vmName'),'/IaaSAntimalware')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"apiVersion\": \"2017-12-01\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.Azure.Security\",\r\n                          \"type\": \"IaaSAntimalware\",\r\n                          \"typeHandlerVersion\": \"1.3\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {\r\n                            \"AntimalwareEnabled\": true,\r\n                            \"RealtimeProtectionEnabled\": \"[parameters('RealtimeProtectionEnabled')]\",\r\n                            \"ScheduledScanSettings\": {\r\n                              \"isEnabled\": \"[parameters('ScheduledScanSettingsIsEnabled')]\",\r\n                              \"day\": \"[parameters('ScheduledScanSettingsDay')]\",\r\n                              \"time\": \"[parameters('ScheduledScanSettingsTime')]\",\r\n                              \"scanType\": \"[parameters('ScheduledScanSettingsScanType')]\"\r\n                            },\r\n                            \"Exclusions\": {\r\n                              \"Extensions\": \"[parameters('ExclusionsExtensions')]\",\r\n                              \"Paths\": \"[parameters('ExclusionsPaths')]\",\r\n                              \"Processes\": \"[parameters('ExclusionsProcesses')]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    },\r\n                    \"ExclusionsExtensions\": {\r\n                      \"value\": \"[parameters('ExclusionsExtensions')]\"\r\n                    },\r\n                    \"ExclusionsPaths\": {\r\n                      \"value\": \"[parameters('ExclusionsPaths')]\"\r\n                    },\r\n                    \"ExclusionsProcesses\": {\r\n                      \"value\": \"[parameters('ExclusionsProcesses')]\"\r\n                    },\r\n                    \"RealtimeProtectionEnabled\": {\r\n                      \"value\": \"[parameters('RealtimeProtectionEnabled')]\"\r\n                    },\r\n                    \"ScheduledScanSettingsIsEnabled\": {\r\n                      \"value\": \"[parameters('ScheduledScanSettingsIsEnabled')]\"\r\n                    },\r\n                    \"ScheduledScanSettingsScanType\": {\r\n                      \"value\": \"[parameters('ScheduledScanSettingsScanType')]\"\r\n                    },\r\n                    \"ScheduledScanSettingsDay\": {\r\n                      \"value\": \"[parameters('ScheduledScanSettingsDay')]\"\r\n                    },\r\n                    \"ScheduledScanSettingsTime\": {\r\n                      \"value\": \"[parameters('ScheduledScanSettingsTime')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/50877efd-8dd9-43d5-b4e6-3b70e64311b9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"50877efd-8dd9-43d5-b4e6-3b70e64311b9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"rohitbh: Deploy key vault KV_B if key vault KV_A does not exist.\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"indexed\",\r\n        \"description\": \"This policy will deploy a key vault named KV_B if a key vault named KV_A does not exist.\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.KeyVault/vaults\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.KeyVault/vaults\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"name\",\r\n                \"equals\": \"KV_B\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2016-10-01\",\r\n                        \"name\": \"KV_A\",\r\n                        \"type\": \"Microsoft.KeyVault/vaults\",\r\n                        \"location\": \"eastus2\",\r\n                        \"properties\": {\r\n                          \"tenantId\": \"72f988bf-86f1-41af-91ab-2d7cd011db47\",\r\n                          \"sku\": {\r\n                            \"family\": \"A\",\r\n                            \"name\": \"standard\"\r\n                          },\r\n                          \"accessPolicies\": []\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/50e2972e-143c-4edf-9ef6-bee0f84212d6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"50e2972e-143c-4edf-9ef6-bee0f84212d6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"RobgaTestRbac\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Resources/subscriptions/resourceGroups\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Authorization/roleAssignments/principalId\",\r\n                    \"equals\": \"Admin\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/560482cd-dac5-41e6-9cef-b0aecd6020de\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"560482cd-dac5-41e6-9cef-b0aecd6020de\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"GokmenhAuditLocation\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"Audit if not west us\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": [\r\n                \"eastus\"\r\n              ]\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/5948d091-78b7-4d3b-a404-cc6a0329b0c6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5948d091-78b7-4d3b-a404-cc6a0329b0c6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"deployifnotexist template alias tests - redis\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Cache/Redis\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Cache/Redis/sku.family\",\r\n                \"equals\": \"C\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Resources/links\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"name\",\r\n                \"like\": \"Whatever*\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"skuFamily\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"enableNonSslPort\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"nameField\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [],\r\n                    \"outputs\": {\r\n                      \"skuFamilyOut\": {\r\n                        \"value\": \"[parameters('skuFamily')]\",\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"enableNonSslPortOut\": {\r\n                        \"value\": \"[parameters('enableNonSslPort')]\",\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"nameFieldOut\": {\r\n                        \"value\": \"[parameters('nameField')]\",\r\n                        \"type\": \"string\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"skuFamily\": {\r\n                      \"value\": \"[field('Microsoft.Cache/Redis/sku.family')]\"\r\n                    },\r\n                    \"enableNonSslPort\": {\r\n                      \"value\": \"[field('Microsoft.Cache/Redis/enableNonSslPort')]\"\r\n                    },\r\n                    \"nameField\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/5a8a68e8-ae1c-420a-9639-a94ebeb3c0c8\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5a8a68e8-ae1c-420a-9639-a94ebeb3c0c8\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"akhe-incident-86226837\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"reproing the incident: https://icm.ad.msft.net/imp/v3/incidents/details/86226837/home\",\r\n        \"metadata\": {\r\n          \"category\": \"akhe\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Sql/servers/firewallRules/startIpAddress\",\r\n                \"exists\": \"false\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Sql/servers/firewallRules/endIpAddress\",\r\n                \"exists\": \" false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/5b02be71-b0a4-4942-a376-9dc88d9ca376\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5b02be71-b0a4-4942-a376-9dc88d9ca376\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"akhe-incident-86318519\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"reproing incident 86318519\",\r\n        \"metadata\": {\r\n          \"category\": \"akhe\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers/firewallrules\"\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"equals\": \"AllowAllWindowsAzureIps\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/5b02be71-b0a4-4942-a376-9dc88d9ca600\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5b02be71-b0a4-4942-a376-9dc88d9ca600\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"akhe-incident-86230190\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"reproing incident 86230190, https://icm.ad.msft.net/imp/v3/incidents/details/86230190/home\\n\\nAudits if a resource doesn't have a lock\",\r\n        \"metadata\": {\r\n          \"category\": \"akhe\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"exists\": \"true\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Authorization/locks\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Authorization/locks/level\",\r\n                \"notIn\": [\r\n                  \"ReadOnly\",\r\n                  \"CanNotDelete\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/5b02be71-b0a4-4942-a376-9dc88d9ca8d6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5b02be71-b0a4-4942-a376-9dc88d9ca8d6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Test storage alias\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"Test storage alias\",\r\n        \"metadata\": {\r\n          \"category\": \"camarvin\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Authorization/policyAssignments\",\r\n              \"name\": \"DoesNotExist101\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"httpsOnly\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"encrypt\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"accessTier\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"skuName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [],\r\n                    \"outputs\": {\r\n                      \"skuNameOut\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[parameters('skuName')]\"\r\n                      },\r\n                      \"accessTierOut\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[parameters('accessTier')]\"\r\n                      },\r\n                      \"httpsOnlyOut\": {\r\n                        \"type\": \"String\",\r\n                        \"value\": \"[parameters('httpsOnly')]\"\r\n                      },\r\n                      \"encryptOut\": {\r\n                        \"type\": \"String\",\r\n                        \"value\": \"[parameters('encrypt')]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"httpsOnly\": {\r\n                      \"value\": \"[field('Microsoft.Storage/storageAccounts/supportsHttpsTrafficOnly')]\"\r\n                    },\r\n                    \"encrypt\": {\r\n                      \"value\": \"[field('Microsoft.Storage/storageAccounts/enableBlobEncryption')]\"\r\n                    },\r\n                    \"accessTier\": {\r\n                      \"value\": \"[field('Microsoft.Storage/storageAccounts/accessTier')]\"\r\n                    },\r\n                    \"skuName\": {\r\n                      \"value\": \"[field('Microsoft.Storage/storageAccounts/sku.name')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/5fa69139-9a49-464e-90b5-0d243a469138\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"5fa69139-9a49-464e-90b5-0d243a469138\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"inherit costcenter tag\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {\r\n          \"category\": \"camarvin\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"tags.CostCenter\",\r\n                \"exists\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"tags.CostCenter\",\r\n                \"value\": \"[resourceGroup().tags.CostCenter]\"\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/6ced0d17-98f3-41e2-8038-08c8f4fb90e3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6ced0d17-98f3-41e2-8038-08c8f4fb90e3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"jilim Apply allowed tag and its default value\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"indexed\",\r\n        \"description\": \"3\",\r\n        \"metadata\": {\r\n          \"category\": \"General\"\r\n        },\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Name\",\r\n              \"description\": \"Name of the tag, such as 'environment'\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"TagA\",\r\n              \"TagB\"\r\n            ]\r\n          },\r\n          \"tagValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Tag Value\",\r\n              \"description\": \"Value of the tag, such as 'production'\",\r\n              \"strongType\": \"omsWorkspace\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n            \"exists\": \"false\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"[concat('tags[', parameters('tagName'), ']')]\",\r\n                \"value\": \"[parameters('tagValue')]\"\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/6d1735de-f3e3-4c40-a8b2-7b3a1042a895\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6d1735de-f3e3-4c40-a8b2-7b3a1042a895\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"testSandipsh metric alert policy1\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"testSandipsh\"\r\n        },\r\n        \"parameters\": {\r\n          \"resourceType\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Resource Type\",\r\n              \"description\": \"The target resource type.\"\r\n            }\r\n          },\r\n          \"alertNamePrefix\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Alert name prefix\",\r\n              \"description\": \"A prefix to be used for the metrics alert.\"\r\n            }\r\n          },\r\n          \"alertDescription\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Alert description.\",\r\n              \"description\": null\r\n            }\r\n          },\r\n          \"alertSeverity\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"alertSeverity\",\r\n              \"description\": \"Severity of alert {0,1,2,3,4}\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"0\",\r\n              \"1\",\r\n              \"2\",\r\n              \"3\",\r\n              \"4\"\r\n            ],\r\n            \"defaultValue\": \"3\"\r\n          },\r\n          \"isEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"isEnabled\",\r\n              \"description\": \"Specifies whether the alert is enabled.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ],\r\n            \"defaultValue\": \"true\"\r\n          },\r\n          \"metricName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Metric name\",\r\n              \"description\": \"Metric name.\"\r\n            }\r\n          },\r\n          \"operator\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Operator\",\r\n              \"description\": \"The metric operator.\"\r\n            }\r\n          },\r\n          \"threshold\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Threshold\",\r\n              \"description\": \"The threshold.\"\r\n            }\r\n          },\r\n          \"timeAggregation\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"TimeAggregation\",\r\n              \"description\": \"The timeAggregation.\"\r\n            }\r\n          },\r\n          \"windowSize\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Window size\",\r\n              \"description\": \"The window size.\"\r\n            }\r\n          },\r\n          \"evaluationFrequency\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Evaluation Frequency\",\r\n              \"description\": \"The evaluation frequency.\"\r\n            }\r\n          },\r\n          \"actionGroupId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"ActionGroupId\",\r\n              \"description\": \"The action group id.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"[parameters('resourceType')]\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"DeployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/metricAlerts\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"name\",\r\n                \"like\": \"[concat(parameters('alertNamePrefix'), '*')]\"\r\n              },\r\n              \"existenceScope\": \"subscription\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"alertNamePrefix\": {\r\n                        \"type\": \"string\",\r\n                        \"minLength\": 1,\r\n                        \"metadata\": {\r\n                          \"description\": \"A prefix to be used for the metrics alert.\"\r\n                        }\r\n                      },\r\n                      \"alertDescription\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"This is a metric alert\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Description of alert\"\r\n                        }\r\n                      },\r\n                      \"alertSeverity\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"3\",\r\n                        \"allowedValues\": [\r\n                          \"0\",\r\n                          \"1\",\r\n                          \"2\",\r\n                          \"3\",\r\n                          \"4\"\r\n                        ],\r\n                        \"metadata\": {\r\n                          \"description\": \"Severity of alert {0,1,2,3,4}\"\r\n                        }\r\n                      },\r\n                      \"isEnabled\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"true\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Specifies whether the alert is enabled\"\r\n                        }\r\n                      },\r\n                      \"metricName\": {\r\n                        \"type\": \"string\",\r\n                        \"minLength\": 1,\r\n                        \"metadata\": {\r\n                          \"description\": \"Name of the metric used in the comparison to activate the alert.\"\r\n                        }\r\n                      },\r\n                      \"operator\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"GreaterThan\",\r\n                        \"allowedValues\": [\r\n                          \"Equals\",\r\n                          \"NotEquals\",\r\n                          \"GreaterThan\",\r\n                          \"GreaterThanOrEqual\",\r\n                          \"LessThan\",\r\n                          \"LessThanOrEqual\"\r\n                        ],\r\n                        \"metadata\": {\r\n                          \"description\": \"Operator comparing the current value with the threshold value.\"\r\n                        }\r\n                      },\r\n                      \"threshold\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"0\",\r\n                        \"metadata\": {\r\n                          \"description\": \"The threshold value at which the alert is activated.\"\r\n                        }\r\n                      },\r\n                      \"timeAggregation\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"Average\",\r\n                        \"allowedValues\": [\r\n                          \"Average\",\r\n                          \"Minimum\",\r\n                          \"Maximum\",\r\n                          \"Total\"\r\n                        ],\r\n                        \"metadata\": {\r\n                          \"description\": \"How the data that is collected should be combined over time.\"\r\n                        }\r\n                      },\r\n                      \"windowSize\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"PT5M\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Period of time used to monitor alert activity based on the threshold. Must be between five minutes and one day. ISO 8601 duration format.\"\r\n                        }\r\n                      },\r\n                      \"evaluationFrequency\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"PT1M\",\r\n                        \"metadata\": {\r\n                          \"description\": \"how often the metric alert is evaluated represented in ISO 8601 duration format\"\r\n                        }\r\n                      },\r\n                      \"actionGroupId\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"\",\r\n                        \"metadata\": {\r\n                          \"description\": \"The ID of the action group that is triggered when the alert is activated or deactivated\"\r\n                        }\r\n                      },\r\n                      \"resourceType\": {\r\n                        \"type\": \"string\",\r\n                        \"metadata\": {\r\n                          \"description\": \"The resource type of target resource.\"\r\n                        }\r\n                      },\r\n                      \"targetResourceName\": {\r\n                        \"type\": \"string\",\r\n                        \"metadata\": {\r\n                          \"description\": \"The target resource name.\"\r\n                        }\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"targetResourceType\": \"[parameters('resourceType')]\",\r\n                      \"resourceIdentifier\": \"[resourceId(variables('targetResourceType'), parameters('targetResourceName'))]\",\r\n                      \"alertName\": \"[concat(toLower(parameters('alertNamePrefix')), uniqueString(resourceGroup().id))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[variables('alertName')]\",\r\n                        \"type\": \"Microsoft.Insights/metricAlerts\",\r\n                        \"location\": \"global\",\r\n                        \"apiVersion\": \"2018-03-01\",\r\n                        \"tags\": {},\r\n                        \"properties\": {\r\n                          \"description\": \"[parameters('alertDescription')]\",\r\n                          \"severity\": \"[parameters('alertSeverity')]\",\r\n                          \"enabled\": \"[parameters('isEnabled')]\",\r\n                          \"scopes\": [\r\n                            \"[variables('resourceIdentifier')]\"\r\n                          ],\r\n                          \"evaluationFrequency\": \"[parameters('evaluationFrequency')]\",\r\n                          \"windowSize\": \"[parameters('windowSize')]\",\r\n                          \"criteria\": {\r\n                            \"odata.type\": \"Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria\",\r\n                            \"allOf\": [\r\n                              {\r\n                                \"name\": \"1st criterion\",\r\n                                \"metricName\": \"[parameters('metricName')]\",\r\n                                \"dimensions\": [],\r\n                                \"operator\": \"[parameters('operator')]\",\r\n                                \"threshold\": \"[parameters('threshold')]\",\r\n                                \"timeAggregation\": \"[parameters('timeAggregation')]\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          \"actions\": [\r\n                            {\r\n                              \"actionGroupId\": \"[parameters('actionGroupId')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"alertNamePrefix\": {\r\n                      \"value\": \"[parameters('alertNamePrefix')]\"\r\n                    },\r\n                    \"alertDescription\": {\r\n                      \"value\": \"[parameters('alertDescription')]\"\r\n                    },\r\n                    \"alertSeverity\": {\r\n                      \"value\": \"[parameters('alertSeverity')]\"\r\n                    },\r\n                    \"isEnabled\": {\r\n                      \"value\": \"[parameters('isEnabled')]\"\r\n                    },\r\n                    \"metricName\": {\r\n                      \"value\": \"[parameters('metricName')]\"\r\n                    },\r\n                    \"operator\": {\r\n                      \"value\": \"[parameters('operator')]\"\r\n                    },\r\n                    \"threshold\": {\r\n                      \"value\": \"[parameters('threshold')]\"\r\n                    },\r\n                    \"timeAggregation\": {\r\n                      \"value\": \"[parameters('timeAggregation')]\"\r\n                    },\r\n                    \"windowSize\": {\r\n                      \"value\": \"[parameters('windowSize')]\"\r\n                    },\r\n                    \"evaluationFrequency\": {\r\n                      \"value\": \"[parameters('evaluationFrequency')]\"\r\n                    },\r\n                    \"actionGroupId\": {\r\n                      \"value\": \"[parameters('actionGroupId')]\"\r\n                    },\r\n                    \"resourceType\": {\r\n                      \"value\": \"[parameters('resourceType')]\"\r\n                    },\r\n                    \"targetResourceName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/6f2c6354-fc96-4f54-984e-8d49d06a80a3\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"6f2c6354-fc96-4f54-984e-8d49d06a80a3\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"testImageId\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"css\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"in\": [\r\n                  \"Microsoft.Compute/virtualMachines\",\r\n                  \"Microsoft.Compute/VirtualMachineScaleSets\"\r\n                ]\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Compute/imageId\",\r\n                  \"contains\": \"resourceGroups/testSandipsh\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/70dc1e8d-61c9-4089-8bf5-895b227c1298\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"70dc1e8d-61c9-4089-8bf5-895b227c1298\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Policy tracked resources SDK tests\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {\r\n          \"category\": \"\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/networkSecurityGroups\"\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"equals\": \"policyTrackedResources-sdk-tests\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Network/networkSecurityGroups/securityRules\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"name\",\r\n                \"notIn\": [\r\n                  \"policyTrackedResources-sdk-tests-rule1\",\r\n                  \"policyTrackedResources-sdk-tests-rule2\"\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"nsgName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-08-01\",\r\n                        \"type\": \"Microsoft.Network/networkSecurityGroups/securityRules\",\r\n                        \"name\": \"[concat(parameters('nsgName'), '/policyTrackedResources-sdk-tests-rule1')]\",\r\n                        \"properties\": {\r\n                          \"description\": \"Test Rule\",\r\n                          \"protocol\": \"Tcp\",\r\n                          \"sourcePortRange\": \"*\",\r\n                          \"destinationPortRange\": \"*\",\r\n                          \"sourceAddressPrefix\": \"*\",\r\n                          \"destinationAddressPrefix\": \"*\",\r\n                          \"access\": \"Allow\",\r\n                          \"priority\": 2000,\r\n                          \"direction\": \"Outbound\"\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2018-08-01\",\r\n                        \"type\": \"Microsoft.Network/networkSecurityGroups/securityRules\",\r\n                        \"name\": \"[concat(parameters('nsgName'), '/policyTrackedResources-sdk-tests-rule2')]\",\r\n                        \"properties\": {\r\n                          \"description\": \"Test Rule\",\r\n                          \"protocol\": \"Tcp\",\r\n                          \"sourcePortRange\": \"*\",\r\n                          \"destinationPortRange\": \"*\",\r\n                          \"sourceAddressPrefix\": \"*\",\r\n                          \"destinationAddressPrefix\": \"*\",\r\n                          \"access\": \"Allow\",\r\n                          \"priority\": 2001,\r\n                          \"direction\": \"Outbound\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"nsgName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/71289c53-22e7-4f31-a6dd-780b532380c2\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"71289c53-22e7-4f31-a6dd-780b532380c2\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deny if blob is not encrypted\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Storage/storageAccounts/enableBlobEncryption\",\r\n                  \"equals\": \"True\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/74d5cf40-7293-46a4-a285-7ea971e3719a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"74d5cf40-7293-46a4-a285-7ea971e3719a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[cstack] Location restriction\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Policy to force allocations to a set of given locations\",\r\n        \"metadata\": {\r\n          \"category\": \"cstack\"\r\n        },\r\n        \"parameters\": {\r\n          \"allowedLocations\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed locations\",\r\n              \"description\": \"The list of allowed locations for resources.\",\r\n              \"strongType\": \"location\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": \"[parameters('allowedLocations')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/763dcd1d-a4a9-46a8-8bd3-357c4533a335\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"763dcd1d-a4a9-46a8-8bd3-357c4533a335\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"chegg deploy VMSS extension\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachineScaleSets\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/VirtualMachineScaleSets/osProfile.windowsConfiguration\",\r\n                    \"exists\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                    \"equals\": \"MicrosoftWindowsServer\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/type\",\r\n                    \"equals\": \"GenevaMonitoring\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachineScaleSets/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Geneva\"\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"vmssName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-06-01\",\r\n                        \"name\": \"[concat(parameters('vmssName'), '/', 'genevaExtension2')]\",\r\n                        \"type\": \"Microsoft.Compute/virtualMachineScaleSets/extensions\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"publisher\": \"Microsoft.Azure.Geneva\",\r\n                          \"type\": \"GenevaMonitoring\",\r\n                          \"typeHandlerVersion\": \"1.0\",\r\n                          \"autoUpgradeMinorVersion\": true,\r\n                          \"settings\": {}\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vmssName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/767d74dd-8fe3-4ef2-a38a-52164f9230da\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"767d74dd-8fe3-4ef2-a38a-52164f9230da\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"ICM 83577342 deny proxy resource location\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"https://icm.ad.msft.net/imp/v3/incidents/details/83577342/home\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"location\",\r\n                \"notEquals\": \"eastus\"\r\n              },\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.StreamAnalytics/streamingjobs/transformations\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/77429b44-aac1-4417-a53e-6900c07e11ac\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"77429b44-aac1-4417-a53e-6900c07e11ac\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Block TLS < 1.2\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Web/sites/config\"\r\n                  },\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Web/sites/slots/config\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"equals\": \"web\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Web/sites/config/minTlsVersion\",\r\n                \"notEquals\": \"1.2\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/78c5df31-2f05-4f4d-acfe-3e536d88c1bc\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"78c5df31-2f05-4f4d-acfe-3e536d88c1bc\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deny ActiveDirectory administrators\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"SQL\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"Microsoft.Sql/servers/administrators/administratorType\",\r\n            \"equals\": \"ActiveDirectory\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/7e520b19-dac2-4bbf-b27b-dcd67a3f60e0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7e520b19-dac2-4bbf-b27b-dcd67a3f60e0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"default value backslash weird chars\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {},\r\n        \"parameters\": {\r\n          \"allowedLocations\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed locations\",\r\n              \"description\": \"The list of allowed locations for resources.\"\r\n            },\r\n            \"defaultValue\": \"C:\\\\rs-pkgs;C:\\\\System Volume Information\\\\DFSR!@#$%^&*()_+=-{}[];:',.<>?~`/;C:\\\\hello\\\\there\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"equals\": \"[parameters('allowedLocations')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/7f4d769f-78db-46eb-ac3c-0b8214f8c245\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"7f4d769f-78db-46eb-ac3c-0b8214f8c245\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"akhe-incident-86230190-v2\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"reproing incident 86230190, https://icm.ad.msft.net/imp/v3/incidents/details/86230190/home\\n\\nAudits if a resource doesn't have a lock v2\",\r\n        \"metadata\": {\r\n          \"category\": \"akhe\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"type\",\r\n              \"equals\": \"Microsoft.Authorization/locks\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Authorization/locks\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Authorization/locks/level\",\r\n                \"in\": [\r\n                  \"ReadOnly\",\r\n                  \"CanNotDelete\"\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/83daa8ee-7c9a-470c-81a8-5a99ac09d134\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"83daa8ee-7c9a-470c-81a8-5a99ac09d134\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Case 118113021002127\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {},\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": null\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"WebApp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux,container\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites\",\r\n              \"existenceCondition\": {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/hostNames[*]\",\r\n                    \"contains\": \"northwell.io\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/86cd412c-c557-473b-984c-a5f15cdcb116\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"86cd412c-c557-473b-984c-a5f15cdcb116\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Parameterized effect (if location != eastus)\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"The policy effect.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"equals\": \"eastus\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/885f1dcb-a9c5-4c8c-8996-2702db44a2d2\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"885f1dcb-a9c5-4c8c-8996-2702db44a2d2\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"jilim exists\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"tags.xyz\",\r\n              \"exists\": false\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/8959fd87-c1dd-4831-9034-a4f876bee1cc\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8959fd87-c1dd-4831-9034-a4f876bee1cc\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Kubernetes ingress policy\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"indexed\",\r\n        \"description\": \"Only specified ingress is allowed based on names\",\r\n        \"metadata\": {\r\n          \"category\": \"Kubernetes\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.ContainerService/managedClusters\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/8dc89b7c-4ffa-4051-b93e-4e8f1bd5631a\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8dc89b7c-4ffa-4051-b93e-4e8f1bd5631a\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"elpere applicability test 1\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/whatever\"\r\n              },\r\n              {\r\n                \"field\": \"tags.applicability\",\r\n                \"exists\": \"true\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/8e6b598c-1a45-404b-97dd-983e37c040da\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"8e6b598c-1a45-404b-97dd-983e37c040da\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"audit_cosmosdb_ipRangeFilter\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.DocumentDB/databaseAccounts\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.DocumentDB/databaseAccounts/ipRangeFilter\",\r\n                  \"equals\": \"lalala\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/9012b1cd-b045-46c6-a510-6137e06a009c\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9012b1cd-b045-46c6-a510-6137e06a009c\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"default value backslash (array)\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {},\r\n        \"parameters\": {\r\n          \"allowedLocations\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed locations\",\r\n              \"description\": \"The list of allowed locations for resources.\"\r\n            },\r\n            \"defaultValue\": [\r\n              \"C:\\\\rs-pkgs\",\r\n              \"C:\\\\System Volume Information\\\\DFSR\"\r\n            ]\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": \"[parameters('allowedLocations')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/985adbc0-6d2e-448a-ac26-89d3688191d5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"985adbc0-6d2e-448a-ac26-89d3688191d5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"github209\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"Audit diagnostic setting for selected resource types\",\r\n        \"metadata\": {\r\n          \"category\": \"Monitoring\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"AuditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/virtualNetworkRules\"\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/9a060c03-fda7-4b0a-b4da-15e2b7e4d117\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"9a060c03-fda7-4b0a-b4da-15e2b7e4d117\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"akhe - Subscription Lvl test\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Subscriptionlevel auditIfNotExist policy\",\r\n        \"metadata\": {\r\n          \"category\": \"akhe\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"source\": \"action\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions/write\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Authorization/locks\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"name\",\r\n                \"equals\": \"testlock\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/a1b067c8-2970-4c0b-b0da-31ae7f33d1de\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"a1b067c8-2970-4c0b-b0da-31ae7f33d1de\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[cstack] Noop\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Don't do anything\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": [\r\n              \"yabba\",\r\n              \"dabba\",\r\n              \"doo\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/a309ad64-0bae-48d9-a6b1-d99c0b4218b6\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"a309ad64-0bae-48d9-a6b1-d99c0b4218b6\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"HTTPS For Web Apps\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"CSS\",\r\n        \"metadata\": {\r\n          \"category\": \"WebApps\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyof\": [\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Web/sites/httpsOnly\",\r\n                      \"exists\": \"true\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Web/sites/httpsOnly\",\r\n                    \"equals\": \"false\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/a337c781-c7d8-4e12-ae69-1951c7e74378\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"a337c781-c7d8-4e12-ae69-1951c7e74378\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Case 118113021002127 - better\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {},\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": null\r\n            },\r\n            \"allowedValues\": [\r\n              \"Audit\",\r\n              \"Disabled\",\r\n              \"Deny\"\r\n            ],\r\n            \"defaultValue\": \"Audit\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"WebApp\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux\"\r\n                  },\r\n                  {\r\n                    \"field\": \"kind\",\r\n                    \"equals\": \"app,linux,container\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Web/sites/hostNames[*]\",\r\n                \"contains\": \"81196380\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/a514cb15-f9d8-49c9-a1e1-8b6d1fe19121\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"a514cb15-f9d8-49c9-a1e1-8b6d1fe19121\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Ensure https traffic only for storage account\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"Ensure https traffic only for storage account\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Storage/storageAccounts/supportsHttpsTrafficOnly\",\r\n                  \"equals\": \"true\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/a5f66345-5fb9-4dfd-864a-e3464ee6c0c4\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"a5f66345-5fb9-4dfd-864a-e3464ee6c0c4\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"add subscription name tag\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"add subscription name tag\",\r\n        \"metadata\": {\r\n          \"category\": \"camarvin\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"tags.subscriptionname\",\r\n            \"exists\": \"false\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"tags.subscriptionname\",\r\n                \"value\": \"[subscription().displayName]\"\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/a752f8cb-6498-4e40-8431-b658ca4d82a2\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"a752f8cb-6498-4e40-8431-b658ca4d82a2\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Add subscription \\\"id\\\" tag\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"camarvin\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"tags.id\",\r\n            \"exists\": \"false\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"tags.id\",\r\n                \"value\": \"[subscription().id]\"\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/a752f8cb-6498-4e40-8431-b658ca4d8339\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"a752f8cb-6498-4e40-8431-b658ca4d8339\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"add subscriptionId tag\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"camarvin\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"tags.subscriptionId\",\r\n            \"exists\": \"false\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"tags.subscriptionId\",\r\n                \"value\": \"[subscription().subscriptionId]\"\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/a752f8cb-6498-4e40-8431-b658ca4d8635\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"a752f8cb-6498-4e40-8431-b658ca4d8635\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"robgaNSGtest\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/networkSecurityGroups/securityRules\"\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/access\",\r\n                    \"equals\": \"Allow\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/direction\",\r\n                    \"equals\": \"Inbound\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRange\",\r\n                        \"equals\": \"3389\"\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRanges[*]\",\r\n                          \"notEquals\": \"3389\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefix\",\r\n                        \"in\": [\r\n                          \"*\",\r\n                          \"Internet\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefixes[*]\",\r\n                          \"notIn\": [\r\n                            \"*\",\r\n                            \"Internet\"\r\n                          ]\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/aeb6a524-e3d1-4b8a-afa8-26ae4e291116\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"aeb6a524-e3d1-4b8a-afa8-26ae4e291116\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Allowed Location Indexed\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"hackathon policy\",\r\n        \"parameters\": {\r\n          \"allowedLocations\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed locations\",\r\n              \"description\": \"The list of allowed locations for resources.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": \"[parameters('allowedLocations')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/Allowed-Locations-Indexed\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"Allowed-Locations-Indexed\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit if antiMalware extension does not exist\",\r\n        \"policyType\": \"Custom\",\r\n        \"description\": \"This policy audits if the anti malware extension .\",\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"AuditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"Microsoft.Azure.Security\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"IaaSAntimalware\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/antiMalwareExtensionExists\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"antiMalwareExtensionExists\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Web socket must be disabled on App Services\",\r\n        \"policyType\": \"Custom\",\r\n        \"description\": \"Ensures web sockets are disabled on App Services.\",\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"location\",\r\n            \"equals\": \"foo\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/AppServiceWebSockets\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"AppServiceWebSockets\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Azure Security Center must be enabled\",\r\n        \"policyType\": \"Custom\",\r\n        \"description\": \"Ensures Azure Security Center is enabled.\",\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"location\",\r\n            \"equals\": \"foo\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/ASCEnabled\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"ASCEnabled\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit a tag and it's value\",\r\n        \"policyType\": \"Custom\",\r\n        \"description\": \"Audits if a tag and it's value doesn't exist for a given resource\",\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"The name for the tag\",\r\n              \"description\": \"The name for the tag.\"\r\n            },\r\n            \"allowedValues\": []\r\n          },\r\n          \"tagValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"The value for the tag\",\r\n              \"description\": \"The value for the tag\"\r\n            },\r\n            \"allowedValues\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"[concat('tags.',parameters('tagName'))]\",\r\n              \"equals\": \"[parameters('tagValue')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/Audit a tag and it's value\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"Audit a tag and it's value\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit a tag and it's value\",\r\n        \"policyType\": \"Custom\",\r\n        \"description\": \"Audits if a tag and it's value doesn't exist for a given resource\",\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"The name for the tag\",\r\n              \"description\": \"The name for the tag.\"\r\n            },\r\n            \"allowedValues\": []\r\n          },\r\n          \"tagValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"The value for the tag\",\r\n              \"description\": \"The value for the tag\"\r\n            },\r\n            \"allowedValues\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"[concat('tags.',parameters('tagName'))]\",\r\n              \"equals\": \"[parameters('tagValue')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/Audit a tag and its value\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"Audit a tag and its value\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit if extension does not exist\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy audits if a required extension doesn't exist.\",\r\n        \"parameters\": {\r\n          \"publisher\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"description\": \"The publisher of the extension\",\r\n              \"displayName\": \"Extension Publisher\"\r\n            }\r\n          },\r\n          \"type\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"description\": \"The type of the extension\",\r\n              \"displayName\": \"Extension Type\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                \"in\": [\r\n                  \"MicrosoftWindowsServer\"\r\n                ]\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Compute/imageOffer\",\r\n                \"in\": [\r\n                  \"WindowsServer\"\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Compute/virtualMachines/extensions\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/publisher\",\r\n                    \"equals\": \"[parameters('publisher')]\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Compute/virtualMachines/extensions/type\",\r\n                    \"equals\": \"[parameters('type')]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/audit-vm-extension\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"audit-vm-extension\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"CanCrudPolicyAssignment Policy Definition $[Auto Test]\",\r\n        \"policyType\": \"Custom\",\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"source\": \"action\",\r\n            \"equals\": \"ResourceProviderTestHost/TestResourceType/TestResourceTypeNestedOne/write\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/azsmnet6487\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"azsmnet6487\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"89322663 audit diag setting\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {},\r\n        \"parameters\": {\r\n          \"listOfResourceTypes\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Resource Types\",\r\n              \"description\": \"The list of resources types to audit for missing diagnostic log settings.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"in\": \"[parameters('listOfResourceTypes')]\"\r\n          },\r\n          \"then\": {\r\n            \"details\": {\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"equals\": \"true\",\r\n                    \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\"\r\n                  }\r\n                ]\r\n              },\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\"\r\n            },\r\n            \"effect\": \"AuditIfNotExists\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/b350b9b0-8ba5-4867-bc9c-63b4544671b9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"b350b9b0-8ba5-4867-bc9c-63b4544671b9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"makharchtest\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"policy\",\r\n        \"metadata\": {\r\n          \"category\": \"\"\r\n        },\r\n        \"parameters\": {\r\n          \"allowedLocations\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed locations\",\r\n              \"description\": \"The list of allowed locations for resources.\",\r\n              \"strongType\": \"location\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": \"[parameters('allowedLocations')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/b36f6195-0fc5-4a41-bbce-875248400f5f\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"b36f6195-0fc5-4a41-bbce-875248400f5f\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"default value backslash really long string\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {},\r\n        \"parameters\": {\r\n          \"allowedLocations\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed locations\",\r\n              \"description\": \"The list of allowed locations for resources.\"\r\n            },\r\n            \"defaultValue\": \"C:\\\\rs-pkgs;C:\\\\System Volume Information\\\\DFSR;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple;C:\\\\Really Long Path\\\\We Want Multiple\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"equals\": \"[parameters('allowedLocations')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/b9203c56-0565-434a-a315-87f4da9f21b9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"b9203c56-0565-434a-a315-87f4da9f21b9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"NSG Rules exists test\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allof\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/networkSecurityGroups\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules[*].protocol\",\r\n                  \"notLike\": \"*\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/bb6a78ae-8737-41e0-9c41-cc777c8c00a0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"bb6a78ae-8737-41e0-9c41-cc777c8c00a0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit allowed locations\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {\r\n          \"allowedLocations\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed locations\",\r\n              \"description\": \"The list of allowed locations for resources.\",\r\n              \"strongType\": \"location\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": \"[parameters('allowedLocations')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/c0f586f1-abe5-4801-8588-7332e49e60c9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"c0f586f1-abe5-4801-8588-7332e49e60c9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"234\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"indexed\",\r\n        \"metadata\": {},\r\n        \"parameters\": {\r\n          \"effect\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Effect\",\r\n              \"description\": \"Enable or disable the execution of the policy\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"AuditIfNotExists\",\r\n              \"Disabled\"\r\n            ],\r\n            \"defaultValue\": \"AuditIfNotExists\"\r\n          },\r\n          \"requiredRetentionDays\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Required retention (days)\",\r\n              \"description\": \"The required diagnostic logs retention in days\"\r\n            },\r\n            \"defaultValue\": \"365\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Insights/logprofiles\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"[parameters('effect')]\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/logprofiles\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/logprofiles/retentionPolicy.enabled\",\r\n                    \"equals\": \"true\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Insights/logprofiles/retentionPolicy.days\",\r\n                    \"equals\": \"[parameters('requiredRetentionDays')]\"\r\n                  }\r\n                ]\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/c37cc5ff-3fbb-4444-a39d-09b9e6fb7116\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"c37cc5ff-3fbb-4444-a39d-09b9e6fb7116\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Doublecheck the lifecycle tag policy\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"This policy refers to tags['Lifecycle'], which with the current implementation of the escaped tags syntax will refer to a tag named 'Lifecycle' (quotes and all). This is a customer policy that would be broken when I switch the meaning of tags['Lifecycle'] to refer simply to a tag named Lifecycle (no quotes)\",\r\n        \"metadata\": {\r\n          \"category\": \"camarvin\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"tags['Lifecycle']\",\r\n            \"notIn\": [\r\n              \"dev\",\r\n              \"tst\",\r\n              \"stg\",\r\n              \"prd\",\r\n              \"trn\",\r\n              \"prf\"\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/c6be98a9-8108-40aa-b726-d2ae8e2891b9\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"c6be98a9-8108-40aa-b726-d2ae8e2891b9\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"akhe resource group auditIfNotExists\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Resources/subscriptions/resourceGroups\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Authorization/locks\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"name\",\r\n                \"equals\": \"testlock\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/c7b9982d-2f50-4730-935f-5c241982a441\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"c7b9982d-2f50-4730-935f-5c241982a441\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"jilim allowed resource types\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {\r\n          \"allowedTypes\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed resource types\",\r\n              \"description\": \"The list of allowed resource types\",\r\n              \"strongType\": \"resourceTypes\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"type\",\r\n              \"in\": \"[parameters('allowedTypes')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/c872f951-1c5d-4c61-89dd-aee2350a11ba\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"c872f951-1c5d-4c61-89dd-aee2350a11ba\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit location\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"parameters\": {\r\n          \"allowedLocations\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed locations\",\r\n              \"description\": \"The list of allowed locations for resources.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": \"[parameters('allowedLocations')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/c8b79b49-a579-4045-984e-1b249ab8b474\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"c8b79b49-a579-4045-984e-1b249ab8b474\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit SQL TDE\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Sql/servers/databases/transparentDataEncryption\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Sql/transparentDataEncryption.status\",\r\n                \"notEquals\": \"enabled\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/c8cedfaa-4aa0-465a-8b90-49caf8177158\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"c8cedfaa-4aa0-465a-8b90-49caf8177158\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"elpere css block NSG changes\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"https://icm.ad.msft.net/imp/v3/incidents/details/95894791/home\",\r\n        \"metadata\": {},\r\n        \"parameters\": {\r\n          \"nsgName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"nsgName\",\r\n              \"description\": \"The name of the NSG.\"\r\n            },\r\n            \"defaultValue\": \"nsgName\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"anyOf\": [\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Network/networkSecurityGroups\"\r\n                  },\r\n                  {\r\n                    \"field\": \"name\",\r\n                    \"equals\": \"[parameters('nsgName')]\"\r\n                  }\r\n                ]\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"field\": \"type\",\r\n                    \"equals\": \"Microsoft.Network/networkSecurityGroups/securityRules\"\r\n                  },\r\n                  {\r\n                    \"field\": \"fullName\",\r\n                    \"like\": \"[concat(parameters('nsgName'), '/*')]\"\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/ca01432d-4278-45a6-8137-69f2155d2248\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"ca01432d-4278-45a6-8137-69f2155d2248\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"camarvin empty string\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"Ensure resource names meet the like condition for a pattern.\",\r\n        \"metadata\": {},\r\n        \"parameters\": {\r\n          \"namePattern\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"namePattern\",\r\n              \"description\": \"Pattern to use for names. Can include wildcard (*).\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"\",\r\n              \"one\",\r\n              \"two\"\r\n            ],\r\n            \"defaultValue\": \"\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"name\",\r\n              \"equals\": \"[parameters('namePattern')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/camarvin-test-empty-assign\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"camarvin-test-empty-assign\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"elpere append 'test' tag\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"name\",\r\n            \"equals\": \"elpereKv\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"append\",\r\n            \"details\": [\r\n              {\r\n                \"field\": \"tags.test\",\r\n                \"value\": \"1\"\r\n              }\r\n            ]\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/ced59ff0-9061-49dd-94de-093b33a640cf\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"ced59ff0-9061-49dd-94de-093b33a640cf\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"elpere deny on 'test' tag\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"tags.test\",\r\n            \"equals\": \"1\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/ced59ff0-9061-49dd-94de-093b33a640d7\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"ced59ff0-9061-49dd-94de-093b33a640d7\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Resource name contains resource group name\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Require resources to contain the resource group's name\",\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"name\",\r\n            \"notContains\": \"[resourceGroup().name]\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/contain-resource-group-name\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"contain-resource-group-name\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"akhe-incident-86226837-v3\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"third attempt to repro this incident. \",\r\n        \"metadata\": {\r\n          \"category\": \"akhe\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Sql/servers\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Sql/servers/firewallRules\"\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/d03e03ca-6424-4e28-8842-5796dc0b5002\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"d03e03ca-6424-4e28-8842-5796dc0b5002\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"akhe-incident-86230190-deployIfNotExists\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"deploys a delete lock for a resource \",\r\n        \"metadata\": {\r\n          \"category\": \"akhe\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"type\",\r\n              \"equals\": \"Microsoft.Authorization/locks\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Authorization/locks\",\r\n              \"roleDefinitionIds\": [\r\n                \"/subscriptions/0b88dfdb-55b3-4fb0-b474-5b6dcbe6b2ef/providers/Microsoft.Authorization/roleDefinitions/8e3af657-a8ff-443c-a75c-2fe8c4bcb635\"\r\n              ],\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Authorization/locks/level\",\r\n                \"in\": [\r\n                  \"CanNotDelete\"\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {},\r\n                    \"variables\": {},\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.Authorization/locks\",\r\n                        \"apiVersion\": \"2015-01-01\",\r\n                        \"name\": \"DeleteLock\",\r\n                        \"properties\": {\r\n                          \"level\": \"CanNotDelete\",\r\n                          \"notes\": \"prevent deletion\"\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"outputs\": {}\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/d03e03ca-6424-4e28-8842-5796dc0b5632\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"d03e03ca-6424-4e28-8842-5796dc0b5632\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Enforce KeyVault diagnostic log storage (elpere)\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"Ensures that AuditEvents are collected from all Key Vaults in the subscription and stored in a specific storage account for 30 days.\",\r\n        \"metadata\": {\r\n          \"category\": \"Key Vault\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.KeyVault/vaults\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                \"equals\": \"true\"\r\n              },\r\n              \"roleDefinitionIds\": [\r\n                \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/roleDefinitions/749f88d5-cbae-40b8-bcfc-e573ddc772fa\",\r\n                \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/roleDefinitions/17d1049b-9a84-46fb-8f53-869881c3d3ab\"\r\n              ],\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"variables\": {\r\n                      \"storageName\": \"elperetest\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"type\": \"Microsoft.KeyVault/vaults/providers/diagnosticSettings\",\r\n                        \"name\": \"[concat(parameters('vaultName'),'/Microsoft.Insights/setbypolicy')]\",\r\n                        \"apiVersion\": \"2017-05-01-preview\",\r\n                        \"location\": \"[parameters('location')]\",\r\n                        \"properties\": {\r\n                          \"storageAccountId\": \"[resourceid('elpere', 'Microsoft.Storage/storageAccounts', variables('storageName'))]\",\r\n                          \"logs\": [\r\n                            {\r\n                              \"category\": \"AuditEvent\",\r\n                              \"enabled\": true,\r\n                              \"retentionPolicy\": {\r\n                                \"enabled\": true,\r\n                                \"days\": 30\r\n                              }\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ],\r\n                    \"parameters\": {\r\n                      \"vaultName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"vaultName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/d0d9349d-843c-443a-9f27-5ce84f08c37e\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"d0d9349d-843c-443a-9f27-5ce84f08c37e\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"elpere deny test\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"name\",\r\n            \"equals\": \"elpereKv\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/d1c0e77c-53b4-4c4d-a1f5-c535a370b0c5\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"d1c0e77c-53b4-4c4d-a1f5-c535a370b0c5\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Access KV as part of remidiation deployment test (elpere)\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"\",\r\n        \"metadata\": {\r\n          \"category\": \"Key Vault\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.KeyVault/vaults\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/diagnosticSettings\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"Microsoft.Insights/diagnosticSettings/logs.enabled\",\r\n                \"equals\": \"hello\"\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"Incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"resources\": [],\r\n                    \"parameters\": {\r\n                      \"testSecret\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"outputs\": {\r\n                      \"testSecretOutput\": {\r\n                        \"type\": \"string\",\r\n                        \"value\": \"[parameters('testSecret')]\"\r\n                      }\r\n                    }\r\n                  },\r\n                  \"parameters\": {\r\n                    \"testSecret\": {\r\n                      \"reference\": {\r\n                        \"keyVault\": {\r\n                          \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/resourceGroups/elpere/providers/Microsoft.KeyVault/vaults/elpereKv\"\r\n                        },\r\n                        \"secretName\": \"test\"\r\n                      }\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/d35ce9be-f51b-4d3e-bc7f-dde2936381b0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"d35ce9be-f51b-4d3e-bc7f-dde2936381b0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deploy security rule with restricted source IPs (NSG level)\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Overwrites security rules with IP restrictions at the NSG level\",\r\n        \"metadata\": {\r\n          \"category\": \"Port Lockdown\"\r\n        },\r\n        \"parameters\": {\r\n          \"destinationPortRanges\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Destination port ranges\",\r\n              \"description\": \"Destination port ranges requiring IP restrictions. Ranges may overlap.\"\r\n            }\r\n          },\r\n          \"sourceAddressPrefixes\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"IP restriction prefixes\",\r\n              \"description\": \"The IP ranges incoming traffic will be restricted to. I.e. 192.4.0.0/8;192.5.0.0/8\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/networkSecurityGroups\"\r\n              },\r\n              {\r\n                \"anyOf\": [\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules[*].destinationPortRange\",\r\n                      \"notIn\": \"[parameters('destinationPortRanges')]\"\r\n                    }\r\n                  },\r\n                  {\r\n                    \"not\": {\r\n                      \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules[*].destinationPortRanges[*]\",\r\n                      \"notIn\": \"[parameters('destinationPortRanges')]\"\r\n                    }\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Network/networkSecurityGroups/securityRules\",\r\n              \"existenceCondition\": {\r\n                \"allOf\": [\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRange\",\r\n                        \"in\": \"[parameters('destinationPortRanges')]\"\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRanges[*]\",\r\n                          \"notIn\": \"[parameters('destinationPortRanges')]\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/access\",\r\n                    \"equals\": \"Allow\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/direction\",\r\n                    \"equals\": \"Inbound\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefixes[*]\",\r\n                            \"exists\": \"true\"\r\n                          },\r\n                          {\r\n                            \"not\": {\r\n                              \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefixes[*]\",\r\n                              \"notLike\": \"*\"\r\n                            }\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefixes[*]\",\r\n                            \"notIn\": [\r\n                              \"*\",\r\n                              \"Internet\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"allOf\": [\r\n                          {\r\n                            \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefix\",\r\n                            \"exists\": \"true\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefix\",\r\n                            \"notEquals\": \"\"\r\n                          },\r\n                          {\r\n                            \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefix\",\r\n                            \"notIn\": [\r\n                              \"*\",\r\n                              \"Internet\"\r\n                            ]\r\n                          }\r\n                        ]\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              },\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"nsgName\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"location\": {\r\n                        \"type\": \"string\"\r\n                      },\r\n                      \"destinationPortRanges\": {\r\n                        \"type\": \"array\"\r\n                      },\r\n                      \"sourceAddressPrefixes\": {\r\n                        \"type\": \"array\"\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"getNsgDeploymentName\": \"[concat('getNSGContent-', parameters('nsgName'))]\",\r\n                      \"collectorDeploymentName\": \"[concat('collectRules-', parameters('nsgName'))]\",\r\n                      \"overwriteNsgDeploymentName\": \"[concat('overwriteNsg-', parameters('nsgName'))]\",\r\n                      \"nsgResourceId\": \"[resourceId(subscription().subscriptionId, resourceGroup().name, 'Microsoft.Network/networkSecurityGroups', parameters('nsgName'))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-02-01\",\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('getNsgDeploymentName')]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"template\": {\r\n                            \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                            \"contentVersion\": \"1.0.0.0\",\r\n                            \"resources\": [],\r\n                            \"outputs\": {\r\n                              \"nsgProperties\": {\r\n                                \"type\": \"object\",\r\n                                \"value\": \"[reference(variables('nsgResourceId'), '2018-03-01', 'Full')]\"\r\n                              }\r\n                            }\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2018-02-01\",\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('collectorDeploymentName')]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"templateLink\": {\r\n                            \"uri\": \"https://portlockdown.blob.core.windows.net/portlockdown-templates/SecurityRule_NSGLevel_collectRules_template.json\",\r\n                            \"contentVersion\": \"1.0.0.0\"\r\n                          },\r\n                          \"parameters\": {\r\n                            \"nsgProperties\": {\r\n                              \"value\": \"[reference(variables('getNsgDeploymentName')).outputs.nsgProperties.value]\"\r\n                            },\r\n                            \"nsgName\": {\r\n                              \"value\": \"[parameters('nsgName')]\"\r\n                            },\r\n                            \"location\": {\r\n                              \"value\": \"[parameters('location')]\"\r\n                            },\r\n                            \"portRangesToRestrict\": {\r\n                              \"value\": \"[parameters('destinationPortRanges')]\"\r\n                            },\r\n                            \"sourceAddressPrefixes\": {\r\n                              \"value\": \"[parameters('sourceAddressPrefixes')]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      },\r\n                      {\r\n                        \"apiVersion\": \"2018-02-01\",\r\n                        \"type\": \"Microsoft.Resources/deployments\",\r\n                        \"name\": \"[variables('overwriteNsgDeploymentName')]\",\r\n                        \"properties\": {\r\n                          \"mode\": \"Incremental\",\r\n                          \"templateLink\": {\r\n                            \"uri\": \"https://portlockdown.blob.core.windows.net/portlockdown-templates/SecurityRule_NSGLevel_overwriteNSG_template.json\",\r\n                            \"contentVersion\": \"1.0.0.0\"\r\n                          },\r\n                          \"parameters\": {\r\n                            \"originalNsgProperties\": {\r\n                              \"value\": \"[reference(variables('getNsgDeploymentName')).outputs.nsgProperties.value]\"\r\n                            },\r\n                            \"updatedSecurityRules\": {\r\n                              \"value\": \"[reference(variables('collectorDeploymentName')).outputs.updatedSecurityRules.value]\"\r\n                            },\r\n                            \"nsgName\": {\r\n                              \"value\": \"[parameters('nsgName')]\"\r\n                            },\r\n                            \"location\": {\r\n                              \"value\": \"[parameters('location')]\"\r\n                            }\r\n                          }\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"nsgName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    },\r\n                    \"sourceAddressPrefixes\": {\r\n                      \"value\": \"[parameters('sourceAddressPrefixes')]\"\r\n                    },\r\n                    \"destinationPortRanges\": {\r\n                      \"value\": \"[parameters('destinationPortRanges')]\"\r\n                    },\r\n                    \"location\": {\r\n                      \"value\": \"[field('location')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/d7b13c30-e6aa-47e1-b50a-8e33f152d086\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"d7b13c30-e6aa-47e1-b50a-8e33f152d086\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit storage account SKUs\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"Demo 323\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfAllowedSKUs\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Audited skus\",\r\n              \"description\": \"The list of skus.\",\r\n              \"strongType\": \"storageSkus\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Storage/storageAccounts\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Storage/storageAccounts/sku.name\",\r\n                  \"in\": \"[parameters('listOfAllowedSKUs')]\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/dbe1e663-7265-4cf4-96b5-7435b21e90ee\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"dbe1e663-7265-4cf4-96b5-7435b21e90ee\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit virtual machines SKUs\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"Demo 323\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfAllowedSKUs\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"List Of Allowed SKUs\",\r\n              \"description\": \"The list of allowed locations for resources.\",\r\n              \"strongType\": \"vmSKUs\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Compute/virtualMachines\"\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"Microsoft.Compute/virtualMachines/sku.name\",\r\n                  \"in\": \"[parameters('listOfAllowedSKUs')]\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/dbe1e663-7265-4cf4-96b5-7435b21e9170\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"dbe1e663-7265-4cf4-96b5-7435b21e9170\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"[elpere] deployIfNotExists Runners test\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Network/networkSecurityGroups\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Network/networkSecurityGroups/securityRules\",\r\n              \"name\": \"deployIfNotExistsTestsRule\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"nsgName\": {\r\n                        \"type\": \"string\"\r\n                      }\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"apiVersion\": \"2018-08-01\",\r\n                        \"type\": \"Microsoft.Network/networkSecurityGroups/securityRules\",\r\n                        \"name\": \"[concat(parameters('nsgName'), '/deployIfNotExistsTestsRule')]\",\r\n                        \"properties\": {\r\n                          \"protocol\": \"Tcp\",\r\n                          \"sourcePortRange\": \"*\",\r\n                          \"destinationPortRange\": \"*\",\r\n                          \"sourceAddressPrefix\": \"*\",\r\n                          \"destinationAddressPrefix\": \"*\",\r\n                          \"access\": \"Deny\",\r\n                          \"priority\": 2000,\r\n                          \"direction\": \"Outbound\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"nsgName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/dbfa9fc0-5202-4001-8759-1aa2387f825b\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"dbfa9fc0-5202-4001-8759-1aa2387f825b\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"allowedOS\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"test_sandipsh\"\r\n        },\r\n        \"parameters\": {\r\n          \"listOfAllowedWindows\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed Windows VMs\",\r\n              \"description\": \"The list of allowed VMs for Windows.\"\r\n            }\r\n          },\r\n          \"listOfAllowedUbuntus\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed Ubuntu VMs\",\r\n              \"description\": \"The list of allowed VMs for Ubuntu.\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"in\": [\r\n                  \"Microsoft.Compute/disks\",\r\n                  \"Microsoft.Compute/virtualMachines\",\r\n                  \"Microsoft.Compute/VirtualMachineScaleSets\"\r\n                ]\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"in\": [\r\n                        \"Canonical\"\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"in\": [\r\n                        \"UbuntuServer\"\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageSku\",\r\n                      \"in\": \"[parameters('listOfAllowedUbuntus')]\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageVersion\",\r\n                      \"in\": [\r\n                        \"latest\"\r\n                      ]\r\n                    }\r\n                  ]\r\n                }\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"allOf\": [\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imagePublisher\",\r\n                      \"in\": [\r\n                        \"MicrosoftWindowsServer\"\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageOffer\",\r\n                      \"in\": [\r\n                        \"WindowsServer\"\r\n                      ]\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageSku\",\r\n                      \"in\": \"[parameters('listOfAllowedWindows')]\"\r\n                    },\r\n                    {\r\n                      \"field\": \"Microsoft.Compute/imageVersion\",\r\n                      \"in\": [\r\n                        \"latest\"\r\n                      ]\r\n                    }\r\n                  ]\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/e2bdec61-8c05-4ad6-b8bf-cd1b0a87c091\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"e2bdec61-8c05-4ad6-b8bf-cd1b0a87c091\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"jilim recovery services backup policies\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {\r\n          \"category\": \"Test\"\r\n        },\r\n        \"parameters\": {\r\n          \"policies\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed Recovery Services backup policies\",\r\n              \"description\": \"The list of allowed Recovery Services backup policies.\",\r\n              \"strongType\": \"Microsoft.RecoveryServices/vaults/backupPolicies\"\r\n            }\r\n          },\r\n          \"policy\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Allowed Recovery Services backup policy\",\r\n              \"description\": \"Allowed Recovery Services backup policy.\",\r\n              \"strongType\": \"Microsoft.RecoveryServices/vaults/backupPolicies\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"location\",\r\n                  \"in\": \"[parameters('policies')]\"\r\n                }\r\n              },\r\n              {\r\n                \"not\": {\r\n                  \"field\": \"location\",\r\n                  \"equals\": \"[parameters('policy')]\"\r\n                }\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/e3f9a624-b17d-4dc8-9649-65814d3241bb\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"e3f9a624-b17d-4dc8-9649-65814d3241bb\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit web sites with tags on their authsettings\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"Seeing if authsettings can even be used in a ifnotexists policy before adding aliases.\",\r\n        \"metadata\": {\r\n          \"category\": \"\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Web/sites\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"authSettings\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"tags\",\r\n                \"exists\": \"false\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/e7c6ee79-2fdb-4c28-9a1f-9dcad3100120\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"e7c6ee79-2fdb-4c28-9a1f-9dcad3100120\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit web sites with tags on their logs config\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"description\": \"Seeing if authsettings can even be used in a ifnotexists policy before adding aliases.\",\r\n        \"metadata\": {\r\n          \"category\": \"\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"Microsoft.Web/sites\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"auditIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Web/sites/config\",\r\n              \"name\": \"logs\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"tags\",\r\n                \"exists\": \"false\"\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/e7c6ee79-2fdb-4c28-9a1f-9dcad3100125\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"e7c6ee79-2fdb-4c28-9a1f-9dcad3100125\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deny changing sites authsettings\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"all\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Web/sites/config\"\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"equals\": \"authsettings\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/e7c6ee79-2fdb-4c28-9a1f-9dcad31001bb\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"e7c6ee79-2fdb-4c28-9a1f-9dcad31001bb\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"defaultValue: all parameters\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {\r\n          \"category\": \"defaultValue\"\r\n        },\r\n        \"parameters\": {\r\n          \"locations\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Strong type (no scope, array)\",\r\n              \"description\": \"The list of locations for resources.\",\r\n              \"strongType\": \"location\"\r\n            },\r\n            \"defaultValue\": [\r\n              \"eastus\",\r\n              \"westus\"\r\n            ]\r\n          },\r\n          \"location\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Strong type (no scope, string)\",\r\n              \"description\": \"The location for resources.\",\r\n              \"strongType\": \"location\"\r\n            },\r\n            \"defaultValue\": \"eastus\"\r\n          },\r\n          \"resourceGroups\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Strong type (array)\",\r\n              \"description\": \"The list of resource groups.\",\r\n              \"strongType\": \"existingResourceGroups\"\r\n            },\r\n            \"defaultValue\": [\r\n              \"camarvin\"\r\n            ]\r\n          },\r\n          \"resourceGroup\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Strong type (string)\",\r\n              \"description\": \"The resource group.\",\r\n              \"strongType\": \"existingResourceGroups\"\r\n            },\r\n            \"defaultValue\": \"camarvin\"\r\n          },\r\n          \"tags\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Non strong type (array)\",\r\n              \"description\": \"The list of tags.\"\r\n            },\r\n            \"defaultValue\": []\r\n          },\r\n          \"tag\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Non strong type (string)\",\r\n              \"description\": \"The tag.\"\r\n            },\r\n            \"defaultValue\": \"\"\r\n          },\r\n          \"allowedLocations\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Strong type (no scope, array, av)\",\r\n              \"description\": \"The list of allowed locations for resources.\",\r\n              \"strongType\": \"location\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"eastus\",\r\n              \"westus\",\r\n              \"southus\"\r\n            ],\r\n            \"defaultValue\": [\r\n              \"eastus\"\r\n            ]\r\n          },\r\n          \"allowedLocation\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Strong type (no scope, string, av)\",\r\n              \"description\": \"The allowed location for resources.\",\r\n              \"strongType\": \"location\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"eastus\",\r\n              \"westus\",\r\n              \"southus\"\r\n            ],\r\n            \"defaultValue\": \"eastus\"\r\n          },\r\n          \"allowedStorageSKUs\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Strong type (array, av)\",\r\n              \"description\": \"The list of allowed storage SKUs for resources.\",\r\n              \"strongType\": \"storageSkus\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Standard_LRS\",\r\n              \"Standard_ZRS\",\r\n              \"Standard_GRS\"\r\n            ],\r\n            \"defaultValue\": [\r\n              \"Standard_LRS\",\r\n              \"Standard_ZRS\",\r\n              \"Standard_GRS\"\r\n            ]\r\n          },\r\n          \"allowedStorageSKU\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Strong type (string, av)\",\r\n              \"description\": \"The allowed storage SKU for resources.\",\r\n              \"strongType\": \"storageSkus\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"Standard_LRS\",\r\n              \"Standard_ZRS\",\r\n              \"Standard_GRS\"\r\n            ],\r\n            \"defaultValue\": \"Standard_LRS\"\r\n          },\r\n          \"allowedTags\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Non strong type (array, av)\",\r\n              \"description\": \"The list of allowed tags.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"FirstName\",\r\n              \"LastName\",\r\n              \"Age\"\r\n            ],\r\n            \"defaultValue\": [\r\n              \"FirstName\",\r\n              \"LastName\",\r\n              \"Age\"\r\n            ]\r\n          },\r\n          \"allowedTag\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Non strong type (string, av)\",\r\n              \"description\": \"The allowed tag.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"FirstName\",\r\n              \"LastName\",\r\n              \"Age\"\r\n            ],\r\n            \"defaultValue\": \"FirstName\"\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"location\",\r\n                \"in\": \"[parameters('locations')]\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"equals\": \"[parameters('location')]\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"in\": \"[parameters('resourceGroups')]\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"equals\": \"[parameters('resourceGroup')]\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"in\": \"[parameters('tags')]\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"equals\": \"[parameters('tag')]\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"in\": \"[parameters('allowedLocations')]\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"equals\": \"[parameters('allowedLocation')]\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"in\": \"[parameters('allowedStorageSkus')]\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"Equals\": \"[parameters('allowedStorageSku')]\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"in\": \"[parameters('allowedTags')]\"\r\n              },\r\n              {\r\n                \"field\": \"location\",\r\n                \"NotEquals\": \"[parameters('allowedTag')]\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/ea1688b3-022e-4add-af39-2fe60689a3b0\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"ea1688b3-022e-4add-af39-2fe60689a3b0\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Deny \\\"Allow All\\\" NSG rules\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Denies the creation of sourceAddressPrefix=\\\"*\\\", destinationPortRange=\\\"*\\\" NSG security rules\",\r\n        \"metadata\": {\r\n          \"category\": \"Port Lockdown\"\r\n        },\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"type\",\r\n                \"equals\": \"Microsoft.Network/networkSecurityGroups/securityRules\"\r\n              },\r\n              {\r\n                \"field\": \"name\",\r\n                \"notEquals\": \"PortLockdown_AllowAll\"\r\n              },\r\n              {\r\n                \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/priority\",\r\n                \"notEquals\": \"4000\"\r\n              },\r\n              {\r\n                \"allOf\": [\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRange\",\r\n                        \"equals\": \"*\"\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/destinationPortRanges[*]\",\r\n                          \"notEquals\": \"*\"\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/access\",\r\n                    \"equals\": \"Allow\"\r\n                  },\r\n                  {\r\n                    \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/direction\",\r\n                    \"equals\": \"Inbound\"\r\n                  },\r\n                  {\r\n                    \"anyOf\": [\r\n                      {\r\n                        \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefix\",\r\n                        \"in\": [\r\n                          \"*\",\r\n                          \"Internet\"\r\n                        ]\r\n                      },\r\n                      {\r\n                        \"not\": {\r\n                          \"field\": \"Microsoft.Network/networkSecurityGroups/securityRules/sourceAddressPrefixes[*]\",\r\n                          \"notIn\": [\r\n                            \"*\",\r\n                            \"Internet\"\r\n                          ]\r\n                        }\r\n                      }\r\n                    ]\r\n                  }\r\n                ]\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/ebcd21e9-b89f-4a22-8654-dd3a4d8b9321\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"ebcd21e9-b89f-4a22-8654-dd3a4d8b9321\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"github264\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"metadata\": {},\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"allOf\": [\r\n              {\r\n                \"field\": \"Microsoft.Web/sites/config/siteAuthSettings.enabled\",\r\n                \"equals\": \"false\"\r\n              }\r\n            ]\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/ef00ee9d-fe45-4d14-8bee-789eea392116\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"ef00ee9d-fe45-4d14-8bee-789eea392116\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"Audit allowed locations\",\r\n        \"policyType\": \"Custom\",\r\n        \"description\": \"This policy enables you to audit your location.\",\r\n        \"parameters\": {\r\n          \"listOfAllowedLocations\": {\r\n            \"type\": \"Array\",\r\n            \"metadata\": {\r\n              \"description\": \"The list of locations that can be specified when deploying resources.\",\r\n              \"strongType\": \"location\",\r\n              \"displayName\": \"Allowed locations\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"location\",\r\n              \"in\": \"[parameters('listOfAllowedLocations')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"Audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/LocationAuditDefinition\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"LocationAuditDefinition\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"policyType\": \"Custom\",\r\n        \"parameters\": {},\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"location\",\r\n            \"equals\": \"northeurope\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/policy2\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"policy2\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"testDisplay\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Updated Unit test junk: sorry for littering. Please delete me!\",\r\n        \"metadata\": {\r\n          \"testName\": \"testValue\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"source\": \"action\",\r\n            \"equals\": \"Microsoft.Resources/Subscriptions/ResourceGroups/write\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/ps6386\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"ps6386\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"Unit test junk: sorry for littering. Please delete me!\",\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"source\": \"action\",\r\n            \"equals\": \"Microsoft.Resources/Subscriptions/ResourceGroups/write\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/ps8886\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"ps8886\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"testDisplay\",\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"Indexed\",\r\n        \"description\": \"Updated Unit test junk: sorry for littering. Please delete me!\",\r\n        \"metadata\": {\r\n          \"testName\": \"testValue\"\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"source\": \"action\",\r\n            \"equals\": \"Microsoft.Resources/Subscriptions/ResourceGroups/write\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"deny\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/ps9652\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"ps9652\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"policyType\": \"Custom\",\r\n        \"mode\": \"All\",\r\n        \"description\": \"test policy\",\r\n        \"parameters\": {\r\n          \"resourceType\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Resource Type\",\r\n              \"description\": \"The target resource type.\"\r\n            }\r\n          },\r\n          \"alertNamePrefix\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Alert name prefix\",\r\n              \"description\": \"A prefix to be used for the metrics alert.\"\r\n            }\r\n          },\r\n          \"alertDescription\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Alert description.\",\r\n              \"description\": \"The description of alert.\"\r\n            }\r\n          },\r\n          \"alertSeverity\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"alertSeverity\",\r\n              \"description\": \"Severity of alert {0,1,2,3,4}\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"0\",\r\n              \"1\",\r\n              \"2\",\r\n              \"3\",\r\n              \"4\"\r\n            ]\r\n          },\r\n          \"isEnabled\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"isEnabled\",\r\n              \"description\": \"Specifies whether the alert is enabled.\"\r\n            },\r\n            \"allowedValues\": [\r\n              \"true\",\r\n              \"false\"\r\n            ]\r\n          },\r\n          \"metricName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Metric name\",\r\n              \"description\": \"The metric name.\"\r\n            }\r\n          },\r\n          \"operator\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Operator\",\r\n              \"description\": \"The operator comparing the current value with the threshold value.\"\r\n            }\r\n          },\r\n          \"threshold\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Threshold\",\r\n              \"description\": \"The threshold value at which the alert is activated.\"\r\n            }\r\n          },\r\n          \"timeAggregation\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"TimeAggregation\",\r\n              \"description\": \"How the data that is collected should be combined over time.\"\r\n            }\r\n          },\r\n          \"windowSize\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Window size\",\r\n              \"description\": \"Period of time used to monitor alert activity based on the threshold. Must be between five minutes and one day. ISO 8601 duration format.\"\r\n            }\r\n          },\r\n          \"evaluationFrequency\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"Evaluation Frequency\",\r\n              \"description\": \"How often the metric alert is evaluated represented in ISO 8601 duration format\"\r\n            }\r\n          },\r\n          \"actionGroupId\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"ActionGroupId\",\r\n              \"description\": \"The ID of the action group that is triggered when the alert is activated or deactivated\"\r\n            }\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"field\": \"type\",\r\n            \"equals\": \"[parameters('resourceType')]\"\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"DeployIfNotExists\",\r\n            \"details\": {\r\n              \"type\": \"Microsoft.Insights/metricAlerts\",\r\n              \"existenceCondition\": {\r\n                \"field\": \"name\",\r\n                \"equals\": \"[concat(parameters('alertNamePrefix'), '-', resourcegroup().name, '-', field('name'))]\"\r\n              },\r\n              \"existenceScope\": \"subscription\",\r\n              \"deployment\": {\r\n                \"properties\": {\r\n                  \"mode\": \"incremental\",\r\n                  \"template\": {\r\n                    \"$schema\": \"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#\",\r\n                    \"contentVersion\": \"1.0.0.0\",\r\n                    \"parameters\": {\r\n                      \"alertNamePrefix\": {\r\n                        \"type\": \"string\",\r\n                        \"minLength\": 1,\r\n                        \"metadata\": {\r\n                          \"description\": \"A prefix to be used for the metrics alert.\"\r\n                        }\r\n                      },\r\n                      \"alertDescription\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"This is a metric alert\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Description of alert\"\r\n                        }\r\n                      },\r\n                      \"alertSeverity\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"3\",\r\n                        \"allowedValues\": [\r\n                          \"0\",\r\n                          \"1\",\r\n                          \"2\",\r\n                          \"3\",\r\n                          \"4\"\r\n                        ],\r\n                        \"metadata\": {\r\n                          \"description\": \"Severity of alert {0,1,2,3,4}\"\r\n                        }\r\n                      },\r\n                      \"isEnabled\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"true\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Specifies whether the alert is enabled\"\r\n                        }\r\n                      },\r\n                      \"metricName\": {\r\n                        \"type\": \"string\",\r\n                        \"minLength\": 1,\r\n                        \"metadata\": {\r\n                          \"description\": \"Name of the metric used in the comparison to activate the alert.\"\r\n                        }\r\n                      },\r\n                      \"operator\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"GreaterThan\",\r\n                        \"allowedValues\": [\r\n                          \"Equals\",\r\n                          \"NotEquals\",\r\n                          \"GreaterThan\",\r\n                          \"GreaterThanOrEqual\",\r\n                          \"LessThan\",\r\n                          \"LessThanOrEqual\"\r\n                        ],\r\n                        \"metadata\": {\r\n                          \"description\": \"Operator comparing the current value with the threshold value.\"\r\n                        }\r\n                      },\r\n                      \"threshold\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"0\",\r\n                        \"metadata\": {\r\n                          \"description\": \"The threshold value at which the alert is activated.\"\r\n                        }\r\n                      },\r\n                      \"timeAggregation\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"Average\",\r\n                        \"allowedValues\": [\r\n                          \"Average\",\r\n                          \"Minimum\",\r\n                          \"Maximum\",\r\n                          \"Total\"\r\n                        ],\r\n                        \"metadata\": {\r\n                          \"description\": \"How the data that is collected should be combined over time.\"\r\n                        }\r\n                      },\r\n                      \"windowSize\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"PT5M\",\r\n                        \"metadata\": {\r\n                          \"description\": \"Period of time used to monitor alert activity based on the threshold. Must be between five minutes and one day. ISO 8601 duration format.\"\r\n                        }\r\n                      },\r\n                      \"evaluationFrequency\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"PT1M\",\r\n                        \"metadata\": {\r\n                          \"description\": \"how often the metric alert is evaluated represented in ISO 8601 duration format\"\r\n                        }\r\n                      },\r\n                      \"actionGroupId\": {\r\n                        \"type\": \"string\",\r\n                        \"defaultValue\": \"\",\r\n                        \"metadata\": {\r\n                          \"description\": \"The ID of the action group that is triggered when the alert is activated or deactivated\"\r\n                        }\r\n                      },\r\n                      \"resourceType\": {\r\n                        \"type\": \"string\",\r\n                        \"metadata\": {\r\n                          \"description\": \"The resource type of target resource.\"\r\n                        }\r\n                      },\r\n                      \"targetResourceName\": {\r\n                        \"type\": \"string\",\r\n                        \"metadata\": {\r\n                          \"description\": \"The target resource name.\"\r\n                        }\r\n                      }\r\n                    },\r\n                    \"variables\": {\r\n                      \"targetResourceType\": \"[parameters('resourceType')]\",\r\n                      \"resourceIdentifier\": \"[resourceId(variables('targetResourceType'), parameters('targetResourceName'))]\",\r\n                      \"alertName\": \"[concat(parameters('alertNamePrefix'), '-', resourcegroup().name, '-',  parameters('targetResourceName'))]\"\r\n                    },\r\n                    \"resources\": [\r\n                      {\r\n                        \"name\": \"[variables('alertName')]\",\r\n                        \"type\": \"Microsoft.Insights/metricAlerts\",\r\n                        \"location\": \"global\",\r\n                        \"apiVersion\": \"2018-03-01\",\r\n                        \"tags\": {},\r\n                        \"properties\": {\r\n                          \"description\": \"[parameters('alertDescription')]\",\r\n                          \"severity\": \"[parameters('alertSeverity')]\",\r\n                          \"enabled\": \"[parameters('isEnabled')]\",\r\n                          \"scopes\": [\r\n                            \"[variables('resourceIdentifier')]\"\r\n                          ],\r\n                          \"evaluationFrequency\": \"[parameters('evaluationFrequency')]\",\r\n                          \"windowSize\": \"[parameters('windowSize')]\",\r\n                          \"criteria\": {\r\n                            \"odata.type\": \"Microsoft.Azure.Monitor.SingleResourceMultipleMetricCriteria\",\r\n                            \"allOf\": [\r\n                              {\r\n                                \"name\": \"1st criterion\",\r\n                                \"metricName\": \"[parameters('metricName')]\",\r\n                                \"dimensions\": [],\r\n                                \"operator\": \"[parameters('operator')]\",\r\n                                \"threshold\": \"[parameters('threshold')]\",\r\n                                \"timeAggregation\": \"[parameters('timeAggregation')]\"\r\n                              }\r\n                            ]\r\n                          },\r\n                          \"actions\": [\r\n                            {\r\n                              \"actionGroupId\": \"[parameters('actionGroupId')]\"\r\n                            }\r\n                          ]\r\n                        }\r\n                      }\r\n                    ]\r\n                  },\r\n                  \"parameters\": {\r\n                    \"alertNamePrefix\": {\r\n                      \"value\": \"[parameters('alertNamePrefix')]\"\r\n                    },\r\n                    \"alertDescription\": {\r\n                      \"value\": \"[parameters('alertDescription')]\"\r\n                    },\r\n                    \"alertSeverity\": {\r\n                      \"value\": \"[parameters('alertSeverity')]\"\r\n                    },\r\n                    \"isEnabled\": {\r\n                      \"value\": \"[parameters('isEnabled')]\"\r\n                    },\r\n                    \"metricName\": {\r\n                      \"value\": \"[parameters('metricName')]\"\r\n                    },\r\n                    \"operator\": {\r\n                      \"value\": \"[parameters('operator')]\"\r\n                    },\r\n                    \"threshold\": {\r\n                      \"value\": \"[parameters('threshold')]\"\r\n                    },\r\n                    \"timeAggregation\": {\r\n                      \"value\": \"[parameters('timeAggregation')]\"\r\n                    },\r\n                    \"windowSize\": {\r\n                      \"value\": \"[parameters('windowSize')]\"\r\n                    },\r\n                    \"evaluationFrequency\": {\r\n                      \"value\": \"[parameters('evaluationFrequency')]\"\r\n                    },\r\n                    \"actionGroupId\": {\r\n                      \"value\": \"[parameters('actionGroupId')]\"\r\n                    },\r\n                    \"resourceType\": {\r\n                      \"value\": \"[parameters('resourceType')]\"\r\n                    },\r\n                    \"targetResourceName\": {\r\n                      \"value\": \"[field('name')]\"\r\n                    }\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/testSandipsh.draft\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"testSandipsh.draft\"\r\n    },\r\n    {\r\n      \"properties\": {\r\n        \"displayName\": \"testtest\",\r\n        \"policyType\": \"Custom\",\r\n        \"description\": \"testtest\",\r\n        \"parameters\": {\r\n          \"tagName\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"The name for the tag\",\r\n              \"description\": \"The name for the tag.\"\r\n            },\r\n            \"allowedValues\": []\r\n          },\r\n          \"tagValue\": {\r\n            \"type\": \"String\",\r\n            \"metadata\": {\r\n              \"displayName\": \"The value for the tag\",\r\n              \"description\": \"The value for the tag\"\r\n            },\r\n            \"allowedValues\": []\r\n          }\r\n        },\r\n        \"policyRule\": {\r\n          \"if\": {\r\n            \"not\": {\r\n              \"field\": \"[concat('tags.',parameters('tagName'))]\",\r\n              \"equals\": \"[parameters('tagValue')]\"\r\n            }\r\n          },\r\n          \"then\": {\r\n            \"effect\": \"audit\"\r\n          }\r\n        }\r\n      },\r\n      \"id\": \"/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/testtest\",\r\n      \"type\": \"Microsoft.Authorization/policyDefinitions\",\r\n      \"name\": \"testtest\"\r\n    }\r\n  ]\r\n}",
      "StatusCode": 200
    },
    {
      "RequestUri": "/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policydefinitions/someName?api-version=2018-05-01",
      "EncodedRequestUri": "L3N1YnNjcmlwdGlvbnMvZDA2MTBiMjctOTY2My00YzA1LTg5ZjgtNWI0YmUwMWU4NmE1L3Byb3ZpZGVycy9NaWNyb3NvZnQuQXV0aG9yaXphdGlvbi9wb2xpY3lkZWZpbml0aW9ucy9zb21lTmFtZT9hcGktdmVyc2lvbj0yMDE4LTA1LTAx",
      "RequestMethod": "GET",
      "RequestBody": "",
      "RequestHeaders": {
        "User-Agent": [
          "AzurePowershell/v1.0.0",
          "PSVersion/v6.1.0"
        ],
        "ParameterSetName": [
          "NameParameterSet"
        ],
        "CommandName": [
          "Set-AzPolicyDefinition"
        ]
      },
      "ResponseHeaders": {
        "Cache-Control": [
          "no-cache"
        ],
        "Pragma": [
          "no-cache"
        ],
        "x-ms-request-id": [
          "westus2:2bba5fda-48a4-4ba3-a86a-3b4caf7063bd"
        ],
        "x-ms-ratelimit-remaining-subscription-reads": [
          "11989"
        ],
        "x-ms-correlation-request-id": [
          "6b057f7a-ded3-4430-81fd-8299504ac4aa"
        ],
        "x-ms-routing-request-id": [
          "WESTUS2:20181220T213813Z:6b057f7a-ded3-4430-81fd-8299504ac4aa"
        ],
        "Strict-Transport-Security": [
          "max-age=31536000; includeSubDomains"
        ],
        "X-Content-Type-Options": [
          "nosniff"
        ],
        "Date": [
          "Thu, 20 Dec 2018 21:38:12 GMT"
        ],
        "Content-Length": [
          "110"
        ],
        "Content-Type": [
          "application/json; charset=utf-8"
        ],
        "Expires": [
          "-1"
        ],
        "Retry-After": [
          "0"
        ]
      },
      "ResponseBody": "{\r\n  \"error\": {\r\n    \"code\": \"PolicyDefinitionNotFound\",\r\n    \"message\": \"The policy definition 'someName' could not be found.\"\r\n  }\r\n}",
      "StatusCode": 404
    },
    {
      "RequestUri": "/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policydefinitions/someName?api-version=2018-05-01",
      "EncodedRequestUri": "L3N1YnNjcmlwdGlvbnMvZDA2MTBiMjctOTY2My00YzA1LTg5ZjgtNWI0YmUwMWU4NmE1L3Byb3ZpZGVycy9NaWNyb3NvZnQuQXV0aG9yaXphdGlvbi9wb2xpY3lkZWZpbml0aW9ucy9zb21lTmFtZT9hcGktdmVyc2lvbj0yMDE4LTA1LTAx",
      "RequestMethod": "GET",
      "RequestBody": "",
      "RequestHeaders": {
        "User-Agent": [
          "AzurePowershell/v1.0.0",
          "PSVersion/v6.1.0"
        ],
        "ParameterSetName": [
          "SubscriptionIdParameterSet"
        ],
        "CommandName": [
          "Set-AzPolicyDefinition"
        ]
      },
      "ResponseHeaders": {
        "Cache-Control": [
          "no-cache"
        ],
        "Pragma": [
          "no-cache"
        ],
        "x-ms-request-id": [
          "westus2:2869ad45-9d57-4c94-9150-be35e2606455"
        ],
        "x-ms-ratelimit-remaining-subscription-reads": [
          "11993"
        ],
        "x-ms-correlation-request-id": [
          "f60d2a50-ad55-4fb4-b6f7-0f10b4666506"
        ],
        "x-ms-routing-request-id": [
          "WESTUS2:20181220T213813Z:f60d2a50-ad55-4fb4-b6f7-0f10b4666506"
        ],
        "Strict-Transport-Security": [
          "max-age=31536000; includeSubDomains"
        ],
        "X-Content-Type-Options": [
          "nosniff"
        ],
        "Date": [
          "Thu, 20 Dec 2018 21:38:13 GMT"
        ],
        "Content-Length": [
          "110"
        ],
        "Content-Type": [
          "application/json; charset=utf-8"
        ],
        "Expires": [
          "-1"
        ],
        "Retry-After": [
          "0"
        ]
      },
      "ResponseBody": "{\r\n  \"error\": {\r\n    \"code\": \"PolicyDefinitionNotFound\",\r\n    \"message\": \"The policy definition 'someName' could not be found.\"\r\n  }\r\n}",
      "StatusCode": 404
    },
    {
      "RequestUri": "/providers/Microsoft.Management/managementgroups/someManagementGroup/providers/Microsoft.Authorization/policydefinitions/someName?api-version=2018-05-01",
      "EncodedRequestUri": "L3Byb3ZpZGVycy9NaWNyb3NvZnQuTWFuYWdlbWVudC9tYW5hZ2VtZW50Z3JvdXBzL3NvbWVNYW5hZ2VtZW50R3JvdXAvcHJvdmlkZXJzL01pY3Jvc29mdC5BdXRob3JpemF0aW9uL3BvbGljeWRlZmluaXRpb25zL3NvbWVOYW1lP2FwaS12ZXJzaW9uPTIwMTgtMDUtMDE=",
      "RequestMethod": "GET",
      "RequestBody": "",
      "RequestHeaders": {
        "User-Agent": [
          "AzurePowershell/v1.0.0",
          "PSVersion/v6.1.0"
        ],
        "ParameterSetName": [
          "ManagementGroupNameParameterSet"
        ],
        "CommandName": [
          "Set-AzPolicyDefinition"
        ]
      },
      "ResponseHeaders": {
        "Cache-Control": [
          "no-cache"
        ],
        "Pragma": [
          "no-cache"
        ],
        "x-ms-request-id": [
          "westus2:568293bd-c61c-465e-b5fa-0eb74a8178b2"
        ],
        "x-ms-ratelimit-remaining-tenant-reads": [
          "11995"
        ],
        "x-ms-correlation-request-id": [
          "da962e1b-a3e4-4e83-9ce8-a6f99c92343c"
        ],
        "x-ms-routing-request-id": [
          "WESTUS2:20181220T213813Z:da962e1b-a3e4-4e83-9ce8-a6f99c92343c"
        ],
        "Strict-Transport-Security": [
          "max-age=31536000; includeSubDomains"
        ],
        "X-Content-Type-Options": [
          "nosniff"
        ],
        "Date": [
          "Thu, 20 Dec 2018 21:38:13 GMT"
        ],
        "Content-Length": [
          "110"
        ],
        "Content-Type": [
          "application/json; charset=utf-8"
        ],
        "Expires": [
          "-1"
        ],
        "Retry-After": [
          "0"
        ]
      },
      "ResponseBody": "{\r\n  \"error\": {\r\n    \"code\": \"PolicyDefinitionNotFound\",\r\n    \"message\": \"The policy definition 'someName' could not be found.\"\r\n  }\r\n}",
      "StatusCode": 404
    },
    {
      "RequestUri": "/subscriptions/d0610b27-9663-4c05-89f8-5b4be01e86a5/providers/Microsoft.Authorization/policyDefinitions/someName?api-version=2018-05-01",
      "EncodedRequestUri": "L3N1YnNjcmlwdGlvbnMvZDA2MTBiMjctOTY2My00YzA1LTg5ZjgtNWI0YmUwMWU4NmE1L3Byb3ZpZGVycy9NaWNyb3NvZnQuQXV0aG9yaXphdGlvbi9wb2xpY3lEZWZpbml0aW9ucy9zb21lTmFtZT9hcGktdmVyc2lvbj0yMDE4LTA1LTAx",
      "RequestMethod": "GET",
      "RequestBody": "",
      "RequestHeaders": {
        "User-Agent": [
          "AzurePowershell/v1.0.0",
          "PSVersion/v6.1.0"
        ],
        "ParameterSetName": [
          "IdParameterSet"
        ],
        "CommandName": [
          "Set-AzPolicyDefinition"
        ]
      },
      "ResponseHeaders": {
        "Cache-Control": [
          "no-cache"
        ],
        "Pragma": [
          "no-cache"
        ],
        "x-ms-request-id": [
          "westus2:d0105ef9-5f88-41df-b820-3097d5caf4fc"
        ],
        "x-ms-ratelimit-remaining-subscription-reads": [
          "11988"
        ],
        "x-ms-correlation-request-id": [
          "ddd9b393-a09a-4283-813d-46a5099dea85"
        ],
        "x-ms-routing-request-id": [
          "WESTUS2:20181220T213813Z:ddd9b393-a09a-4283-813d-46a5099dea85"
        ],
        "Strict-Transport-Security": [
          "max-age=31536000; includeSubDomains"
        ],
        "X-Content-Type-Options": [
          "nosniff"
        ],
        "Date": [
          "Thu, 20 Dec 2018 21:38:12 GMT"
        ],
        "Content-Length": [
          "110"
        ],
        "Content-Type": [
          "application/json; charset=utf-8"
        ],
        "Expires": [
          "-1"
        ],
        "Retry-After": [
          "0"
        ]
      },
      "ResponseBody": "{\r\n  \"error\": {\r\n    \"code\": \"PolicyDefinitionNotFound\",\r\n    \"message\": \"The policy definition 'someName' could not be found.\"\r\n  }\r\n}",
      "StatusCode": 404
    }
  ],
  "Names": {},
  "Variables": {
    "SubscriptionId": "d0610b27-9663-4c05-89f8-5b4be01e86a5"
  }
}