{
  "New-AzSentinelEntityQuery+[NoContext]+CreateExpanded+$PUT+https://management.azure.com/subscriptions/1c61ccbf-70b3-45a3-a1fb-848ce46d70a6/resourceGroups/aspstest91v7fr/providers/Microsoft.OperationalInsights/workspaces/asptest8xu4wd/providers/Microsoft.SecurityInsights/entityQueries/56959909-d6b6-4cf1-95b3-6c86f0a7dc5e?api-version=2021-09-01-preview+1": {
    "Request": {
      "Method": "PUT",
      "RequestUri": "https://management.azure.com/subscriptions/1c61ccbf-70b3-45a3-a1fb-848ce46d70a6/resourceGroups/aspstest91v7fr/providers/Microsoft.OperationalInsights/workspaces/asptest8xu4wd/providers/Microsoft.SecurityInsights/entityQueries/56959909-d6b6-4cf1-95b3-6c86f0a7dc5e?api-version=2021-09-01-preview",
      "Content": "{\n  \"kind\": \"Activity\",\n  \"properties\": {\n    \"queryDefinitions\": {\n      \"query\": \"let UserConsentToApplication = (Account_Name:string, Account_UPNSuffix:string, Account_AadUserId:string){\\r\\n            let account_upn = iff(Account_Name != \\\"\\\" and Account_UPNSuffix != \\\"\\\", strcat(Account_Name,\\\"@\\\",Account_UPNSuffix),\\\"\\\" );\\r\\n            AuditLogs\\r\\n            | where OperationName == \\\"Consent to application\\\"\\r\\n            | extend Source_Account_UPNSuffix = tostring(todynamic(InitiatedBy) [\\\"user\\\"][\\\"userPrincipalName\\\"]), Source_Account_AadUserId = tostring(todynamic(InitiatedBy) [\\\"user\\\"][\\\"id\\\"])\\r\\n            | where (account_upn != \\\"\\\" and account_upn =~ Source_Account_UPNSuffix) \\r\\n            or (Account_AadUserId != \\\"\\\" and Account_AadUserId =~ Source_Account_AadUserId)\\r\\n            | extend Target_CloudApplication_Name = tostring(todynamic(TargetResources)[0][\\\"displayName\\\"]), Target_CloudApplication_AppId = tostring(todynamic(TargetResources)[0][\\\"id\\\"])\\r\\n            };\\r\\n            UserConsentToApplication(\\u0027{{Account_Name}}\\u0027, \\u0027{{Account_UPNSuffix}}\\u0027, \\u0027{{Account_AadUserId}}\\u0027)  \\r\\n            | project Target_CloudApplication_AppId, Target_CloudApplication_Name, TimeGenerated\"\n    },\n    \"title\": \"The user consented to OAuth application\",\n    \"content\": \"The user consented to the OAuth application named {{Target_CloudApplication_Name}} {{Count}} time(s)\",\n    \"description\": \"This activity lists user\\u0027s consents to an OAuth applications.\",\n    \"inputEntityType\": \"Account\"\n  }\n}",
      "isContentBase64": false,
      "Headers": {
      },
      "ContentHeaders": {
        "Content-Type": [ "application/json" ],
        "Content-Length": [ "1571" ]
      }
    },
    "Response": {
      "StatusCode": 201,
      "Headers": {
        "Cache-Control": [ "no-cache" ],
        "Pragma": [ "no-cache" ],
        "Server": [ "Kestrel" ],
        "x-ms-ratelimit-remaining-subscription-writes": [ "1193" ],
        "x-ms-request-id": [ "8b652823-01cc-42b7-88c7-36b658aaa3bb" ],
        "x-ms-correlation-request-id": [ "8b652823-01cc-42b7-88c7-36b658aaa3bb" ],
        "x-ms-routing-request-id": [ "WESTUS2:20211212T020726Z:8b652823-01cc-42b7-88c7-36b658aaa3bb" ],
        "Strict-Transport-Security": [ "max-age=31536000; includeSubDomains" ],
        "X-Content-Type-Options": [ "nosniff" ],
        "Date": [ "Sun, 12 Dec 2021 02:07:26 GMT" ]
      },
      "ContentHeaders": {
        "Content-Length": [ "2034" ],
        "Content-Type": [ "application/json; charset=utf-8" ],
        "Expires": [ "-1" ]
      },
      "Content": "{\"id\":\"/subscriptions/1c61ccbf-70b3-45a3-a1fb-848ce46d70a6/resourceGroups/aspstest91v7fr/providers/Microsoft.OperationalInsights/workspaces/asptest8xu4wd/providers/Microsoft.SecurityInsights/entityQueries/56959909-d6b6-4cf1-95b3-6c86f0a7dc5e\",\"name\":\"56959909-d6b6-4cf1-95b3-6c86f0a7dc5e\",\"etag\":\"\\\"5101f127-0000-0100-0000-61b5595e0000\\\"\",\"type\":\"Microsoft.SecurityInsights/entityQueries\",\"kind\":\"Activity\",\"properties\":{\"title\":\"The user consented to OAuth application\",\"content\":\"The user consented to the OAuth application named {{Target_CloudApplication_Name}} {{Count}} time(s)\",\"description\":\"This activity lists user\u0027s consents to an OAuth applications.\",\"queryDefinitions\":{\"query\":\"let UserConsentToApplication = (Account_Name:string, Account_UPNSuffix:string, Account_AadUserId:string){\\r\\n            let account_upn = iff(Account_Name != \\\"\\\" and Account_UPNSuffix != \\\"\\\", strcat(Account_Name,\\\"@\\\",Account_UPNSuffix),\\\"\\\" );\\r\\n            AuditLogs\\r\\n            | where OperationName == \\\"Consent to application\\\"\\r\\n            | extend Source_Account_UPNSuffix = tostring(todynamic(InitiatedBy) [\\\"user\\\"][\\\"userPrincipalName\\\"]), Source_Account_AadUserId = tostring(todynamic(InitiatedBy) [\\\"user\\\"][\\\"id\\\"])\\r\\n            | where (account_upn != \\\"\\\" and account_upn =~ Source_Account_UPNSuffix) \\r\\n            or (Account_AadUserId != \\\"\\\" and Account_AadUserId =~ Source_Account_AadUserId)\\r\\n            | extend Target_CloudApplication_Name = tostring(todynamic(TargetResources)[0][\\\"displayName\\\"]), Target_CloudApplication_AppId = tostring(todynamic(TargetResources)[0][\\\"id\\\"])\\r\\n            };\\r\\n            UserConsentToApplication(\u0027{{Account_Name}}\u0027, \u0027{{Account_UPNSuffix}}\u0027, \u0027{{Account_AadUserId}}\u0027)  \\r\\n            | project Target_CloudApplication_AppId, Target_CloudApplication_Name, TimeGenerated\"},\"requiredInputFieldsSets\":[],\"entitiesFilter\":{},\"enabled\":true,\"createdTimeUtc\":\"2021-12-12T02:07:26.3377287Z\",\"lastModifiedTimeUtc\":\"2021-12-12T02:07:26.3377287Z\",\"inputEntityType\":\"Account\"}}",
      "isContentBase64": false
    }
  }
}