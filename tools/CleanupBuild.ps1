[CmdletBinding()]
Param
(
    [Parameter()]
    [string]$BuildConfig
)

$output = Join-Path (Get-Item $PSScriptRoot).Parent.FullName "artifacts\$BuildConfig\net452"
Write-Verbose "The output folder is set to $output"

Write-Verbose "Removing generated NuGet folders from $output"
$resourcesFolders = @("de", "es", "fr", "it", "ja", "ko", "ru", "zh-Hans", "zh-Hant", "cs", "pl", "pt-BR", "tr")
Get-ChildItem -Include $resourcesFolders -Recurse -Force -Path $output | Remove-Item -Force -Recurse -ErrorAction SilentlyContinue

Write-Verbose "Removing autogenerated XML help files, code analysis, config files, and symbols."
$exclude = @("*.dll-Help.xml", "Scaffold.xml", "RoleSettings.xml", "WebRole.xml", "WorkerRole.xml")
$include = @("*.xml", "*.lastcodeanalysissucceeded", "*.dll.config", "*.pdb")
Get-ChildItem -Include $include -Exclude $exclude -Recurse -Path $output | Remove-Item -Force -Recurse
Get-ChildItem -Recurse -Path $output -Include *.dll-Help.psd1 | Remove-Item -Force

Write-Verbose "Removing markdown help files and folders"
Get-ChildItem -Recurse -Path $output -Include *.md | Remove-Item -Force -Confirm:$false
Get-ChildItem -Directory -Include help -Recurse -Path $output | Remove-Item -Force -Confirm:$false -ErrorAction "Ignore"

Write-Verbose "Removing unneeded web deployment dependencies"
$webdependencies = @("Microsoft.Web.Hosting.dll", "Microsoft.Web.Delegation.dll", "Microsoft.Web.Administration.dll", "Microsoft.Web.Deployment.Tracing.dll")
Get-ChildItem -Include $webdependencies -Recurse -Path $output | Remove-Item -Force
