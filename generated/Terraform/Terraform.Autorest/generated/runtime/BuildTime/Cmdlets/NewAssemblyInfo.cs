/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/
using System;
using System.IO;
using System.Linq;
using System.Management.Automation;
using System.Text;

namespace Microsoft.Azure.PowerShell.Cmdlets.Terraform.Runtime.PowerShell
{
    [Cmdlet("New", "AssemblyInfo")]
    [DoNotExport]
    public class NewAssemblyInfo : PSCmdlet
    {
        private readonly string assemblyInfoPath = Path.Combine(".", "Properties", "AssemblyInfo.cs");
        private const string assemblyName = "Terraform";
        private const string assemblyVersion = "0.1.0";
        private const string assemblyCompanyName = "";
        private const string assemblyProduct = "";
        private const string assemblyCopyright = "";
        protected override void ProcessRecord()
        {
            try
            {
                if (File.Exists(assemblyInfoPath))
                {
                    return;
                }
                StringBuilder sb = new StringBuilder();
                sb.AppendLine(@"
# ----------------------------------------------------------------------------------
# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the Apache License, Version 2.0 (the ""License"");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# http://www.apache.org/licenses/LICENSE-2.0
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an ""AS IS"" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# Code generated by Microsoft (R) AutoRest Code Generator.Changes may cause incorrect behavior and will be lost if the code
# is regenerated.
# ----------------------------------------------------------------------------------
");
                sb.Append($"{Environment.NewLine}");
                sb.AppendLine("using System;");
                sb.AppendLine("using System.Reflection;");
                sb.AppendLine("using System.Runtime.InteropServices;");
                sb.Append($"{Environment.NewLine}");
                sb.AppendLine($"[assembly: AssemblyTitle(\"Microsoft Azure Powershell - {assemblyName}\")]");
                sb.AppendLine($"[assembly: AssemblyCompany(\"{assemblyCompanyName}\")]");
                sb.AppendLine($"[assembly: AssemblyProduct(\"{assemblyProduct}\")]");
                sb.AppendLine($"[assembly: AssemblyCopyright(\"{assemblyCopyright}\")]");
                sb.Append($"{Environment.NewLine}");
                sb.AppendLine("[assembly: ComVisible(false)]");
                sb.AppendLine("[assembly: CLSCompliant(false)]");
                sb.AppendLine($"[assembly: Guid(\"{Guid.NewGuid()}\")]");
                sb.AppendLine($"[assembly: AssemblyVersion(\"{assemblyVersion}\")]");
                sb.Append($"[assembly: AssemblyFileVersion(\"{assemblyVersion}\")]");

                FileInfo assemblyInfo = new FileInfo(assemblyInfoPath);
                assemblyInfo.Directory.Create();
                File.WriteAllText(assemblyInfo.FullName, sb.ToString());
            }
            catch (Exception ee)
            {
                Console.WriteLine($"${ee.GetType().Name}/{ee.StackTrace}");
                throw ee;
            }
        }
    }
}