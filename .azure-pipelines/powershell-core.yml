variables:
  WindowsName: windows
  WindowsImage: vs2017-win2016
  LinuxName: linux
  LinuxImage: ubuntu-18.04
  MacOSName: macOS
  MacOSImage: macOS-10.13
  TestFramework: netcoreapp2.1
  TestTarget: Test
  Configuration: Debug

jobs:
- job: Build
  displayName: Build
  condition: succeeded()
  strategy:
    matrix:
      windows:
        OSName: $(WindowsName)
        ImageName: $(WindowsImage)
      linux:
        OSName: $(LinuxName)
        ImageName: $(LinuxImage)
      macOS:
        OSName: $(MacOSName)
        ImageName: $(MacOSImage)
  pool:
    vmImage: $(ImageName)

  steps:
  - template: util/build-steps.yml
    parameters:
      osName: $(OSName)
      testFramework: $(TestFramework)
      configuration: $(Configuration)

- job: Analyze
  displayName: Analyze
  dependsOn: Build
  condition: succeeded()
  strategy:
    matrix:
      windows:
        OSName: $(WindowsName)
        ImageName: $(WindowsImage)
      linux:
        OSName: $(LinuxName)
        ImageName: $(LinuxImage)
      macOS:
        OSName: $(MacOSName)
        ImageName: $(MacOSImage)
  pool:
    vmImage: $(ImageName)

  steps:
  - template: util/analyze-steps.yml
    parameters:
      osName: $(OSName)
      configuration: $(Configuration)

- job: Test
  displayName: Test
  dependsOn: Build
  condition: succeeded()
  timeoutInMinutes: 120
  strategy:
    matrix:
      windows:
        OSName: $(WindowsName)
        ImageName: $(WindowsImage)
      linux:
        OSName: $(LinuxName)
        ImageName: $(LinuxImage)
      macOS:
        OSName: $(MacOSName)
        ImageName: $(MacOSImage)
  pool:
    vmImage: $(ImageName)

  steps:
  - template: util/test-steps.yml
    parameters:
      osName: $(OSName)
      testFramework: $(TestFramework)
      testTarget: $(TestTarget)
      configuration: $(Configuration)
